"use strict";var AnimationSystem,AsteroidDeathView,AsteroidView,AudioSystem,BackgroundView,BulletAgeSystem,BulletView,CollisionSystem,Components,DeathThroesSystem,Dot,DpadController,Entities,FireButton,FixedPhysicsSystem,Game,GameController,GameManager,GunControlSystem,HudSystem,HudView,KeyPoll,MersenneTwister,Nodes,Point,Properties,RenderSystem,ShipControlSystem,Sound,SpaceshipDeathView,SpaceshipView,SpriteAsteroid,SpriteBullet,SpriteSpaceship,SystemPriorities,TouchableArea,TouchableButton,TouchableCircle,TouchableDirection,TouchableJoystick,WaitForStartSystem,WaitForStartView,WarpButton,res,__bind=function(a,b){return function(){return a.apply(b,arguments)}},__hasProp={}.hasOwnProperty,__extends=function(a,b){function c(){this.constructor=a}for(var d in b)__hasProp.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a};res={fb_login:"res/images/fb-login.png",dialog_blue:"res/images/dialog-box.png",dialog_star:"res/images/black-dialog.png",button_blue:"res/images/standard-button-on.png",button_star:"res/images/black-button-on.png",background:"res/images/BackdropBlackLittleSparkBlack.png",leaderboard:"res/icons/b_Leaderboard.png",settings:"res/icons/b_Parameters.png",round:"res/images/round48.png",square:"res/images/square48.png",touchorigin:"res/images/touchorigin.png",touchend:"res/images/touchend.png",fire:"res/fire.png",warp:"res/warp.png"},SpriteBullet=1,SpriteAsteroid=2,SpriteSpaceship=3,GameController=function(){var a;return a=function(b,c){var d,e,f,g,h,i;if(g=!0,"boolean"==typeof b&&(g=b),"object"!=typeof b&&"function"!=typeof b&&(b={}),i=c)for(h in i)c=b[h],e=i[h],b!==e&&(g&&("object"==typeof e||(f="[object Array]"===Object.prototype.toString.call(e)))?(f?(f=!1,d=c&&"[object Array]"===Object.prototype.toString.call(c)?c:[]):d=c&&"object"==typeof c?c:{},b[h]=a(d,e)):"undefined"!=typeof e&&(b[h]=e));return b},GameController={options:{left:{type:"dpad",position:{left:"13%",bottom:"22%"},dpad:{up:{width:"7%",height:"15%",stroke:2,touchStart:function(){GameController.simulateKeyEvent("press",38),GameController.simulateKeyEvent("down",38)},touchEnd:function(){GameController.simulateKeyEvent("up",38)}},left:{width:"15%",height:"7%",stroke:2,touchStart:function(){GameController.simulateKeyEvent("press",37),GameController.simulateKeyEvent("down",37)},touchEnd:function(){GameController.simulateKeyEvent("up",37)}},down:{width:"7%",height:"15%",stroke:2,touchStart:function(){GameController.simulateKeyEvent("press",40),GameController.simulateKeyEvent("down",40)},touchEnd:function(){GameController.simulateKeyEvent("up",40)}},right:{width:"15%",height:"7%",stroke:2,touchStart:function(){GameController.simulateKeyEvent("press",39),GameController.simulateKeyEvent("down",39)},touchEnd:function(){GameController.simulateKeyEvent("up",39)}}},joystick:{radius:60,touchMove:function(a){console.log(a)}}},right:{type:"buttons",position:{right:"17%",bottom:"28%"},buttons:[{offset:{x:"-13%",y:0},label:"X",radius:"7%",stroke:2,backgroundColor:"blue",fontColor:"#fff",touchStart:function(){GameController.simulateKeyEvent("press",88),GameController.simulateKeyEvent("down",88)},touchEnd:function(){GameController.simulateKeyEvent("up",88)}},{offset:{x:0,y:"-11%"},label:"Y",radius:"7%",stroke:2,backgroundColor:"yellow",fontColor:"#fff",touchStart:function(){GameController.simulateKeyEvent("press",70),GameController.simulateKeyEvent("down",70)},touchEnd:function(){GameController.simulateKeyEvent("up",70)}},{offset:{x:"13%",y:0},label:"B",radius:"7%",stroke:2,backgroundColor:"red",fontColor:"#fff",touchStart:function(){GameController.simulateKeyEvent("press",90),GameController.simulateKeyEvent("down",90)},touchEnd:function(){GameController.simulateKeyEvent("up",90)}},{offset:{x:0,y:"11%"},label:"A",radius:"7%",stroke:2,backgroundColor:"green",fontColor:"#fff",touchStart:function(){GameController.simulateKeyEvent("press",67),GameController.simulateKeyEvent("down",67)},touchEnd:function(){GameController.simulateKeyEvent("up",67)}}],dpad:{up:{width:"7%",height:"15%",stroke:2},left:{width:"15%",height:"7%",stroke:2},down:{width:"7%",height:"15%",stroke:2},right:{width:"15%",height:"7%",stroke:2}},joystick:{radius:60,touchMove:function(a){console.log(a)}}},touchRadius:45},touchableAreas:[],touchableAreasCount:0,touches:[],offsetX:0,offsetY:0,bound:{left:!1,right:!1,top:!1,bottom:!1},cachedSprites:{},paused:!1,game:null,init:function(b,c){var d;null==c&&(c={}),"ontouchstart"in document.documentElement&&(this.game=b,a(this.options,c),d=navigator.userAgent.toLowerCase(),this.performanceFriendly=-1!==d.indexOf("iphone")||-1!==d.indexOf("android")||this.options.forcePerformanceFriendly,this.createOverlayCanvas())},boundingSet:function(a){var b,c,d,e,f,g,h;a.width?(h=this.getPixels(a.width),c=this.getPixels(a.height),d=this.getPixels(a.x),g=this.getPixels(a.y)):(e=this.options.touchRadius?2*this.getPixels(a.radius)+this.getPixels(this.options.touchRadius)/2:a.radius,h=c=2*(e+this.getPixels(a.stroke)),d=this.getPixels(a.x)-h/2,g=this.getPixels(a.y)-c/2),f=d+h,b=g+c,(this.bound.left===!1||d<this.bound.left)&&(this.bound.left=d),(this.bound.right===!1||f>this.bound.right)&&(this.bound.right=f),(this.bound.top===!1||g<this.bound.top)&&(this.bound.top=g),(this.bound.bottom===!1||b>this.bound.bottom)&&(this.bound.bottom=b)},createOverlayCanvas:function(){this.setTouchEvents(),this.loadSide("left"),this.loadSide("right"),this.render(),this.touches&&0!==this.touches.length||(this.paused=!0)},pixelRatio:1,getPixels:function(a,b){return"undefined"==typeof a?0:"number"==typeof a?a:"x"===b?parseInt(a)/100*this.game.width:parseInt(a)/100*this.game.height},simulateKeyEvent:function(a,b){var c;return"undefined"==typeof window.onkeydown?!1:(c=document.createEvent("KeyboardEvent"),null!=c.initKeyboardEvent?c.initKeyboardEvent("key"+a,!0,!0,document.defaultView,!1,!1,!1,!1,b,b):c.initKeyEvent("key"+a,!0,!0,document.defaultView,!1,!1,!1,!1,b,b),void(c.keyCodeVal=b))},setTouchEvents:function(){},addTouchableDirection:function(a){var b;b=new TouchableDirection(this,a),b.id=this.touchableAreas.push(b),this.touchableAreasCount++,this.boundingSet(a)},addJoystick:function(a){var b;b=new TouchableJoystick(this,a),b.id=this.touchableAreas.push(b),this.touchableAreasCount++,this.boundingSet(a)},addButton:function(a){var b;b=new TouchableButton(this,a),b.id=this.touchableAreas.push(b),this.touchableAreasCount++,this.boundingSet(a)},addTouchableArea:function(a,b){},loadButtons:function(a){var b,c,d,e,f;for(b=this.options[a].buttons,c=0,d=b.length;d>c;)"undefined"==typeof b[c]||"undefined"==typeof b[c].offset||(e=this.getPositionX(a),f=this.getPositionY(a),b[c].x=e+this.getPixels(b[c].offset.x,"y"),b[c].y=f+this.getPixels(b[c].offset.y,"y"),this.addButton(b[c])),c++},loadDPad:function(a){var b,c,d,e,f;c=this.options[a].dpad||{},e=this.getPositionX(a),f=this.getPositionY(a),(c.up&&c.left&&c.down&&c.right||c.background)&&(d={x:e,y:f,radius:c.right.height},b=new TouchableCircle(this,d),this.touchableAreas.push(b),this.touchableAreasCount++),c.up!==!1&&(c.up.x=e-this.getPixels(c.up.width,"y")/2,c.up.y=f-(this.getPixels(c.up.height,"y")+this.getPixels(c.left.height,"y")/2),c.up.direction="up",this.addTouchableDirection(c.up)),c.left!==!1&&(c.left.x=e-(this.getPixels(c.left.width,"y")+this.getPixels(c.up.width,"y")/2),c.left.y=f-this.getPixels(c.left.height,"y")/2,c.left.direction="left",this.addTouchableDirection(c.left)),c.down!==!1&&(c.down.x=e-this.getPixels(c.down.width,"y")/2,c.down.y=f+this.getPixels(c.left.height,"y")/2,c.down.direction="down",this.addTouchableDirection(c.down)),c.right!==!1&&(c.right.x=e+this.getPixels(c.up.width,"y")/2,c.right.y=f-this.getPixels(c.right.height,"y")/2,c.right.direction="right",this.addTouchableDirection(c.right))},loadJoystick:function(a){var b;b=this.options[a].joystick,b.x=this.getPositionX(a),b.y=this.getPositionY(a),this.addJoystick(b)},reloadSide:function(a){this.loadSide(a)},loadSide:function(a){"dpad"===this.options[a].type?this.loadDPad(a):"joystick"===this.options[a].type?this.loadJoystick(a):"buttons"===this.options[a].type&&this.loadButtons(a)},normalizeTouchPositionX:function(a){return(a-this.offsetX)*this.pixelRatio},normalizeTouchPositionY:function(a){return(a-this.offsetY)*this.pixelRatio},getXFromRight:function(a){return this.game.width-a},getYFromBottom:function(a){return this.game.height-a},getPositionX:function(a){return"undefined"!=typeof this.options[a].position.left?this.getPixels(this.options[a].position.left,"x"):this.getXFromRight(this.getPixels(this.options[a].position.right,"x"))},getPositionY:function(a){return"undefined"!=typeof this.options[a].position.top?this.getPixels(this.options[a].position.top,"y"):this.getYFromBottom(this.getPixels(this.options[a].position.bottom,"y"))},renderAreas:function(){var a,b,c,d,e,f,g,h,i;for(b=0,c=this.touchableAreasCount;c>b;)if(a=this.touchableAreas[b],"undefined"!=typeof a){for(a.draw(),g=!1,d=0,e=this.touches.length;e>d;)f=this.touches[d],"undefined"!=typeof f&&(h=this.normalizeTouchPositionX(f.clientX),i=this.normalizeTouchPositionY(f.clientY),a.check(h,i)!==!1&&(g||(g=this.touches[d])),d++);g?(a.active||a.touchStartWrapper(g),a.touchMoveWrapper(g)):a.active&&a.touchEndWrapper(g),b++}},render:function(){this.paused&&this.performanceFriendly||this.renderAreas(),this.ready=!0},renderWrapper:function(){GameController.render()}}}(),TouchableArea=function(){function a(a){this.controller=a}return a.prototype.touchStart=null,a.prototype.touchMove=null,a.prototype.touchEnd=null,a.prototype.type="area",a.prototype.id=!1,a.prototype.active=!1,a.prototype.setTouchStart=function(a){this.touchStart=a},a.prototype.touchStartWrapper=function(a){this.touchStart&&this.touchStart(),"function"==typeof this.setActive&&this.setActive(!0),this.active=!0},a.prototype.setTouchMove=function(a){this.touchMove=a},a.prototype.lastPosX=0,a.prototype.lastPosY=0,a.prototype.touchMoveWrapper=function(b,c){var d;d=b.getLocation(),!this.touchMove||d.x===a.prototype.lastPosX&&d.y===a.prototype.lastPosY||(this.touchMove(),this.lastPosX=d.x,this.lastPosY=d.y),this.active=!0,"function"==typeof this.setActive&&this.setActive(!0)},a.prototype.setTouchEnd=function(a){this.touchEnd=a},a.prototype.touchEndWrapper=function(a){this.touchEnd&&this.touchEnd(),this.active=!1,"function"==typeof this.setActive&&this.setActive(!1),this.controller.render()},a}(),TouchableButton=function(a){function b(a,c){this.setActive=__bind(this.setActive,this);var d,e;for(d in c)e=c[d],"x"===d?this[d]=a.getPixels(e,"x"):"x"===d||"radius"===d?this[d]=a.getPixels(e,"y"):this[d]=e;b.__super__.constructor.call(this,a),this.sprite=this.createSprite(a.game)}var c;return __extends(b,a),c=0,b.prototype.sprite=null,b.prototype.type="button",b.prototype.fontFamily="opendyslexic",b.prototype.id=-1,b.prototype.check=function(a,b){return Math.abs(a-this.x)<this.radius+this.controller.options.touchRadius/2&&Math.abs(b-this.y)<this.radius+this.controller.options.touchRadius/2?!0:!1},b.prototype.draw=function(){},b.prototype.setActive=function(a){this.sprite.alpha=a?1:.8},b.prototype.createSprite=function(a){var b,c,d,e,f;switch(b=a.add.bitmapData(2*(this.radius+this.stroke),2*(this.radius+this.stroke)),c=b.context,c.lineWidth=this.stroke,d=c.createRadialGradient(this.radius,this.radius,1,this.radius,this.radius,this.radius),f=void 0,this.backgroundColor||"white"){case"blue":d.addColorStop(0,"rgba(123, 181, 197, 0.6)"),d.addColorStop(1,"#105a78"),f="#0A4861";break;case"green":d.addColorStop(0,"rgba(29, 201, 36, 0.6)"),d.addColorStop(1,"#107814"),f="#085C0B";break;case"red":d.addColorStop(0,"rgba(165, 34, 34, 0.6)"),d.addColorStop(1,"#520101"),f="#330000";break;case"yellow":d.addColorStop(0,"rgba(219, 217, 59, 0.6)"),d.addColorStop(1,"#E8E10E"),f="#BDB600";break;case"white":d.addColorStop(0,"rgba( 255,255,255,.3 )"),d.addColorStop(1,"#eee")}return c.fillStyle=d,c.strokeStyle=f,c.beginPath(),c.arc(b.width/2,b.width/2,this.radius,0,2*Math.PI,!1),c.fill(),c.stroke(),this.label&&(c.fillStyle=f,c.font="bold "+(this.fontSize||.35*b.height)+"px "+this.fontFamily,c.textAlign="center",c.textBaseline="middle",c.fillText(this.label,b.height/2+2,b.height/2+2),c.fillStyle=this.fontColor,c.font="bold "+(this.fontSize||.35*b.height)+"px "+this.fontFamily,c.textAlign="center",c.textBaseline="middle",c.fillText(this.label,b.height/2,b.height/2)),e=a.add.sprite(this.x,this.y,b),e.alpha=.8,e.inputEnabled=!0,e.events.onInputDown.add(this.touchStartWrapper,this),e.events.onInputUp.add(this.touchEndWrapper,this),e},b}(TouchableArea),TouchableCircle=function(a){function b(a,c){var d,e;this.controller=a;for(d in c)e=c[d],"x"===d?this[d]=this.controller.getPixels(e,"x"):"x"===d||"radius"===d?this[d]=this.controller.getPixels(e,"y"):this[d]=e;this.sprite=this.createSprite(this.controller.game),b.__super__.constructor.call(this,this.controller)}return __extends(b,a),b.prototype.check=function(a,b){return!1},b.prototype.draw=function(){},b.prototype.createSprite=function(a){var b,c,d,e,f;return this.stroke=this.stroke||2,e=2*(this.radius+this.controller.options.touchRadius+this.stroke),b=a.add.bitmapData(e,e),c=b.context,d=c.createRadialGradient(0,0,1,0,0,this.radius),d.addColorStop(0,"rgba( 200,200,200,.2 )"),d.addColorStop(1,"rgba( 200,200,200,.4 )"),c.strokeStyle="rgba( 0,0,0,.4 )",c.fillStyle=d,c.beginPath(),c.arc(this.radius,this.radius,this.radius,0,2*Math.PI,!1),c.fill(),c.stroke(),f=a.add.sprite(this.x-this.radius,this.y-this.radius,b)},b}(TouchableArea),TouchableDirection=function(a){function b(a,c){var d,e;this.controller=a,this.setActive=__bind(this.setActive,this);for(d in c)e=c[d],"x"===d?this[d]=this.controller.getPixels(e,"x"):"y"===d||"height"===d||"width"===d?this[d]=this.controller.getPixels(e,"y"):this[d]=e;this.sprite=this.createSprite(this.controller.game),b.__super__.constructor.call(this,this.controller)}return __extends(b,a),b.prototype.bitmap=null,b.prototype.type="direction",b.prototype.check=function(a,b){return(Math.abs(a-this.x)<this.controller.options.touchRadius/2||a>this.x)&&(Math.abs(a-(this.x+this.width))<this.controller.options.touchRadius/2||a<this.x+this.width)&&(Math.abs(b-this.y)<this.controller.options.touchRadius/2||b>this.y)&&(Math.abs(b-(this.y+this.height))<this.controller.options.touchRadius/2||b<this.y+this.height)?!0:!1},b.prototype.draw=function(){},b.prototype.setActive=function(a){this.sprite.alpha=a?.9:.45},b.prototype.createSprite=function(a){var b,c,d,e;switch(d=null,b=this.controller.game.add.bitmapData(2*this.width+this.stroke,2*this.height+this.stroke),c=b.context,this.direction||"down"){case"up":d=c.createLinearGradient(0,0,0,this.height),d.addColorStop(0,"rgba( 0, 0, 0, 0.45)"),d.addColorStop(1,"rgba( 0, 0, 0, 0.90)");break;case"left":d=c.createLinearGradient(0,0,this.width,0),d.addColorStop(0,"rgba( 0, 0, 0, 0.45)"),d.addColorStop(1,"rgba( 0, 0, 0, 0.90)");break;case"right":d=c.createLinearGradient(0,0,this.width,0),d.addColorStop(0,"rgba( 0, 0, 0, 0.45)"),d.addColorStop(1,"rgba( 0, 0, 0, 0.90)");break;case"down":d=c.createLinearGradient(0,0,0,this.height),d.addColorStop(0,"rgba( 0, 0, 0, 0.45)"),d.addColorStop(1,"rgba( 0, 0, 0, 0.90)")}return c.fillStyle=d,c.fillRect(0,0,this.width,this.height),c.lineWidth=this.stroke,c.strokeStyle="rgba( 255, 255, 255, 0.1 )",c.strokeRect(0,0,this.width,this.height),e=a.add.sprite(this.x,this.y,b),e.alpha=.45,e.inputEnabled=!0,e.events.onInputDown.add(this.touchStartWrapper,this),e.events.onInputUp.add(this.touchEndWrapper,this),e},b}(TouchableArea),TouchableJoystick=function(a){function b(a,c){var d,e;this.controller=a,this.setActive=__bind(this.setActive,this);for(d in c)e=c[d],this[d]=e;this.originX=this.currentX=this.currentX||this.x,this.originY=this.currentY=this.currentY||this.y,this.base=this.createBase(this.controller.game),this.sprite=this.createSprite(this.controller.game),b.__super__.constructor.call(this,this.controller)}return __extends(b,a),b.prototype.type="joystick",b.prototype.check=function(a,b){return Math.abs(a-this.x)<this.radius+this.controller.getPixels(this.controller.options.touchRadius)/2&&Math.abs(b-this.y)<this.radius+this.controller.getPixels(this.controller.options.touchRadius)/2?!0:!1},b.prototype.setActive=function(a){this.sprite.alpha=a?.8:.4},b.prototype.moveDetails={},b.prototype.touchMoveWrapper=function(a,b,c){this.active&&(this.currentX=this.controller.normalizeTouchPositionX(b),this.currentY=this.controller.normalizeTouchPositionY(c),this.touchMove&&this.moveDetails.dx!==this.currentX-this.x&&this.moveDetails.dy!==this.y-this.currentY&&(b=this.currentX-this.radius,c=this.currentY-this.radius,this.sprite.x=b,this.sprite.y=c,this.moveDetails.dx=this.currentX-this.x,this.moveDetails.dy=this.y-this.currentY,this.moveDetails.max=this.radius+this.controller.options.touchRadius/2,this.moveDetails.normalizedX=this.moveDetails.dx/this.moveDetails.max,this.moveDetails.normalizedY=this.moveDetails.dy/this.moveDetails.max,this.touchMove(this.moveDetails)))},b.prototype.touchEndWrapper=function(a){return this.sprite.x=this.originX-.7*this.radius,this.sprite.y=this.originY-.7*this.radius,b.__super__.touchEndWrapper.call(this,a)},b.prototype.draw=function(){},b.prototype.createSprite=function(a){var b,c,d;return this.stroke=this.stroke||2,c=2*(this.radius+this.controller.options.touchRadius+this.stroke),b=a.add.bitmapData(c,c),b.context.fillStyle="#444",b.context.beginPath(),b.context.arc(.7*this.radius,.7*this.radius,.7*this.radius,0,2*Math.PI,!1),b.context.fill(),b.context.stroke(),d=a.add.sprite(this.currentX-.7*this.radius,this.currentY-.7*this.radius,b),d.alpha=.8,d.inputEnabled=!0,d.events.onInputDown.add(this.touchStartWrapper,this),d.events.onInputUp.add(this.touchEndWrapper,this),a.input.addMoveCallback(this.touchMoveWrapper,this),d},b.prototype.createBase=function(a){var b,c,d,e,f;return this.stroke=this.stroke||2,e=2*(this.radius+this.controller.options.touchRadius+this.stroke),b=a.add.bitmapData(e,e),c=b.context,d=null,c.lineWidth=this.stroke,d=c.createRadialGradient(0,0,1,0,0,this.radius),d.addColorStop(0,"rgba( 200,200,200,.2 )"),d.addColorStop(1,"rgba( 200,200,200,.4 )"),c.strokeStyle="rgba( 0,0,0,.4 )",c.fillStyle=d,c.beginPath(),c.arc(this.radius,this.radius,this.radius,0,2*Math.PI,!1),c.fill(),c.stroke(),f=a.add.sprite(this.currentX-this.radius,this.currentY-this.radius,b),f.alpha=.4,f},b}(TouchableArea),MersenneTwister=function(){function a(a){var c;switch(this.mt=function(){c=[];for(var a=0;e>=0?e>a:a>e;e>=0?a++:a--)c.push(a);return c}.apply(this),typeof a){case"number":this.init_genrand(a);break;case"object":this.init_genrand(a,a.length);break;default:this.init_genrand(Date.now()%b)}}var b,c,d,e,f;return e=624,c=397,d=-1727483681,f=-2147483648,b=2147483647,a.prototype.mt=null,a.prototype.mti=e+1,a.prototype.nextBool=function(){return 1===(1&this.genrand_int32())},a.prototype.nextDouble=function(){return this.genrand_res53()},a.prototype.nextInt=function(a){return~~(this.genrand_res53()*a)},a.prototype.init_genrand=function(a){for(this.mt[0]=-1&a,this.mti=1;this.mti<e;)this.mt[this.mti]=1812433253*(this.mt[this.mti-1]^this.mt[this.mti-1]>>>30)+this.mti,this.mt[this.mti]=(-1&this.mt[this.mti])>>>0,this.mti++},a.prototype.init_by_array=function(a,b){var c,d,g;for(this.init_genrand(19650218),c=1,d=0,g=e>b?e:b;g>0;)this.mt[c]=(this.mt[c]^1664525*(this.mt[c-1]^this.mt[c-1]>>>30))+a[d]+d,this.mt[c]&=-1,c++,d++,c>=e&&(this.mt[0]=this.mt[e-1],c=1),d>=b&&(d=0),g--;for(g=e-1;g>0;)this.mt[c]=(this.mt[c]^1566083941*(this.mt[c-1]^this.mt[c-1]>>>30))-c,this.mt[c]&=-1,c++,c>=e&&(this.mt[0]=this.mt[e-1],c=1),g--;this.mt[0]=f},a.prototype.genrand_int32=function(){var a,g,h;if(g=[0,d],this.mti>=e){for(this.mti===e+1&&this.init_genrand(5489),a=0;e-c>a;)h=this.mt[a]&f|this.mt[a+1]&b,this.mt[a]=this.mt[a+c]^h>>>1^g[1&h],a++;for(;e-1>a;)h=this.mt[a]&f|this.mt[a+1]&b,this.mt[a]=this.mt[a+(c-e)]^h>>>1^g[1&h],a++;h=this.mt[e-1]&f|this.mt[0]&b,this.mt[e-1]=this.mt[c-1]^h>>>1^g[1&h],this.mti=0}return h=this.mt[this.mti++],h^=h>>>11,h^=h<<7&-1658038656,h^=h<<15&-272236544,h^=h>>>18,h>>>0},a.prototype.genrand_int31=function(){return this.genrand_int32()>>>1},a.prototype.genrand_real1=function(){return 2.3283064365386963e-10*this.genrand_int32()},a.prototype.genrand_real2=function(){return 2.3283064365386963e-10*this.genrand_int32()},a.prototype.genrand_real3=function(){return 2.3283064365386963e-10*(this.genrand_int32()+.5)},a.prototype.genrand_res53=function(){var a,b;return a=this.genrand_int32()>>>5,b=this.genrand_int32()>>>6,1.1102230246251565e-16*(67108864*a+b)},a}(),Properties=function(){function a(){}var b,c,d;return b=null,c="",d=null,a.init=function(a,e){var f,g,h;if(c=a,d=e,b=new localStorageDB(c,cc.sys.localStorage),f=b.isNew()){b.createTable("settings",["name","value"]),b.createTable("leaderboard",["date","score"]);for(g in d)h=d[g],b.insert("settings",{name:g,value:h});return b.commit()}},a.get=function(a){return b.queryAll("settings",{query:{name:a}})[0].value},a.set=function(a,c){b.update("settings",{name:a},function(a){return a.value=c,a}),b.commit()},a}(),AsteroidDeathView=function(){function a(a,b){this.animate=__bind(this.animate,this);var c,d,e;for(this.dots=[],d=e=0;8>e;d=++e)c=new Dot(a,a.rnd,b),this.dots.push(c)}return a.prototype.dots=null,a.prototype.x=0,a.prototype.y=0,a.prototype.rotation=0,a.prototype.stage=null,a.prototype.first=!0,a.prototype.animate=function(a){var b,c,d,e,f,g,h,i;if(this.first)for(this.first=!1,g=this.dots,c=0,e=g.length;e>c;c++)b=g[c],b.graphics.x=this.x,b.graphics.y=this.y;for(h=this.dots,i=[],d=0,f=h.length;f>d;d++)b=h[d],b.graphics.x+=b.velocity.x*a,i.push(b.graphics.y+=b.velocity.y*a);return i},a.prototype.dispose=function(){var a,b,c,d,e;for(d=this.dots,e=[],b=0,c=d.length;c>b;b++)a=d[b],e.push(a.graphics.removeFromParent(!0));return e},a}(),Dot=function(){function a(a,b,c){var d,e,f,g,h,i;this.graphics=new cc.DrawNode,a.addChild(this.graphics),e=cc.color(255,255,255,255),d=2*b.nextDouble()*Math.PI,f=b.nextDouble()*c,h=Math.cos(d)*f,i=Math.sin(d)*f,this.graphics.drawDot(cc.p(h,i),1,e),g=10*b.nextDouble()+10,this.velocity=new Point(Math.cos(d)*g,Math.sin(d)*g)}return a.prototype.velocity=null,a.prototype.graphics=null,a.prototype.x=0,a.prototype.y=0,a}(),AsteroidView=function(){function a(a,b){var c,d,e,f,g,h,i;for(h=a.rnd,this.graphics=new cc.DrawNode,a.addChild(this.graphics),d=cc.color(255,255,255,255),c=0,i=[cc.p(b,0)];c<2*Math.PI;)e=(.75+.25*h.nextDouble())*b,f=Math.cos(c)*e,g=Math.sin(c)*e,i.push(cc.p(f,g)),c+=.5*h.nextDouble();i.push(cc.p(b,0)),this.graphics.drawPoly(i,d,1,d)}return a.prototype.graphics=null,a.prototype.dispose=function(){return this.graphics.removeFromParent(!0)},a}(),BackgroundView=function(){function a(a,b){this.graphics=new cc.Sprite(b),a.addChild(this.graphics)}return a.prototype.graphics=null,a.prototype.dispose=function(){return this.graphics.removeFromParent(!0)},a}(),BulletView=function(){function a(a){var b;this.graphics=new cc.DrawNode,a.addChild(this.graphics),b=cc.color(255,255,255,255),this.graphics.drawDot(cc.p(0,0),2,b)}return a.prototype.graphics=null,a.prototype.dispose=function(){return this.graphics.removeFromParent(!0)},a}(),DpadController=function(){function a(a){var b;this.graphics=new cc.DrawNode,a.addChild(this.graphics),b=cc.color(255,255,255,255),this.graphics.drawDot(cc.p(0,0),2,b)}return a.prototype.graphics=null,a.prototype.dispose=function(){return this.graphics.removeFromParent(!0)},a}(),FireButton=function(){function a(a){var b;this.graphics=new cc.DrawNode,a.addChild(this.graphics),b=cc.color(255,255,255,255),this.graphics.drawDot(cc.p(0,0),2,b)}return a.prototype.graphics=null,a.prototype.dispose=function(){return this.graphics.removeFromParent(!0)},a}(),HudView=function(){function a(a,b){this.setScore=__bind(this.setScore,this),this.setLives=__bind(this.setLives,this);var c;c=cc.director.getWinSize(),this.graphics=new cc.DrawNode,this.graphics.drawRect(cc.p(0,c.height/2+40),cc.p(30,c.height/2-40),cc.color(192,192,192,127)),a.addChild(this.graphics),this.score=cc.LabelTTF.create("SCORE: 0","opendyslexic",18),this.score.setPosition(cc.p(c.width-130,c.height-20)),a.addChild(this.score),this.setScore(0),this.setLives(3)}return a.prototype.graphics=null,a.prototype.score=null,a.prototype.lives=null,a.prototype.x=0,a.prototype.y=0,a.prototype.rotation=0,a.prototype.dispose=function(){return this.graphics.removeFromParent(!0),this.score.removeFromParent(!0)},a.prototype.setLives=function(a){},a.prototype.setScore=function(a){this.score.setString("SCORE: "+a)},a}(),KeyPoll=function(){function a(a){this.game=a,this.isUp=__bind(this.isUp,this),this.isDown=__bind(this.isDown,this),this.states={},cc.eventManager.addListener({event:cc.EventListener.KEYBOARD,onKeyPressed:function(a){return function(b,c){a.states[b]=!0}}(this),onKeyReleased:function(a){return function(b,c){a.states[b]&&(a.states[b]=!1)}}(this)},this.game)}return a.KEY_LEFT=37,a.KEY_UP=38,a.KEY_RIGHT=39,a.KEY_Z=90,a.KEY_W=87,a.KEY_SPACE=32,a.prototype.states=null,a.prototype.keys=[a.KEY_LEFT,a.KEY_RIGHT,a.KEY_Z,a.KEY_UP,a.KEY_SPACE],a.prototype.isDown=function(a){return this.states[a]},a.prototype.isUp=function(a){return!this.states[a]},a}(),Point=function(){function a(a,b){this.x=null!=a?a:0,this.y=null!=b?b:0}return a.prototype.x=0,a.prototype.y=0,a.distance=function(a,b){var c,d;return c=a.x-b.x,d=a.y-b.y,Math.sqrt(c*c+d*d)},a.prototype.distanceSquaredTo=function(a){var b,c;return b=this.x-a.x,c=this.y-a.y,b*b+c*c},a.prototype.distanceTo=function(a){var b,c;return b=this.x-a.x,c=this.y-a.y,Math.sqrt(b*b+c*c)},a}(),SpaceshipDeathView=function(){function a(a){this.animate=__bind(this.animate,this);var b,c,d;c=a.rnd,b=cc.color(255,255,255,255),this.shape1=new cc.DrawNode,a.addChild(this.shape1),d=[cc.p(10,0),cc.p(-7,7),cc.p(-4,0),cc.p(10,0)],this.shape1.drawPoly(d,b,1,b),this.shape2=new cc.DrawNode,a.addChild(this.shape2),d=[cc.p(10,0),cc.p(-7,-7),cc.p(-4,0),cc.p(10,0)],this.shape2.drawPoly(d,b,1,b),this.vel1=new Point(10*c.nextDouble()-5,10*c.nextDouble()+10),this.vel2=new Point(10*c.nextDouble()-5,-(10*c.nextDouble()+10)),this.rot1=300*c.nextDouble()-150,this.rot2=300*c.nextDouble()-150}return a.prototype.shape1=null,a.prototype.shape2=null,a.prototype.vel1=null,a.prototype.vel2=null,a.prototype.rot1=null,a.prototype.rot2=null,a.prototype.first=!0,a.prototype.x=0,a.prototype.y=0,a.prototype.rotation=0,a.prototype.check=!0,a.prototype.dispose=function(){return this.shape1.removeFromParent(!0),this.shape2.removeFromParent(!0)},a.prototype.animate=function(a){this.first&&(this.first=!1,this.shape1.setPosition(cc.p(this.x,this.y)),this.shape2.setPosition(cc.p(this.x,this.y)),this.shape1.setRotation(this.rotation),this.shape2.setRotation(this.rotation)),this.shape1.setPositionX(this.shape1.getPositionX()+this.vel1.x*a),this.shape1.setPositionY(this.shape1.getPositionY()+this.vel1.y*a),this.shape1.setRotation(this.shape1.getRotation()+this.rot1*a),this.shape2.setPositionX(this.shape2.getPositionX()+this.vel2.x*a),this.shape2.setPositionY(this.shape2.getPositionY()+this.vel2.y*a),this.shape2.setRotation(this.shape2.getRotation()+this.rot2*a)},a}(),SpaceshipView=function(){function a(a){this.game=a,this.graphics=new cc.DrawNode,this.game.addChild(this.graphics),this.draw(cc.color(255,255,255,255))}return a.prototype.graphics=null,a.prototype.dispose=function(){return this.graphics.removeFromParent(!0)},a.prototype.draw=function(a){var b;return b=[cc.p(10,0),cc.p(-7,7),cc.p(-4,0),cc.p(-7,-7),cc.p(10,0)],this.graphics.drawPoly(b,a,1,a)},a}(),Sound=function(){function a(){this.audio=new window.Audio,this.audio.src=this.src,this.audio.load()}return a.volume=.5,a.enabled=!0,a.FACTOR=2,a.preload=function(a){var b;return b=new window.Audio,b.src=a,b.volume=0,b.play(),a},a.prototype.src="",a.prototype.audio=null,a.prototype.loop=function(){return this},a.prototype.play=function(){return a.enabled&&(this.audio.volume=a.volume,this.audio.play()),this},a.prototype.pause=function(){return this.audio.pause(),this},a}(),WaitForStartView=function(){function a(e){var f,g;this.game=e,this.onTouchEnded=__bind(this.onTouchEnded,this),this.onTouchMoved=__bind(this.onTouchMoved,this),this.onTouchBegan=__bind(this.onTouchBegan,this),this.start=__bind(this.start,this),this.click=new b,f=cc.director.getWinSize(),g=Math.floor(f.width/2),1===a.count++?(this.text1=cc.LabelTTF.create("GAME OVER","opendyslexic",40),this.text1.setPosition(cc.p(g,200))):(this.text1=cc.LabelTTF.create("ASTEROIDS","opendyslexic",40),this.text1.setPosition(cc.p(g,200))),this.game.addChild(this.text1),d?(this.text2=cc.LabelTTF.create("TOUCH TO START","opendyslexic",12),this.text2.setPosition(cc.p(g,175))):(this.text2=cc.LabelTTF.create("CLICK TO START","opendyslexic",12),this.text2.setPosition(cc.p(g,175))),this.game.addChild(this.text2),c&&(this.text3=cc.LabelTTF.create("Z ~ Fire  |  SPACE ~ Warp  |  Left/Right ~ Turn  |  Up ~ Accelerate","opendyslexic",10),this.text3.setPosition(cc.p(g,40)),this.game.addChild(this.text3)),cc.eventManager.addListener({event:cc.EventListener.TOUCH_ONE_BY_ONE,swallowTouches:!0,onTouchBegan:this.onTouchBegan,onTouchMoved:this.onTouchMoved,onTouchEnded:this.onTouchEnded},this.text1)}var b,c,d;return a.count=0,b=ash.signals.Signal0,a.prototype.x=0,a.prototype.y=0,a.prototype.rotation=0,a.prototype.text1=null,a.prototype.text2=null,a.prototype.text3=null,a.prototype.click=null,d=cc.sys.isMobile,c=!cc.sys.isMobile,a.prototype.start=function(a){},a.prototype.onTouchBegan=function(a,b){return this.game.removeChild(this.text1),this.game.removeChild(this.text2),null!=this.text3&&this.game.removeChild(this.text3),this.click.dispatch()},a.prototype.onTouchMoved=function(a,b){},a.prototype.onTouchEnded=function(a,b){},a}(),WarpButton=function(){function a(a){var b;this.graphics=new cc.DrawNode,a.addChild(this.graphics),b=cc.color(255,255,255,255),this.graphics.drawDot(cc.p(0,0),2,b)}return a.prototype.graphics=null,a.prototype.dispose=function(){return this.graphics.removeFromParent(!0)},a}(),Components=function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p;return{Animation:a=function(){function a(a){this.animation=a}return a.prototype.animation=null,a}(),Asteroid:b=function(){function a(a){this.fsm=a}return a.prototype.fsm=null,a}(),Audio:c=function(){function a(){this.toPlay=[]}return a.prototype.toPlay=null,a.prototype.play=function(a){return this.toPlay.push(a)},a}(),Bullet:d=function(){function a(a){this.lifeRemaining=a}return a.prototype.lifeRemaining=0,a}(),Collision:e=function(){function a(a){this.radius=a}return a.prototype.radius=0,a}(),DeathThroes:f=function(){function a(a){this.countdown=a}return a.prototype.countdown=0,a.prototype.body=null,a}(),Display:g=function(){function a(a){this.graphic=a}return a.prototype.graphic=0,a}(),GameState:h=function(){function a(){}return a.prototype.lives=3,a.prototype.level=0,a.prototype.hits=0,a.prototype.bonus=0,a.prototype.playing=!1,a.prototype.setForStart=function(){this.lives=3,this.level=0,this.hits=0,this.playing=!0},a}(),Gun:i=function(){function a(a,b,c,d){this.minimumShotInterval=c,this.bulletLifetime=d,this.shooting=!1,this.offsetFromParent=null,this.timeSinceLastShot=0,this.offsetFromParent=new Point(a,b)}return a.prototype.shooting=!1,a.prototype.offsetFromParent=null,a.prototype.timeSinceLastShot=0,a.prototype.offsetFromParent=null,a}(),GunControls:j=function(){function a(a){this.trigger=a}return a.prototype.trigger=0,a}(),Hud:k=function(){function a(a){this.view=a}return a.prototype.view=null,a.prototype.leaderboard=!1,a}(),MotionControls:l=function(){function a(a,b,c,d,e,f){this.left=a,this.right=b,this.accelerate=c,this.warp=d,this.accelerationRate=e,this.rotationRate=f}return a.prototype.left=0,a.prototype.right=0,a.prototype.accelerate=0,a.prototype.warp=0,a.prototype.accelerationRate=0,a.prototype.rotationRate=0,a}(),Physics:m=function(){function a(a,b,c){this.body=a,this.type=b,this.entity=c}return a.prototype.body=null,a.prototype.previousX=0,a.prototype.previousY=0,a.prototype.previousAngle=0,a.prototype.type=0,
a.prototype.entity=null,a}(),Position:n=function(){function a(a,b,c){this.rotation=null!=c?c:0,this.position=new Point(a,b)}return a.prototype.position=null,a.prototype.rotation=0,a}(),Spaceship:o=function(){function a(a){this.fsm=a}return a.prototype.fsm=null,a}(),WaitForStart:p=function(){function a(a){this.waitForStart=a,this.setStartGame=__bind(this.setStartGame,this),this.waitForStart.click.add(this.setStartGame)}return a.prototype.waitForStart=null,a.prototype.startGame=!1,a.prototype.setStartGame=function(){this.startGame=!0},a}()}}(),Nodes=function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o;return{AnimationNode:a=function(){function a(){}return a.prototype.animation=Components.Animation,a}(),AsteroidCollisionNode:b=function(){function a(){}return a.prototype.asteroid=Components.Asteroid,a.prototype.position=Components.Position,a.prototype.collision=Components.Collision,a.prototype.audio=Components.Audio,a.prototype.physics=Components.Physics,a}(),AudioNode:c=function(){function a(){}return a.prototype.audio=Components.Audio,a}(),BulletAgeNode:d=function(){function a(){}return a.prototype.bullet=Components.Bullet,a.prototype.physics=Components.Physics,a.prototype.display=Components.Display,a}(),BulletCollisionNode:e=function(){function a(){}return a.prototype.bullet=Components.Bullet,a.prototype.position=Components.Position,a.prototype.physics=Components.Physics,a}(),DeathThroesNode:f=function(){function a(){}return a.prototype.dead=Components.DeathThroes,a.prototype.display=Components.Display,a}(),GameNode:g=function(){function a(){}return a.prototype.state=Components.GameState,a}(),GunControlNode:h=function(){function a(){}return a.prototype.audio=Components.Audio,a.prototype.control=Components.GunControls,a.prototype.gun=Components.Gun,a.prototype.position=Components.Position,a}(),HudNode:i=function(){function a(){}return a.prototype.state=Components.GameState,a.prototype.hud=Components.Hud,a}(),MovementNode:j=function(){function a(){}return a.prototype.position=Components.Position,a}(),PhysicsControlNode:k=function(){function a(){}return a.prototype.control=Components.MotionControls,a.prototype.physics=Components.Physics,a.prototype.display=Components.Display,a}(),PhysicsNode:l=function(){function a(){}return a.prototype.position=Components.Position,a.prototype.physics=Components.Physics,a}(),RenderNode:m=function(){function a(){}return a.prototype.position=Components.Position,a.prototype.display=Components.Display,a}(),SpaceshipNode:n=function(){function a(){}return a.prototype.spaceship=Components.Spaceship,a.prototype.position=Components.Position,a}(),WaitForStartNode:o=function(){function a(){}return a.prototype.wait=Components.WaitForStart,a}()}}(),Entities=function(){function a(a){this.game=a,this.createUserBullet=__bind(this.createUserBullet,this),this.createSpaceship=__bind(this.createSpaceship,this),this.ash=this.game.ash,this.rnd=this.game.rnd,this.world=this.game.world}var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t;return b=Components.Animation,c=Components.Asteroid,d=Components.Audio,e=Components.Bullet,f=Components.Collision,g=Components.DeathThroes,h=Components.Display,k=Components.GameState,l=Components.Gun,m=Components.GunControls,n=Components.Hud,o=Components.MotionControls,p=Components.Physics,q=Components.Position,r=Components.Spaceship,s=Components.WaitForStart,i=ash.core.Entity,j=ash.fsm.EntityStateMachine,a.ASTEROID=1,a.SPACESHIP=2,a.BULLET=3,a.prototype.LEFT=KeyPoll.KEY_LEFT,a.prototype.RIGHT=KeyPoll.KEY_RIGHT,a.prototype.THRUST=KeyPoll.KEY_UP,a.prototype.FIRE=KeyPoll.KEY_Z,a.prototype.WARP=KeyPoll.KEY_SPACE,t=function(a){return parseFloat(Properties.get(a))},a.prototype.game=null,a.prototype.ash=null,a.prototype.world=null,a.prototype.waitEntity=null,a.prototype.rnd=null,a.prototype.bulletId=0,a.prototype.asteroidId=0,a.prototype.spaceshipId=0,a.prototype.destroyEntity=function(a){this.ash.removeEntity(a)},a.prototype.createGame=function(){var a,b;return b=new HudView(this.game),a=new i("game").add(new k).add(new n(b)),this.ash.addEntity(a),a},a.prototype.createWaitForClick=function(){var a;return a=new WaitForStartView(this.game),this.waitEntity=new i("wait").add(new s(a)),this.waitEntity.get(s).startGame=!1,this.ash.addEntity(this.waitEntity),this.waitEntity},a.prototype.createAsteroid=function(e,k,l){var m,n,o,r,s,u,v,w;return n=new cp.Body(1,cp.momentForCircle(1,0,e,cp.v(0,0))),n.p=cc.p(k,l),v=(this.rnd.nextDouble()-.5)*t("asteroidLinearVelocity")*(50-e),w=(this.rnd.nextDouble()-.5)*t("asteroidLinearVelocity")*(50-e),n.applyImpulse(cp.v(v,w),cp.v(0,0)),this.world.addBody(n),u=new cp.CircleShape(n,e,cp.v(0,0)),u.setCollisionType(SpriteAsteroid),u.setSensor(!0),this.world.addShape(u),m=new i,r=new j(m),s=new AsteroidView(this.game,e),r.createState("alive").add(p).withInstance(new p(n,a.ASTEROID,m)).add(f).withInstance(new f(e)).add(h).withInstance(new h(s)),o=new AsteroidDeathView(this.game,e),r.createState("destroyed").add(g).withInstance(new g(3)).add(h).withInstance(new h(o)).add(b).withInstance(new b(o)),m.add(new c(r)).add(new q(k,l,0)).add(new d),r.changeState("alive"),n.userData={type:a.ASTEROID,entity:m},this.ash.addEntity(m),m},a.prototype.createSpaceship=function(){var c,e,k,n,s,t,u,v,w,x;return t=cc.director.getWinSize(),w=this.rnd.nextInt(t.width),x=this.rnd.nextInt(t.height),v=[10,0,-7,-7,-7,7],c=new cp.Body(1,cp.momentForPoly(1,v,cp.v(0,0))),c.p=cc.p(w,x),c.applyImpulse(cp.v(0,0),cp.v(0,0)),this.world.addBody(c),s=new cp.PolyShape(c,v,cp.v(0,0)),s.u=.1,s.setCollisionType(SpriteSpaceship),s.setSensor(!0),this.world.addShape(s),u=new i,k=new j(u),n=new SpaceshipView(this.game),k.createState("playing").add(p).withInstance(new p(c,a.SPACESHIP,u)).add(o).withInstance(new o(this.LEFT,this.RIGHT,this.THRUST,this.WARP,100,3)).add(l).withInstance(new l(8,0,.3,2)).add(m).withInstance(new m(this.FIRE)).add(f).withInstance(new f(9)).add(h).withInstance(new h(n)),e=new SpaceshipDeathView(this.game),k.createState("destroyed").add(g).withInstance(new g(5)).add(h).withInstance(new h(e)).add(b).withInstance(new b(e)),u.add(new r(k)).add(new q(w,x,0)).add(new d),k.changeState("playing"),c.userData={type:a.SPACESHIP,entity:u},this.ash.addEntity(u),u},a.prototype.createUserBullet=function(b,c){var d,g,j,k,l,m,n,o,r,s,u;return k=Math.cos(c.rotation),m=Math.sin(c.rotation),s=k*b.offsetFromParent.x-m*b.offsetFromParent.y+c.position.x,u=m*b.offsetFromParent.x+k*b.offsetFromParent.y+c.position.y,n=cc.director.getWinSize(),s+=n.width/2,u+=n.height/2,d=new cp.Body(1,cp.momentForCircle(1,0,1,cp.v(0,0))),d.p=cc.p(s,u),o=k*t("bulletLinearVelocity"),r=m*t("bulletLinearVelocity"),d.applyImpulse(cp.v(o,r),cp.v(0,0)),this.world.addBody(d),l=new cp.CircleShape(d,1,cp.v(0,0)),l.setCollisionType(SpriteBullet),l.setSensor(!0),this.world.addShape(l),j=new BulletView(this.game),g=(new i).add(new e(b.bulletLifetime)).add(new q(s,u,0)).add(new f(0)).add(new p(d,a.BULLET,g)).add(new h(j)),d.userData={type:a.BULLET,entity:g},this.ash.addEntity(g),g},a.prototype.createImage=function(a,b,c,d){var e;return null==d&&(d=1),e=new i,e.add(new h(new BackgroundView(this.game,c))),e.add(new q(a,b)),this.ash.addEntity(e),e},a.prototype.createDpad=function(a,b){var c;return c=new i,c.add(new h(new DpadController(this.game))),c.add(new q(a,b)),this.ash.addEntity(c),c},a.prototype.createWarp=function(a,b){var c;return c=new i,c.add(new h(new FireButton(this.game))),c.add(new q(a,b)),this.ash.addEntity(c),c},a.prototype.createFire=function(a,b){var c;return c=new i,c.add(new h(new FireButton(this.game))),c.add(new q(a,b)),this.ash.addEntity(c),c},a}(),SystemPriorities=function(){function a(){}return a.preUpdate=1,a.update=2,a.move=3,a.resolveCollisions=4,a.stateMachines=5,a.render=6,a.animate=7,a}(),RenderSystem=function(a){function b(a){this.update=__bind(this.update,this),this.nodes=a.ash.nodes}var c,d,e;return __extends(b,a),b.prototype.stage=null,b.prototype.renderer=null,b.prototype.nodes=null,e=0,d=0,c=2*Math.PI,b.prototype.addToEngine=function(a){var b;for(this.nodes=a.getNodeList(this.nodes.RenderNode),b=this.nodes.head;b;)this.addToDisplay(b),b=b.next},b.prototype.addToDisplay=function(a){},b.prototype.removeFromDisplay=function(a){},b.prototype.removeFromEngine=function(a){this.nodes=null},b.prototype.update=function(a){var b,d,e,f,g,h;for(h=cc.director.getWinSize(),e=~~h.width/2,f=~~h.height/2,d=this.nodes.head;d;)null!=(b=d.display.graphic.graphics)&&(g=d.position.position,b.setPosition(cc.p(g.x+e,g.y+f)),b.setRotation(cc.radiansToDegrees(c-d.position.rotation))),d=d.next},b}(ash.core.System),AnimationSystem=function(a){function b(a){this.updateNode=__bind(this.updateNode,this),b.__super__.constructor.call(this,a.ash.nodes.AnimationNode,this.updateNode)}return __extends(b,a),b.prototype.updateNode=function(a,b){a.animation.animation.animate(b)},b}(ash.tools.ListIteratingSystem),AudioSystem=function(a){function b(a){this.updateNode=__bind(this.updateNode,this),b.__super__.constructor.call(this,a.ash.nodes.AudioNode,this.updateNode)}return __extends(b,a),b.prototype.updateNode=function(a,b){var c,d,e,f;f=a.audio.toPlay;for(c in f)e=f[c],d=new e,d.play(0,1);a.audio.toPlay=[]},b}(ash.tools.ListIteratingSystem),BulletAgeSystem=function(a){function b(a){this.updateNode=__bind(this.updateNode,this),b.__super__.constructor.call(this,a.ash.nodes.BulletAgeNode,this.updateNode),this.entities=a.entities}return __extends(b,a),b.prototype.entities=null,b.prototype.updateNode=function(a,b){var c;c=a.bullet,c.lifeRemaining-=b,c.lifeRemaining<=0&&(a.display.graphic.dispose(),this.entities.destroyEntity(a.entity))},b}(ash.tools.ListIteratingSystem),CollisionSystem=function(a){function b(a){this.collisionHandler=__bind(this.collisionHandler,this),this.update=__bind(this.update,this),this.rnd=a.rnd,this.world=a.world,this.entities=a.entities,this.components=a.ash.components,this.collisions=[],this.world.addCollisionHandler(SpriteAsteroid,SpriteSpaceship,this.collisionHandler,null,null,null),this.world.addCollisionHandler(SpriteBullet,SpriteAsteroid,this.collisionHandler,null,null,null)}var c,d,e,f,g,h,i,j,k,l;return __extends(b,a),c=Components.Asteroid,e=Components.Audio,g=Components.Collision,h=Components.DeathThroes,i=Components.Display,j=Components.Physics,k=Components.Position,l=Components.Spaceship,f=1,d=2,b.prototype.world=null,b.prototype.entities=null,b.prototype.games=null,b.prototype.rnd=null,b.prototype.collisions=null,b.prototype.update=function(a){for(var b,e,m,n,o,p,q,r,s,t,u,v,w;this.collisions.length;)if(w=this.collisions.pop(),t=w.type,b=w.a,e=w.b,t===f){if(null!=b.get(j)&&(this.entities.destroyEntity(b),b.get(i).graphic.dispose()),null!=e.get(j)&&(r=e.get(g).radius,q=e.get(k).position,p=function(){switch(r){case 30:return 20;case 20:return 50;case 10:return 100;default:return 0}}(),r>10&&(s=cc.director.getWinSize(),n=~~s.width/2,o=~~s.height/2,u=q.x+n,v=q.y+o,this.entities.createAsteroid(r-10,u+10*this.rnd.nextDouble()-5,v+10*this.rnd.nextDouble()-5),this.entities.createAsteroid(r-10,u+10*this.rnd.nextDouble()-5,v+10*this.rnd.nextDouble()-5)),m=e.get(j).body,e.get(i).graphic.dispose(),e.get(c).fsm.changeState("destroyed"),e.get(h).body=m,this.games.head))for(this.games.head.state.hits+=p,this.games.head.state.bonus+=p;this.games.head.state.bonus>5e3;)this.games.head.state.lives++,this.games.head.state.bonus-=5e3}else t===d&&null!=e.get(j)&&(m=e.get(j).body,e.get(i).graphic.dispose(),e.get(l).fsm.changeState("destroyed"),e.get(h).body=m,this.games.head&&this.games.head.state.lives--)},b.prototype.addToEngine=function(a){this.games=a.getNodeList(Nodes.GameNode)},b.prototype.removeFromEngine=function(a){this.games=null},b.prototype.collisionHandler=function(a,b){var c,e;switch(c=a.a.body.userData,e=a.b.body.userData,c.type){case Entities.ASTEROID:switch(e.type){case Entities.BULLET:this.collisions.push({type:f,a:e.entity,b:c.entity});break;case Entities.SPACESHIP:this.collisions.push({type:d,a:c.entity,b:e.entity})}break;case Entities.BULLET:e.type===Entities.ASTEROID&&this.collisions.push({type:f,a:c.entity,b:e.entity});break;case Entities.SPACESHIP:e.type===Entities.ASTEROID&&this.collisions.push({type:d,a:e.entity,b:c.entity})}},b}(ash.core.System),DeathThroesSystem=function(a){function b(a){this.updateNode=__bind(this.updateNode,this),b.__super__.constructor.call(this,a.ash.nodes.DeathThroesNode,this.updateNode),this.entities=a.entities}return __extends(b,a),b.prototype.entities=null,b.prototype.updateNode=function(a,b){var c;c=a.dead,c.countdown-=b,c.countdown<=0&&(this.entities.destroyEntity(a.entity),a.display.graphic.dispose())},b}(ash.tools.ListIteratingSystem),FixedPhysicsSystem=function(a){function b(a){this.updateNode=__bind(this.updateNode,this),this.update=__bind(this.update,this);var b;this.world=a.world,this.nodes=a.ash.nodes,b=cc.director.getWinSize(),this.width=b.width,this.height=b.height,this.offsetX=~~this.width/2,this.offsetY=~~this.height/2}var c,d;return __extends(b,a),c=1/60,b.prototype.handle=0,b.prototype.config=null,b.prototype.world=null,b.prototype.entities=null,b.prototype.nodes=null,b.prototype.enabled=!0,b.prototype.game=null,b.prototype.width=0,b.prototype.height=0,b.prototype.offsetX=0,b.prototype.offsetY=0,d=0,b.prototype.addToEngine=function(a){this.nodes=a.getNodeList(this.nodes.PhysicsNode)},b.prototype.removeFromEngine=function(a){0!==this.handle&&clearInterval(this.handle),this.nodes=null},b.prototype.update=function(a){var b;if(this.enabled)for(this.world.step(a),b=this.nodes.head;b;)this.updateNode(b,a),b=b.next},b.prototype.updateNode=function(a,b){var c,d,e,f,g,h,i,j;e=a.position,d=a.physics,c=d.body,j=c.p,f=j.x,h=j.y,g=f>this.width?0:0>f?this.width:f,i=h>this.height?0:0>h?this.height:h,(g!==f||i!==h)&&(c.p=cc.p(g,i)),e.position.x=g-this.offsetX,e.position.y=i-this.offsetY,e.rotation=c.getAngVel()},b}(ash.core.System),GameManager=function(a){function b(a){var b;this.game=a,this.update=__bind(this.update,this),this.entities=this.game.entities,this.rnd=this.game.rnd,this.nodes=this.game.ash.nodes,b=cc.director.getWinSize(),this.width=b.width,this.height=b.height}return __extends(b,a),b.prototype.parent=null,b.prototype.config=null,b.prototype.entities=null,b.prototype.rnd=null,b.prototype.gameNodes=null,b.prototype.spaceships=null,b.prototype.asteroids=null,b.prototype.bullets=null,b.prototype.width=0,b.prototype.height=0,b.prototype.addToEngine=function(a){this.gameNodes=a.getNodeList(this.nodes.GameNode),this.spaceships=a.getNodeList(this.nodes.SpaceshipNode),this.asteroids=a.getNodeList(this.nodes.AsteroidCollisionNode),this.bullets=a.getNodeList(this.nodes.BulletCollisionNode)},b.prototype.update=function(a){var b,c,d,e,f,g,h,i;if(g=this.gameNodes.head,g&&g.state.playing){if(this.spaceships.empty)if(g.state.lives>0){for(f=new Point(.5*this.width,.5*this.height),d=!0,b=this.asteroids.head;b;){if(Point.distance(b.position.position,f)<=b.collision.radius+50){d=!1;break}b=b.next}d&&this.entities.createSpaceship()}else g.state.playing=!1,this.entities.createWaitForClick();if(this.asteroids.empty&&this.bullets.empty&&!this.spaceships.empty)for(i=this.spaceships.head,g.state.level++,c=2+g.state.level,e=0;c>e;){for(;;)if(h=new Point(this.rnd.nextDouble()*this.width,this.rnd.nextDouble()*this.height),!(Point.distance(h,i.position.position)<=80))break;this.entities.createAsteroid(30,h.x,h.y),++e}}},b.prototype.removeFromEngine=function(a){this.gameNodes=null,this.spaceships=null,this.asteroids=null,this.bullets=null},b}(ash.core.System),GunControlSystem=function(a){function b(a){var d,e,f;this.game=a,this.updateNode=__bind(this.updateNode,this),b.__super__.constructor.call(this,this.game.ash.nodes.GunControlNode,this.updateNode),this.keyPoll=this.game.keyPoll,this.entities=this.game.entities,this.buttons=null!=(f=this.game.controller)?f.buttons:void 0,e=cc.director.getWinSize(),d=new cc.Sprite(res.fire),d.x=e.width-50,d.y=50,a.addChild(d),cc.eventManager.addListener({event:cc.EventListener.TOUCH_ONE_BY_ONE,onTouchBegan:function(a,b){var d,f,g;return g=a.getLocation(),d=g.x,f=g.y,d>=e.width-100&&100>=f?(c=!0,!0):void 0},onTouchMoved:function(a,b){},onTouchEnded:function(a,b){c=!1}},d)}var c;return __extends(b,a),c=!1,b.prototype.keyPoll=null,b.prototype.entities=null,b.prototype.buttons=null,b.prototype.updateNode=function(a,b){var d,e,f;d=a.control,f=a.position,e=a.gun,e.shooting=c||this.keyPoll.isDown(d.trigger),e.timeSinceLastShot+=b,e.shooting&&e.timeSinceLastShot>=e.minimumShotInterval&&(this.entities.createUserBullet(e,f),e.timeSinceLastShot=0)},b}(ash.tools.ListIteratingSystem),HudSystem=function(a){function b(a){this.updateNode=__bind(this.updateNode,this),b.__super__.constructor.call(this,a.ash.nodes.HudNode,this.updateNode)}return __extends(b,a),b.prototype.updateNode=function(a,b){a.hud.view.setLives(a.state.lives),a.hud.view.setScore(a.state.hits)},b}(ash.tools.ListIteratingSystem),ShipControlSystem=function(a){function b(a){this.updateNode=__bind(this.updateNode,this);var c,d;b.__super__.constructor.call(this,a.ash.nodes.PhysicsControlNode,this.updateNode),this.keyPoll=a.keyPoll,this.rnd=a.rnd,d=cc.director.getWinSize(),this.width=d.width,this.height=d.height,this.controller=a.controller,c=new cc.Sprite(res.warp),c.x=d.width-200,c.y=50,a.addChild(c),cc.eventManager.addListener({event:cc.EventListener.TOUCH_ONE_BY_ONE,onTouchBegan:function(b){return function(c,e){var i,j,k;return k=c.getLocation(),i=k.x,j=k.y,i<d.width/2?(g=cc.Sprite.create(res.touchorigin),a.addChild(g,0),g.setPosition(i,j),f=cc.Sprite.create(res.touchend),a.addChild(f,0),f.setPosition(i,j),h=!0,!0):i<=d.width-150&&100>=j?(b.warping=b.rnd.nextInt(30)+30,!0):void 0}}(this),onTouchMoved:function(a){return function(a,b){f.setPosition(a.getLocation().x,f.getPosition().y)}}(this),onTouchEnded:function(b){return function(b,c){h=!1,a.removeChild(g),a.removeChild(f)}}(this)},a)}var c,d,e,f,g,h;return __extends(b,a),g=null,h=!1,f=null,c=1,e=0,d=[16711680,65280,255,16711935,65535,16776960],b.prototype.keyPoll=null,b.prototype.rnd=null,b.prototype.warping=0,b.prototype.kount=0,b.prototype.width=0,b.prototype.height=0,b.prototype.updateNode=function(a,b){var e,i,j,k,l,m,n,o,p,q;if(i=a.control,e=a.physics.body,this.warping)return this.warping--,m=this.rnd.nextInt(this.width),n=this.rnd.nextInt(this.height),e.p=cc.p(m,n),void(0===this.warping?a.display.graphic.draw(cc.color(255,255,255,255)):a.display.graphic.draw(d[this.rnd.nextInt(6)]));if(h)j=f.getPosition().x-g.getPosition().x,-2>j?(k=e.getAngVel(),e.setAngVel(k+i.rotationRate*b)):j>2?(k=k||e.getAngVel(),e.setAngVel(k-i.rotationRate*b)):(k=k||e.getAngVel(),l=e.getVel(),l.x+=Math.cos(k)*i.accelerationRate*b*c,l.y+=Math.sin(k)*i.accelerationRate*b*c,e.setVel(l));else{if(this.keyPoll.isDown(i.warp)||(null!=(o=this.controller)&&null!=(p=o.buttons)?p.warp:void 0))return null!=(q=this.controller)&&(q.warp=!1),void(this.warping=this.rnd.nextInt(30)+30);this.keyPoll.isDown(i.accelerate)&&(k=k||e.getAngVel(),l=e.getVel(),l.x+=Math.cos(k)*i.accelerationRate*b*c,l.y+=Math.sin(k)*i.accelerationRate*b*c,e.setVel(l)),this.keyPoll.isDown(i.left)&&(k=e.getAngVel(),e.setAngVel(k-i.rotationRate*b)),this.keyPoll.isDown(i.right)&&(k=k||e.getAngVel(),e.setAngVel(k+i.rotationRate*b))}},b}(ash.tools.ListIteratingSystem),WaitForStartSystem=function(a){function b(a){this.update=__bind(this.update,this),this.entities=a.entities}return __extends(b,a),b.prototype.engine=null,b.prototype.entities=null,b.prototype.gameNodes=null,b.prototype.waitNodes=null,b.prototype.asteroids=null,b.prototype.addToEngine=function(a){this.ash=a,this.waitNodes=a.getNodeList(Nodes.WaitForStartNode),this.gameNodes=a.getNodeList(Nodes.GameNode),this.asteroids=a.getNodeList(Nodes.AsteroidCollisionNode)},b.prototype.removeFromEngine=function(a){this.waitNodes=null,this.gameNodes=null,this.asteroids=null},b.prototype.update=function(a){var b,c,d,e;if(e=this.waitNodes.head,c=this.gameNodes.head,e&&e.wait.startGame&&c){for(b=this.asteroids.head;b;)d=b.entity.get(Components.Display).graphic,this.entities.destroyEntity(b.entity),d.dispose(),b=b.next;c.state.setForStart(),e.wait.startGame=!1,this.ash.removeEntity(e.entity)}},b}(ash.core.System),Game=cc.Layer.extend({ash:null,rnd:null,reg:null,entities:null,world:null,player:null,hud:null,keyPoll:null,name:"asteroids",properties:{profiler:"on",leaderboard:"off",player:"",userId:"",background:"blue",playMusic:"50",playSfx:"50",asteroidDensity:"1.0",asteroidFriction:"1.0",asteroidRestitution:"0.2",asteroidDamping:"0.0",asteroidLinearVelocity:"4.0",asteroidAngularVelocity:"2.0",spaceshipDensity:"1.0",spaceshipFriction:"1.0",spaceshipRestitution:"0.2",spaceshipDamping:"0.75",bulletDensity:"1.0",bulletFriction:"0.0",bulletRestitution:"0.0",bulletDamping:"0.0",bulletLinearVelocity:"150"},ctor:function(){var a,b,c;this._super(),Properties.init(this.name,this.properties),this.rnd=new MersenneTwister,this.ash=new ash.core.Engine,c=new ash.ext.Helper(Components,Nodes);for(a in c)b=c[a],this.ash[a]=b;this.keyPoll=new KeyPoll(this),this.world=new cp.Space,this.world.gravity=cp.v(0,0),this.entities=new Entities(this),this.entities.createImage(0,0,res.background),this.ash.addSystem(new FixedPhysicsSystem(this),SystemPriorities.move),this.ash.addSystem(new BulletAgeSystem(this),SystemPriorities.update),this.ash.addSystem(new DeathThroesSystem(this),SystemPriorities.update),this.ash.addSystem(new CollisionSystem(this),SystemPriorities.resolveCollisions),this.ash.addSystem(new AnimationSystem(this),SystemPriorities.animate),this.ash.addSystem(new HudSystem(this),SystemPriorities.animate),this.ash.addSystem(new RenderSystem(this),SystemPriorities.render),this.ash.addSystem(new AudioSystem(this),SystemPriorities.render),this.ash.addSystem(new WaitForStartSystem(this),SystemPriorities.preUpdate),this.ash.addSystem(new GameManager(this),SystemPriorities.preUpdate),this.ash.addSystem(new ShipControlSystem(this),SystemPriorities.update),this.ash.addSystem(new GunControlSystem(this),SystemPriorities.update),this.entities.createWaitForClick(),this.entities.createGame(),this.scheduleUpdate()},update:function(a){this.ash.update(a)}}),Game.scene=function(){var a;return a=new cc.Scene,a.addChild(new Game),a};