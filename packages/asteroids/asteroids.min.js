(function(){"use strict";var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z,$,_,aa,ba,ca,da,ea,fa,ga,ha,ia=function(a,b){return function(){return a.apply(b,arguments)}},ja={}.hasOwnProperty,ka=function(a,b){function c(){this.constructor=a}for(var d in b)ja.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a};N=function(){function a(a){var c;switch(this.mt=function(){c=[];for(var a=0;e>=0?e>a:a>e;e>=0?a++:a--)c.push(a);return c}.apply(this),typeof a){case"number":this.init_genrand(a);break;case"object":this.init_genrand(a,a.length);break;default:this.init_genrand(Date.now()%b)}}var b,c,d,e,f;return e=624,c=397,d=2567483615,f=2147483648,b=2147483647,a.prototype.mt=null,a.prototype.mti=e+1,a.prototype.nextBool=function(){return 1===(1&this.genrand_int32())},a.prototype.nextDouble=function(){return this.genrand_res53()},a.prototype.nextInt=function(a){return~~(this.genrand_res53()*a)},a.prototype.init_genrand=function(a){for(this.mt[0]=4294967295&a,this.mti=1;this.mti<e;)this.mt[this.mti]=1812433253*(this.mt[this.mti-1]^this.mt[this.mti-1]>>30)+this.mti,this.mt[this.mti]&=4294967295,this.mti++},a.prototype.init_by_array=function(a,b){var c,d,f;for(this.init_genrand(19650218),c=1,d=0,f=e>b?e:b;f>0;)this.mt[c]=(this.mt[c]^1664525*(this.mt[c-1]^this.mt[c-1]>>30))+a[d]+d,this.mt[c]&=4294967295,c++,d++,c>=e&&(this.mt[0]=this.mt[e-1],c=1),d>=b&&(d=0),f--;for(f=e-1;f>0;)this.mt[c]=(this.mt[c]^1566083941*(this.mt[c-1]^this.mt[c-1]>>30))-c,this.mt[c]&=4294967295,c++,c>=e&&(this.mt[0]=this.mt[e-1],c=1),f--;this.mt[0]=2147483648},a.prototype.genrand_int32=function(){var a,g,h;if(g=[0,d],this.mti>=e){for(this.mti===e+1&&this.init_genrand(5489),a=0;e-c>a;)h=this.mt[a]&f|this.mt[a+1]&b,this.mt[a]=this.mt[a+c]^h>>1^g[1&h],a++;for(;e-1>a;)h=this.mt[a]&f|this.mt[a+1]&b,this.mt[a]=this.mt[a+(c-e)]^h>>1^g[1&h],a++;h=this.mt[e-1]&f|this.mt[0]&b,this.mt[e-1]=this.mt[c-1]^h>>1^g[1&h],this.mti=0}return h=this.mt[this.mti++],h^=h>>11,h^=h<<7&2636928640,h^=h<<15&4022730752,h^=h>>18,h>>0},a.prototype.genrand_int31=function(){return this.genrand_int32()>>1},a.prototype.genrand_real1=function(){return this.genrand_int32()*(1/4294967296)},a.prototype.genrand_real2=function(){return this.genrand_int32()*(1/4294967296)},a.prototype.genrand_real3=function(){return(this.genrand_int32()+.5)*(1/4294967296)},a.prototype.genrand_res53=function(){var a,b;return a=this.genrand_int32()>>5,b=this.genrand_int32()>>6,(67108864*a+b)*(1/9007199254740992)},a}(),V=function(){function a(a,b){this.x=null!=a?a:0,this.y=null!=b?b:0}return a.prototype.x=0,a.prototype.y=0,a.distance=function(a,b){var c,d;return c=a.x-b.x,d=a.y-b.y,Math.sqrt(c*c+d*d)},a.prototype.distanceSquaredTo=function(a){var b,c;return b=this.x-a.x,c=this.y-a.y,b*b+c*c},a.prototype.distanceTo=function(a){var b,c;return b=this.x-a.x,c=this.y-a.y,Math.sqrt(b*b+c*c)},a}(),M=function(){function a(a,b){this.isUp=ia(this.isUp,this),this.isDown=ia(this.isDown,this),this.keyUpListener=ia(this.keyUpListener,this),this.keyDownListener=ia(this.keyDownListener,this),this.states={},window.addEventListener("keydown",this.keyDownListener),window.addEventListener("keyup",this.keyUpListener),a.device.touch&&this.gamePad(a,b)}return a.KEY_LEFT=37,a.KEY_UP=38,a.KEY_RIGHT=39,a.KEY_Z=90,a.prototype.states=null,a.prototype.keys=[a.KEY_LEFT,a.KEY_RIGHT,a.KEY_Z,a.KEY_UP],a.prototype.keyDownListener=function(a){this.states[a.keyCode]=!0},a.prototype.keyUpListener=function(a){this.states[a.keyCode]&&(this.states[a.keyCode]=!1)},a.prototype.isDown=function(a){return this.states[a]},a.prototype.isUp=function(a){return!this.states[a]},a.prototype.gamePad=function(a,b){var c,d,e,f;return c=a.add.button(0,b.height-80,"round"),c.onInputDown.add(function(a){return function(){a.states[a.keys[0]]=!0}}(this)),c.onInputUp.add(function(a){return function(){a.states[a.keys[0]]=!1}}(this)),d=a.add.button(35,b.height-45,"round"),d.onInputDown.add(function(a){return function(){a.states[a.keys[1]]=!0}}(this)),d.onInputUp.add(function(a){return function(){a.states[a.keys[1]]=!1}}(this)),e=a.add.button(b.width-80,b.height-45,"square"),e.onInputDown.add(function(a){return function(){a.states[a.keys[2]]=!0}}(this)),e.onInputUp.add(function(a){return function(){a.states[a.keys[2]]=!1}}(this)),f=a.add.button(b.width-45,b.height-80,"round"),f.onInputDown.add(function(a){return function(){a.states[a.keys[3]]=!0}}(this)),f.onInputUp.add(function(a){return function(){a.states[a.keys[3]]=!1}}(this))},a}(),$=function(){function a(){this.audio=new window.Audio,this.audio.src=this.src,this.audio.load()}return a.volume=.5,a.enabled=!0,a.preload=function(a){var b;return b=new window.Audio,b.src=a,b.volume=0,b.play(),a},a.prototype.src="",a.prototype.audio=null,a.prototype.loop=function(){return this},a.prototype.play=function(){return a.enabled&&(this.audio.volume=a.volume,this.audio.play()),this},a.prototype.pause=function(){return this.audio.pause(),this},a}(),y=function(){function a(){}return a.prototype.src=$.preload("res/sounds/asteroid.wav"),a.prototype.play=function(){return a.audio.play("",0,$.volume/10)},a}(),z=function(){function a(){}return a.prototype.src=$.preload("res/sounds/ship.wav"),a.prototype.play=function(){return a.audio.play("",0,$.volume/10)},a}(),Z=function(){function a(){}return a.prototype.src=$.preload("res/sounds/shoot.wav"),a.prototype.play=function(){return a.audio.play("",0,$.volume/10)},a}(),g=function(){function a(a,b){var c,d,e,f;for(this.graphics=a.add.graphics(0,0),this.graphics.clear(),c=0,this.graphics.beginFill(16777215),this.graphics.moveTo(b,0);c<2*Math.PI;)d=(.75+.25*rnd.nextDouble())*b,e=Math.cos(c)*d,f=Math.sin(c)*d,this.graphics.lineTo(e,f),c+=.5*rnd.nextDouble();this.graphics.moveTo(b,0),this.graphics.endFill()}return a.prototype.graphics=null,Object.defineProperties(a.prototype,{x:{get:function(){return this.graphics.x},set:function(a){return this.graphics.x=a}},y:{get:function(){return this.graphics.x},set:function(a){return this.graphics.y=a}},rotation:{get:function(){return this.graphics.rotation},set:function(a){return this.graphics.rotation=a}}}),a.prototype.dispose=function(){return this.graphics.destroy()},a}(),f=function(){function a(a,b){this.animate=ia(this.animate,this);var c,d,e;for(this.dots=[],d=e=0;8>e;d=++e)c=new w(a,b),this.dots.push(c)}return a.prototype.dots=null,a.prototype.x=0,a.prototype.y=0,a.prototype.rotation=0,a.prototype.stage=null,a.prototype.first=!0,a.prototype.animate=function(a){var b,c,d,e,f,g,h,i;if(this.first)for(this.first=!1,g=this.dots,c=0,e=g.length;e>c;c++)b=g[c],b.graphics.x=this.x,b.graphics.y=this.y;for(h=this.dots,i=[],d=0,f=h.length;f>d;d++)b=h[d],b.graphics.x+=b.velocity.x*a,i.push(b.graphics.y+=b.velocity.y*a);return i},a.prototype.dispose=function(){var a,b,c,d,e;for(d=this.dots,e=[],b=0,c=d.length;c>b;b++)a=d[b],e.push(a.graphics.destroy());return e},a}(),w=function(){function a(a,b){var c,d,e;this.graphics=a.add.graphics(0,0),this.graphics.beginFill(16777215),this.graphics.drawCircle(0,0,1),this.graphics.endFill(),c=2*rnd.nextDouble()*Math.PI,d=rnd.nextDouble()*b,this.graphics.x=Math.cos(c)*d,this.graphics.y=Math.sin(c)*d,e=10*rnd.nextDouble()+10,this.velocity=new V(Math.cos(c)*e,Math.sin(c)*e)}return a.prototype.velocity=null,a.prototype.graphics=null,a.prototype.x=0,a.prototype.y=0,a}(),p=function(){function a(a){this.graphics=a.add.graphics(0,0),this.graphics.beginFill(16777215),this.graphics.drawCircle(0,0,2),this.graphics.endFill()}return a.prototype.graphics=null,Object.defineProperties(a.prototype,{x:{get:function(){return this.graphics.x},set:function(a){return this.graphics.x=a}},y:{get:function(){return this.graphics.x},set:function(a){return this.graphics.y=a}},rotation:{get:function(){return this.graphics.rotation},set:function(a){return this.graphics.rotation=a}}}),a.prototype.dispose=function(){return this.graphics.destroy()},a}(),L=function(){function a(a){this.setScore=ia(this.setScore,this),this.setLives=ia(this.setLives,this),this.graphics=a.add.graphics(0,100),this.graphics.beginFill(12632256),this.graphics.drawRect(0,0,30,40),this.graphics.endFill(),this.graphics.alpha=.5,this.score=a.add.text(window.innerWidth-130,20,"",{font:"bold 18px opendyslexic",fill:"white"}),this.setScore(0),this.setLives(3)}return a.prototype.graphics=null,a.prototype.score=null,a.prototype.lives=null,a.prototype.x=0,a.prototype.y=0,a.prototype.rotation=0,a.prototype.dispose=function(){return this.graphics.destroy(),this.score.destroy()},a.prototype.setLives=function(a){var b,c,d;for(this.graphics.clear(),this.graphics.beginFill(12632256),this.graphics.drawRect(0,0,30,40),this.graphics.endFill(),this.graphics.beginFill(0),c=d=0;a>=0?a>d:d>a;c=a>=0?++d:--d)b=10*c+10,this.graphics.moveTo(20,b),this.graphics.lineTo(3,7+b),this.graphics.lineTo(6,b),this.graphics.lineTo(3,-7+b),this.graphics.lineTo(20,b);this.graphics.endFill(),this.graphics.alpha=.5},a.prototype.setScore=function(a){this.score.setText("SCORE: "+a)},a}(),aa=function(){function a(a){this.animate=ia(this.animate,this),this.shape1=a.add.graphics(0,0),this.shape1.clear(),this.shape1.beginFill(16777215),this.shape1.moveTo(10,0),this.shape1.lineTo(-7,7),this.shape1.lineTo(-4,0),this.shape1.lineTo(10,0),this.shape1.endFill(),this.shape2=a.add.graphics(0,0),this.shape2.clear(),this.shape2.beginFill(16777215),this.shape2.moveTo(10,0),this.shape2.lineTo(-7,-7),this.shape2.lineTo(-4,0),this.shape2.lineTo(10,0),this.shape2.endFill(),this.vel1=new V(10*rnd.nextDouble()-5,10*rnd.nextDouble()+10),this.vel2=new V(10*rnd.nextDouble()-5,-(10*rnd.nextDouble()+10)),this.rot1=300*rnd.nextDouble()-150,this.rot2=300*rnd.nextDouble()-150}return a.prototype.shape1=null,a.prototype.shape2=null,a.prototype.vel1=null,a.prototype.vel2=null,a.prototype.rot1=null,a.prototype.rot2=null,a.prototype.first=!0,a.prototype.x=0,a.prototype.y=0,a.prototype.rotation=0,a.prototype.check=!0,a.prototype.dispose=function(){return this.shape1.destroy(),this.shape2.destroy()},a.prototype.animate=function(a){this.first&&(this.first=!1,this.shape1.x=this.shape2.x=this.x,this.shape1.y=this.shape2.y=this.y,this.shape1.rotation=this.shape2.rotation=this.rotation),this.shape1.x+=this.vel1.x*a,this.shape1.y+=this.vel1.y*a,this.shape1.rotation+=this.rot1*a,this.shape2.x+=this.vel2.x*a,this.shape2.y+=this.vel2.y*a,this.shape2.rotation+=this.rot2*a},a}(),ca=function(){function a(a){this.graphics=a.add.graphics(0,0),this.graphics.clear(),this.graphics.beginFill(16777215),this.graphics.moveTo(10,0),this.graphics.lineTo(-7,7),this.graphics.lineTo(-4,0),this.graphics.lineTo(-7,-7),this.graphics.lineTo(10,0),this.graphics.endFill()}return a.prototype.graphics=null,Object.defineProperties(a.prototype,{x:{get:function(){return this.graphics.x},set:function(a){return this.graphics.x=a}},y:{get:function(){return this.graphics.x},set:function(a){return this.graphics.y=a}},rotation:{get:function(){return this.graphics.rotation},set:function(a){return this.graphics.rotation=a}}}),a.prototype.dispose=function(){return this.graphics.destroy()},a}(),ha=function(){function a(c){this.start=ia(this.start,this);var d,e;this.click=new b,d=Math.floor(window.innerWidth/2),e=window.innerHeight-40,this.text1=1===a.count++?c.add.text(d,85,"GAME OVER",{font:"bold 60px opendyslexic",fill:"white",stroke:"black",strokeThickness:30}):c.add.text(d,85,"ASTEROIDS",{font:"bold 60px opendyslexic",fill:"white",stroke:"black",strokeThickness:30}),this.text2=c.device.touch?c.add.text(d,175,"TOUCH TO START",{font:"bold 12px opendyslexic",fill:"white"}):c.add.text(d,175,"CLICK TO START",{font:"bold 12px opendyslexic",fill:"white"}),this.text1.anchor.x=.5,this.text2.anchor.x=.5,c.device.desktop&&(this.text3=c.add.text(d,e,"Z to Fire  ~  Arrow Keys to Move",{font:"bold 10px opendyslexic",fill:"white"}),this.text3.anchor.x=.5),this.text1.inputEnabled=!0,this.text2.inputEnabled=!0,this.text1.events.onInputDown.add(this.start),this.text2.events.onInputDown.add(this.start)}var b;return a.count=0,b=ash.signals.Signal0,a.prototype.x=0,a.prototype.y=0,a.prototype.rotation=0,a.prototype.text1=null,a.prototype.text2=null,a.prototype.text3=null,a.prototype.click=null,a.prototype.start=function(){var a;return this.text1.destroy(),this.text2.destroy(),null!=(a=this.text3)&&a.destroy(),this.click.dispatch()},a}(),a=function(){function a(a){this.animation=a}return a.prototype.animation=null,a}(),d=function(){function a(a){this.fsm=a}return a.prototype.fsm=null,a}(),i=function(){function a(){this.toPlay=[]}return a.prototype.toPlay=null,a.prototype.play=function(a){return this.toPlay.push(a)},a}(),l=function(){function a(a){this.lifeRemaining=a}return a.prototype.lifeRemaining=0,a}(),q=function(){function a(a){this.radius=a}return a.prototype.radius=0,a}(),s=function(){function a(a){this.countdown=a}return a.prototype.countdown=0,a.prototype.body=null,a}(),v=function(){function a(a){this.graphic=a}return a.prototype.graphic=0,a}(),D=function(){function a(){}return a.prototype.lives=3,a.prototype.level=0,a.prototype.hits=0,a.prototype.playing=!1,a.prototype.setForStart=function(){this.lives=3,this.level=0,this.hits=0,this.playing=!0},a}(),E=function(){function a(a,b,c,d){this.minimumShotInterval=c,this.bulletLifetime=d,this.shooting=!1,this.offsetFromParent=null,this.timeSinceLastShot=0,this.offsetFromParent=new V(a,b)}return a.prototype.shooting=!1,a.prototype.offsetFromParent=null,a.prototype.timeSinceLastShot=0,a.prototype.offsetFromParent=null,a}(),H=function(){function a(a){this.trigger=a}return a.prototype.trigger=0,a}(),I=function(){function a(a){this.view=a}return a.prototype.view=null,a}(),O=function(){function a(a,b,c,d,e){this.left=a,this.right=b,this.accelerate=c,this.accelerationRate=d,this.rotationRate=e}return a.prototype.left=0,a.prototype.right=0,a.prototype.accelerate=0,a.prototype.accelerationRate=0,a.prototype.rotationRate=0,a}(),Q=function(){function a(a){this.body=a}return a.prototype.body=null,a}(),W=function(){function a(a,b,c){this.rotation=c,this.position=new V(a,b)}return a.prototype.position=null,a.prototype.rotation=0,a}(),_=function(){function a(a){this.fsm=a}return a.prototype.fsm=null,a}(),ea=function(){function a(a){this.waitForStart=a,this.setStartGame=ia(this.setStartGame,this),this.waitForStart.click.add(this.setStartGame)}return a.prototype.waitForStart=null,a.prototype.startGame=!1,a.prototype.setStartGame=function(){this.startGame=!0},a}(),b=function(b){function c(){return c.__super__.constructor.apply(this,arguments)}return ka(c,b),c.components={animation:a},c.prototype.animation=null,c}(ash.core.Node),e=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return ka(b,a),b.components={asteroid:d,position:W,collision:q,audio:i,physics:Q},b.prototype.asteroid=null,b.prototype.position=null,b.prototype.collision=null,b.prototype.audio=null,b.prototype.physics=null,b}(ash.core.Node),j=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return ka(b,a),b.components={audio:i},b.prototype.audio=null,b}(ash.core.Node),m=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return ka(b,a),b.components={bullet:l,physics:Q,display:v},b.prototype.bullet=null,b.prototype.physics=null,b.prototype.display=null,b}(ash.core.Node),o=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return ka(b,a),b.components={bullet:l,position:W,physics:Q},b.prototype.bullet=null,b.prototype.physics=null,b}(ash.core.Node),t=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return ka(b,a),b.components={dead:s,display:v},b.prototype.dead=null,b.prototype.display=null,b}(ash.core.Node),C=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return ka(b,a),b.components={state:D},b.prototype.state=null,b}(ash.core.Node),F=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return ka(b,a),b.components={audio:i,control:H,gun:E,position:W},b.prototype.control=null,b.prototype.gun=null,b.prototype.position=null,b.prototype.audio=null,b}(ash.core.Node),J=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return ka(b,a),b.components={state:D,hud:I},b.prototype.state=null,b.prototype.hud=null,b}(ash.core.Node),P=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return ka(b,a),b.components={position:W},b.prototype.position=null,b}(ash.core.Node),R=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return ka(b,a),b.components={control:O,physics:Q},b.prototype.control=null,b.prototype.physics=null,b}(ash.core.Node),T=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return ka(b,a),b.components={position:W,physics:Q},b.prototype.position=null,b.prototype.physics=null,b}(ash.core.Node),X=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return ka(b,a),b.components={position:W,display:v},b.prototype.position=null,b.prototype.display=null,b}(ash.core.Node),ba=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return ka(b,a),b.components={spaceship:_,position:W},b.prototype.spaceship=0,b.prototype.position=0,b}(ash.core.Node),fa=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return ka(b,a),b.components={wait:ea},b.prototype.wait=null,b}(ash.core.Node),U=function(a){function b(a,b,c){this.config=a,this.world=b,this.stage=c,this.updateNode=ia(this.updateNode,this),this.update=ia(this.update,this)}var c,d;return ka(b,a),c=Box2D.Dynamics.b2Body,d=Box2D.Common.Math.b2Vec2,b.prototype.config=null,b.prototype.world=null,b.prototype.stage=null,b.prototype.creator=null,b.prototype.nodes=null,b.prototype.enabled=!0,b.deadPool=[],b.prototype.addToEngine=function(a){this.nodes=a.getNodeList(T)},b.prototype.removeFromEngine=function(){this.nodes=null},b.prototype.update=function(a){var c,d,e;if(this.enabled){for(this.world.Step(a,10,10),this.world.ClearForces(),d=this.nodes.head;d;)this.updateNode(d,a),d=d.next;for(;c=b.deadPool.pop();)e=c.GetUserData(),null!=e.entity&&delete e.entity,c.SetUserData(e),this.world.DestroyBody(c)}},b.prototype.updateNode=function(a){var b,c,e,f,g,h,i,j;e=a.position,c=a.physics,b=c.body,j=b.GetPosition(),f=j.x,h=j.y,g=f>this.config.width?0:0>f?this.config.width:f,i=h>this.config.height?0:0>h?this.config.height:h,(g!==f||i!==h)&&b.SetPosition(new d(g,i)),e.position.x=g,e.position.y=i,e.rotation=b.GetAngularVelocity()},b}(ash.core.System),c=function(a){function c(){this.updateNode=ia(this.updateNode,this),c.__super__.constructor.call(this,b,this.updateNode)}return ka(c,a),c.prototype.updateNode=function(a,b){a.animation.animation.animate(b)},c}(ash.tools.ListIteratingSystem),k=function(a){function b(){this.updateNode=ia(this.updateNode,this),b.__super__.constructor.call(this,j,this.updateNode)}return ka(b,a),b.prototype.updateNode=function(a){var b,c,d,e;e=a.audio.toPlay;for(b in e)d=e[b],c=new d,c.play(0,1);a.audio.toPlay=[]},b}(ash.tools.ListIteratingSystem),n=function(a){function b(a){this.creator=a,this.updateNode=ia(this.updateNode,this),b.__super__.constructor.call(this,m,this.updateNode)}return ka(b,a),b.prototype.creator=null,b.prototype.updateNode=function(a,b){var c;c=a.bullet,c.lifeRemaining-=b,c.lifeRemaining<=0&&(a.display.graphic.dispose(),U.deadPool.push(a.physics.body),this.creator.destroyEntity(a.entity))},b}(ash.tools.ListIteratingSystem),r=function(a){function b(a,b){this.world=a,this.creator=b,this.PostSolve=ia(this.PostSolve,this),this.PreSolve=ia(this.PreSolve,this),this.EndContact=ia(this.EndContact,this),this.BeginContact=ia(this.BeginContact,this),this.update=ia(this.update,this),this.collisions=[],this.world.SetContactListener(this)}var c,e,f;return ka(b,a),f=Box2D.Dynamics.b2ContactListener,e=1,c=2,b.prototype.world=null,b.prototype.creator=null,b.prototype.games=null,b.prototype.collisions=null,b.prototype.update=function(){for(var a,b,f,g,h,j,k;this.collisions.length;)k=this.collisions.pop(),j=k.type,a=k.a,b=k.b,j===e?(null!=a.get(Q)&&(this.creator.destroyEntity(a),a.get(v).graphic.dispose(),U.deadPool.push(a.get(Q).body)),null!=b.get(Q)&&(h=b.get(q).radius,g=b.get(W).position,h>10&&(this.creator.createAsteroid(h-10,g.x+10*rnd.nextDouble()-5,g.y+10*rnd.nextDouble()-5),this.creator.createAsteroid(h-10,g.x+10*rnd.nextDouble()-5,g.y+10*rnd.nextDouble()-5)),f=b.get(Q).body,b.get(v).graphic.dispose(),b.get(d).fsm.changeState("destroyed"),b.get(s).body=f,b.get(i).play(y),this.games.head&&this.games.head.state.hits++)):j===c&&null!=b.get(Q)&&(f=b.get(Q).body,b.get(v).graphic.dispose(),b.get(_).fsm.changeState("destroyed"),b.get(s).body=f,b.get(i).play(z),this.games.head&&this.games.head.state.lives--)},b.prototype.addToEngine=function(a){this.games=a.getNodeList(C)},b.prototype.removeFromEngine=function(){this.games=null},b.prototype.BeginContact=function(a){var b,d;switch(b=a.GetFixtureA().GetBody().GetUserData(),d=a.GetFixtureB().GetBody().GetUserData(),b.type){case"asteroid":switch(d.type){case"bullet":this.collisions.push({type:e,a:d.entity,b:b.entity});break;case"spaceship":this.collisions.push({type:c,a:b.entity,b:d.entity})}break;case"bullet":"asteroid"===d.type&&this.collisions.push({type:e,a:b.entity,b:d.entity});break;case"spaceship":"asteroid"===d.type&&this.collisions.push({type:c,a:d.entity,b:b.entity})}},b.prototype.EndContact=function(){},b.prototype.PreSolve=function(){},b.prototype.PostSolve=function(){},b}(ash.core.System),u=function(a){function b(a){this.creator=a,this.updateNode=ia(this.updateNode,this),b.__super__.constructor.call(this,t,this.updateNode)}return ka(b,a),b.prototype.creator=null,b.prototype.updateNode=function(a,b){var c;c=a.dead,c.countdown-=b,c.countdown<=0&&(this.creator.destroyEntity(a.entity),a.display.graphic.dispose(),U.deadPool.push(c.body))},b}(ash.tools.ListIteratingSystem),B=function(a){function b(a,b){this.creator=a,this.config=b,this.update=ia(this.update,this)}return ka(b,a),b.prototype.config=null,b.prototype.creator=null,b.prototype.gameNodes=null,b.prototype.spaceships=null,b.prototype.asteroids=null,b.prototype.bullets=null,b.prototype.addToEngine=function(a){this.gameNodes=a.getNodeList(C),this.spaceships=a.getNodeList(ba),this.asteroids=a.getNodeList(e),this.bullets=a.getNodeList(o)},b.prototype.update=function(){var a,b,c,d,e,f,g,h;if(f=this.gameNodes.head,f&&f.state.playing){if(this.spaceships.empty)if(f.state.lives>0){for(e=new V(.5*this.config.width,.5*this.config.height),c=!0,a=this.asteroids.head;a;){if(V.distance(a.position.position,e)<=a.collision.radius+50){c=!1;break}a=a.next}c&&this.creator.createSpaceship()}else f.state.playing=!1,this.creator.createWaitForClick();if(this.asteroids.empty&&this.bullets.empty&&!this.spaceships.empty)for(h=this.spaceships.head,f.state.level++,b=2+f.state.level,d=0;b>d;){for(;;)if(g=new V(rnd.nextDouble()*this.config.width,rnd.nextDouble()*this.config.height),!(V.distance(g,h.position.position)<=80))break;this.creator.createAsteroid(30,g.x,g.y),++d}}},b.prototype.removeFromEngine=function(){this.gameNodes=null,this.spaceships=null,this.asteroids=null,this.bullets=null},b}(ash.core.System),G=function(a){function b(a,c){this.keyPoll=a,this.creator=c,this.updateNode=ia(this.updateNode,this),b.__super__.constructor.call(this,F,this.updateNode)}return ka(b,a),b.prototype.keyPoll=null,b.prototype.creator=null,b.prototype.updateNode=function(a,b){var c,d,e;c=a.control,e=a.position,d=a.gun,d.shooting=this.keyPoll.isDown(c.trigger),d.timeSinceLastShot+=b,d.shooting&&d.timeSinceLastShot>=d.minimumShotInterval&&(this.creator.createUserBullet(d,e),a.audio.play(Z),d.timeSinceLastShot=0)},b}(ash.tools.ListIteratingSystem),K=function(a){function b(){this.updateNode=ia(this.updateNode,this),b.__super__.constructor.call(this,J,this.updateNode)}return ka(b,a),b.prototype.updateNode=function(a){a.hud.view.setLives(a.state.lives),a.hud.view.setScore(a.state.hits)},b}(ash.tools.ListIteratingSystem),S=function(a){function b(a){this.keyPoll=a,this.updateNode=ia(this.updateNode,this),b.__super__.constructor.call(this,R,this.updateNode)}var c,d,e,f;return ka(b,a),d=window.devicePixelRatio,c=null!=(null!=(f=window.ext)?f.IDTK_SRV_BOX2D:void 0),e=Box2D.Common.Math.b2Vec2,b.prototype.keyPoll=null,b.prototype.updateNode=function(a,b){var e,f,g,h;f=a.control,e=a.physics.body,this.keyPoll.isDown(f.left)&&(g=e.GetAngularVelocity(),e.SetAngularVelocity(g-f.rotationRate*b)),this.keyPoll.isDown(f.right)&&(g=g||e.GetAngularVelocity(),e.SetAngularVelocity(g+f.rotationRate*b)),this.keyPoll.isDown(f.accelerate)&&(g=g||e.GetAngularVelocity(),h=e.GetLinearVelocity(),h.x+=Math.cos(g)*f.accelerationRate*b*d,h.y+=Math.sin(g)*f.accelerationRate*b*d,c||e.SetAwake(!0),e.SetLinearVelocity(h))},b}(ash.tools.ListIteratingSystem),Y=function(a){function b(a){this.stage=a,this.update=ia(this.update,this)}return ka(b,a),b.prototype.stage=null,b.prototype.renderer=null,b.prototype.nodes=null,b.prototype.addToEngine=function(a){var b;for(this.nodes=a.getNodeList(X),b=this.nodes.head;b;)this.addToDisplay(b),b=b.next},b.prototype.addToDisplay=function(){},b.prototype.removeFromDisplay=function(){},b.prototype.removeFromEngine=function(){this.nodes=null},b.prototype.update=function(){var a,b,c,d;for(c=this.nodes.head;c;)a=c.display,b=a.graphic,d=c.position,b.x=d.position.x,b.y=d.position.y,b.rotation=d.rotation,c=c.next},b}(ash.core.System),da=function(){function a(){}return a.preUpdate=1,a.update=2,a.move=3,a.resolveCollisions=4,a.stateMachines=5,a.render=6,a.animate=7,a}(),ga=function(a){function b(a){this.creator=a,this.update=ia(this.update,this)}return ka(b,a),b.prototype.engine=null,b.prototype.creator=null,b.prototype.gameNodes=null,b.prototype.waitNodes=null,b.prototype.asteroids=null,b.prototype.addToEngine=function(a){this.engine=a,this.waitNodes=a.getNodeList(fa),this.gameNodes=a.getNodeList(C),this.asteroids=a.getNodeList(e)},b.prototype.removeFromEngine=function(){this.waitNodes=null,this.gameNodes=null,this.asteroids=null},b.prototype.update=function(){var a,b,c,d;if(d=this.waitNodes.head,b=this.gameNodes.head,d&&d.wait.startGame&&b){for(a=this.asteroids.head;a;)c=a.entity.get(v).graphic,this.creator.destroyEntity(a.entity),c.dispose(),a=a.next;b.state.setForStart(),d.wait.startGame=!1,this.engine.removeEntity(d.entity)}},b}(ash.core.System),x=function(){function b(a,b,c,d){this.game=a,this.engine=b,this.world=c,this.config=d}var c,e,h,j,k,m,n,o;return c=ash.core.Entity,e=ash.fsm.EntityStateMachine,h=Box2D.Dynamics.b2Body,j=Box2D.Dynamics.b2BodyDef,k=Box2D.Collision.Shapes.b2CircleShape,m=Box2D.Dynamics.b2FixtureDef,n=Box2D.Collision.Shapes.b2PolygonShape,o=Box2D.Common.Math.b2Vec2,b.prototype.game=null,b.prototype.engine=null,b.prototype.world=null,b.prototype.waitEntity=null,b.prototype.bulletId=0,b.prototype.asteroidId=0,b.prototype.spaceshipId=0,b.prototype.destroyEntity=function(a){this.engine.removeEntity(a)},b.prototype.createGame=function(){var a,b;return b=new L(this.game),a=new c("game").add(new D).add(new I(b)).add(new v(b)).add(new W(0,0,0,0)),this.engine.addEntity(a),a},b.prototype.createWaitForClick=function(){var a;return a=new ha(this.game),this.waitEntity=new c("wait").add(new ea(a)).add(new v(a)).add(new W(0,0,0,0)),this.waitEntity.get(ea).startGame=!1,this.engine.addEntity(this.waitEntity),this.waitEntity},b.prototype.createAsteroid=function(b,l,n){var o,p,r,t,u,w,x,y,z;return r=new j,r.type=h.b2_dynamicBody,r.fixedRotation=!0,r.position.x=l,r.position.y=n,y=4*(rnd.nextDouble()-.5)*(50-b)*2,z=4*(rnd.nextDouble()-.5)*(50-b)*2,r.linearVelocity.Set(y,z),r.angularVelocity=2*rnd.nextDouble()-1,u=new m,u.density=1,u.friction=1,u.restitution=.2,u.shape=new k(b),p=this.world.CreateBody(r),p.CreateFixture(u),o=new c,w=new e(o),x=new g(this.game,b),w.createState("alive").add(Q).withInstance(new Q(p)).add(q).withInstance(new q(b)).add(v).withInstance(new v(x)),t=new f(this.game,b),w.createState("destroyed").add(s).withInstance(new s(3)).add(v).withInstance(new v(t)).add(a).withInstance(new a(t)),o.add(new d(w)).add(new W(l,n,0)).add(new i),p.SetUserData({type:"asteroid",entity:o}),w.changeState("alive"),this.engine.addEntity(o),o},b.prototype.createSpaceship=function(){var b,d,f,g,k,l,p,r,t;return r=rnd.nextInt(this.config.width),t=rnd.nextInt(this.config.height),d=new j,d.type=h.b2_dynamicBody,d.fixedRotation=!1,d.position.x=r,d.position.y=t,d.linearVelocity.Set(0,0),d.angularVelocity=0,d.linearDamping=.75,g=new m,g.density=1,g.friction=1,g.restitution=.2,g.shape=new n,g.shape.SetAsArray([new o(.45,0),new o(-.25,.25),new o(-.25,-.25)],3),b=this.world.CreateBody(d),b.CreateFixture(g),p=new c,k=new e(p),l=new ca(this.game),k.createState("playing").add(Q).withInstance(new Q(b)).add(O).withInstance(new O(M.KEY_LEFT,M.KEY_RIGHT,M.KEY_UP,100,3)).add(E).withInstance(new E(8,0,.3,2)).add(H).withInstance(new H(M.KEY_Z)).add(q).withInstance(new q(9)).add(v).withInstance(new v(l)),f=new aa(this.game),k.createState("destroyed").add(s).withInstance(new s(5)).add(v).withInstance(new v(f)).add(a).withInstance(new a(f)),p.add(new _(k)).add(new W(r,t,0)).add(new i),b.SetUserData({type:"spaceship",entity:p}),k.changeState("playing"),this.engine.addEntity(p),p},b.prototype.createUserBullet=function(a,b){var d,e,f,g,i,n,o,r,s;return i=Math.cos(b.rotation),o=Math.sin(b.rotation),r=i*a.offsetFromParent.x-o*a.offsetFromParent.y+b.position.x,s=o*a.offsetFromParent.x+i*a.offsetFromParent.y+b.position.y,e=new j,e.type=h.b2_dynamicBody,e.fixedRotation=!0,e.position.x=r,e.position.y=s,e.linearVelocity.Set(150*i,150*o),e.angularVelocity=0,n=new m,n.density=1,n.friction=0,n.restitution=.2,n.shape=new k(0),d=this.world.CreateBody(e),d.CreateFixture(n),g=new p(this.game),f=(new c).add(new l(a.bulletLifetime)).add(new W(r,s,0)).add(new q(0)).add(new Q(d)).add(new v(g)),d.SetUserData({type:"bullet",entity:f}),this.engine.addEntity(f),f},b}(),A=function(){function a(){}return a.prototype.width=0,a.prototype.height=0,a}(),h=function(){function a(a){this.stats=a,this.setPlaySfx=ia(this.setPlaySfx,this),this.setPlayMusic=ia(this.setPlayMusic,this),this.setBackground=ia(this.setBackground,this),this.pause=ia(this.pause,this),this.create=ia(this.create,this),this.preload=ia(this.preload,this),this.init=ia(this.init,this),this.game=new Phaser.Game(i*h,g*h,Phaser.CANVAS,"",{init:this.init,preload:this.preload,create:this.create})}var b,d,e,f,g,h,i;return i=window.innerWidth,g=window.innerHeight,h=window.devicePixelRatio,e=Box2D.Common.Math.b2Vec2,f=Box2D.Dynamics.b2World,b=ash.core.Engine,d=ash.tick.FrameTickProvider,a.prototype.game=null,a.prototype.engine=null,a.prototype.tickProvider=null,a.prototype.creator=null,a.prototype.keyPoll=null,a.prototype.config=null,a.prototype.world=null,a.prototype.background=null,a.prototype.physics=null,a.prototype.playMusic=localStorage.playMusic,a.prototype.playSfx=localStorage.playSfx,a.prototype.optBgd=localStorage.background||"blue",a.prototype.bgdColor=6970061,a.prototype.init=function(){this.game.scale.scaleMode=Phaser.ScaleManager.SHOW_ALL,this.game.scale.minWidth=i*h,this.game.scale.minHeight=g*h,this.game.scale.maxWidth=i*h,this.game.scale.maxHeight=g*h,this.game.scale.pageAlignVertically=!0,this.game.scale.pageAlignHorizontally=!0},a.prototype.preload=function(){this.game.load.image("background","res/starfield.png"),this.game.load.image("leaderboard","res/icons/b_Leaderboard.png"),this.game.load.image("more","res/icons/b_More1.png"),this.game.load.image("parameters","res/icons/b_Parameters.png"),this.game.load.image("round","res/round.png"),this.game.load.image("square","res/square.png"),this.game.load.audio("asteroid",[y.prototype.src]),this.game.load.audio("ship",[z.prototype.src]),this.game.load.audio("shoot",[Z.prototype.src])},a.prototype.create=function(){y.audio=this.game.add.audio("asteroid"),y.audio.play("",0,0),z.audio=this.game.add.audio("ship"),z.audio.play("",0,0),Z.audio=this.game.add.audio("shoot"),Z.audio.play("",0,0),
this.background=this.game.add.sprite(0,0,"background"),this.background.width=i,this.background.height=g,this.game.stage.backgroundColor=this.bgdColor,this.game.add.button(i-50,50,"parameters",function(){return function(){return Cocoon.App.loadInTheWebView("options.html")}}(this)),this.game.add.button(i-50,125,"leaderboard",function(){return function(){return Cocoon.App.loadInTheWebView("leaders.html")}}(this)),this.game.add.button(i-50,200,"more",function(){return function(){return Cocoon.App.loadInTheWebView("more.html")}}(this)),Cocoon.App.WebView.on("load",{success:function(a){return function(){return a.pause(!0),Cocoon.App.showTheWebView()}}(this),error:function(){return function(){return console.log("Cannot show the Webview for some reason :/"),console.log(JSON.stringify(arguments))}}(this)}),this.config=new A,this.config.height=g,this.config.width=i,this.world=new f(new e(0,0),!0),this.engine=new b,this.creator=new x(this.game,this.engine,this.world,this.config),this.keyPoll=new M(this.game,this.config),this.engine.addSystem(new ga(this.creator),da.preUpdate),this.engine.addSystem(new B(this.creator,this.config),da.preUpdate),this.engine.addSystem(new S(this.keyPoll),da.update),this.engine.addSystem(new G(this.keyPoll,this.creator),da.update),this.engine.addSystem(new n(this.creator),da.update),this.engine.addSystem(new u(this.creator),da.update),this.engine.addSystem(this.physics=new U(this.config,this.world),da.move),this.engine.addSystem(new r(this.world,this.creator),da.resolveCollisions),this.engine.addSystem(new c,da.animate),this.engine.addSystem(new K,da.animate),this.engine.addSystem(new Y,da.render),this.engine.addSystem(new k,da.render),this.creator.createWaitForClick(),this.creator.createGame(),this.tickProvider=new d(this.stats),this.tickProvider.add(this.engine.update),this.tickProvider.start()},a.prototype.pause=function(a){this.physics.enabled=!a},a.prototype.setBackground=function(a){1===a?(this.background.alpha=1,this.optBgd="star",localStorage.background="star"):(this.background.alpha=0,this.optBgd="blue",localStorage.background="blue")},a.prototype.setPlayMusic=function(a){this.playMusic=a,localStorage.playMusic=a},a.prototype.setPlaySfx=function(a){this.playSfx=a,$.volume=a/100,localStorage.playSfx=a},a}(),function(){return window.addEventListener("load",function(){var a,b,c,d;navigator.isCocoonJS?b=null:(b=new Stats,a=document.createElement("div"),document.body.appendChild(a),a.appendChild(b.domElement),b.domElement.style.position="absolute",c=0,d=0,b.setMode(0),b.domElement.style.position="absolute",b.domElement.style.left=""+c+"px",b.domElement.style.top=""+d+"px",document.body.appendChild(b.domElement)),window.rnd=new N,window.asteroids=new h(b)})}()}).call(this);