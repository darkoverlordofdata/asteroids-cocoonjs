(function(){"use strict";var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M=function(a,b){return function(){return a.apply(b,arguments)}},N={}.hasOwnProperty,O=function(a,b){function c(){this.constructor=a}for(var d in b)N.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a};y=function(){function a(a){var c;switch(this.mt=function(){c=[];for(var a=0;e>=0?e>a:a>e;e>=0?a++:a--)c.push(a);return c}.apply(this),typeof a){case"number":this.init_genrand(a);break;case"object":this.init_genrand(a,a.length);break;default:this.init_genrand(Date.now()%b)}}var b,c,d,e,f;return e=624,c=397,d=-1727483681,f=-2147483648,b=2147483647,a.prototype.mt=null,a.prototype.mti=e+1,a.prototype.nextBool=function(){return 1===(1&this.genrand_int32())},a.prototype.nextDouble=function(){return this.genrand_res53()},a.prototype.nextInt=function(a){return~~(this.genrand_res53()*a)},a.prototype.init_genrand=function(a){for(this.mt[0]=-1&a,this.mti=1;this.mti<e;)this.mt[this.mti]=1812433253*(this.mt[this.mti-1]^this.mt[this.mti-1]>>>30)+this.mti,this.mt[this.mti]=(-1&this.mt[this.mti])>>>0,this.mti++},a.prototype.init_by_array=function(a,b){var c,d,g;for(this.init_genrand(19650218),c=1,d=0,g=e>b?e:b;g>0;)this.mt[c]=(this.mt[c]^1664525*(this.mt[c-1]^this.mt[c-1]>>>30))+a[d]+d,this.mt[c]&=-1,c++,d++,c>=e&&(this.mt[0]=this.mt[e-1],c=1),d>=b&&(d=0),g--;for(g=e-1;g>0;)this.mt[c]=(this.mt[c]^1566083941*(this.mt[c-1]^this.mt[c-1]>>>30))-c,this.mt[c]&=-1,c++,c>=e&&(this.mt[0]=this.mt[e-1],c=1),g--;this.mt[0]=f},a.prototype.genrand_int32=function(){var a,g,h;if(g=[0,d],this.mti>=e){for(this.mti===e+1&&this.init_genrand(5489),a=0;e-c>a;)h=this.mt[a]&f|this.mt[a+1]&b,this.mt[a]=this.mt[a+c]^h>>>1^g[1&h],a++;for(;e-1>a;)h=this.mt[a]&f|this.mt[a+1]&b,this.mt[a]=this.mt[a+(c-e)]^h>>>1^g[1&h],a++;h=this.mt[e-1]&f|this.mt[0]&b,this.mt[e-1]=this.mt[c-1]^h>>>1^g[1&h],this.mti=0}return h=this.mt[this.mti++],h^=h>>>11,h^=h<<7&-1658038656,h^=h<<15&-272236544,h^=h>>>18,h>>>0},a.prototype.genrand_int31=function(){return this.genrand_int32()>>>1},a.prototype.genrand_real1=function(){return 2.3283064365386963e-10*this.genrand_int32()},a.prototype.genrand_real2=function(){return 2.3283064365386963e-10*this.genrand_int32()},a.prototype.genrand_real3=function(){return 2.3283064365386963e-10*(this.genrand_int32()+.5)},a.prototype.genrand_res53=function(){var a,b;return a=this.genrand_int32()>>>5,b=this.genrand_int32()>>>6,1.1102230246251565e-16*(67108864*a+b)},a}(),L=function(a,b){var c,d,e,f;for(a=""+a,b=""+b,d=[],c=e=0,f=Math.max(a.length,b.length);f>=0?f>e:e>f;c=f>=0?++e:--e)d.push(a[c]),d.push(b[c]);return d.join("")},A=function(){function a(a,b){this.x=null!=a?a:0,this.y=null!=b?b:0}return a.prototype.x=0,a.prototype.y=0,a.distance=function(a,b){var c,d;return c=a.x-b.x,d=a.y-b.y,Math.sqrt(c*c+d*d)},a.prototype.distanceSquaredTo=function(a){var b,c;return b=this.x-a.x,c=this.y-a.y,b*b+c*c},a.prototype.distanceTo=function(a){var b,c;return b=this.x-a.x,c=this.y-a.y,Math.sqrt(b*b+c*c)},a}(),w=function(){function a(a){this.parent=a,this.isUp=M(this.isUp,this),this.isDown=M(this.isDown,this),this.keyUpListener=M(this.keyUpListener,this),this.keyDownListener=M(this.keyDownListener,this),this.states={},window.addEventListener("keydown",this.keyDownListener),window.addEventListener("keyup",this.keyUpListener)}return a.KEY_LEFT=37,a.KEY_UP=38,a.KEY_RIGHT=39,a.KEY_Z=90,a.KEY_W=87,a.KEY_SPACE=32,a.prototype.states=null,a.prototype.keys=[a.KEY_LEFT,a.KEY_RIGHT,a.KEY_Z,a.KEY_UP,a.KEY_SPACE],a.prototype.keyDownListener=function(a){this.states[a.keyCode]=!0},a.prototype.keyUpListener=function(a){this.states[a.keyCode]&&(this.states[a.keyCode]=!1)},a.prototype.isDown=function(a){return this.states[a]},a.prototype.isUp=function(a){return!this.states[a]},a.prototype.buttons=function(a,b){var c,d;return c=a.add.button(b.width-100,b.height-50,"round"),c.onInputDown.add(function(a){return function(){a.states[a.keys[2]]=!0}}(this)),c.onInputUp.add(function(a){return function(){a.states[a.keys[2]]=!1}}(this)),d=a.add.button(b.width/2,b.height-50,"square"),d.anchor.x=.5,d.onInputDown.add(function(a){return function(){a.states[a.keys[4]]=!0}}(this)),d.onInputUp.add(function(a){return function(){a.states[a.keys[4]]=!1}}(this))},a}(),F=function(){function a(){this.audio=new window.Audio,this.audio.src=this.src,this.audio.load()}return a.volume=.5,a.enabled=!0,a.FACTOR=2,a.preload=function(a){var b;return b=new window.Audio,b.src=a,b.volume=0,b.play(),a},a.prototype.src="",a.prototype.audio=null,a.prototype.loop=function(){return this},a.prototype.play=function(){return a.enabled&&(this.audio.volume=a.volume,this.audio.play()),this},a.prototype.pause=function(){return this.audio.pause(),this},a}(),n=function(){function a(){}return a.prototype.src=F.preload("res/sounds/asteroid.wav"),a.prototype.play=function(){return a.audio.play("",0,F.volume/F.FACTOR)},a}(),o=function(){function a(){}return a.prototype.src=F.preload("res/sounds/ship.wav"),a.prototype.play=function(){return a.audio.play("",0,F.volume/F.FACTOR)},a}(),D=function(){function a(){}return a.prototype.src=F.preload("res/sounds/shoot.wav"),a.prototype.play=function(){return a.audio.play("",0,F.volume/F.FACTOR)},a}(),d=function(){function a(a,b){var c,d,e,f,g,h;for(d=a.game,h=a.rnd,this.graphics=d.add.graphics(0,0),this.graphics.clear(),c=0,this.graphics.beginFill(16777215),this.graphics.moveTo(b,0);c<2*Math.PI;)e=(.75+.25*h.nextDouble())*b,f=Math.cos(c)*e,g=Math.sin(c)*e,this.graphics.lineTo(f,g),c+=.5*h.nextDouble();this.graphics.moveTo(b,0),this.graphics.endFill()}return a.prototype.graphics=null,Object.defineProperties(a.prototype,{x:{get:function(){return this.graphics.x},set:function(a){return this.graphics.x=a}},y:{get:function(){return this.graphics.x},set:function(a){return this.graphics.y=a}},rotation:{get:function(){return this.graphics.rotation},set:function(a){return this.graphics.rotation=a}}}),a.prototype.dispose=function(){return this.graphics.destroy()},a}(),c=function(){function a(a,b){this.animate=M(this.animate,this);var c,d,e;for(this.dots=[],d=e=0;8>e;d=++e)c=new l(a.game,a.rnd,b),this.dots.push(c)}return a.prototype.dots=null,a.prototype.x=0,a.prototype.y=0,a.prototype.rotation=0,a.prototype.stage=null,a.prototype.first=!0,a.prototype.animate=function(a){var b,c,d,e,f,g,h,i;if(this.first)for(this.first=!1,g=this.dots,c=0,e=g.length;e>c;c++)b=g[c],b.graphics.x=this.x,b.graphics.y=this.y;for(h=this.dots,i=[],d=0,f=h.length;f>d;d++)b=h[d],b.graphics.x+=b.velocity.x*a,i.push(b.graphics.y+=b.velocity.y*a);return i},a.prototype.dispose=function(){var a,b,c,d,e;for(d=this.dots,e=[],b=0,c=d.length;c>b;b++)a=d[b],e.push(a.graphics.destroy());return e},a}(),l=function(){function a(a,b,c){var d,e,f;this.graphics=a.add.graphics(0,0),this.graphics.beginFill(16777215),this.graphics.drawCircle(0,0,1),this.graphics.endFill(),d=2*b.nextDouble()*Math.PI,e=b.nextDouble()*c,this.graphics.x=Math.cos(d)*e,this.graphics.y=Math.sin(d)*e,f=10*b.nextDouble()+10,this.velocity=new A(Math.cos(d)*f,Math.sin(d)*f)}return a.prototype.velocity=null,a.prototype.graphics=null,a.prototype.x=0,a.prototype.y=0,a}(),h=function(){function a(a){this.graphics=a.add.graphics(0,0),this.graphics.beginFill(16777215),this.graphics.drawCircle(0,0,2),this.graphics.endFill()}return a.prototype.graphics=null,Object.defineProperties(a.prototype,{x:{get:function(){return this.graphics.x},set:function(a){return this.graphics.x=a}},y:{get:function(){return this.graphics.x},set:function(a){return this.graphics.y=a}},rotation:{get:function(){return this.graphics.rotation},set:function(a){return this.graphics.rotation=a}}}),a.prototype.dispose=function(){return this.graphics.destroy()},a}(),v=function(){function a(a,b){this.setScore=M(this.setScore,this),this.setLives=M(this.setLives,this),this.graphics=a.add.graphics(0,100),this.graphics.beginFill(12632256),this.graphics.drawRect(0,0,30,40),this.graphics.endFill(),this.graphics.alpha=.5,this.score=a.add.text(window.innerWidth-130,20,"",{font:"bold 18px opendyslexic",fill:"white"}),this.setScore(0),this.setLives(3)}return a.prototype.graphics=null,a.prototype.score=null,a.prototype.lives=null,a.prototype.x=0,a.prototype.y=0,a.prototype.rotation=0,a.prototype.dispose=function(){return this.graphics.destroy(),this.score.destroy()},a.prototype.setLives=function(a){var b,c,d;for(this.graphics.clear(),this.graphics.beginFill(12632256),this.graphics.drawRect(0,0,30,40),this.graphics.endFill(),this.graphics.beginFill(0),c=d=0;a>=0?a>d:d>a;c=a>=0?++d:--d)b=10*c+10,this.graphics.moveTo(20,b),this.graphics.lineTo(3,7+b),this.graphics.lineTo(6,b),this.graphics.lineTo(3,-7+b),this.graphics.lineTo(20,b);this.graphics.endFill(),this.graphics.alpha=.5},a.prototype.setScore=function(a){this.score.setText("SCORE: "+a)},a}(),G=function(){function a(a){this.animate=M(this.animate,this);var b,c;b=a.game,c=a.rnd,this.shape1=b.add.graphics(0,0),this.shape1.clear(),this.shape1.beginFill(16777215),this.shape1.moveTo(10,0),this.shape1.lineTo(-7,7),this.shape1.lineTo(-4,0),this.shape1.lineTo(10,0),this.shape1.endFill(),this.shape2=b.add.graphics(0,0),this.shape2.clear(),this.shape2.beginFill(16777215),this.shape2.moveTo(10,0),this.shape2.lineTo(-7,-7),this.shape2.lineTo(-4,0),this.shape2.lineTo(10,0),this.shape2.endFill(),this.vel1=new A(10*c.nextDouble()-5,10*c.nextDouble()+10),this.vel2=new A(10*c.nextDouble()-5,-(10*c.nextDouble()+10)),this.rot1=300*c.nextDouble()-150,this.rot2=300*c.nextDouble()-150}return a.prototype.shape1=null,a.prototype.shape2=null,a.prototype.vel1=null,a.prototype.vel2=null,a.prototype.rot1=null,a.prototype.rot2=null,a.prototype.first=!0,a.prototype.x=0,a.prototype.y=0,a.prototype.rotation=0,a.prototype.check=!0,a.prototype.dispose=function(){return this.shape1.destroy(),this.shape2.destroy()},a.prototype.animate=function(a){this.first&&(this.first=!1,this.shape1.x=this.shape2.x=this.x,this.shape1.y=this.shape2.y=this.y,this.shape1.rotation=this.shape2.rotation=this.rotation),this.shape1.x+=this.vel1.x*a,this.shape1.y+=this.vel1.y*a,this.shape1.rotation+=this.rot1*a,this.shape2.x+=this.vel2.x*a,this.shape2.y+=this.vel2.y*a,this.shape2.rotation+=this.rot2*a},a}(),H=function(){function a(a){this.graphics=a.add.graphics(0,0),this.draw(16777215)}return a.prototype.graphics=null,Object.defineProperties(a.prototype,{x:{get:function(){return this.graphics.x},set:function(a){return this.graphics.x=a}},y:{get:function(){return this.graphics.x},set:function(a){return this.graphics.y=a}},rotation:{get:function(){return this.graphics.rotation},set:function(a){return this.graphics.rotation=a}}}),a.prototype.dispose=function(){return this.graphics.destroy()},a.prototype.draw=function(a){return this.graphics.clear(),this.graphics.beginFill(a),this.graphics.moveTo(10,0),this.graphics.lineTo(-7,7),this.graphics.lineTo(-4,0),this.graphics.lineTo(-7,-7),this.graphics.lineTo(10,0),this.graphics.endFill()},a}(),K=function(){function a(c,d){var e,f;this.game=c,this.parent=d,this.start1=M(this.start1,this),this.start=M(this.start,this),this.click=new b,e=Math.floor(window.innerWidth/2),f=window.innerHeight-40,1===a.count++?this.text1=this.game.add.text(e,85,"GAME OVER",{font:"bold 60px opendyslexic",fill:"white",stroke:"black",strokeThickness:30}):this.text1=this.game.add.text(e,85,"ASTEROIDS",{font:"bold 60px opendyslexic",fill:"white",stroke:"black",strokeThickness:30}),this.game.device.touch?this.text2=this.game.add.text(e,175,"TOUCH TO START",{font:"bold 12px opendyslexic",fill:"white"}):this.text2=this.game.add.text(e,175,"CLICK TO START",{font:"bold 12px opendyslexic",fill:"white"}),this.text1.anchor.x=.5,this.text2.anchor.x=.5,this.game.device.desktop&&(this.text3=this.game.add.text(e,f,"Z ~ Fire  |  SPACE ~ Warp  |  Left/Right ~ Turn  |  Up ~ Accelerate",{font:"bold 10px opendyslexic",fill:"white"}),this.text3.anchor.x=.5),this.text1.inputEnabled=!0,this.text2.inputEnabled=!0,this.text1.events.onInputDown.add(this.start),this.text2.events.onInputDown.add(this.start)}var b;return a.count=0,b=ash.signals.Signal0,a.prototype.x=0,a.prototype.y=0,a.prototype.rotation=0,a.prototype.text1=null,a.prototype.text2=null,a.prototype.text3=null,a.prototype.click=null,a.prototype.start=function(a){var b;return this.faderBitmap=this.game.make.bitmapData(this.game.width,this.game.height),this.faderBitmap.rect(0,0,this.game.width,this.game.height,"rgb(0,0,0)"),this.faderSprite=this.game.add.sprite(0,0,this.faderBitmap),this.faderSprite.alpha=0,b=this.game.add.tween(this.faderSprite),b.to({alpha:1},1e3),b.onComplete.add(this.start1),b.start()},a.prototype.start1=function(){var a,b,c;return this.text1.destroy(),this.text2.destroy(),null!=(b=this.text3)&&b.destroy(),a=this.game.add.tween(this.faderSprite),a.to({alpha:0},1e3),a.onComplete.add(function(a){return function(){return a.click.dispatch()}}(this)),a.start(),null!=(c=this.parent.controller)?c.start():void 0},a}(),j=function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p;return{Animation:a=function(){function a(a){this.animation=a}return a.prototype.animation=null,a}(),Asteroid:b=function(){function a(a){this.fsm=a}return a.prototype.fsm=null,a}(),Audio:c=function(){function a(){this.toPlay=[]}return a.prototype.toPlay=null,a.prototype.play=function(a){return this.toPlay.push(a)},a}(),Bullet:d=function(){function a(a){this.lifeRemaining=a}return a.prototype.lifeRemaining=0,a}(),Collision:e=function(){function a(a){this.radius=a}return a.prototype.radius=0,a}(),DeathThroes:f=function(){function a(a){this.countdown=a}return a.prototype.countdown=0,a.prototype.body=null,a}(),Display:g=function(){function a(a){this.graphic=a}return a.prototype.graphic=0,a}(),GameState:h=function(){function a(){}return a.prototype.lives=3,a.prototype.level=0,a.prototype.hits=0,a.prototype.bonus=0,a.prototype.playing=!1,a.prototype.setForStart=function(){this.lives=3,this.level=0,this.hits=0,this.playing=!0},a}(),Gun:i=function(){function a(a,b,c,d){this.minimumShotInterval=c,this.bulletLifetime=d,this.shooting=!1,this.offsetFromParent=null,this.timeSinceLastShot=0,this.offsetFromParent=new A(a,b)}return a.prototype.shooting=!1,a.prototype.offsetFromParent=null,a.prototype.timeSinceLastShot=0,a.prototype.offsetFromParent=null,a}(),GunControls:j=function(){function a(a){this.trigger=a}return a.prototype.trigger=0,a}(),Hud:k=function(){function a(a){this.view=a}return a.prototype.view=null,a.prototype.leaderboard=!1,a}(),MotionControls:l=function(){function a(a,b,c,d,e,f){this.left=a,this.right=b,this.accelerate=c,this.warp=d,this.accelerationRate=e,this.rotationRate=f}return a.prototype.left=0,a.prototype.right=0,a.prototype.accelerate=0,a.prototype.warp=0,a.prototype.accelerationRate=0,a.prototype.rotationRate=0,a}(),Physics:m=function(){function a(a){this.body=a}return a.prototype.body=null,a.prototype.previousX=0,a.prototype.previousY=0,a.prototype.previousAngle=0,a}(),Position:n=function(){function a(a,b,c){this.rotation=c,this.position=new A(a,b)}return a.prototype.position=null,a.prototype.rotation=0,a}(),Spaceship:o=function(){function a(a){this.fsm=a}return a.prototype.fsm=null,a}(),WaitForStart:p=function(){function a(a){this.waitForStart=a,this.setStartGame=M(this.setStartGame,this),this.waitForStart.click.add(this.setStartGame)}return a.prototype.waitForStart=null,a.prototype.startGame=!1,a.prototype.setStartGame=function(){this.startGame=!0},a}()}}(),z=function(){var a,b,c,d,e,f,g,h,i,k,l,m,n,o,p;return{AnimationNode:a=function(){function a(){}return a.prototype.animation=j.Animation,a}(),AsteroidCollisionNode:b=function(){function a(){}return a.prototype.asteroid=j.Asteroid,a.prototype.position=j.Position,a.prototype.collision=j.Collision,a.prototype.audio=j.Audio,a.prototype.physics=j.Physics,a}(),AudioNode:c=function(){function a(){}return a.prototype.audio=j.Audio,a}(),BulletAgeNode:d=function(){function a(){}return a.prototype.bullet=j.Bullet,a.prototype.physics=j.Physics,a.prototype.display=j.Display,a}(),BulletCollisionNode:e=function(){function a(){}return a.prototype.bullet=j.Bullet,a.prototype.position=j.Position,a.prototype.physics=j.Physics,a}(),DeathThroesNode:f=function(){function a(){}return a.prototype.dead=j.DeathThroes,a.prototype.display=j.Display,a}(),GameNode:g=function(){function a(){}return a.prototype.state=j.GameState,a}(),GunControlNode:h=function(){function a(){}return a.prototype.audio=j.Audio,a.prototype.control=j.GunControls,a.prototype.gun=j.Gun,a.prototype.position=j.Position,a}(),HudNode:i=function(){function a(){}return a.prototype.state=j.GameState,a.prototype.hud=j.Hud,a}(),MovementNode:k=function(){function a(){}return a.prototype.position=j.Position,a}(),PhysicsControlNode:l=function(){function a(){}return a.prototype.control=j.MotionControls,a.prototype.physics=j.Physics,a.prototype.display=j.Display,a}(),PhysicsNode:m=function(){function a(){}return a.prototype.position=j.Position,a.prototype.physics=j.Physics,a}(),RenderNode:n=function(){function a(){}return a.prototype.position=j.Position,a.prototype.display=j.Display,a}(),SpaceshipNode:o=function(){function a(){}return a.prototype.spaceship=j.Spaceship,a.prototype.position=j.Position,a}(),WaitForStartNode:p=function(){function a(){}return a.prototype.wait=j.WaitForStart,a}()}}(),q=function(a){function b(a){this.updateNode=M(this.updateNode,this),this.update=M(this.update,this),this.process=M(this.process,this),this.world=a.world,this.game=a.game,this.width=a.width,this.height=a.height,this.nodes=a.ash.nodes}var c,d,e,f,g;return O(b,a),f=Box2D.Dynamics.b2Body,g=Box2D.Common.Math.b2Vec2,d=1/60,e=8,c=3,b.prototype.handle=0,b.prototype.config=null,b.prototype.world=null,b.prototype.entities=null,b.prototype.nodes=null,b.prototype.enabled=!0,b.prototype.game=null,b.prototype.width=0,b.prototype.height=0,b.deadPool=[],b.prototype.addToEngine=function(a){this.nodes=a.getNodeList(this.nodes.PhysicsNode),this.handle=setInterval(this.process,d)},b.prototype.removeFromEngine=function(a){0!==this.handle&&clearInterval(this.handle),this.handle=0,this.nodes=null},b.prototype.process=function(){this.game.paused||this.enabled&&(this.world.Step(d,e,c),this.world.ClearForces())},b.prototype.update=function(a){var c,d,e;if(!this.game.paused&&this.enabled){for(d=this.nodes.head;d;)this.updateNode(d,a),d=d.next;for(;c=b.deadPool.pop();)e=c.GetUserData(),null!=e.entity&&delete e.entity,c.SetUserData(e),this.world.DestroyBody(c)}},b.prototype.updateNode=function(a,b){var c,d,e,f,h,i,j,k;e=a.position,d=a.physics,c=d.body,k=c.GetPosition(),f=k.x,i=k.y,h=f>this.width?0:0>f?this.width:f,j=i>this.height?0:0>i?this.height:i,(h!==f||j!==i)&&c.SetPosition(new g(h,j)),e.position.x=h,e.position.y=j,e.rotation=c.GetAngularVelocity()},b}(ash.core.System),E=function(a){function b(a){this.smoothStates=M(this.smoothStates,this),this.resetSmoothStates=M(this.resetSmoothStates,this),this.update=M(this.update,this),this.removeFromEngine=M(this.removeFromEngine,this),this.addToEngine=M(this.addToEngine,this),this.width=a.width,this.height=a.height,this.world=a.world,this.game=a.game,this.nodes=a.ash.nodes}var c,d,e,f,g,h;return O(b,a),e=Box2D.Dynamics.b2Body,f=Box2D.Common.Math.b2Vec2,c=1/60,d=5,h=8,g=1,b.prototype.fixedTimestepAccumulator=0,b.prototype.fixedTimestepAccumulatorRatio=0,b.prototype.config=null,b.prototype.world=null,b.prototype.entities=null,b.prototype.nodes=null,b.prototype.enabled=!0,b.prototype.game=null,b.prototype.width=0,b.prototype.height=0,b.deadPool=[],b.prototype.addToEngine=function(a){this.nodes=a.getNodeList(this.nodes.PhysicsNode)},b.prototype.removeFromEngine=function(a){this.nodes=null},b.prototype.update=function(a){var e,f,i,j,k;if(!this.game.paused&&this.enabled){for(this.fixedTimestepAccumulator+=a,i=Math.floor(this.fixedTimestepAccumulator/c),i>0&&(this.fixedTimestepAccumulator-=i*c),this.fixedTimestepAccumulatorRatio=this.fixedTimestepAccumulator/c,j=Math.min(i,d),f=0;j>f;)this.resetSmoothStates(),this.world.Step(a,h,g),f++;for(this.world.ClearForces(),this.smoothStates();e=b.deadPool.pop();)k=e.GetUserData(),null!=k.entity&&delete k.entity,e.SetUserData(k),this.world.DestroyBody(e)}},b.prototype.resetSmoothStates=function(){var a,b,c,d,e,g,h,i,j;for(b=this.nodes.head;b;)d=b.position,c=b.physics,a=c.body,j=a.GetPosition(),e=j.x,h=j.y,d.position.x=c.previousX=e,d.position.y=c.previousY=h,d.rotation=c.previousAngle=a.GetAngularVelocity(),g=e>this.width?0:0>e?this.width:e,i=h>this.height?0:0>h?this.height:h,(g!==e||i!==h)&&a.SetPosition(new f(g,i)),b=b.next},b.prototype.smoothStates=function(){var a,b,c,d,e,g,h,i,j,k;for(c=1-this.fixedTimestepAccumulatorRatio,b=this.nodes.head;b;)e=b.position,d=b.physics,a=d.body,k=a.GetPosition(),g=k.x,i=k.y,e.position.x=this.fixedTimestepAccumulatorRatio*g+c*d.previousX,e.position.y=this.fixedTimestepAccumulatorRatio*i+c*d.previousY,e.rotation=a.GetAngularVelocity()*this.fixedTimestepAccumulatorRatio+c*d.previousAngle,h=g>this.width?0:0>g?this.width:g,j=i>this.height?0:0>i?this.height:i,(h!==g||j!==i)&&a.SetPosition(new f(h,j)),b=b.next},b}(ash.core.System),b=function(a){function b(a){this.updateNode=M(this.updateNode,this),b.__super__.constructor.call(this,a.ash.nodes.AnimationNode,this.updateNode)}return O(b,a),b.prototype.updateNode=function(a,b){a.animation.animation.animate(b)},b}(ash.tools.ListIteratingSystem),f=function(a){function b(a){this.updateNode=M(this.updateNode,this),b.__super__.constructor.call(this,a.ash.nodes.AudioNode,this.updateNode)}return O(b,a),b.prototype.updateNode=function(a,b){var c,d,e,f;f=a.audio.toPlay;for(c in f)e=f[c],d=new e,d.play(0,1);a.audio.toPlay=[]},b}(ash.tools.ListIteratingSystem),g=function(a){function b(a,c){this.PhysicsSystem=c,this.updateNode=M(this.updateNode,this),b.__super__.constructor.call(this,a.ash.nodes.BulletAgeNode,this.updateNode),this.entities=a.entities}return O(b,a),b.prototype.entities=null,b.prototype.PhysicsSystem=null,b.prototype.updateNode=function(a,b){var c;c=a.bullet,c.lifeRemaining-=b,c.lifeRemaining<=0&&(a.display.graphic.dispose(),this.PhysicsSystem.deadPool.push(a.physics.body),this.entities.destroyEntity(a.entity))},b}(ash.tools.ListIteratingSystem),i=function(a){function b(a,b){this.PhysicsSystem=b,this.PostSolve=M(this.PostSolve,this),this.PreSolve=M(this.PreSolve,this),this.EndContact=M(this.EndContact,this),this.BeginContact=M(this.BeginContact,this),this.update=M(this.update,this),this.world=a.world,this.entities=a.entities,this.rnd=a.rnd,this.components=a.ash.components,this.collisions=[],this.world.SetContactListener(this)}var c,d,e,f,g,h,i,k,l,p,q;return O(b,a),c=j.Asteroid,e=j.Audio,g=j.Collision,h=j.DeathThroes,i=j.Display,k=j.Physics,l=j.Position,p=j.Spaceship,q=Box2D.Dynamics.b2ContactListener,f=1,d=2,b.prototype.world=null,b.prototype.entities=null,b.prototype.games=null,b.prototype.rnd=null,b.prototype.collisions=null,b.prototype.PhysicsSystem=null,b.prototype.update=function(a){for(var b,j,m,q,r,s,t,u;this.collisions.length;)if(u=this.collisions.pop(),t=u.type,b=u.a,j=u.b,t===f){if(null!=b.get(k)&&(this.entities.destroyEntity(b),b.get(i).graphic.dispose(),this.PhysicsSystem.deadPool.push(b.get(k).body)),null!=j.get(k)&&(s=j.get(g).radius,r=j.get(l).position,q=function(){switch(s){case 30:return 20;case 20:return 50;case 10:return 100;default:return 0}}(),s>10&&(this.entities.createAsteroid(s-10,r.x+10*this.rnd.nextDouble()-5,r.y+10*this.rnd.nextDouble()-5),this.entities.createAsteroid(s-10,r.x+10*this.rnd.nextDouble()-5,r.y+10*this.rnd.nextDouble()-5)),m=j.get(k).body,j.get(i).graphic.dispose(),j.get(c).fsm.changeState("destroyed"),j.get(h).body=m,j.get(e).play(n),this.games.head))for(this.games.head.state.hits+=q,this.games.head.state.bonus+=q;this.games.head.state.bonus>5e3;)this.games.head.state.lives++,this.games.head.state.bonus-=5e3}else t===d&&null!=j.get(k)&&(m=j.get(k).body,j.get(i).graphic.dispose(),j.get(p).fsm.changeState("destroyed"),j.get(h).body=m,j.get(e).play(o),this.games.head&&this.games.head.state.lives--)},b.prototype.addToEngine=function(a){this.games=a.getNodeList(z.GameNode)},b.prototype.removeFromEngine=function(a){this.games=null},b.prototype.BeginContact=function(a){var b,c;switch(b=a.GetFixtureA().GetBody().GetUserData(),c=a.GetFixtureB().GetBody().GetUserData(),b.type){case m.ASTEROID:switch(c.type){case m.BULLET:this.collisions.push({type:f,a:c.entity,b:b.entity});break;case m.SPACESHIP:this.collisions.push({type:d,a:b.entity,b:c.entity})}break;case m.BULLET:c.type===m.ASTEROID&&this.collisions.push({type:f,a:b.entity,b:c.entity});break;case m.SPACESHIP:c.type===m.ASTEROID&&this.collisions.push({type:d,a:c.entity,b:b.entity})}},b.prototype.EndContact=function(a){},b.prototype.PreSolve=function(a,b){},b.prototype.PostSolve=function(a,b){},b}(ash.core.System),k=function(a){function b(a,c){this.PhysicsSystem=c,this.updateNode=M(this.updateNode,this),b.__super__.constructor.call(this,a.ash.nodes.DeathThroesNode,this.updateNode),this.entities=a.entities}return O(b,a),b.prototype.entities=null,b.prototype.PhysicsSystem=null,b.prototype.updateNode=function(a,b){var c;c=a.dead,c.countdown-=b,c.countdown<=0&&(this.entities.destroyEntity(a.entity),a.display.graphic.dispose(),this.PhysicsSystem.deadPool.push(c.body))},b}(ash.tools.ListIteratingSystem),r=function(a){function b(a){this.parent=a,this.update=M(this.update,this),this.entities=this.parent.entities,this.rnd=this.parent.rnd,this.width=this.parent.width,this.height=this.parent.height,this.nodes=this.parent.ash.nodes}return O(b,a),b.prototype.parent=null,b.prototype.config=null,b.prototype.entities=null,b.prototype.rnd=null,b.prototype.gameNodes=null,b.prototype.spaceships=null,b.prototype.asteroids=null,b.prototype.bullets=null,b.prototype.width=0,b.prototype.height=0,b.prototype.addToEngine=function(a){this.gameNodes=a.getNodeList(this.nodes.GameNode),this.spaceships=a.getNodeList(this.nodes.SpaceshipNode),this.asteroids=a.getNodeList(this.nodes.AsteroidCollisionNode),this.bullets=a.getNodeList(this.nodes.BulletCollisionNode)},b.prototype.update=function(a){var b,c,d,e,f,g,h,i;if(g=this.gameNodes.head,g&&g.state.playing){if(this.spaceships.empty)if(g.state.lives>0){for(f=new A(.5*this.width,.5*this.height),d=!0,b=this.asteroids.head;b;){if(A.distance(b.position.position,f)<=b.collision.radius+50){d=!1;break}b=b.next}d&&this.entities.createSpaceship()}else g.state.playing=!1,this.parent.score(g.state.hits),this.entities.createWaitForClick();if(this.asteroids.empty&&this.bullets.empty&&!this.spaceships.empty)for(i=this.spaceships.head,g.state.level++,c=2+g.state.level,e=0;c>e;){for(;;)if(h=new A(this.rnd.nextDouble()*this.width,this.rnd.nextDouble()*this.height),!(A.distance(h,i.position.position)<=80))break;this.entities.createAsteroid(30,h.x,h.y),++e}}},b.prototype.removeFromEngine=function(a){this.gameNodes=null,this.spaceships=null,this.asteroids=null,this.bullets=null},b}(ash.core.System),t=function(a){function b(a){var c;this.parent=a,this.updateNode=M(this.updateNode,this),b.__super__.constructor.call(this,this.parent.ash.nodes.GunControlNode,this.updateNode),this.keyPoll=this.parent.keyPoll,this.entities=this.parent.entities,this.buttons=null!=(c=this.parent.controller)?c.buttons:void 0}return O(b,a),b.prototype.keyPoll=null,b.prototype.entities=null,b.prototype.buttons=null,b.prototype.updateNode=function(a,b){var c,d,e,f;c=a.control,e=a.position,d=a.gun,d.shooting=this.keyPoll.isDown(c.trigger)||(null!=(f=this.buttons)?f.fire:void 0),d.timeSinceLastShot+=b,d.shooting&&d.timeSinceLastShot>=d.minimumShotInterval&&(this.entities.createUserBullet(d,e),a.audio.play(D),d.timeSinceLastShot=0)},b}(ash.tools.ListIteratingSystem),u=function(a){function b(a){this.updateNode=M(this.updateNode,this),b.__super__.constructor.call(this,a.ash.nodes.HudNode,this.updateNode)}return O(b,a),b.prototype.updateNode=function(a,b){a.hud.view.setLives(a.state.lives),a.hud.view.setScore(a.state.hits)},b}(ash.tools.ListIteratingSystem),C=function(a){function b(a){this.updateNode=M(this.updateNode,this),b.__super__.constructor.call(this,a.ash.nodes.PhysicsControlNode,this.updateNode),this.keyPoll=a.keyPoll,this.rnd=a.rnd,this.width=a.width,this.height=a.height,this.game=a.game,this.controller=a.controller}var c,d,e,f,g;return O(b,a),d=window.devicePixelRatio,c=null!=(null!=(g=window.ext)?g.IDTK_SRV_BOX2D:void 0),e=Box2D.Common.Math.b2Vec2,f=[16711680,65280,255,16711935,65535,16776960],b.prototype.keyPoll=null,b.prototype.rnd=null,b.prototype.warping=0,b.prototype.kount=0,b.prototype.width=0,b.prototype.height=0,b.prototype.updateNode=function(a,b){var e,g,h,i,j,k,l,m,n,o,p,q,r,s,t;return i=a.control,h=a.physics.body,this.warping?(this.warping--,o=this.rnd.nextInt(this.width),p=this.rnd.nextInt(this.height),h.SetPosition({x:o,y:p}),void(0===this.warping?a.display.graphic.draw(16777215):a.display.graphic.draw(f[this.rnd.nextInt(6)]))):this.keyPoll.isDown(i.warp)||(null!=(q=this.controller)&&null!=(r=q.buttons)?r.warp:void 0)?(this.controller.warp=!1,void(this.warping=this.rnd.nextInt(30)+30)):(j=null!=(s=this.controller)?s.dpad:void 0,null!=j&&(j.left&&(l=h.GetAngularVelocity(),h.SetAngularVelocity(l-i.rotationRate*b)),j.right&&(l=l||h.GetAngularVelocity(),h.SetAngularVelocity(l+i.rotationRate*b)),j.up&&(l=l||h.GetAngularVelocity(),n=h.GetLinearVelocity(),n.x+=Math.cos(l)*i.accelerationRate*b*d,n.y+=Math.sin(l)*i.accelerationRate*b*d,c||h.SetAwake(!0),h.SetLinearVelocity(n))),k=null!=(t=this.controller)?t.joystick:void 0,null!=k&&(g=Math.atan2(k.normalizedY,k.normalizedX)/Math.PI*180,e=Math.abs(g),l=h.GetAngularVelocity(),e>135&&179>e?h.SetAngularVelocity(l-i.rotationRate*b):e>1&&45>e?h.SetAngularVelocity(l+i.rotationRate*b):g>45&&135>g&&(m=127/Math.sqrt(k.normalizedX*k.normalizedX+k.normalizedY*k.normalizedY),n=h.GetLinearVelocity(),n.x+=Math.cos(l)*m*b*d,n.y+=Math.sin(l)*m*b*d,c||h.SetAwake(!0),h.SetLinearVelocity(n))),this.keyPoll.isDown(i.left)&&(l=h.GetAngularVelocity(),h.SetAngularVelocity(l-i.rotationRate*b)),this.keyPoll.isDown(i.right)&&(l=l||h.GetAngularVelocity(),h.SetAngularVelocity(l+i.rotationRate*b)),void(this.keyPoll.isDown(i.accelerate)&&(l=l||h.GetAngularVelocity(),n=h.GetLinearVelocity(),n.x+=Math.cos(l)*i.accelerationRate*b*d,n.y+=Math.sin(l)*i.accelerationRate*b*d,c||h.SetAwake(!0),h.SetLinearVelocity(n))))},b}(ash.tools.ListIteratingSystem),B=function(a){function b(a){this.update=M(this.update,this),this.nodes=a.ash.nodes}return O(b,a),b.prototype.stage=null,b.prototype.renderer=null,b.prototype.nodes=null,b.prototype.addToEngine=function(a){var b;for(this.nodes=a.getNodeList(this.nodes.RenderNode),b=this.nodes.head;b;)this.addToDisplay(b),b=b.next},b.prototype.addToDisplay=function(a){},b.prototype.removeFromDisplay=function(a){},b.prototype.removeFromEngine=function(a){this.nodes=null},b.prototype.update=function(a){var b,c,d,e;for(d=this.nodes.head;d;)b=d.display,c=b.graphic,e=d.position,c.x=e.position.x,c.y=e.position.y,c.rotation=e.rotation,d=d.next},b}(ash.core.System),I=function(){function a(){}return a.preUpdate=1,a.update=2,a.move=3,a.resolveCollisions=4,a.stateMachines=5,a.render=6,a.animate=7,a}(),J=function(a){function b(a){this.update=M(this.update,this),this.entities=a.entities}return O(b,a),b.prototype.engine=null,b.prototype.entities=null,b.prototype.gameNodes=null,b.prototype.waitNodes=null,b.prototype.asteroids=null,b.prototype.addToEngine=function(a){this.ash=a,this.waitNodes=a.getNodeList(z.WaitForStartNode),this.gameNodes=a.getNodeList(z.GameNode),this.asteroids=a.getNodeList(z.AsteroidCollisionNode)},b.prototype.removeFromEngine=function(a){this.waitNodes=null,this.gameNodes=null,this.asteroids=null},b.prototype.update=function(a){var b,c,d,e;if(e=this.waitNodes.head,c=this.gameNodes.head,e&&e.wait.startGame&&c){for(b=this.asteroids.head;b;)d=b.entity.get(Display).graphic,this.entities.destroyEntity(b.entity),d.dispose(),b=b.next;c.state.setForStart(),e.wait.startGame=!1,this.ash.removeEntity(e.entity)}},b}(ash.core.System),m=function(){function a(a){this.parent=a,this.createUserBullet=M(this.createUserBullet,this),
this.createSpaceship=M(this.createSpaceship,this),this.game=this.parent.game,this.ash=this.parent.ash,this.world=this.parent.world,this.rnd=this.parent.rnd}var b,e,f,g,i,k,l,m,n,o,p,q,r,s,t,u,x,y,z,A,B,C,D,E,F;return b=j.Animation,e=j.Asteroid,f=j.Audio,g=j.Bullet,i=j.Collision,k=j.DeathThroes,l=j.Display,o=j.GameState,p=j.Gun,q=j.GunControls,r=j.Hud,s=j.MotionControls,t=j.Physics,u=j.Position,x=j.Spaceship,y=j.WaitForStart,m=ash.core.Entity,n=ash.fsm.EntityStateMachine,a.ASTEROID=1,a.SPACESHIP=2,a.BULLET=3,a.prototype.LEFT=w.KEY_LEFT,a.prototype.RIGHT=w.KEY_RIGHT,a.prototype.THRUST=w.KEY_UP,a.prototype.FIRE=w.KEY_Z,a.prototype.WARP=w.KEY_SPACE,F=function(a){return parseFloat(asteroids.get(a))},z=Box2D.Dynamics.b2Body,A=Box2D.Dynamics.b2BodyDef,B=Box2D.Collision.Shapes.b2CircleShape,C=Box2D.Dynamics.b2FixtureDef,D=Box2D.Collision.Shapes.b2PolygonShape,E=Box2D.Common.Math.b2Vec2,a.prototype.game=null,a.prototype.ash=null,a.prototype.world=null,a.prototype.waitEntity=null,a.prototype.rnd=null,a.prototype.bulletId=0,a.prototype.asteroidId=0,a.prototype.spaceshipId=0,a.prototype.destroyEntity=function(a){this.ash.removeEntity(a)},a.prototype.createGame=function(){var a,b;return b=new v(this.game),a=new m("game").add(new o).add(new r(b)).add(new l(b)).add(new u(0,0,0,0)),this.ash.addEntity(a),a},a.prototype.createWaitForClick=function(){var a;return a=new K(this.game,this.parent),this.waitEntity=new m("wait").add(new y(a)).add(new l(a)).add(new u(0,0,0,0)),this.waitEntity.get(y).startGame=!1,this.ash.addEntity(this.waitEntity),this.waitEntity},a.prototype.createAsteroid=function(g,h,j){var o,p,q,r,s,v,w,x,y;return q=new A,q.type=z.b2_dynamicBody,q.fixedRotation=!0,q.position.x=h,q.position.y=j,x=(this.rnd.nextDouble()-.5)*F("asteroidLinearVelocity")*(50-g),y=(this.rnd.nextDouble()-.5)*F("asteroidLinearVelocity")*(50-g),q.linearVelocity.Set(x,y),q.angularVelocity=this.rnd.nextDouble()*F("asteroidAngularVelocity")-1,q.linearDamping=F("asteroidDamping"),s=new C,s.density=F("asteroidDensity"),s.friction=F("asteroidFriction"),s.restitution=F("asteroidRestitution"),s.shape=new B(g),p=this.world.CreateBody(q),p.CreateFixture(s),o=new m,v=new n(o),w=new d(this.parent,g),v.createState("alive").add(t).withInstance(new t(p)).add(i).withInstance(new i(g)).add(l).withInstance(new l(w)),r=new c(this.parent,g),v.createState("destroyed").add(k).withInstance(new k(3)).add(l).withInstance(new l(r)).add(b).withInstance(new b(r)),o.add(new e(v)).add(new u(h,j,0)).add(new f),p.SetUserData({type:a.ASTEROID,entity:o}),v.changeState("alive"),this.ash.addEntity(o),o},a.prototype.createSpaceship=function(){var c,d,e,g,h,j,o,r,v;return r=this.rnd.nextInt(this.parent.width),v=this.rnd.nextInt(this.parent.height),d=new A,d.type=z.b2_dynamicBody,d.fixedRotation=!1,d.position.x=r,d.position.y=v,d.linearVelocity.Set(0,0),d.angularVelocity=0,d.linearDamping=F("spaceshipDamping"),g=new C,g.density=F("spaceshipDensity"),g.friction=F("spaceshipFriction"),g.restitution=F("spaceshipRestitution"),g.shape=new D,g.shape.SetAsArray([new E(.45,0),new E(-.25,.25),new E(-.25,-.25)],3),c=this.world.CreateBody(d),c.CreateFixture(g),o=new m,h=new n(o),j=new H(this.game),h.createState("playing").add(t).withInstance(new t(c)).add(s).withInstance(new s(this.LEFT,this.RIGHT,this.THRUST,this.WARP,100,3)).add(p).withInstance(new p(8,0,.3,2)).add(q).withInstance(new q(this.FIRE)).add(i).withInstance(new i(9)).add(l).withInstance(new l(j)),e=new G(this.parent),h.createState("destroyed").add(k).withInstance(new k(5)).add(l).withInstance(new l(e)).add(b).withInstance(new b(e)),o.add(new x(h)).add(new u(r,v,0)).add(new f),c.SetUserData({type:a.SPACESHIP,entity:o}),h.changeState("playing"),this.ash.addEntity(o),o},a.prototype.createUserBullet=function(b,c){var d,e,f,j,k,n,o,p,q;return k=Math.cos(c.rotation),o=Math.sin(c.rotation),p=k*b.offsetFromParent.x-o*b.offsetFromParent.y+c.position.x,q=o*b.offsetFromParent.x+k*b.offsetFromParent.y+c.position.y,e=new A,e.type=z.b2_dynamicBody,e.fixedRotation=!0,e.bullet=!0,e.position.x=p,e.position.y=q,e.linearVelocity.Set(k*F("bulletLinearVelocity"),o*F("bulletLinearVelocity")),e.angularVelocity=0,e.linearDamping=F("bulletDamping"),n=new C,n.density=F("bulletDensity"),n.friction=F("bulletFriction"),n.restitution=F("bulletRestitution"),n.shape=new B(0),d=this.world.CreateBody(e),d.CreateFixture(n),j=new h(this.game),f=(new m).add(new g(b.bulletLifetime)).add(new u(p,q,0)).add(new i(0)).add(new t(d)).add(new l(j)),d.SetUserData({type:a.BULLET,entity:f}),this.ash.addEntity(f),f},a}(),a=function(){function a(a,b){this.name=a,this.properties=b,this.initializeDb=M(this.initializeDb,this),this.set=M(this.set,this),this.get=M(this.get,this),this.create=M(this.create,this),this.preload=M(this.preload,this),this.init=M(this.init,this),this.game=new Phaser.Game(this.width*this.scale,this.height*this.scale,Phaser.CANVAS,"",{init:this.init,preload:this.preload,create:this.create}),this.rnd=new y,this.initializeDb(this.name,this.properties)}var b;return b=function(a){return a.charAt(0).toUpperCase()+a.substr(1)},a.prototype.name="",a.prototype.game=null,a.prototype.height=window.innerHeight,a.prototype.width=window.innerWidth,a.prototype.scale=window.devicePixelRatio,a.prototype.init=function(){this.game.scale.scaleMode=Phaser.ScaleManager.SHOW_ALL,this.game.scale.minWidth=this.width*this.scale,this.game.scale.minHeight=this.height*this.scale,this.game.scale.maxWidth=this.width*this.scale,this.game.scale.maxHeight=this.height*this.scale,this.game.scale.pageAlignVertically=!0,this.game.scale.pageAlignHorizontally=!0},a.prototype.preload=function(){},a.prototype.create=function(){},a.prototype.get=function(a){var c;return c="get"+b(a),null!=this[c]?this[c]():Db.queryAll("settings",{query:{name:a}})[0].value},a.prototype.set=function(a,c){var d;d="set"+b(a),null!=this[d]?this[d](c):(Db.update("settings",{name:a},function(a){return a.value=c,a}),Db.commit())},a.prototype.initializeDb=function(a,b){var c,d,e;if(window.Db=new localStorageDB(a,localStorage),c=Db.isNew()){Db.createTable("settings",["name","value"]),Db.createTable("leaderboard",["date","score"]);for(d in b)e=b[d],Db.insert("settings",{name:d,value:e});Db.commit()}return c},a}(),s=function(){function a(a){this.parent=a,this.fade=M(this.fade,this),this.getFaderSprite=M(this.getFaderSprite,this),this.pause=M(this.pause,this),this.onSettings=M(this.onSettings,this),this.game=this.parent.game,this.height=this.parent.height,this.width=this.parent.width,this.optBgd=this.parent.optBgd,Cocoon.App.WebView.on("load",{success:function(a){return function(){return Cocoon.App.showTheWebView()}}(this),error:function(a){return function(){return console.log("Cannot show the Webview: "+JSON.stringify(arguments))}}(this)}),this.game.add.button(this.width-50,50,"settings",this.onSettings)}return a.prototype.parent=null,a.prototype.game=null,a.prototype.faderBitmap=null,a.prototype.faderSprite=null,a.prototype.optBgd="",a.prototype.height=0,a.prototype.width=0,a.prototype.onSettings=function(){this.pause(function(a){return function(){return Cocoon.App.loadInTheWebView("settings.html")}}(this))},a.prototype.pause=function(a){null!=a?(this.faderSprite=null,this.parent.physics.enabled=!1,this.fade(a)):this.fade(function(a){return function(){return a.parent.physics.enabled=!0}}(this))},a.prototype.getFaderSprite=function(){return null==this.faderSprite&&(this.faderBitmap=this.game.make.bitmapData(this.game.width,this.game.height),this.faderBitmap.rect(0,0,this.game.width,this.game.height,"rgb(0,0,0)"),this.faderSprite=this.game.add.sprite(0,0,this.faderBitmap),this.faderSprite.alpha=0),this.faderSprite.bringToTop()},a.prototype.fade=function(a){var b,c;c=this.getFaderSprite(),b=this.game.add.tween(c),0===c.alpha?(b.to({alpha:1},500),b.onComplete.add(a,this),b.start()):(this.game.paused=!1,b.to({alpha:0},500),b.onComplete.add(a,this),b.start())},a}(),p=function(a){function b(a,c,d,e){this.parent=a,this.fbAppId=c,this.name=d,this.title=e,this.score=M(this.score,this),this.showLocal=M(this.showLocal,this),this.showServer=M(this.showServer,this),this.show=M(this.show,this),this.onLogin=M(this.onLogin,this),this.onLeaderboard=M(this.onLeaderboard,this),b.__super__.constructor.call(this,this.parent),this.fb=Cocoon.Social.Facebook,this.fb.init({appId:this.fbAppId}),console.log("player",this.parent.get("player")),console.log("userId",this.parent.get("userId")),console.log("leaderboard",this.parent.get("leaderboard")),"on"===this.parent.get("leaderboard")?this.fb.getLoginStatus(function(a){return function(b){return a.fbUserID=b.userID,"connected"===b.status?a.fbStatus=1:(a.fbStatus=0,a.fbButton=a.game.add.button((a.width-195)/2,50,"fb-login",a.onLogin))}}(this)):(this.fbStatus=0,this.fbButton=this.game.add.button((this.width-195)/2,50,"fb-login",this.onLogin)),this.game.add.button(this.width-50,125,"leaderboard",this.onLeaderboard)}return O(b,a),b.prototype.name="",b.prototype.title="",b.prototype.fb=null,b.prototype.fbButton=null,b.prototype.fbAppId="",b.prototype.fbUserID="",b.prototype.fbUserName="",b.prototype.fbStatus=0,b.prototype.onLeaderboard=function(){this.pause(function(a){return function(){return a.show(a.pause)}}(this))},b.prototype.onLogin=function(){return this.pause(function(a){return function(){return a.fb.login(function(b){return b.authResponse?a.fb.api("/me",function(b){return console.log(b),a.pause(),b.error?console.error("login error: "+b.error.message):(console.log("login succeeded"),a.fbButton.input.enabled=!1,a.fbButton.alpha=0,a.fbStatus=1,a.fbUserID=b.id,a.fbUserName=b.name,""===a.parent.get("player")||a.parent.get("player")===a.fbUserName?(a.parent.set("player",a.fbUserName),a.parent.set("userId",a.fbUserID),a.parent.set("leaderboard","on"),Cocoon.App.loadInTheWebView("settings.html")):void 0)}):void 0})}}(this))},b.prototype.show=function(a){var b;null==a&&(a=function(){}),1===this.fbStatus?(b=new XMLHttpRequest,b.onreadystatechange=function(a){return function(){var c;return 4===b.readyState&&200===b.status?(c=JSON.parse(b.responseText),a.showServer(c)):void 0}}(this),b.open("get",HOST+"/leaderboard/"+this.name+"/"+this.get("player"),!0),b.setRequestHeader("Content-Type","application/json; charset=UTF-8"),b.send()):this.showLocal(Db.queryAll("leaderboard",{limit:10,sort:[["score","DESC"]]}),a)},b.prototype.showServer=function(a,b){var c,d,e,f,g,h,i,j,k,l,m;for(d=this.game.add.group(),f=new Phaser.Sprite(this.game,0,0,"dialog-"+this.optBgd),f.width=this.width,f.height=this.height,d.add(f),c={font:"bold 30px opendyslexic",fill:"#ffffff"},h={font:"bold 20px opendyslexic",fill:"#ffffff"},j=new Phaser.Text(this.game,this.width/2,20,this.title+" - "+this.get("player"),c),j.anchor.x=.5,d.add(j),d.add(new Phaser.Text(this.game,200,80,"##",h)),d.add(new Phaser.Text(this.game,300,80,"Name",h)),d.add(new Phaser.Text(this.game,500,80,"Score",h)),d.add(new Phaser.Text(this.game,200,100,"--",h)),d.add(new Phaser.Text(this.game,300,100,"--------",h)),d.add(new Phaser.Text(this.game,500,100,"--------",h)),k=120,l=0,m=a.length;m>l;l++)i=a[l],d.add(new Phaser.Text(this.game,200,k,i.rank,h)),d.add(new Phaser.Text(this.game,300,k,i.member,h)),d.add(new Phaser.Text(this.game,500,k,i.score,h)),k+=20;e=new Phaser.Button(this.game,this.width/2,this.height-64,"button-"+this.optBgd,function(a){return function(){d.destroy(),d=null,b()}}(this)),e.anchor.x=.5,d.add(e),g=new Phaser.Text(this.game,0,e.height/2,"continue",c),g.anchor.x=.5,g.anchor.y=.5,e.addChild(g)},b.prototype.showLocal=function(a,b){var c,d,e,f,g,h,i,j,k,l,m,n;for(d=this.game.add.group(),f=new Phaser.Sprite(this.game,0,0,"dialog-"+this.optBgd),f.width=this.width,f.height=this.height,d.add(f),c={font:"bold 30px opendyslexic",fill:"#ffffff"},i={font:"bold 20px opendyslexic",fill:"#ffffff"},k=new Phaser.Text(this.game,this.width/2,20,this.title,c),k.anchor.x=.5,d.add(k),d.add(new Phaser.Text(this.game,200,80,"Date",i)),d.add(new Phaser.Text(this.game,400,80,"Score",i)),d.add(new Phaser.Text(this.game,200,100,"--------",i)),d.add(new Phaser.Text(this.game,400,100,"--------",i)),l=120,m=0,n=a.length;n>m;m++)j=a[m],h=j.date.substr(4,2)+"/"+j.date.substr(6,2)+"/"+j.date.substr(0,4),d.add(new Phaser.Text(this.game,200,l,h,i)),d.add(new Phaser.Text(this.game,400,l,j.score,i)),l+=20;e=new Phaser.Button(this.game,this.width/2,this.height-64,"button-"+this.optBgd,function(a){return function(){d.destroy(),d=null,b()}}(this)),e.anchor.x=.5,d.add(e),g=new Phaser.Text(this.game,0,e.height/2,"continue",c),g.anchor.x=.5,g.anchor.y=.5,e.addChild(g)},b.prototype.score=function(a){var b,c,d,e,f,g,h;e=new Date,d=(e.getMonth()+1).toString(),1===d.length&&(d="0"+d),b=e.getDate().toString(),1===b.length&&(b="0"+b),g=e.getFullYear().toString(),h=g+d+b,0===this.fbStatus?(0===Db.queryAll("leaderboard",{query:{date:h}}).length?Db.insert("leaderboard",{date:h,score:a}):Db.update("leaderboard",{date:h},function(b){return a>b.score&&(b.score=a),b}),Db.commit()):(c={key:L(this.fbAppId,this.fbUserID),dt:Date.now(),id:this.name,title:this.title,appId:this.fbAppId,userId:this.fbUserID,date:h,score:a,userName:this.parent.get("player")},f=new XMLHttpRequest,f.open("post",HOST+"/leaderboard/score",!0),f.setRequestHeader("Content-Type","application/json; charset=UTF-8"),f.send(JSON.stringify(c)))},b}(s),x=function(a){function b(a,c,d){this.parent=a,this.name=c,this.title=d,this.score=M(this.score,this),this.showLocal=M(this.showLocal,this),this.show=M(this.show,this),this.onLeaderboard=M(this.onLeaderboard,this),b.__super__.constructor.call(this,this.parent),this.game.add.button(this.width-50,125,"leaderboard",this.onLeaderboard)}return O(b,a),b.prototype.name="",b.prototype.title="",b.prototype.fb=null,b.prototype.fbButton=null,b.prototype.fbAppId="",b.prototype.fbUserID="",b.prototype.fbUserName="",b.prototype.fbStatus=0,b.prototype.onLeaderboard=function(){this.pause(function(a){return function(){return a.show(a.pause)}}(this))},b.prototype.show=function(a){null==a&&(a=function(){}),this.showLocal(Db.queryAll("leaderboard",{limit:10,sort:[["score","DESC"]]}),a)},b.prototype.showLocal=function(a,b){var c,d,e,f,g,h,i,j,k,l,m,n;for(d=this.game.add.group(),f=new Phaser.Sprite(this.game,0,0,"dialog-"+this.optBgd),f.width=this.width,f.height=this.height,d.add(f),c={font:"bold 30px opendyslexic",fill:"#ffffff"},i={font:"bold 20px opendyslexic",fill:"#ffffff"},k=new Phaser.Text(this.game,this.width/2,20,this.title,c),k.anchor.x=.5,d.add(k),d.add(new Phaser.Text(this.game,200,80,"Date",i)),d.add(new Phaser.Text(this.game,400,80,"Score",i)),d.add(new Phaser.Text(this.game,200,100,"--------",i)),d.add(new Phaser.Text(this.game,400,100,"--------",i)),l=120,m=0,n=a.length;n>m;m++)j=a[m],h=j.date.substr(4,2)+"/"+j.date.substr(6,2)+"/"+j.date.substr(0,4),d.add(new Phaser.Text(this.game,200,l,h,i)),d.add(new Phaser.Text(this.game,400,l,j.score,i)),l+=20;e=new Phaser.Button(this.game,this.width/2,this.height-64,"button-"+this.optBgd,function(a){return function(){d.destroy(),d=null,b()}}(this)),e.anchor.x=.5,d.add(e),g=new Phaser.Text(this.game,0,e.height/2,"continue",c),g.anchor.x=.5,g.anchor.y=.5,e.addChild(g)},b.prototype.score=function(a){var b,c,d,e,f;d=new Date,c=(d.getMonth()+1).toString(),1===c.length&&(c="0"+c),b=d.getDate().toString(),1===b.length&&(b="0"+b),e=d.getFullYear().toString(),f=e+c+b,0===Db.queryAll("leaderboard",{query:{date:f}}).length?Db.insert("leaderboard",{date:f,score:a}):Db.update("leaderboard",{date:f},function(b){return a>b.score&&(b.score=a),b}),Db.commit()},b}(s),e=function(a){function c(){this.setPlaySfx=M(this.setPlaySfx,this),this.setPlayMusic=M(this.setPlayMusic,this),this.setBackground=M(this.setBackground,this),this.getBackground=M(this.getBackground,this),this.getFbUserName=M(this.getFbUserName,this),this.getFbUserID=M(this.getFbUserID,this),this.getFbAppId=M(this.getFbAppId,this),this.score=M(this.score,this),this.resume=M(this.resume,this),this.create=M(this.create,this),this.preload=M(this.preload,this),c.__super__.constructor.call(this,"asteroids",this.properties)}var d,e;return O(c,a),d=Box2D.Common.Math.b2Vec2,e=Box2D.Dynamics.b2World,c.prototype.pad=null,c.prototype.profiler=null,c.prototype.engine=null,c.prototype.entities=null,c.prototype.keyPoll=null,c.prototype.world=null,c.prototype.physics=null,c.prototype.background=null,c.prototype.leaderboard=null,c.prototype.bgdColor=6970061,c.prototype.playMusic=!0,c.prototype.playSfx=!0,c.prototype.optBgd="blue",c.prototype.properties={profiler:"on",leaderboard:"off",player:"",userId:"",background:"blue",playMusic:"50",playSfx:"50",asteroidDensity:"1.0",asteroidFriction:"1.0",asteroidRestitution:"0.2",asteroidDamping:"0.0",asteroidLinearVelocity:"4.0",asteroidAngularVelocity:"2.0",spaceshipDensity:"1.0",spaceshipFriction:"1.0",spaceshipRestitution:"0.2",spaceshipDamping:"0.75",bulletDensity:"1.0",bulletFriction:"0.0",bulletRestitution:"0.0",bulletDamping:"0.0",bulletLinearVelocity:"150"},c.prototype.preload=function(){this.game.load.image("fb-login","res/fb-login.png"),this.game.load.image("dialog-blue","res/dialog-box.png"),this.game.load.image("dialog-star","res/black-dialog.png"),this.game.load.image("button-blue","res/standard-button-on.png"),this.game.load.image("button-star","res/black-button-on.png"),this.game.load.image("background","res/BackdropBlackLittleSparkBlack.png"),this.game.load.image("leaderboard","res/icons/b_Leaderboard.png"),this.game.load.image("settings","res/icons/b_Parameters.png"),this.game.load.image("round","res/round48.png"),this.game.load.image("square","res/square48.png"),this.game.load.audio("asteroid",[n.prototype.src]),this.game.load.audio("ship",[o.prototype.src]),this.game.load.audio("shoot",[D.prototype.src])},c.prototype.create=function(){var a,c;c=!(!window.ext||"undefined"==typeof window.ext.IDTK_SRV_BOX2D),this.profiler=this.game.plugins.add(Phaser.Plugin.PerformanceMonitor,{profiler:this.get("profiler")}),this.optBgd=Db.queryAll("settings",{query:{name:"background"}})[0].value,this.game.stage.backgroundColor=this.bgdColor,this.background=this.game.add.sprite(0,0,"background"),this.background.width=this.width,this.background.height=this.height,this.background.alpha="blue"===this.optBgd?0:1,c?this.leaderboard=new x(this,"asteroids","Asteroid Simulator"):this.leaderboard=new p(this,"887669707958104","asteroids","Asteroid Simulator"),n.audio=this.game.add.audio("asteroid"),n.audio.play("",0,0),o.audio=this.game.add.audio("ship"),o.audio.play("",0,0),D.audio=this.game.add.audio("shoot"),D.audio.play("",0,0),this.keyPoll=new w(this),this.world=new e(new d(0,0),!0),this.world.SetContinuousPhysics(!0),this.ash=this.game.plugins.add(ash.ext.PhaserEngine,z,j),this.entities=new m(this),this.controller=this.game.plugins.add(Phaser.Plugin.GameControllerPlugin,{force:!1}),this.controller.addDPad("left",60,this.height-60,{up:{width:"10%",height:"7%"},left:{width:"7%",height:"10%"},right:{width:"7%",height:"10%"},down:!1}),this.controller.addButtons("right",this.width-180,this.height-80,{1:{title:"warp",color:"yellow"},3:{title:"FIRE",color:"red"}}),a=c?q:E,this.physics=new a(this),this.ash.addSystem(this.physics,I.move),this.ash.addSystem(new g(this,a),I.update),this.ash.addSystem(new k(this,a),I.update),this.ash.addSystem(new i(this,a),I.resolveCollisions),this.ash.addSystem(new b(this),I.animate),this.ash.addSystem(new u(this),I.animate),this.ash.addSystem(new B(this),I.render),this.ash.addSystem(new f(this),I.render),this.ash.addSystem(new J(this),I.preUpdate),this.ash.addSystem(new r(this),I.preUpdate),this.ash.addSystem(new C(this),I.update),this.ash.addSystem(new t(this),I.update),this.entities.createWaitForClick(),this.entities.createGame()},c.prototype.resume=function(){this.leaderboard.pause()},c.prototype.score=function(a){this.leaderboard.score(a)},c.prototype.getFbAppId=function(){return this.leaderboard.fbAppId},c.prototype.getFbUserID=function(){return this.leaderboard.fbUserID},c.prototype.getFbUserName=function(){return this.leaderboard.fbUserName},c.prototype.getBackground=function(){return"blue"===Db.queryAll("settings",{query:{name:"background"}})[0].value?0:1},c.prototype.setBackground=function(a){var b;b=["blue","star"],this.background.alpha=a,this.optBgd=b[a],Db.update("settings",{name:"background"},function(c){return c.value=b[a],c}),Db.commit()},c.prototype.setPlayMusic=function(a){Db.update("settings",{name:"playMusic"},function(b){return b.value=a,b}),Db.commit(),this.playMusic=a},c.prototype.setPlaySfx=function(a){Db.update("settings",{name:"playSfx"},function(b){return b.value=a,b}),Db.commit(),this.playSfx=a,F.volume=a/100},c}(a),Phaser.Plugin.PerformanceMonitor=function(a){function b(a,c){b.__super__.constructor.call(this,a,c)}return O(b,a),b.prototype.stats=null,b.prototype.visible=!1,b.prototype.active=!1,b.prototype.hasPreUpdate=!1,b.prototype.hasPostRender=!1,b.prototype.init=function(a){var b,c,d,e,f,g;return navigator.isCocoonJS||"off"===a.profiler?(this.preUpdate=this.nop,this.postRender=this.nop):"undefined"!=typeof Stats&&null!==Stats?(null!=a.container?b=a.container:(b=document.createElement("div"),document.body.appendChild(b)),this.stats=new Stats,b.appendChild(this.stats.domElement),this.stats.domElement.style.position="absolute",c=null!=(e=a.x)?e:0,d=null!=(f=a.y)?f:0,this.stats.setMode(null!=(g=a.mode)?g:0),this.stats.domElement.style.position="absolute",this.stats.domElement.style.left=""+c+"px",this.stats.domElement.style.top=""+d+"px",this.active=!0,this.visible=!0,this.hasPreUpdate=!0,this.hasPostRender=!0):(this.preUpdate=this.nop,this.postRender=this.nop)},b.prototype.preUpdate=function(){this.stats.begin()},b.prototype.postRender=function(){this.stats.end()},b.prototype.nop=function(){},b}(Phaser.Plugin),function(){return window.addEventListener("load",function(){return window.asteroids=new e})}()}).call(this);