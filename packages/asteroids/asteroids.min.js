(function(){"use strict";var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H=function(a,b){return function(){return a.apply(b,arguments)}},I={}.hasOwnProperty,J=function(a,b){function c(){this.constructor=a}for(var d in b)I.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a};u=function(){function a(a){var c;switch(this.mt=function(){c=[];for(var a=0;e>=0?e>a:a>e;e>=0?a++:a--)c.push(a);return c}.apply(this),typeof a){case"number":this.init_genrand(a);break;case"object":this.init_genrand(a,a.length);break;default:this.init_genrand(Date.now()%b)}}var b,c,d,e,f;return e=624,c=397,d=2567483615,f=2147483648,b=2147483647,a.prototype.mt=null,a.prototype.mti=e+1,a.prototype.nextBool=function(){return 1===(1&this.genrand_int32())},a.prototype.nextDouble=function(){return this.genrand_res53()},a.prototype.nextInt=function(a){return~~(this.genrand_res53()*a)},a.prototype.init_genrand=function(a){for(this.mt[0]=4294967295&a,this.mti=1;this.mti<e;)this.mt[this.mti]=1812433253*(this.mt[this.mti-1]^this.mt[this.mti-1]>>30)+this.mti,this.mt[this.mti]&=4294967295,this.mti++},a.prototype.init_by_array=function(a,b){var c,d,f;for(this.init_genrand(19650218),c=1,d=0,f=e>b?e:b;f>0;)this.mt[c]=(this.mt[c]^1664525*(this.mt[c-1]^this.mt[c-1]>>30))+a[d]+d,this.mt[c]&=4294967295,c++,d++,c>=e&&(this.mt[0]=this.mt[e-1],c=1),d>=b&&(d=0),f--;for(f=e-1;f>0;)this.mt[c]=(this.mt[c]^1566083941*(this.mt[c-1]^this.mt[c-1]>>30))-c,this.mt[c]&=4294967295,c++,c>=e&&(this.mt[0]=this.mt[e-1],c=1),f--;this.mt[0]=2147483648},a.prototype.genrand_int32=function(){var a,g,h;if(g=[0,d],this.mti>=e){for(this.mti===e+1&&this.init_genrand(5489),a=0;e-c>a;)h=this.mt[a]&f|this.mt[a+1]&b,this.mt[a]=this.mt[a+c]^h>>1^g[1&h],a++;for(;e-1>a;)h=this.mt[a]&f|this.mt[a+1]&b,this.mt[a]=this.mt[a+(c-e)]^h>>1^g[1&h],a++;h=this.mt[e-1]&f|this.mt[0]&b,this.mt[e-1]=this.mt[c-1]^h>>1^g[1&h],this.mti=0}return h=this.mt[this.mti++],h^=h>>11,h^=h<<7&2636928640,h^=h<<15&4022730752,h^=h>>18,h>>0},a.prototype.genrand_int31=function(){return this.genrand_int32()>>1},a.prototype.genrand_real1=function(){return this.genrand_int32()*(1/4294967296)},a.prototype.genrand_real2=function(){return this.genrand_int32()*(1/4294967296)},a.prototype.genrand_real3=function(){return(this.genrand_int32()+.5)*(1/4294967296)},a.prototype.genrand_res53=function(){var a,b;return a=this.genrand_int32()>>5,b=this.genrand_int32()>>6,(67108864*a+b)*(1/9007199254740992)},a}(),w=function(){function a(a,b){this.x=null!=a?a:0,this.y=null!=b?b:0}return a.prototype.x=0,a.prototype.y=0,a.distance=function(a,b){var c,d;return c=a.x-b.x,d=a.y-b.y,Math.sqrt(c*c+d*d)},a.prototype.distanceSquaredTo=function(a){var b,c;return b=this.x-a.x,c=this.y-a.y,b*b+c*c},a.prototype.distanceTo=function(a){var b,c;return b=this.x-a.x,c=this.y-a.y,Math.sqrt(b*b+c*c)},a}(),t=function(){function a(a){this.parent=a,this.isUp=H(this.isUp,this),this.isDown=H(this.isDown,this),this.keyUpListener=H(this.keyUpListener,this),this.keyDownListener=H(this.keyDownListener,this),this.states={},window.addEventListener("keydown",this.keyDownListener),window.addEventListener("keyup",this.keyUpListener)}return a.KEY_LEFT=37,a.KEY_UP=38,a.KEY_RIGHT=39,a.KEY_Z=90,a.KEY_W=87,a.KEY_SPACE=32,a.prototype.states=null,a.prototype.keys=[a.KEY_LEFT,a.KEY_RIGHT,a.KEY_Z,a.KEY_UP,a.KEY_SPACE],a.prototype.keyDownListener=function(a){this.states[a.keyCode]=!0},a.prototype.keyUpListener=function(a){this.states[a.keyCode]&&(this.states[a.keyCode]=!1)},a.prototype.isDown=function(a){return this.states[a]},a.prototype.isUp=function(a){return!this.states[a]},a.prototype.buttons=function(a,b){var c,d;return c=a.add.button(b.width-100,b.height-50,"round"),c.onInputDown.add(function(a){return function(){a.states[a.keys[2]]=!0}}(this)),c.onInputUp.add(function(a){return function(){a.states[a.keys[2]]=!1}}(this)),d=a.add.button(b.width/2,b.height-50,"square"),d.anchor.x=.5,d.onInputDown.add(function(a){return function(){a.states[a.keys[4]]=!0}}(this)),d.onInputUp.add(function(a){return function(){a.states[a.keys[4]]=!1}}(this))},a}(),B=function(){function a(){this.audio=new window.Audio,this.audio.src=this.src,this.audio.load()}return a.volume=.5,a.enabled=!0,a.FACTOR=2,a.preload=function(a){var b;return b=new window.Audio,b.src=a,b.volume=0,b.play(),a},a.prototype.src="",a.prototype.audio=null,a.prototype.loop=function(){return this},a.prototype.play=function(){return a.enabled&&(this.audio.volume=a.volume,this.audio.play()),this},a.prototype.pause=function(){return this.audio.pause(),this},a}(),m=function(){function a(){}return a.prototype.src=B.preload("res/sounds/asteroid.wav"),a.prototype.play=function(){return a.audio.play("",0,B.volume/B.FACTOR)},a}(),n=function(){function a(){}return a.prototype.src=B.preload("res/sounds/ship.wav"),a.prototype.play=function(){return a.audio.play("",0,B.volume/B.FACTOR)},a}(),z=function(){function a(){}return a.prototype.src=B.preload("res/sounds/shoot.wav"),a.prototype.play=function(){return a.audio.play("",0,B.volume/B.FACTOR)},a}(),c=function(){function a(a,b){var c,d,e,f,g,h;for(d=a.game,h=a.rnd,this.graphics=d.add.graphics(0,0),this.graphics.clear(),c=0,this.graphics.beginFill(16777215),this.graphics.moveTo(b,0);c<2*Math.PI;)e=(.75+.25*h.nextDouble())*b,f=Math.cos(c)*e,g=Math.sin(c)*e,this.graphics.lineTo(f,g),c+=.5*h.nextDouble();this.graphics.moveTo(b,0),this.graphics.endFill()}return a.prototype.graphics=null,Object.defineProperties(a.prototype,{x:{get:function(){return this.graphics.x},set:function(a){return this.graphics.x=a}},y:{get:function(){return this.graphics.x},set:function(a){return this.graphics.y=a}},rotation:{get:function(){return this.graphics.rotation},set:function(a){return this.graphics.rotation=a}}}),a.prototype.dispose=function(){return this.graphics.destroy()},a}(),b=function(){function a(a,b){this.animate=H(this.animate,this);var c,d,e;for(this.dots=[],d=e=0;8>e;d=++e)c=new k(a.game,a.rnd,b),this.dots.push(c)}return a.prototype.dots=null,a.prototype.x=0,a.prototype.y=0,a.prototype.rotation=0,a.prototype.stage=null,a.prototype.first=!0,a.prototype.animate=function(a){var b,c,d,e,f,g,h,i;if(this.first)for(this.first=!1,g=this.dots,c=0,e=g.length;e>c;c++)b=g[c],b.graphics.x=this.x,b.graphics.y=this.y;for(h=this.dots,i=[],d=0,f=h.length;f>d;d++)b=h[d],b.graphics.x+=b.velocity.x*a,i.push(b.graphics.y+=b.velocity.y*a);return i},a.prototype.dispose=function(){var a,b,c,d,e;for(d=this.dots,e=[],b=0,c=d.length;c>b;b++)a=d[b],e.push(a.graphics.destroy());return e},a}(),k=function(){function a(a,b,c){var d,e,f;this.graphics=a.add.graphics(0,0),this.graphics.beginFill(16777215),this.graphics.drawCircle(0,0,1),this.graphics.endFill(),d=2*b.nextDouble()*Math.PI,e=b.nextDouble()*c,this.graphics.x=Math.cos(d)*e,this.graphics.y=Math.sin(d)*e,f=10*b.nextDouble()+10,this.velocity=new w(Math.cos(d)*f,Math.sin(d)*f)}return a.prototype.velocity=null,a.prototype.graphics=null,a.prototype.x=0,a.prototype.y=0,a}(),g=function(){function a(a){this.graphics=a.add.graphics(0,0),this.graphics.beginFill(16777215),this.graphics.drawCircle(0,0,2),this.graphics.endFill()}return a.prototype.graphics=null,Object.defineProperties(a.prototype,{x:{get:function(){return this.graphics.x},set:function(a){return this.graphics.x=a}},y:{get:function(){return this.graphics.x},set:function(a){return this.graphics.y=a}},rotation:{get:function(){return this.graphics.rotation},set:function(a){return this.graphics.rotation=a}}}),a.prototype.dispose=function(){return this.graphics.destroy()},a}(),s=function(){function a(a,b){this.setScore=H(this.setScore,this),this.setLives=H(this.setLives,this),this.graphics=a.add.graphics(0,100),this.graphics.beginFill(12632256),this.graphics.drawRect(0,0,30,40),this.graphics.endFill(),this.graphics.alpha=.5,this.score=a.add.text(window.innerWidth-130,20,"",{font:"bold 18px opendyslexic",fill:"white"}),this.setScore(0),this.setLives(3)}return a.prototype.graphics=null,a.prototype.score=null,a.prototype.lives=null,a.prototype.x=0,a.prototype.y=0,a.prototype.rotation=0,a.prototype.dispose=function(){return this.graphics.destroy(),this.score.destroy()},a.prototype.setLives=function(a){var b,c,d;for(this.graphics.clear(),this.graphics.beginFill(12632256),this.graphics.drawRect(0,0,30,40),this.graphics.endFill(),this.graphics.beginFill(0),c=d=0;a>=0?a>d:d>a;c=a>=0?++d:--d)b=10*c+10,this.graphics.moveTo(20,b),this.graphics.lineTo(3,7+b),this.graphics.lineTo(6,b),this.graphics.lineTo(3,-7+b),this.graphics.lineTo(20,b);this.graphics.endFill(),this.graphics.alpha=.5},a.prototype.setScore=function(a){this.score.setText("SCORE: "+a)},a}(),C=function(){function a(a){this.animate=H(this.animate,this);var b,c;b=a.game,c=a.rnd,this.shape1=b.add.graphics(0,0),this.shape1.clear(),this.shape1.beginFill(16777215),this.shape1.moveTo(10,0),this.shape1.lineTo(-7,7),this.shape1.lineTo(-4,0),this.shape1.lineTo(10,0),this.shape1.endFill(),this.shape2=b.add.graphics(0,0),this.shape2.clear(),this.shape2.beginFill(16777215),this.shape2.moveTo(10,0),this.shape2.lineTo(-7,-7),this.shape2.lineTo(-4,0),this.shape2.lineTo(10,0),this.shape2.endFill(),this.vel1=new w(10*c.nextDouble()-5,10*c.nextDouble()+10),this.vel2=new w(10*c.nextDouble()-5,-(10*c.nextDouble()+10)),this.rot1=300*c.nextDouble()-150,this.rot2=300*c.nextDouble()-150}return a.prototype.shape1=null,a.prototype.shape2=null,a.prototype.vel1=null,a.prototype.vel2=null,a.prototype.rot1=null,a.prototype.rot2=null,a.prototype.first=!0,a.prototype.x=0,a.prototype.y=0,a.prototype.rotation=0,a.prototype.check=!0,a.prototype.dispose=function(){return this.shape1.destroy(),this.shape2.destroy()},a.prototype.animate=function(a){this.first&&(this.first=!1,this.shape1.x=this.shape2.x=this.x,this.shape1.y=this.shape2.y=this.y,this.shape1.rotation=this.shape2.rotation=this.rotation),this.shape1.x+=this.vel1.x*a,this.shape1.y+=this.vel1.y*a,this.shape1.rotation+=this.rot1*a,this.shape2.x+=this.vel2.x*a,this.shape2.y+=this.vel2.y*a,this.shape2.rotation+=this.rot2*a},a}(),D=function(){function a(a){this.graphics=a.add.graphics(0,0),this.draw(16777215)}return a.prototype.graphics=null,Object.defineProperties(a.prototype,{x:{get:function(){return this.graphics.x},set:function(a){return this.graphics.x=a}},y:{get:function(){return this.graphics.x},set:function(a){return this.graphics.y=a}},rotation:{get:function(){return this.graphics.rotation},set:function(a){return this.graphics.rotation=a}}}),a.prototype.dispose=function(){return this.graphics.destroy()},a.prototype.draw=function(a){return this.graphics.clear(),this.graphics.beginFill(a),this.graphics.moveTo(10,0),this.graphics.lineTo(-7,7),this.graphics.lineTo(-4,0),this.graphics.lineTo(-7,-7),this.graphics.lineTo(10,0),this.graphics.endFill()},a}(),G=function(){function a(c,d){var e,f;this.game=c,this.parent=d,this.start1=H(this.start1,this),this.start=H(this.start,this),this.click=new b,e=Math.floor(window.innerWidth/2),f=window.innerHeight-40,this.text1=1===a.count++?this.game.add.text(e,85,"GAME OVER",{font:"bold 60px opendyslexic",fill:"white",stroke:"black",strokeThickness:30}):this.game.add.text(e,85,"ASTEROIDS",{font:"bold 60px opendyslexic",fill:"white",stroke:"black",strokeThickness:30}),this.text2=this.game.device.touch?this.game.add.text(e,175,"TOUCH TO START",{font:"bold 12px opendyslexic",fill:"white"}):this.game.add.text(e,175,"CLICK TO START",{font:"bold 12px opendyslexic",fill:"white"}),this.text1.anchor.x=.5,this.text2.anchor.x=.5,this.game.device.desktop&&(this.text3=this.game.add.text(e,f,"Z ~ Fire  |  SPACE ~ Warp  |  Left/Right ~ Turn  |  Up ~ Accelerate",{font:"bold 10px opendyslexic",fill:"white"}),this.text3.anchor.x=.5),this.text1.inputEnabled=!0,this.text2.inputEnabled=!0,this.text1.events.onInputDown.add(this.start),this.text2.events.onInputDown.add(this.start)}var b;return a.count=0,b=ash.signals.Signal0,a.prototype.x=0,a.prototype.y=0,a.prototype.rotation=0,a.prototype.text1=null,a.prototype.text2=null,a.prototype.text3=null,a.prototype.click=null,a.prototype.start=function(a){var b;return this.faderBitmap=this.game.make.bitmapData(this.game.width,this.game.height),this.faderBitmap.rect(0,0,this.game.width,this.game.height,"rgb(0,0,0)"),this.faderSprite=this.game.add.sprite(0,0,this.faderBitmap),this.faderSprite.alpha=0,b=this.game.add.tween(this.faderSprite),b.to({alpha:1},1e3),b.onComplete.add(this.start1),b.start()},a.prototype.start1=function(){var a,b,c;return this.text1.destroy(),this.text2.destroy(),null!=(b=this.text3)&&b.destroy(),a=this.game.add.tween(this.faderSprite),a.to({alpha:0},1e3),a.onComplete.add(function(a){return function(){return a.click.dispatch()}}(this)),a.start(),null!=(c=this.parent.controller)?c.start():void 0},a}(),i=function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p;return{Animation:a=function(){function a(a){this.animation=a}return a.prototype.animation=null,a}(),Asteroid:b=function(){function a(a){this.fsm=a}return a.prototype.fsm=null,a}(),Audio:c=function(){function a(){this.toPlay=[]}return a.prototype.toPlay=null,a.prototype.play=function(a){return this.toPlay.push(a)},a}(),Bullet:d=function(){function a(a){this.lifeRemaining=a}return a.prototype.lifeRemaining=0,a}(),Collision:e=function(){function a(a){this.radius=a}return a.prototype.radius=0,a}(),DeathThroes:f=function(){function a(a){this.countdown=a}return a.prototype.countdown=0,a.prototype.body=null,a}(),Display:g=function(){function a(a){this.graphic=a}return a.prototype.graphic=0,a}(),GameState:h=function(){function a(){}return a.prototype.lives=3,a.prototype.level=0,a.prototype.hits=0,a.prototype.playing=!1,a.prototype.setForStart=function(){this.lives=3,this.level=0,this.hits=0,this.playing=!0},a}(),Gun:i=function(){function a(a,b,c,d){this.minimumShotInterval=c,this.bulletLifetime=d,this.shooting=!1,this.offsetFromParent=null,this.timeSinceLastShot=0,this.offsetFromParent=new w(a,b)}return a.prototype.shooting=!1,a.prototype.offsetFromParent=null,a.prototype.timeSinceLastShot=0,a.prototype.offsetFromParent=null,a}(),GunControls:j=function(){function a(a){this.trigger=a}return a.prototype.trigger=0,a}(),Hud:k=function(){function a(a){this.view=a}return a.prototype.view=null,a.prototype.leaderboard=!1,a}(),MotionControls:l=function(){function a(a,b,c,d,e,f){this.left=a,this.right=b,this.accelerate=c,this.warp=d,this.accelerationRate=e,this.rotationRate=f}return a.prototype.left=0,a.prototype.right=0,a.prototype.accelerate=0,a.prototype.warp=0,a.prototype.accelerationRate=0,a.prototype.rotationRate=0,a}(),Physics:m=function(){function a(a){this.body=a}return a.prototype.body=null,a.prototype.previousX=0,a.prototype.previousY=0,a.prototype.previousAngle=0,a}(),Position:n=function(){function a(a,b,c){this.rotation=c,this.position=new w(a,b)}return a.prototype.position=null,a.prototype.rotation=0,a}(),Spaceship:o=function(){function a(a){this.fsm=a}return a.prototype.fsm=null,a}(),WaitForStart:p=function(){function a(a){this.waitForStart=a,this.setStartGame=H(this.setStartGame,this),this.waitForStart.click.add(this.setStartGame)}return a.prototype.waitForStart=null,a.prototype.startGame=!1,a.prototype.setStartGame=function(){this.startGame=!0},a}()}}(),v=function(){var a,b,c,d,e,f,g,h,j,k,l,m,n,o,p;return{AnimationNode:a=function(){function a(){}return a.prototype.animation=i.Animation,a}(),AsteroidCollisionNode:b=function(){function a(){}return a.prototype.asteroid=i.Asteroid,a.prototype.position=i.Position,a.prototype.collision=i.Collision,a.prototype.audio=i.Audio,a.prototype.physics=i.Physics,a}(),AudioNode:c=function(){function a(){}return a.prototype.audio=i.Audio,a}(),BulletAgeNode:d=function(){function a(){}return a.prototype.bullet=i.Bullet,a.prototype.physics=i.Physics,a.prototype.display=i.Display,a}(),BulletCollisionNode:e=function(){function a(){}return a.prototype.bullet=i.Bullet,a.prototype.position=i.Position,a.prototype.physics=i.Physics,a}(),DeathThroesNode:f=function(){function a(){}return a.prototype.dead=i.DeathThroes,a.prototype.display=i.Display,a}(),GameNode:g=function(){function a(){}return a.prototype.state=i.GameState,a}(),GunControlNode:h=function(){function a(){}return a.prototype.audio=i.Audio,a.prototype.control=i.GunControls,a.prototype.gun=i.Gun,a.prototype.position=i.Position,a}(),HudNode:j=function(){function a(){}return a.prototype.state=i.GameState,a.prototype.hud=i.Hud,a}(),MovementNode:k=function(){function a(){}return a.prototype.position=i.Position,a}(),PhysicsControlNode:l=function(){function a(){}return a.prototype.control=i.MotionControls,a.prototype.physics=i.Physics,a.prototype.display=i.Display,a}(),PhysicsNode:m=function(){function a(){}return a.prototype.position=i.Position,a.prototype.physics=i.Physics,a}(),RenderNode:n=function(){function a(){}return a.prototype.position=i.Position,a.prototype.display=i.Display,a}(),SpaceshipNode:o=function(){function a(){}return a.prototype.spaceship=i.Spaceship,a.prototype.position=i.Position,a}(),WaitForStartNode:p=function(){function a(){}return a.prototype.wait=i.WaitForStart,a}()}}(),o=function(a){function b(a){this.updateNode=H(this.updateNode,this),this.update=H(this.update,this),this.process=H(this.process,this),this.world=a.world,this.game=a.game,this.width=a.width,this.height=a.height,this.nodes=a.ash.nodes}var c,d,e,f,g;return J(b,a),f=Box2D.Dynamics.b2Body,g=Box2D.Common.Math.b2Vec2,d=1/60,e=8,c=3,b.prototype.handle=0,b.prototype.config=null,b.prototype.world=null,b.prototype.entities=null,b.prototype.nodes=null,b.prototype.enabled=!0,b.prototype.game=null,b.prototype.width=0,b.prototype.height=0,b.deadPool=[],b.prototype.addToEngine=function(a){this.nodes=a.getNodeList(this.nodes.PhysicsNode),this.handle=setInterval(this.process,d)},b.prototype.removeFromEngine=function(a){0!==this.handle&&clearInterval(this.handle),this.handle=0,this.nodes=null},b.prototype.process=function(){this.game.paused||this.enabled&&(this.world.Step(d,e,c),this.world.ClearForces())},b.prototype.update=function(a){var c,d,e;if(!this.game.paused&&this.enabled){for(d=this.nodes.head;d;)this.updateNode(d,a),d=d.next;for(;c=b.deadPool.pop();)e=c.GetUserData(),null!=e.entity&&delete e.entity,c.SetUserData(e),this.world.DestroyBody(c)}},b.prototype.updateNode=function(a,b){var c,d,e,f,h,i,j,k;e=a.position,d=a.physics,c=d.body,k=c.GetPosition(),f=k.x,i=k.y,h=f>this.width?0:0>f?this.width:f,j=i>this.height?0:0>i?this.height:i,(h!==f||j!==i)&&c.SetPosition(new g(h,j)),e.position.x=h,e.position.y=j,e.rotation=c.GetAngularVelocity()},b}(ash.core.System),A=function(a){function b(a){this.smoothStates=H(this.smoothStates,this),this.resetSmoothStates=H(this.resetSmoothStates,this),this.update=H(this.update,this),this.width=a.width,this.height=a.height,this.world=a.world,this.game=a.game,this.nodes=a.ash.nodes}var c,d,e,f,g,h;return J(b,a),e=Box2D.Dynamics.b2Body,f=Box2D.Common.Math.b2Vec2,c=1/60,d=5,h=8,g=1,b.prototype.fixedTimestepAccumulator=0,b.prototype.fixedTimestepAccumulatorRatio=0,b.prototype.config=null,b.prototype.world=null,b.prototype.entities=null,b.prototype.nodes=null,b.prototype.enabled=!0,b.prototype.game=null,b.prototype.width=0,b.prototype.height=0,b.deadPool=[],b.prototype.addToEngine=function(a){this.nodes=a.getNodeList(this.nodes.PhysicsNode)},b.prototype.removeFromEngine=function(a){this.nodes=null},b.prototype.update=function(a){var e,f,i,j,k;if(!this.game.paused&&this.enabled){for(this.fixedTimestepAccumulator+=a,i=Math.floor(this.fixedTimestepAccumulator/c),i>0&&(this.fixedTimestepAccumulator-=i*c),this.fixedTimestepAccumulatorRatio=this.fixedTimestepAccumulator/c,j=Math.min(i,d),f=0;j>f;)this.resetSmoothStates(),this.world.Step(a,h,g),f++;for(this.world.ClearForces(),this.smoothStates();e=b.deadPool.pop();)k=e.GetUserData(),null!=k.entity&&delete k.entity,e.SetUserData(k),this.world.DestroyBody(e)}},b.prototype.resetSmoothStates=function(){var a,b,c,d,e,g,h,i,j;for(b=this.nodes.head;b;)d=b.position,c=b.physics,a=c.body,j=a.GetPosition(),e=j.x,h=j.y,d.position.x=c.previousX=e,d.position.y=c.previousY=h,d.rotation=c.previousAngle=a.GetAngularVelocity(),g=e>this.width?0:0>e?this.width:e,i=h>this.height?0:0>h?this.height:h,(g!==e||i!==h)&&a.SetPosition(new f(g,i)),b=b.next},b.prototype.smoothStates=function(){var a,b,c,d,e,g,h,i,j,k;for(c=1-this.fixedTimestepAccumulatorRatio,b=this.nodes.head;b;)e=b.position,d=b.physics,a=d.body,k=a.GetPosition(),g=k.x,i=k.y,e.position.x=this.fixedTimestepAccumulatorRatio*g+c*d.previousX,e.position.y=this.fixedTimestepAccumulatorRatio*i+c*d.previousY,e.rotation=a.GetAngularVelocity()*this.fixedTimestepAccumulatorRatio+c*d.previousAngle,h=g>this.width?0:0>g?this.width:g,j=i>this.height?0:0>i?this.height:i,(h!==g||j!==i)&&a.SetPosition(new f(h,j)),b=b.next},b}(ash.core.System),a=function(a){function b(a){this.updateNode=H(this.updateNode,this),b.__super__.constructor.call(this,a.ash.nodes.AnimationNode,this.updateNode)}return J(b,a),b.prototype.updateNode=function(a,b){a.animation.animation.animate(b)},b}(ash.tools.ListIteratingSystem),e=function(a){function b(a){this.updateNode=H(this.updateNode,this),b.__super__.constructor.call(this,a.ash.nodes.AudioNode,this.updateNode)}return J(b,a),b.prototype.updateNode=function(a,b){var c,d,e,f;f=a.audio.toPlay;for(c in f)e=f[c],d=new e,d.play(0,1);a.audio.toPlay=[]},b}(ash.tools.ListIteratingSystem),f=function(a){function b(a,c){this.PhysicsSystem=c,this.updateNode=H(this.updateNode,this),b.__super__.constructor.call(this,a.ash.nodes.BulletAgeNode,this.updateNode),this.entities=a.entities}return J(b,a),b.prototype.entities=null,b.prototype.PhysicsSystem=null,b.prototype.updateNode=function(a,b){var c;c=a.bullet,c.lifeRemaining-=b,c.lifeRemaining<=0&&(a.display.graphic.dispose(),this.PhysicsSystem.deadPool.push(a.physics.body),this.entities.destroyEntity(a.entity))},b}(ash.tools.ListIteratingSystem),h=function(a){function b(a,b){this.PhysicsSystem=b,this.PostSolve=H(this.PostSolve,this),this.PreSolve=H(this.PreSolve,this),this.EndContact=H(this.EndContact,this),this.BeginContact=H(this.BeginContact,this),this.update=H(this.update,this),this.world=a.world,this.entities=a.entities,this.rnd=a.rnd,this.components=a.ash.components,this.collisions=[],this.world.SetContactListener(this)}var c,d,e,f,g,h,j,k,o,p,q;return J(b,a),c=i.Asteroid,e=i.Audio,g=i.Collision,h=i.DeathThroes,j=i.Display,k=i.Physics,o=i.Position,p=i.Spaceship,q=Box2D.Dynamics.b2ContactListener,f=1,d=2,b.prototype.world=null,b.prototype.entities=null,b.prototype.games=null,b.prototype.rnd=null,b.prototype.collisions=null,b.prototype.PhysicsSystem=null,b.prototype.update=function(a){for(var b,i,l,q,r,s,t;this.collisions.length;)t=this.collisions.pop(),s=t.type,b=t.a,i=t.b,s===f?(null!=b.get(k)&&(this.entities.destroyEntity(b),b.get(j).graphic.dispose(),this.PhysicsSystem.deadPool.push(b.get(k).body)),null!=i.get(k)&&(r=i.get(g).radius,q=i.get(o).position,r>10&&(this.entities.createAsteroid(r-10,q.x+10*this.rnd.nextDouble()-5,q.y+10*this.rnd.nextDouble()-5),this.entities.createAsteroid(r-10,q.x+10*this.rnd.nextDouble()-5,q.y+10*this.rnd.nextDouble()-5)),l=i.get(k).body,i.get(j).graphic.dispose(),i.get(c).fsm.changeState("destroyed"),i.get(h).body=l,i.get(e).play(m),this.games.head&&this.games.head.state.hits++)):s===d&&null!=i.get(k)&&(l=i.get(k).body,i.get(j).graphic.dispose(),i.get(p).fsm.changeState("destroyed"),i.get(h).body=l,i.get(e).play(n),this.games.head&&this.games.head.state.lives--)},b.prototype.addToEngine=function(a){this.games=a.getNodeList(v.GameNode)},b.prototype.removeFromEngine=function(a){this.games=null},b.prototype.BeginContact=function(a){var b,c;switch(b=a.GetFixtureA().GetBody().GetUserData(),c=a.GetFixtureB().GetBody().GetUserData(),b.type){case l.ASTEROID:switch(c.type){case l.BULLET:this.collisions.push({type:f,a:c.entity,b:b.entity});break;case l.SPACESHIP:this.collisions.push({type:d,a:b.entity,b:c.entity})}break;case l.BULLET:c.type===l.ASTEROID&&this.collisions.push({type:f,a:b.entity,b:c.entity});break;case l.SPACESHIP:c.type===l.ASTEROID&&this.collisions.push({type:d,a:c.entity,b:b.entity})}},b.prototype.EndContact=function(a){},b.prototype.PreSolve=function(a,b){},b.prototype.PostSolve=function(a,b){},b}(ash.core.System),j=function(a){function b(a,c){this.PhysicsSystem=c,this.updateNode=H(this.updateNode,this),b.__super__.constructor.call(this,a.ash.nodes.DeathThroesNode,this.updateNode),this.entities=a.entities}return J(b,a),b.prototype.entities=null,b.prototype.PhysicsSystem=null,b.prototype.updateNode=function(a,b){var c;c=a.dead,c.countdown-=b,c.countdown<=0&&(this.entities.destroyEntity(a.entity),a.display.graphic.dispose(),this.PhysicsSystem.deadPool.push(c.body))},b}(ash.tools.ListIteratingSystem),p=function(a){function b(a){this.parent=a,this.update=H(this.update,this),this.entities=this.parent.entities,this.rnd=this.parent.rnd,this.width=this.parent.width,this.height=this.parent.height,this.nodes=this.parent.ash.nodes}return J(b,a),b.prototype.parent=null,b.prototype.config=null,b.prototype.entities=null,b.prototype.rnd=null,b.prototype.gameNodes=null,b.prototype.spaceships=null,b.prototype.asteroids=null,b.prototype.bullets=null,b.prototype.width=0,b.prototype.height=0,b.prototype.addToEngine=function(a){this.gameNodes=a.getNodeList(this.nodes.GameNode),this.spaceships=a.getNodeList(this.nodes.SpaceshipNode),this.asteroids=a.getNodeList(this.nodes.AsteroidCollisionNode),this.bullets=a.getNodeList(this.nodes.BulletCollisionNode)},b.prototype.update=function(a){var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p;if(i=this.gameNodes.head,i&&i.state.playing){if(this.spaceships.empty)if(i.state.lives>0){for(h=new w(.5*this.width,.5*this.height),d=!0,b=this.asteroids.head;b;){if(w.distance(b.position.position,h)<=b.collision.radius+50){d=!1;break}b=b.next}d&&this.entities.createSpaceship()}else i.state.playing=!1,n=new Date,g=(n.getMonth()+1).toString(),1===g.length&&(g="0"+g),e=n.getDate().toString(),1===e.length&&(e="0"+e),o=n.getFullYear().toString(),p=o+g+e,1===this.parent.fbStatus?(l={appId:this.parent.fbAppId,userId:this.parent.fbUserID,date:p,score:i.state.hits},k=new XMLHttpRequest,k.open("POST","/score/asteroids"),k.setRequestHeader("Content-Type","application/json"),k.send(JSON.stringify(l))):(0===Db.queryAll("leaderboard",{query:{date:p}}).length?Db.insert("leaderboard",{date:p,score:i.state.hits}):Db.update("leaderboard",{date:p},function(a){return i.state.hits>a.score&&(a.score=i.state.hits),a}),Db.commit()),this.entities.createWaitForClick();if(this.asteroids.empty&&this.bullets.empty&&!this.spaceships.empty)for(m=this.spaceships.head,i.state.level++,c=2+i.state.level,f=0;c>f;){for(;;)if(j=new w(this.rnd.nextDouble()*this.width,this.rnd.nextDouble()*this.height),!(w.distance(j,m.position.position)<=80))break;this.entities.createAsteroid(30,j.x,j.y),++f}}},b.prototype.removeFromEngine=function(a){this.gameNodes=null,this.spaceships=null,this.asteroids=null,this.bullets=null},b}(ash.core.System),q=function(a){function b(a){var c;this.parent=a,this.updateNode=H(this.updateNode,this),b.__super__.constructor.call(this,this.parent.ash.nodes.GunControlNode,this.updateNode),this.keyPoll=this.parent.keyPoll,this.entities=this.parent.entities,this.buttons=null!=(c=this.parent.controller)?c.buttons:void 0}return J(b,a),b.prototype.keyPoll=null,b.prototype.entities=null,b.prototype.buttons=null,b.prototype.updateNode=function(a,b){var c,d,e,f;c=a.control,e=a.position,d=a.gun,d.shooting=this.keyPoll.isDown(c.trigger)||(null!=(f=this.buttons)?f.fire:void 0),d.timeSinceLastShot+=b,d.shooting&&d.timeSinceLastShot>=d.minimumShotInterval&&(this.entities.createUserBullet(d,e),a.audio.play(z),d.timeSinceLastShot=0)},b}(ash.tools.ListIteratingSystem),r=function(a){function b(a){this.updateNode=H(this.updateNode,this),b.__super__.constructor.call(this,a.ash.nodes.HudNode,this.updateNode)}return J(b,a),b.prototype.updateNode=function(a,b){a.hud.view.setLives(a.state.lives),a.hud.view.setScore(a.state.hits)},b}(ash.tools.ListIteratingSystem),y=function(a){function b(a){this.updateNode=H(this.updateNode,this),b.__super__.constructor.call(this,a.ash.nodes.PhysicsControlNode,this.updateNode),this.keyPoll=a.keyPoll,this.rnd=a.rnd,this.width=a.width,this.height=a.height,this.game=a.game,this.controller=a.controller}var c,d,e,f,g;return J(b,a),d=window.devicePixelRatio,c=null!=(null!=(g=window.ext)?g.IDTK_SRV_BOX2D:void 0),e=Box2D.Common.Math.b2Vec2,f=[16711680,65280,255,16711935,65535,16776960],b.prototype.keyPoll=null,b.prototype.rnd=null,b.prototype.warping=0,b.prototype.kount=0,b.prototype.width=0,b.prototype.height=0,b.prototype.updateNode=function(a,b){var e,g,h,i,j,k,l,m,n,o,p,q,r,s,t;return i=a.control,h=a.physics.body,this.warping?(this.warping--,o=this.rnd.nextInt(this.width),p=this.rnd.nextInt(this.height),h.SetPosition({x:o,y:p}),void a.display.graphic.draw(0===this.warping?16777215:f[this.rnd.nextInt(6)])):this.keyPoll.isDown(i.warp)||(null!=(q=this.controller)&&null!=(r=q.buttons)?r.warp:void 0)?(this.controller.warp=!1,void(this.warping=this.rnd.nextInt(30)+30)):(j=null!=(s=this.controller)?s.dpad:void 0,null!=j&&(j.left&&(l=h.GetAngularVelocity(),h.SetAngularVelocity(l-i.rotationRate*b)),j.right&&(l=l||h.GetAngularVelocity(),h.SetAngularVelocity(l+i.rotationRate*b)),j.up&&(l=l||h.GetAngularVelocity(),n=h.GetLinearVelocity(),n.x+=Math.cos(l)*i.accelerationRate*b*d,n.y+=Math.sin(l)*i.accelerationRate*b*d,c||h.SetAwake(!0),h.SetLinearVelocity(n))),k=null!=(t=this.controller)?t.joystick:void 0,null!=k&&(g=Math.atan2(k.normalizedY,k.normalizedX)/Math.PI*180,e=Math.abs(g),l=h.GetAngularVelocity(),e>135&&179>e?h.SetAngularVelocity(l-i.rotationRate*b):e>1&&45>e?h.SetAngularVelocity(l+i.rotationRate*b):g>45&&135>g&&(m=127/Math.sqrt(k.normalizedX*k.normalizedX+k.normalizedY*k.normalizedY),n=h.GetLinearVelocity(),n.x+=Math.cos(l)*m*b*d,n.y+=Math.sin(l)*m*b*d,c||h.SetAwake(!0),h.SetLinearVelocity(n))),this.keyPoll.isDown(i.left)&&(l=h.GetAngularVelocity(),h.SetAngularVelocity(l-i.rotationRate*b)),this.keyPoll.isDown(i.right)&&(l=l||h.GetAngularVelocity(),h.SetAngularVelocity(l+i.rotationRate*b)),void(this.keyPoll.isDown(i.accelerate)&&(l=l||h.GetAngularVelocity(),n=h.GetLinearVelocity(),n.x+=Math.cos(l)*i.accelerationRate*b*d,n.y+=Math.sin(l)*i.accelerationRate*b*d,c||h.SetAwake(!0),h.SetLinearVelocity(n))))},b}(ash.tools.ListIteratingSystem),x=function(a){function b(a){this.update=H(this.update,this),this.nodes=a.ash.nodes}return J(b,a),b.prototype.stage=null,b.prototype.renderer=null,b.prototype.nodes=null,b.prototype.addToEngine=function(a){var b;for(this.nodes=a.getNodeList(this.nodes.RenderNode),b=this.nodes.head;b;)this.addToDisplay(b),b=b.next},b.prototype.addToDisplay=function(a){},b.prototype.removeFromDisplay=function(a){},b.prototype.removeFromEngine=function(a){this.nodes=null},b.prototype.update=function(a){var b,c,d,e;for(d=this.nodes.head;d;)b=d.display,c=b.graphic,e=d.position,c.x=e.position.x,c.y=e.position.y,c.rotation=e.rotation,d=d.next},b}(ash.core.System),E=function(){function a(){}return a.preUpdate=1,a.update=2,a.move=3,a.resolveCollisions=4,a.stateMachines=5,a.render=6,a.animate=7,a}(),F=function(a){function b(a){this.update=H(this.update,this),this.entities=a.entities}return J(b,a),b.prototype.engine=null,b.prototype.entities=null,b.prototype.gameNodes=null,b.prototype.waitNodes=null,b.prototype.asteroids=null,b.prototype.addToEngine=function(a){this.ash=a,this.waitNodes=a.getNodeList(v.WaitForStartNode),this.gameNodes=a.getNodeList(v.GameNode),this.asteroids=a.getNodeList(v.AsteroidCollisionNode)},b.prototype.removeFromEngine=function(a){this.waitNodes=null,this.gameNodes=null,this.asteroids=null},b.prototype.update=function(a){var b,c,d,e;if(e=this.waitNodes.head,c=this.gameNodes.head,e&&e.wait.startGame&&c){for(b=this.asteroids.head;b;)d=b.entity.get(Display).graphic,this.entities.destroyEntity(b.entity),d.dispose(),b=b.next;c.state.setForStart(),e.wait.startGame=!1,this.ash.removeEntity(e.entity)}},b}(ash.core.System),l=function(){function a(a){this.parent=a,this.createUserBullet=H(this.createUserBullet,this),
this.createSpaceship=H(this.createSpaceship,this),this.game=this.parent.game,this.ash=this.parent.ash,this.world=this.parent.world,this.rnd=this.parent.rnd}var d,e,f,h,j,k,l,m,n,o,p,q,r,u,v,w,x,y,z,A,B,E,F,I,J;return d=i.Animation,e=i.Asteroid,f=i.Audio,h=i.Bullet,j=i.Collision,k=i.DeathThroes,l=i.Display,o=i.GameState,p=i.Gun,q=i.GunControls,r=i.Hud,u=i.MotionControls,v=i.Physics,w=i.Position,x=i.Spaceship,y=i.WaitForStart,m=ash.core.Entity,n=ash.fsm.EntityStateMachine,a.ASTEROID=1,a.SPACESHIP=2,a.BULLET=3,a.prototype.LEFT=t.KEY_LEFT,a.prototype.RIGHT=t.KEY_RIGHT,a.prototype.THRUST=t.KEY_UP,a.prototype.FIRE=t.KEY_Z,a.prototype.WARP=t.KEY_SPACE,J=function(a){return parseFloat(asteroids.get(a))},z=Box2D.Dynamics.b2Body,A=Box2D.Dynamics.b2BodyDef,B=Box2D.Collision.Shapes.b2CircleShape,E=Box2D.Dynamics.b2FixtureDef,F=Box2D.Collision.Shapes.b2PolygonShape,I=Box2D.Common.Math.b2Vec2,a.prototype.game=null,a.prototype.ash=null,a.prototype.world=null,a.prototype.waitEntity=null,a.prototype.rnd=null,a.prototype.bulletId=0,a.prototype.asteroidId=0,a.prototype.spaceshipId=0,a.prototype.destroyEntity=function(a){this.ash.removeEntity(a)},a.prototype.createGame=function(){var a,b;return b=new s(this.game),a=new m("game").add(new o).add(new r(b)).add(new l(b)).add(new w(0,0,0,0)),this.ash.addEntity(a),a},a.prototype.createWaitForClick=function(){var a;return a=new G(this.game,this.parent),this.waitEntity=new m("wait").add(new y(a)).add(new l(a)).add(new w(0,0,0,0)),this.waitEntity.get(y).startGame=!1,this.ash.addEntity(this.waitEntity),this.waitEntity},a.prototype.createAsteroid=function(g,h,i){var o,p,q,r,s,t,u,x,y;return q=new A,q.type=z.b2_dynamicBody,q.fixedRotation=!0,q.position.x=h,q.position.y=i,x=(this.rnd.nextDouble()-.5)*J("asteroidLinearVelocity")*(50-g),y=(this.rnd.nextDouble()-.5)*J("asteroidLinearVelocity")*(50-g),q.linearVelocity.Set(x,y),q.angularVelocity=this.rnd.nextDouble()*J("asteroidAngularVelocity")-1,q.linearDamping=J("asteroidDamping"),s=new E,s.density=J("asteroidDensity"),s.friction=J("asteroidFriction"),s.restitution=J("asteroidRestitution"),s.shape=new B(g),p=this.world.CreateBody(q),p.CreateFixture(s),o=new m,t=new n(o),u=new c(this.parent,g),t.createState("alive").add(v).withInstance(new v(p)).add(j).withInstance(new j(g)).add(l).withInstance(new l(u)),r=new b(this.parent,g),t.createState("destroyed").add(k).withInstance(new k(3)).add(l).withInstance(new l(r)).add(d).withInstance(new d(r)),o.add(new e(t)).add(new w(h,i,0)).add(new f),p.SetUserData({type:a.ASTEROID,entity:o}),t.changeState("alive"),this.ash.addEntity(o),o},a.prototype.createSpaceship=function(){var b,c,e,g,h,i,o,r,s;return r=this.rnd.nextInt(this.parent.width),s=this.rnd.nextInt(this.parent.height),c=new A,c.type=z.b2_dynamicBody,c.fixedRotation=!1,c.position.x=r,c.position.y=s,c.linearVelocity.Set(0,0),c.angularVelocity=0,c.linearDamping=J("spaceshipDamping"),g=new E,g.density=J("spaceshipDensity"),g.friction=J("spaceshipFriction"),g.restitution=J("spaceshipRestitution"),g.shape=new F,g.shape.SetAsArray([new I(.45,0),new I(-.25,.25),new I(-.25,-.25)],3),b=this.world.CreateBody(c),b.CreateFixture(g),o=new m,h=new n(o),i=new D(this.game),h.createState("playing").add(v).withInstance(new v(b)).add(u).withInstance(new u(this.LEFT,this.RIGHT,this.THRUST,this.WARP,100,3)).add(p).withInstance(new p(8,0,.3,2)).add(q).withInstance(new q(this.FIRE)).add(j).withInstance(new j(9)).add(l).withInstance(new l(i)),e=new C(this.parent),h.createState("destroyed").add(k).withInstance(new k(5)).add(l).withInstance(new l(e)).add(d).withInstance(new d(e)),o.add(new x(h)).add(new w(r,s,0)).add(new f),b.SetUserData({type:a.SPACESHIP,entity:o}),h.changeState("playing"),this.ash.addEntity(o),console.log(o),o},a.prototype.createUserBullet=function(b,c){var d,e,f,i,k,n,o,p,q;return k=Math.cos(c.rotation),o=Math.sin(c.rotation),p=k*b.offsetFromParent.x-o*b.offsetFromParent.y+c.position.x,q=o*b.offsetFromParent.x+k*b.offsetFromParent.y+c.position.y,e=new A,e.type=z.b2_dynamicBody,e.fixedRotation=!0,e.bullet=!0,e.position.x=p,e.position.y=q,e.linearVelocity.Set(k*J("bulletLinearVelocity"),o*J("bulletLinearVelocity")),e.angularVelocity=0,e.linearDamping=J("bulletDamping"),n=new E,n.density=J("bulletDensity"),n.friction=J("bulletFriction"),n.restitution=J("bulletRestitution"),n.shape=new B(0),d=this.world.CreateBody(e),d.CreateFixture(n),i=new g(this.game),f=(new m).add(new h(b.bulletLifetime)).add(new w(p,q,0)).add(new j(0)).add(new v(d)).add(new l(i)),d.SetUserData({type:a.BULLET,entity:f}),this.ash.addEntity(f),f},a}(),d=function(){function b(){this.initializeDb=H(this.initializeDb,this),this.setPlaySfx=H(this.setPlaySfx,this),this.setPlayMusic=H(this.setPlayMusic,this),this.setBackground=H(this.setBackground,this),this.getBackground=H(this.getBackground,this),this.set=H(this.set,this),this.get=H(this.get,this),this.onLogin=H(this.onLogin,this),this.onLeaderboard=H(this.onLeaderboard,this),this.onSettings=H(this.onSettings,this),this.leaderboardImpl=H(this.leaderboardImpl,this),this.showLeaderboard=H(this.showLeaderboard,this),this.pause=H(this.pause,this),this.fade=H(this.fade,this),this.getFaderSprite=H(this.getFaderSprite,this),this.create=H(this.create,this),this.preload=H(this.preload,this),this.init=H(this.init,this),this.game=new Phaser.Game(this.width*this.scale,this.height*this.scale,Phaser.CANVAS,"",{init:this.init,preload:this.preload,create:this.create}),this.rnd=new u,this.initializeDb(),Cocoon.App.WebView.on("load",{success:function(a){return function(){return Cocoon.App.showTheWebView()}}(this),error:function(a){return function(){return console.log("Cannot show the Webview: "+JSON.stringify(arguments))}}(this)})}var c,d,g;return c=Box2D.Common.Math.b2Vec2,d=Box2D.Dynamics.b2World,g=function(a){return a.charAt(0).toUpperCase()+a.substr(1)},b.prototype.game=null,b.prototype.pad=null,b.prototype.profiler=null,b.prototype.engine=null,b.prototype.entities=null,b.prototype.keyPoll=null,b.prototype.config=null,b.prototype.world=null,b.prototype.background=null,b.prototype.physics=null,b.prototype.faderBitmap=null,b.prototype.faderSprite=null,b.prototype.fbAppId="887669707958104",b.prototype.fbUserID="",b.prototype.fbButton=null,b.prototype.fbStatus=0,b.prototype.bgdColor=6970061,b.prototype.height=window.innerHeight,b.prototype.width=window.innerWidth,b.prototype.scale=window.devicePixelRatio,b.prototype.playMusic=localStorage.playMusic,b.prototype.playSfx=localStorage.playSfx,b.prototype.optBgd=localStorage.background||"blue",b.prototype.init=function(){this.game.scale.scaleMode=Phaser.ScaleManager.SHOW_ALL,this.game.scale.minWidth=this.width*this.scale,this.game.scale.minHeight=this.height*this.scale,this.game.scale.maxWidth=this.width*this.scale,this.game.scale.maxHeight=this.height*this.scale,this.game.scale.pageAlignVertically=!0,this.game.scale.pageAlignHorizontally=!0},b.prototype.preload=function(){this.game.load.image("fb-login","res/fb-login.png"),this.game.load.image("dialog-blue","res/dialog-box.png"),this.game.load.image("dialog-star","res/black-dialog.png"),this.game.load.image("button-blue","res/standard-button-on.png"),this.game.load.image("button-star","res/black-button-on.png"),this.game.load.image("background","res/BackdropBlackLittleSparkBlack.png"),this.game.load.image("leaderboard","res/icons/b_Leaderboard.png"),this.game.load.image("settings","res/icons/b_Parameters.png"),this.game.load.image("round","res/round48.png"),this.game.load.image("square","res/square48.png"),this.game.load.audio("asteroid",[m.prototype.src]),this.game.load.audio("ship",[n.prototype.src]),this.game.load.audio("shoot",[z.prototype.src])},b.prototype.create=function(){var b,g;this.profiler=this.game.plugins.add(Phaser.Plugin.PerformanceMonitor,{profiler:this.get("profiler")}),this.optBgd=Db.queryAll("settings",{query:{name:"background"}})[0].value,this.game.stage.backgroundColor=this.bgdColor,this.background=this.game.add.sprite(0,0,"background"),this.background.width=this.width,this.background.height=this.height,this.background.alpha="blue"===this.optBgd?0:1,this.game.add.button(this.width-50,50,"settings",this.onSettings),this.game.add.button(this.width-50,125,"leaderboard",this.onLeaderboard),FB.init({appId:this.fbAppId,status:!0,xfbml:!0,version:"v2.3"}),FB.getLoginStatus(function(a){return function(b){return a.fbUserID=b.userID,"connected"===b.status?a.fbStatus=1:(a.fbStatus=0,a.fbButton=a.game.add.button((a.width-195)/2,50,"fb-login",a.onLogin))}}(this)),m.audio=this.game.add.audio("asteroid"),m.audio.play("",0,0),n.audio=this.game.add.audio("ship"),n.audio.play("",0,0),z.audio=this.game.add.audio("shoot"),z.audio.play("",0,0),this.keyPoll=new t(this),this.world=new d(new c(0,0),!0),this.world.SetContinuousPhysics(!0),this.ash=this.game.plugins.add(ash.core.PhaserEngine,v,i),this.entities=new l(this),this.controller=this.game.plugins.add(Phaser.Plugin.GameControllerPlugin,{force:!1}),this.controller.addDPad("left",60,this.height-60,{up:{width:"10%",height:"7%"},left:{width:"7%",height:"10%"},right:{width:"7%",height:"10%"},down:!1}),this.controller.addButtons("right",this.width-180,this.height-80,{1:{title:"warp",color:"yellow"},3:{title:"FIRE",color:"red"}}),g=!(!window.ext||"undefined"==typeof window.ext.IDTK_SRV_BOX2D),b=g?o:A,this.physics=new b(this),this.ash.addSystem(this.physics,E.move),this.ash.addSystem(new f(this,b),E.update),this.ash.addSystem(new j(this,b),E.update),this.ash.addSystem(new h(this,b),E.resolveCollisions),this.ash.addSystem(new a(this),E.animate),this.ash.addSystem(new r(this),E.animate),this.ash.addSystem(new x(this),E.render),this.ash.addSystem(new e(this),E.render),this.ash.addSystem(new F(this),E.preUpdate),this.ash.addSystem(new p(this),E.preUpdate),this.ash.addSystem(new y(this),E.update),this.ash.addSystem(new q(this),E.update),this.entities.createWaitForClick(),this.entities.createGame()},b.prototype.getFaderSprite=function(){return null==this.faderSprite&&(this.faderBitmap=this.game.make.bitmapData(this.game.width,this.game.height),this.faderBitmap.rect(0,0,this.game.width,this.game.height,"rgb(0,0,0)"),this.faderSprite=this.game.add.sprite(0,0,this.faderBitmap),this.faderSprite.alpha=0),this.faderSprite.bringToTop()},b.prototype.fade=function(a){var b,c;c=this.getFaderSprite(),b=this.game.add.tween(c),0===c.alpha?(b.to({alpha:1},500),b.onComplete.add(a,this),b.start()):(this.game.paused=!1,b.to({alpha:0},500),b.onComplete.add(a,this),b.start())},b.prototype.pause=function(a){null!=a?(this.faderSprite=null,this.physics.enabled=!1,this.fade(a)):this.fade(function(a){return function(){return a.physics.enabled=!0}}(this))},b.prototype.showLeaderboard=function(){1===this.fbStatus?FB.api("me/scores",function(a){return function(b){return a.leaderboardImpl(b)}}(this)):this.leaderboardImpl(Db.queryAll("leaderboard",{limit:10,sort:[["score","DESC"]]}))},b.prototype.leaderboardImpl=function(a){var b,c,d,e,f,g,h,i,j,k,l,m;for(c=this.game.add.group(),e=new Phaser.Sprite(this.game,0,0,"dialog-"+this.optBgd),e.width=this.width,e.height=this.height,c.add(e),b={font:"bold 30px opendyslexic",fill:"#ffffff"},h={font:"bold 20px opendyslexic",fill:"#ffffff"},j=new Phaser.Text(this.game,this.width/2,20,"Asteroids",b),j.anchor.x=.5,c.add(j),c.add(new Phaser.Text(this.game,200,80,"Date",h)),c.add(new Phaser.Text(this.game,400,80,"Score",h)),c.add(new Phaser.Text(this.game,200,100,"--------",h)),c.add(new Phaser.Text(this.game,400,100,"--------",h)),k=120,l=0,m=a.length;m>l;l++)i=a[l],g=i.date.substr(4,2)+"/"+i.date.substr(6,2)+"/"+i.date.substr(0,4),c.add(new Phaser.Text(this.game,200,k,g,h)),c.add(new Phaser.Text(this.game,400,k,i.score,h)),k+=20;d=new Phaser.Button(this.game,this.width/2,this.height-64,"button-"+this.optBgd,function(a){return function(){c.destroy(),c=null,a.pause()}}(this)),d.anchor.x=.5,c.add(d),f=new Phaser.Text(this.game,0,d.height/2,"continue",b),f.anchor.x=.5,f.anchor.y=.5,d.addChild(f)},b.prototype.onSettings=function(){this.pause(function(a){return function(){return Cocoon.App.loadInTheWebView("settings.html")}}(this))},b.prototype.onLeaderboard=function(){this.pause(function(a){return function(){return a.showLeaderboard()}}(this))},b.prototype.onLogin=function(){return this.pause(function(a){return function(){return FB.login(function(b){return b.authResponse?FB.api("/me",function(b){return a.pause(),b.error?console.error("login error: "+b.error.message):(console.log("login succeeded"),a.fbButton.input.enabled=!1,a.fbButton.alpha=0,a.fbStatus=1,a.fbUserID=b.id)}):void 0})}}(this))},b.prototype.get=function(a){var b;return b="get"+g(a),null!=this[b]?this[b]():Db.queryAll("settings",{query:{name:a}})[0].value},b.prototype.set=function(a,b){var c;c="set"+g(a),null!=this[c]?this[c](b):(Db.update("settings",{name:a},function(a){return a.value=b,a}),Db.commit())},b.prototype.getBackground=function(){return"blue"===Db.queryAll("settings",{query:{name:"background"}})[0].value?0:1},b.prototype.setBackground=function(a){var b;b=["blue","star"],this.background.alpha=a,this.optBgd=b[a],Db.update("settings",{name:"background"},function(c){return c.value=b[a],c}),Db.commit()},b.prototype.setPlayMusic=function(a){Db.update("settings",{name:"playMusic"},function(b){return b.value=a,b}),Db.commit(),this.playMusic=a},b.prototype.setPlaySfx=function(a){Db.update("settings",{name:"playSfx"},function(b){return b.value=a,b}),Db.commit(),this.playSfx=a,B.volume=a/100},b.prototype.initializeDb=function(){window.Db=new localStorageDB("asteroids",localStorage),Db.isNew()&&(Db.createTable("leaderboard",["date","score"]),Db.createTable("settings",["name","value"]),Db.insert("settings",{name:"profiler",value:"on"}),Db.insert("settings",{name:"background",value:"blue"}),Db.insert("settings",{name:"playMusic",value:"50"}),Db.insert("settings",{name:"playSfx",value:"50"}),Db.insert("settings",{name:"asteroidDensity",value:"1.0"}),Db.insert("settings",{name:"asteroidFriction",value:"1.0"}),Db.insert("settings",{name:"asteroidRestitution",value:"0.2"}),Db.insert("settings",{name:"asteroidDamping",value:"0.0"}),Db.insert("settings",{name:"asteroidLinearVelocity",value:"4.0"}),Db.insert("settings",{name:"asteroidAngularVelocity",value:"2.0"}),Db.insert("settings",{name:"spaceshipDensity",value:"1.0"}),Db.insert("settings",{name:"spaceshipFriction",value:"1.0"}),Db.insert("settings",{name:"spaceshipRestitution",value:"0.2"}),Db.insert("settings",{name:"spaceshipDamping",value:"0.75"}),Db.insert("settings",{name:"bulletDensity",value:"1.0"}),Db.insert("settings",{name:"bulletFriction",value:"0.0"}),Db.insert("settings",{name:"bulletRestitution",value:"0.0"}),Db.insert("settings",{name:"bulletDamping",value:"0.0"}),Db.insert("settings",{name:"bulletLinearVelocity",value:"150"}),Db.commit()),0===Db.queryAll("settings",{query:{name:"profiler"}}).length&&Db.insert("settings",{name:"profiler",value:"off"})},b}(),Phaser.Plugin.PerformanceMonitor=function(a){function b(a,c){b.__super__.constructor.call(this,a,c)}return J(b,a),b.prototype.stats=null,b.prototype.visible=!1,b.prototype.active=!1,b.prototype.hasPreUpdate=!1,b.prototype.hasPostRender=!1,b.prototype.init=function(a){var b,c,d,e,f,g;return navigator.isCocoonJS||"off"===a.profiler?(this.preUpdate=this.nop,this.postRender=this.nop):"undefined"!=typeof Stats&&null!==Stats?(null!=a.container?b=a.container:(b=document.createElement("div"),document.body.appendChild(b)),this.stats=new Stats,b.appendChild(this.stats.domElement),this.stats.domElement.style.position="absolute",c=null!=(e=a.x)?e:0,d=null!=(f=a.y)?f:0,this.stats.setMode(null!=(g=a.mode)?g:0),this.stats.domElement.style.position="absolute",this.stats.domElement.style.left=""+c+"px",this.stats.domElement.style.top=""+d+"px",this.active=!0,this.visible=!0,this.hasPreUpdate=!0,this.hasPostRender=!0):(this.preUpdate=this.nop,this.postRender=this.nop)},b.prototype.preUpdate=function(){this.stats.begin()},b.prototype.postRender=function(){this.stats.end()},b.prototype.nop=function(){},b}(Phaser.Plugin),function(){return window.addEventListener("load",function(){return window.asteroids=new d})}()}).call(this);