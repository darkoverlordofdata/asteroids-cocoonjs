(function(){"use strict";var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z,$,_,aa,ba,ca,da,ea,fa,ga,ha,ia=function(a,b){return function(){return a.apply(b,arguments)}},ja={}.hasOwnProperty,ka=function(a,b){function c(){this.constructor=a}for(var d in b)ja.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a};N=function(){function a(a){var c;switch(this.mt=function(){c=[];for(var a=0;e>=0?e>a:a>e;e>=0?a++:a--)c.push(a);return c}.apply(this),typeof a){case"number":this.init_genrand(a);break;case"object":this.init_genrand(a,a.length);break;default:this.init_genrand(Date.now()%b)}}var b,c,d,e,f;return e=624,c=397,d=2567483615,f=2147483648,b=2147483647,a.prototype.mt=null,a.prototype.mti=e+1,a.prototype.nextBool=function(){return 1===(1&this.genrand_int32())},a.prototype.nextDouble=function(){return this.genrand_res53()},a.prototype.nextInt=function(a){return~~(this.genrand_res53()*a)},a.prototype.init_genrand=function(a){for(this.mt[0]=4294967295&a,this.mti=1;this.mti<e;)this.mt[this.mti]=1812433253*(this.mt[this.mti-1]^this.mt[this.mti-1]>>30)+this.mti,this.mt[this.mti]&=4294967295,this.mti++},a.prototype.init_by_array=function(a,b){var c,d,f;for(this.init_genrand(19650218),c=1,d=0,f=e>b?e:b;f>0;)this.mt[c]=(this.mt[c]^1664525*(this.mt[c-1]^this.mt[c-1]>>30))+a[d]+d,this.mt[c]&=4294967295,c++,d++,c>=e&&(this.mt[0]=this.mt[e-1],c=1),d>=b&&(d=0),f--;for(f=e-1;f>0;)this.mt[c]=(this.mt[c]^1566083941*(this.mt[c-1]^this.mt[c-1]>>30))-c,this.mt[c]&=4294967295,c++,c>=e&&(this.mt[0]=this.mt[e-1],c=1),f--;this.mt[0]=2147483648},a.prototype.genrand_int32=function(){var a,g,h;if(g=[0,d],this.mti>=e){for(this.mti===e+1&&this.init_genrand(5489),a=0;e-c>a;)h=this.mt[a]&f|this.mt[a+1]&b,this.mt[a]=this.mt[a+c]^h>>1^g[1&h],a++;for(;e-1>a;)h=this.mt[a]&f|this.mt[a+1]&b,this.mt[a]=this.mt[a+(c-e)]^h>>1^g[1&h],a++;h=this.mt[e-1]&f|this.mt[0]&b,this.mt[e-1]=this.mt[c-1]^h>>1^g[1&h],this.mti=0}return h=this.mt[this.mti++],h^=h>>11,h^=h<<7&2636928640,h^=h<<15&4022730752,h^=h>>18,h>>0},a.prototype.genrand_int31=function(){return this.genrand_int32()>>1},a.prototype.genrand_real1=function(){return this.genrand_int32()*(1/4294967296)},a.prototype.genrand_real2=function(){return this.genrand_int32()*(1/4294967296)},a.prototype.genrand_real3=function(){return(this.genrand_int32()+.5)*(1/4294967296)},a.prototype.genrand_res53=function(){var a,b;return a=this.genrand_int32()>>5,b=this.genrand_int32()>>6,(67108864*a+b)*(1/9007199254740992)},a}(),T=function(){function a(a,b){this.x=null!=a?a:0,this.y=null!=b?b:0}return a.prototype.x=0,a.prototype.y=0,a.distance=function(a,b){var c,d;return c=a.x-b.x,d=a.y-b.y,Math.sqrt(c*c+d*d)},a.prototype.distanceSquaredTo=function(a){var b,c;return b=this.x-a.x,c=this.y-a.y,b*b+c*c},a.prototype.distanceTo=function(a){var b,c;return b=this.x-a.x,c=this.y-a.y,Math.sqrt(b*b+c*c)},a}(),M=function(){function a(a){this.parent=a,this.isUp=ia(this.isUp,this),this.isDown=ia(this.isDown,this),this.keyUpListener=ia(this.keyUpListener,this),this.keyDownListener=ia(this.keyDownListener,this),this.states={},window.addEventListener("keydown",this.keyDownListener),window.addEventListener("keyup",this.keyUpListener)}return a.KEY_LEFT=37,a.KEY_UP=38,a.KEY_RIGHT=39,a.KEY_Z=90,a.KEY_W=87,a.KEY_SPACE=32,a.prototype.states=null,a.prototype.keys=[a.KEY_LEFT,a.KEY_RIGHT,a.KEY_Z,a.KEY_UP,a.KEY_SPACE],a.prototype.keyDownListener=function(a){this.states[a.keyCode]=!0},a.prototype.keyUpListener=function(a){this.states[a.keyCode]&&(this.states[a.keyCode]=!1)},a.prototype.isDown=function(a){return this.states[a]},a.prototype.isUp=function(a){return!this.states[a]},a.prototype.buttons=function(a,b){var c,d;return c=a.add.button(b.width-100,b.height-50,"round"),c.onInputDown.add(function(a){return function(){a.states[a.keys[2]]=!0}}(this)),c.onInputUp.add(function(a){return function(){a.states[a.keys[2]]=!1}}(this)),d=a.add.button(b.width/2,b.height-50,"square"),d.anchor.x=.5,d.onInputDown.add(function(a){return function(){a.states[a.keys[4]]=!0}}(this)),d.onInputUp.add(function(a){return function(){a.states[a.keys[4]]=!1}}(this))},a}(),$=function(){function a(){this.audio=new window.Audio,this.audio.src=this.src,this.audio.load()}return a.volume=.5,a.enabled=!0,a.FACTOR=2,a.preload=function(a){var b;return b=new window.Audio,b.src=a,b.volume=0,b.play(),a},a.prototype.src="",a.prototype.audio=null,a.prototype.loop=function(){return this},a.prototype.play=function(){return a.enabled&&(this.audio.volume=a.volume,this.audio.play()),this},a.prototype.pause=function(){return this.audio.pause(),this},a}(),y=function(){function a(){}return a.prototype.src=$.preload("res/sounds/asteroid.wav"),a.prototype.play=function(){return a.audio.play("",0,$.volume/$.FACTOR)},a}(),z=function(){function a(){}return a.prototype.src=$.preload("res/sounds/ship.wav"),a.prototype.play=function(){return a.audio.play("",0,$.volume/$.FACTOR)},a}(),Y=function(){function a(){}return a.prototype.src=$.preload("res/sounds/shoot.wav"),a.prototype.play=function(){return a.audio.play("",0,$.volume/$.FACTOR)},a}(),g=function(){function a(a,b){var c,d,e,f;for(this.graphics=a.add.graphics(0,0),this.graphics.clear(),c=0,this.graphics.beginFill(16777215),this.graphics.moveTo(b,0);c<2*Math.PI;)d=(.75+.25*rnd.nextDouble())*b,e=Math.cos(c)*d,f=Math.sin(c)*d,this.graphics.lineTo(e,f),c+=.5*rnd.nextDouble();this.graphics.moveTo(b,0),this.graphics.endFill()}return a.prototype.graphics=null,Object.defineProperties(a.prototype,{x:{get:function(){return this.graphics.x},set:function(a){return this.graphics.x=a}},y:{get:function(){return this.graphics.x},set:function(a){return this.graphics.y=a}},rotation:{get:function(){return this.graphics.rotation},set:function(a){return this.graphics.rotation=a}}}),a.prototype.dispose=function(){return this.graphics.destroy()},a}(),f=function(){function a(a,b){this.animate=ia(this.animate,this);var c,d,e;for(this.dots=[],d=e=0;8>e;d=++e)c=new w(a,b),this.dots.push(c)}return a.prototype.dots=null,a.prototype.x=0,a.prototype.y=0,a.prototype.rotation=0,a.prototype.stage=null,a.prototype.first=!0,a.prototype.animate=function(a){var b,c,d,e,f,g,h,i;if(this.first)for(this.first=!1,g=this.dots,c=0,e=g.length;e>c;c++)b=g[c],b.graphics.x=this.x,b.graphics.y=this.y;for(h=this.dots,i=[],d=0,f=h.length;f>d;d++)b=h[d],b.graphics.x+=b.velocity.x*a,i.push(b.graphics.y+=b.velocity.y*a);return i},a.prototype.dispose=function(){var a,b,c,d,e;for(d=this.dots,e=[],b=0,c=d.length;c>b;b++)a=d[b],e.push(a.graphics.destroy());return e},a}(),w=function(){function a(a,b){var c,d,e;this.graphics=a.add.graphics(0,0),this.graphics.beginFill(16777215),this.graphics.drawCircle(0,0,1),this.graphics.endFill(),c=2*rnd.nextDouble()*Math.PI,d=rnd.nextDouble()*b,this.graphics.x=Math.cos(c)*d,this.graphics.y=Math.sin(c)*d,e=10*rnd.nextDouble()+10,this.velocity=new T(Math.cos(c)*e,Math.sin(c)*e)}return a.prototype.velocity=null,a.prototype.graphics=null,a.prototype.x=0,a.prototype.y=0,a}(),p=function(){function a(a){this.graphics=a.add.graphics(0,0),this.graphics.beginFill(16777215),this.graphics.drawCircle(0,0,2),this.graphics.endFill()}return a.prototype.graphics=null,Object.defineProperties(a.prototype,{x:{get:function(){return this.graphics.x},set:function(a){return this.graphics.x=a}},y:{get:function(){return this.graphics.x},set:function(a){return this.graphics.y=a}},rotation:{get:function(){return this.graphics.rotation},set:function(a){return this.graphics.rotation=a}}}),a.prototype.dispose=function(){return this.graphics.destroy()},a}(),L=function(){function a(a,b){this.setScore=ia(this.setScore,this),this.setLives=ia(this.setLives,this),this.graphics=a.add.graphics(0,100),this.graphics.beginFill(12632256),this.graphics.drawRect(0,0,30,40),this.graphics.endFill(),this.graphics.alpha=.5,this.score=a.add.text(window.innerWidth-130,20,"",{font:"bold 18px opendyslexic",fill:"white"}),this.setScore(0),this.setLives(3)}return a.prototype.graphics=null,a.prototype.score=null,a.prototype.lives=null,a.prototype.x=0,a.prototype.y=0,a.prototype.rotation=0,a.prototype.dispose=function(){return this.graphics.destroy(),this.score.destroy()},a.prototype.setLives=function(a){var b,c,d;for(this.graphics.clear(),this.graphics.beginFill(12632256),this.graphics.drawRect(0,0,30,40),this.graphics.endFill(),this.graphics.beginFill(0),c=d=0;a>=0?a>d:d>a;c=a>=0?++d:--d)b=10*c+10,this.graphics.moveTo(20,b),this.graphics.lineTo(3,7+b),this.graphics.lineTo(6,b),this.graphics.lineTo(3,-7+b),this.graphics.lineTo(20,b);this.graphics.endFill(),this.graphics.alpha=.5},a.prototype.setScore=function(a){this.score.setText("SCORE: "+a)},a}(),aa=function(){function a(a){this.animate=ia(this.animate,this),this.shape1=a.add.graphics(0,0),this.shape1.clear(),this.shape1.beginFill(16777215),this.shape1.moveTo(10,0),this.shape1.lineTo(-7,7),this.shape1.lineTo(-4,0),this.shape1.lineTo(10,0),this.shape1.endFill(),this.shape2=a.add.graphics(0,0),this.shape2.clear(),this.shape2.beginFill(16777215),this.shape2.moveTo(10,0),this.shape2.lineTo(-7,-7),this.shape2.lineTo(-4,0),this.shape2.lineTo(10,0),this.shape2.endFill(),this.vel1=new T(10*rnd.nextDouble()-5,10*rnd.nextDouble()+10),this.vel2=new T(10*rnd.nextDouble()-5,-(10*rnd.nextDouble()+10)),this.rot1=300*rnd.nextDouble()-150,this.rot2=300*rnd.nextDouble()-150}return a.prototype.shape1=null,a.prototype.shape2=null,a.prototype.vel1=null,a.prototype.vel2=null,a.prototype.rot1=null,a.prototype.rot2=null,a.prototype.first=!0,a.prototype.x=0,a.prototype.y=0,a.prototype.rotation=0,a.prototype.check=!0,a.prototype.dispose=function(){return this.shape1.destroy(),this.shape2.destroy()},a.prototype.animate=function(a){this.first&&(this.first=!1,this.shape1.x=this.shape2.x=this.x,this.shape1.y=this.shape2.y=this.y,this.shape1.rotation=this.shape2.rotation=this.rotation),this.shape1.x+=this.vel1.x*a,this.shape1.y+=this.vel1.y*a,this.shape1.rotation+=this.rot1*a,this.shape2.x+=this.vel2.x*a,this.shape2.y+=this.vel2.y*a,this.shape2.rotation+=this.rot2*a},a}(),ca=function(){function a(a){this.graphics=a.add.graphics(0,0),this.draw(16777215)}return a.prototype.graphics=null,Object.defineProperties(a.prototype,{x:{get:function(){return this.graphics.x},set:function(a){return this.graphics.x=a}},y:{get:function(){return this.graphics.x},set:function(a){return this.graphics.y=a}},rotation:{get:function(){return this.graphics.rotation},set:function(a){return this.graphics.rotation=a}}}),a.prototype.dispose=function(){return this.graphics.destroy()},a.prototype.draw=function(a){return this.graphics.clear(),this.graphics.beginFill(a),this.graphics.moveTo(10,0),this.graphics.lineTo(-7,7),this.graphics.lineTo(-4,0),this.graphics.lineTo(-7,-7),this.graphics.lineTo(10,0),this.graphics.endFill()},a}(),ha=function(){function a(c,d){var e,f;this.game=c,this.parent=d,this.start1=ia(this.start1,this),this.start=ia(this.start,this),this.click=new b,e=Math.floor(window.innerWidth/2),f=window.innerHeight-40,this.text1=1===a.count++?this.game.add.text(e,85,"GAME OVER",{font:"bold 60px opendyslexic",fill:"white",stroke:"black",strokeThickness:30}):this.game.add.text(e,85,"ASTEROIDS",{font:"bold 60px opendyslexic",fill:"white",stroke:"black",strokeThickness:30}),this.text2=this.game.device.touch?this.game.add.text(e,175,"TOUCH TO START",{font:"bold 12px opendyslexic",fill:"white"}):this.game.add.text(e,175,"CLICK TO START",{font:"bold 12px opendyslexic",fill:"white"}),this.text1.anchor.x=.5,this.text2.anchor.x=.5,this.game.device.desktop&&(this.text3=this.game.add.text(e,f,"Z ~ Fire  |  SPACE ~ Warp  |  Left/Right ~ Turn  |  Up ~ Accelerate",{font:"bold 10px opendyslexic",fill:"white"}),this.text3.anchor.x=.5),this.text1.inputEnabled=!0,this.text2.inputEnabled=!0,this.text1.events.onInputDown.add(this.start),this.text2.events.onInputDown.add(this.start)}var b;return a.count=0,b=ash.signals.Signal0,a.prototype.x=0,a.prototype.y=0,a.prototype.rotation=0,a.prototype.text1=null,a.prototype.text2=null,a.prototype.text3=null,a.prototype.click=null,a.prototype.start=function(a){var b;return this.faderBitmap=this.game.make.bitmapData(this.game.width,this.game.height),this.faderBitmap.rect(0,0,this.game.width,this.game.height,"rgb(0,0,0)"),this.faderSprite=this.game.add.sprite(0,0,this.faderBitmap),this.faderSprite.alpha=0,b=this.game.add.tween(this.faderSprite),b.to({alpha:1},1e3),b.onComplete.add(this.start1),b.start()},a.prototype.start1=function(){var a,b,c;return this.text1.destroy(),this.text2.destroy(),null!=(b=this.text3)&&b.destroy(),a=this.game.add.tween(this.faderSprite),a.to({alpha:0},1e3),a.onComplete.add(function(a){return function(){return a.click.dispatch()}}(this)),a.start(),null!=(c=this.parent.controller)?c.start():void 0},a}(),a=function(){function a(a){this.animation=a}return a.prototype.animation=null,a}(),d=function(){function a(a){this.fsm=a}return a.prototype.fsm=null,a}(),i=function(){function a(){this.toPlay=[]}return a.prototype.toPlay=null,a.prototype.play=function(a){return this.toPlay.push(a)},a}(),l=function(){function a(a){this.lifeRemaining=a}return a.prototype.lifeRemaining=0,a}(),q=function(){function a(a){this.radius=a}return a.prototype.radius=0,a}(),s=function(){function a(a){this.countdown=a}return a.prototype.countdown=0,a.prototype.body=null,a}(),v=function(){function a(a){this.graphic=a}return a.prototype.graphic=0,a}(),D=function(){function a(){}return a.prototype.lives=3,a.prototype.level=0,a.prototype.hits=0,a.prototype.playing=!1,a.prototype.setForStart=function(){this.lives=3,this.level=0,this.hits=0,this.playing=!0},a}(),E=function(){function a(a,b,c,d){this.minimumShotInterval=c,this.bulletLifetime=d,this.shooting=!1,this.offsetFromParent=null,this.timeSinceLastShot=0,this.offsetFromParent=new T(a,b)}return a.prototype.shooting=!1,a.prototype.offsetFromParent=null,a.prototype.timeSinceLastShot=0,a.prototype.offsetFromParent=null,a}(),H=function(){function a(a){this.trigger=a}return a.prototype.trigger=0,a}(),I=function(){function a(a){this.view=a}return a.prototype.view=null,a.prototype.leaderboard=!1,a}(),O=function(){function a(a,b,c,d,e,f){this.left=a,this.right=b,this.accelerate=c,this.warp=d,this.accelerationRate=e,this.rotationRate=f}return a.prototype.left=0,a.prototype.right=0,a.prototype.accelerate=0,a.prototype.warp=0,a.prototype.accelerationRate=0,a.prototype.rotationRate=0,a}(),Q=function(){function a(a){this.body=a}return a.prototype.body=null,a.prototype.previousX=0,a.prototype.previousY=0,a.prototype.previousAngle=0,a}(),U=function(){function a(a,b,c){this.rotation=c,this.position=new T(a,b)}return a.prototype.position=null,a.prototype.rotation=0,a}(),_=function(){function a(a){this.fsm=a}return a.prototype.fsm=null,a}(),ea=function(){function a(a){this.waitForStart=a,this.setStartGame=ia(this.setStartGame,this),this.waitForStart.click.add(this.setStartGame)}return a.prototype.waitForStart=null,a.prototype.startGame=!1,a.prototype.setStartGame=function(){this.startGame=!0},a}(),b=function(b){function c(){return c.__super__.constructor.apply(this,arguments)}return ka(c,b),c.components={animation:a},c.prototype.animation=null,c}(ash.core.Node),e=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return ka(b,a),b.components={asteroid:d,position:U,collision:q,audio:i,physics:Q},b.prototype.asteroid=null,b.prototype.position=null,b.prototype.collision=null,b.prototype.audio=null,b.prototype.physics=null,b}(ash.core.Node),j=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return ka(b,a),b.components={audio:i},b.prototype.audio=null,b}(ash.core.Node),m=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return ka(b,a),b.components={bullet:l,physics:Q,display:v},b.prototype.bullet=null,b.prototype.physics=null,b.prototype.display=null,b}(ash.core.Node),o=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return ka(b,a),b.components={bullet:l,position:U,physics:Q},b.prototype.bullet=null,b.prototype.physics=null,b}(ash.core.Node),t=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return ka(b,a),b.components={dead:s,display:v},b.prototype.dead=null,b.prototype.display=null,b}(ash.core.Node),C=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return ka(b,a),b.components={state:D},b.prototype.state=null,b}(ash.core.Node),F=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return ka(b,a),b.components={audio:i,control:H,gun:E,position:U},b.prototype.control=null,b.prototype.gun=null,b.prototype.position=null,b.prototype.audio=null,b}(ash.core.Node),J=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return ka(b,a),b.components={state:D,hud:I},b.prototype.state=null,b.prototype.hud=null,b}(ash.core.Node),P=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return ka(b,a),b.components={position:U},b.prototype.position=null,b}(ash.core.Node),R=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return ka(b,a),b.components={control:O,physics:Q,display:v},b.prototype.control=null,b.prototype.physics=null,b.prototype.display=null,b}(ash.core.Node),S=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return ka(b,a),b.components={position:U,physics:Q},b.prototype.position=null,b.prototype.physics=null,b}(ash.core.Node),V=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return ka(b,a),b.components={position:U,display:v},b.prototype.position=null,b.prototype.display=null,b}(ash.core.Node),ba=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return ka(b,a),b.components={spaceship:_,position:U},b.prototype.spaceship=0,b.prototype.position=0,b}(ash.core.Node),fa=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return ka(b,a),b.components={wait:ea},b.prototype.wait=null,b}(ash.core.Node),A=function(a){function b(a){this.updateNode=ia(this.updateNode,this),this.update=ia(this.update,this),this.process=ia(this.process,this),this.world=a.world,this.game=a.game,this.width=a.width,this.height=a.height}var c,d,e,f,g;return ka(b,a),f=Box2D.Dynamics.b2Body,g=Box2D.Common.Math.b2Vec2,d=1/60,e=8,c=3,b.prototype.handle=0,b.prototype.config=null,b.prototype.world=null,b.prototype.creator=null,b.prototype.nodes=null,b.prototype.enabled=!0,b.prototype.game=null,b.prototype.width=0,b.prototype.height=0,b.deadPool=[],b.prototype.addToEngine=function(a){this.nodes=a.getNodeList(S),this.handle=setInterval(this.process,d)},b.prototype.removeFromEngine=function(a){0!==this.handle&&clearInterval(this.handle),this.handle=0,this.nodes=null},b.prototype.process=function(){this.game.paused||this.enabled&&(this.world.Step(d,e,c),this.world.ClearForces())},b.prototype.update=function(a){var c,d,e;if(!this.game.paused&&this.enabled){for(d=this.nodes.head;d;)this.updateNode(d,a),d=d.next;for(;c=b.deadPool.pop();)e=c.GetUserData(),null!=e.entity&&delete e.entity,c.SetUserData(e),this.world.DestroyBody(c)}},b.prototype.updateNode=function(a,b){var c,d,e,f,h,i,j,k;e=a.position,d=a.physics,c=d.body,k=c.GetPosition(),f=k.x,i=k.y,h=f>this.width?0:0>f?this.width:f,j=i>this.height?0:0>i?this.height:i,(h!==f||j!==i)&&c.SetPosition(new g(h,j)),e.position.x=h,e.position.y=j,e.rotation=c.GetAngularVelocity()},b}(ash.core.System),Z=function(a){function b(a){this.smoothStates=ia(this.smoothStates,this),this.resetSmoothStates=ia(this.resetSmoothStates,this),this.update=ia(this.update,this),this.width=a.width,this.height=a.height,this.world=a.world,this.game=a.game}var c,d,e,f,g,h;return ka(b,a),e=Box2D.Dynamics.b2Body,f=Box2D.Common.Math.b2Vec2,c=1/60,d=5,h=8,g=1,b.prototype.fixedTimestepAccumulator=0,b.prototype.fixedTimestepAccumulatorRatio=0,b.prototype.config=null,b.prototype.world=null,b.prototype.creator=null,b.prototype.nodes=null,b.prototype.enabled=!0,b.prototype.game=null,b.prototype.width=0,b.prototype.height=0,b.deadPool=[],b.prototype.addToEngine=function(a){this.nodes=a.getNodeList(S)},b.prototype.removeFromEngine=function(a){this.nodes=null},b.prototype.update=function(a){var e,f,i,j,k;if(!this.game.paused&&this.enabled){for(this.fixedTimestepAccumulator+=a,i=Math.floor(this.fixedTimestepAccumulator/c),i>0&&(this.fixedTimestepAccumulator-=i*c),this.fixedTimestepAccumulatorRatio=this.fixedTimestepAccumulator/c,j=Math.min(i,d),f=0;j>f;)this.resetSmoothStates(),this.world.Step(a,h,g),f++;for(this.world.ClearForces(),this.smoothStates();e=b.deadPool.pop();)k=e.GetUserData(),null!=k.entity&&delete k.entity,e.SetUserData(k),this.world.DestroyBody(e)}},b.prototype.resetSmoothStates=function(){var a,b,c,d,e,g,h,i,j;for(b=this.nodes.head;b;)d=b.position,c=b.physics,a=c.body,j=a.GetPosition(),e=j.x,h=j.y,d.position.x=c.previousX=e,d.position.y=c.previousY=h,d.rotation=c.previousAngle=a.GetAngularVelocity(),g=e>this.width?0:0>e?this.width:e,i=h>this.height?0:0>h?this.height:h,(g!==e||i!==h)&&a.SetPosition(new f(g,i)),b=b.next},b.prototype.smoothStates=function(){var a,b,c,d,e,g,h,i,j,k;for(c=1-this.fixedTimestepAccumulatorRatio,b=this.nodes.head;b;)e=b.position,d=b.physics,a=d.body,k=a.GetPosition(),g=k.x,i=k.y,e.position.x=this.fixedTimestepAccumulatorRatio*g+c*d.previousX,e.position.y=this.fixedTimestepAccumulatorRatio*i+c*d.previousY,e.rotation=a.GetAngularVelocity()*this.fixedTimestepAccumulatorRatio+c*d.previousAngle,h=g>this.width?0:0>g?this.width:g,j=i>this.height?0:0>i?this.height:i,(h!==g||j!==i)&&a.SetPosition(new f(h,j)),b=b.next},b}(ash.core.System),c=function(a){function c(){this.updateNode=ia(this.updateNode,this),c.__super__.constructor.call(this,b,this.updateNode)}return ka(c,a),c.prototype.updateNode=function(a,b){a.animation.animation.animate(b)},c}(ash.tools.ListIteratingSystem),k=function(a){function b(){this.updateNode=ia(this.updateNode,this),b.__super__.constructor.call(this,j,this.updateNode)}return ka(b,a),b.prototype.updateNode=function(a,b){var c,d,e,f;f=a.audio.toPlay;for(c in f)e=f[c],d=new e,d.play(0,1);a.audio.toPlay=[]},b}(ash.tools.ListIteratingSystem),n=function(a){function b(a,c){this.PhysicsSystem=c,this.updateNode=ia(this.updateNode,this),b.__super__.constructor.call(this,m,this.updateNode),this.creator=a.creator}return ka(b,a),b.prototype.creator=null,b.prototype.PhysicsSystem=null,b.prototype.updateNode=function(a,b){var c;c=a.bullet,c.lifeRemaining-=b,c.lifeRemaining<=0&&(a.display.graphic.dispose(),this.PhysicsSystem.deadPool.push(a.physics.body),this.creator.destroyEntity(a.entity))},b}(ash.tools.ListIteratingSystem),r=function(a){function b(a,b){this.PhysicsSystem=b,this.PostSolve=ia(this.PostSolve,this),this.PreSolve=ia(this.PreSolve,this),this.EndContact=ia(this.EndContact,this),this.BeginContact=ia(this.BeginContact,this),this.update=ia(this.update,this),this.world=a.world,this.creator=a.creator,this.collisions=[],this.world.SetContactListener(this)}var c,e,f;return ka(b,a),f=Box2D.Dynamics.b2ContactListener,e=1,c=2,b.prototype.world=null,b.prototype.creator=null,b.prototype.games=null,b.prototype.collisions=null,b.prototype.PhysicsSystem=null,b.prototype.update=function(a){for(var b,f,g,h,j,k,l;this.collisions.length;)l=this.collisions.pop(),k=l.type,b=l.a,f=l.b,k===e?(null!=b.get(Q)&&(this.creator.destroyEntity(b),b.get(v).graphic.dispose(),this.PhysicsSystem.deadPool.push(b.get(Q).body)),null!=f.get(Q)&&(j=f.get(q).radius,h=f.get(U).position,j>10&&(this.creator.createAsteroid(j-10,h.x+10*rnd.nextDouble()-5,h.y+10*rnd.nextDouble()-5),this.creator.createAsteroid(j-10,h.x+10*rnd.nextDouble()-5,h.y+10*rnd.nextDouble()-5)),g=f.get(Q).body,f.get(v).graphic.dispose(),f.get(d).fsm.changeState("destroyed"),f.get(s).body=g,f.get(i).play(y),this.games.head&&this.games.head.state.hits++)):k===c&&null!=f.get(Q)&&(g=f.get(Q).body,f.get(v).graphic.dispose(),f.get(_).fsm.changeState("destroyed"),f.get(s).body=g,f.get(i).play(z),this.games.head&&this.games.head.state.lives--)},b.prototype.addToEngine=function(a){this.games=a.getNodeList(C)},b.prototype.removeFromEngine=function(a){this.games=null},b.prototype.BeginContact=function(a){var b,d;switch(b=a.GetFixtureA().GetBody().GetUserData(),d=a.GetFixtureB().GetBody().GetUserData(),b.type){case x.ASTEROID:switch(d.type){case x.BULLET:this.collisions.push({type:e,a:d.entity,b:b.entity});break;case x.SPACESHIP:this.collisions.push({type:c,a:b.entity,b:d.entity})}break;case x.BULLET:d.type===x.ASTEROID&&this.collisions.push({type:e,a:b.entity,b:d.entity});break;case x.SPACESHIP:d.type===x.ASTEROID&&this.collisions.push({type:c,a:d.entity,b:b.entity})}},b.prototype.EndContact=function(a){},b.prototype.PreSolve=function(a,b){},b.prototype.PostSolve=function(a,b){},b}(ash.core.System),u=function(a){function b(a,c){this.PhysicsSystem=c,this.updateNode=ia(this.updateNode,this),b.__super__.constructor.call(this,t,this.updateNode),this.creator=a.creator}return ka(b,a),b.prototype.creator=null,b.prototype.PhysicsSystem=null,b.prototype.updateNode=function(a,b){var c;c=a.dead,c.countdown-=b,c.countdown<=0&&(this.creator.destroyEntity(a.entity),a.display.graphic.dispose(),this.PhysicsSystem.deadPool.push(c.body))},b}(ash.tools.ListIteratingSystem),B=function(a){function b(a){this.update=ia(this.update,this),this.creator=a.creator,this.width=a.width,this.height=a.height}return ka(b,a),b.prototype.config=null,b.prototype.creator=null,b.prototype.gameNodes=null,b.prototype.spaceships=null,b.prototype.asteroids=null,b.prototype.bullets=null,b.prototype.width=0,b.prototype.height=0,b.prototype.addToEngine=function(a){this.gameNodes=a.getNodeList(C),this.spaceships=a.getNodeList(ba),this.asteroids=a.getNodeList(e),this.bullets=a.getNodeList(o)},b.prototype.update=function(a){var b,c,d,e,f,g,h,i,j,k,l,m,n;if(i=this.gameNodes.head,i&&i.state.playing){if(this.spaceships.empty)if(i.state.lives>0){for(h=new T(.5*this.width,.5*this.height),d=!0,b=this.asteroids.head;b;){if(T.distance(b.position.position,h)<=b.collision.radius+50){d=!1;break}b=b.next}d&&this.creator.createSpaceship()}else i.state.playing=!1,l=new Date,g=(l.getMonth()+1).toString(),1===g.length&&(g="0"+g),e=l.getDate().toString(),1===e.length&&(e="0"+e),m=l.getFullYear().toString(),n=m+g+e,0===Db.queryAll("leaderboard",{query:{date:n}}).length?Db.insert("leaderboard",{date:n,score:i.state.hits}):Db.update("leaderboard",{date:n},function(a){return i.state.hits>a.score&&(a.score=i.state.hits),a}),Db.commit(),this.creator.createWaitForClick();if(this.asteroids.empty&&this.bullets.empty&&!this.spaceships.empty)for(k=this.spaceships.head,i.state.level++,c=2+i.state.level,f=0;c>f;){for(;;)if(j=new T(rnd.nextDouble()*this.width,rnd.nextDouble()*this.height),!(T.distance(j,k.position.position)<=80))break;this.creator.createAsteroid(30,j.x,j.y),++f}}},b.prototype.removeFromEngine=function(a){this.gameNodes=null,this.spaceships=null,this.asteroids=null,this.bullets=null},b}(ash.core.System),G=function(a){function b(a){this.parent=a,this.updateNode=ia(this.updateNode,this),b.__super__.constructor.call(this,F,this.updateNode),this.keyPoll=this.parent.keyPoll,this.creator=this.parent.creator,this.controller=this.parent.controller}return ka(b,a),b.prototype.keyPoll=null,b.prototype.creator=null,b.prototype.updateNode=function(a,b){var c,d,e,f,g;c=a.control,e=a.position,d=a.gun,d.shooting=this.keyPoll.isDown(c.trigger)||(null!=(f=this.controller)&&null!=(g=f.buttons)?g.fire:void 0),d.timeSinceLastShot+=b,d.shooting&&d.timeSinceLastShot>=d.minimumShotInterval&&(this.creator.createUserBullet(d,e),a.audio.play(Y),d.timeSinceLastShot=0)},b}(ash.tools.ListIteratingSystem),K=function(a){function b(){this.updateNode=ia(this.updateNode,this),b.__super__.constructor.call(this,J,this.updateNode)}return ka(b,a),b.prototype.updateNode=function(a,b){a.hud.view.setLives(a.state.lives),a.hud.view.setScore(a.state.hits)},b}(ash.tools.ListIteratingSystem),X=function(a){function b(a){this.parent=a,this.updateNode=ia(this.updateNode,this),b.__super__.constructor.call(this,R,this.updateNode),this.keyPoll=this.parent.keyPoll,this.width=this.parent.width,this.height=this.parent.height,this.game=this.parent.game,this.controller=this.parent.controller}var c,d,e,f,g;return ka(b,a),d=window.devicePixelRatio,c=null!=(null!=(g=window.ext)?g.IDTK_SRV_BOX2D:void 0),e=Box2D.Common.Math.b2Vec2,f=[16711680,65280,255,16711935,65535,16776960],b.prototype.keyPoll=null,b.prototype.warping=0,b.prototype.kount=0,b.prototype.width=0,b.prototype.height=0,b.prototype.updateNode=function(a,b){var e,g,h,i,j,k,l,m,n,o,p,q,r,s,t;return i=a.control,h=a.physics.body,this.warping?(this.warping--,o=rnd.nextInt(this.width),p=rnd.nextInt(this.height),h.SetPosition({x:o,y:p}),void a.display.graphic.draw(0===this.warping?16777215:f[rnd.nextInt(6)])):this.keyPoll.isDown(i.warp)||(null!=(q=this.controller)&&null!=(r=q.buttons)?r.warp:void 0)?(this.controller.warp=!1,void(this.warping=rnd.nextInt(30)+30)):(j=null!=(s=this.controller)?s.dpad:void 0,null!=j&&(j.left&&(l=h.GetAngularVelocity(),h.SetAngularVelocity(l-i.rotationRate*b)),j.right&&(l=l||h.GetAngularVelocity(),h.SetAngularVelocity(l+i.rotationRate*b)),j.up&&(l=l||h.GetAngularVelocity(),n=h.GetLinearVelocity(),n.x+=Math.cos(l)*i.accelerationRate*b*d,n.y+=Math.sin(l)*i.accelerationRate*b*d,c||h.SetAwake(!0),h.SetLinearVelocity(n))),k=null!=(t=this.controller)?t.joystick:void 0,null!=k&&(g=Math.atan2(k.normalizedY,k.normalizedX)/Math.PI*180,e=Math.abs(g),l=h.GetAngularVelocity(),e>135&&179>e?h.SetAngularVelocity(l-i.rotationRate*b):e>1&&45>e?h.SetAngularVelocity(l+i.rotationRate*b):g>45&&135>g&&(m=127/Math.sqrt(k.normalizedX*k.normalizedX+k.normalizedY*k.normalizedY),n=h.GetLinearVelocity(),n.x+=Math.cos(l)*m*b*d,n.y+=Math.sin(l)*m*b*d,c||h.SetAwake(!0),h.SetLinearVelocity(n))),this.keyPoll.isDown(i.left)&&(l=h.GetAngularVelocity(),h.SetAngularVelocity(l-i.rotationRate*b)),this.keyPoll.isDown(i.right)&&(l=l||h.GetAngularVelocity(),h.SetAngularVelocity(l+i.rotationRate*b)),void(this.keyPoll.isDown(i.accelerate)&&(l=l||h.GetAngularVelocity(),n=h.GetLinearVelocity(),n.x+=Math.cos(l)*i.accelerationRate*b*d,n.y+=Math.sin(l)*i.accelerationRate*b*d,c||h.SetAwake(!0),h.SetLinearVelocity(n))))},b}(ash.tools.ListIteratingSystem),W=function(a){function b(a){this.stage=a,this.update=ia(this.update,this)}return ka(b,a),b.prototype.stage=null,b.prototype.renderer=null,b.prototype.nodes=null,b.prototype.addToEngine=function(a){var b;for(this.nodes=a.getNodeList(V),b=this.nodes.head;b;)this.addToDisplay(b),b=b.next},b.prototype.addToDisplay=function(a){},b.prototype.removeFromDisplay=function(a){},b.prototype.removeFromEngine=function(a){this.nodes=null},b.prototype.update=function(a){var b,c,d,e;for(d=this.nodes.head;d;)b=d.display,c=b.graphic,e=d.position,c.x=e.position.x,c.y=e.position.y,c.rotation=e.rotation,d=d.next},b}(ash.core.System),da=function(){function a(){}return a.preUpdate=1,a.update=2,a.move=3,a.resolveCollisions=4,a.stateMachines=5,a.render=6,a.animate=7,a}(),ga=function(a){function b(a){this.update=ia(this.update,this),this.creator=a.creator}return ka(b,a),b.prototype.engine=null,b.prototype.creator=null,b.prototype.gameNodes=null,b.prototype.waitNodes=null,b.prototype.asteroids=null,b.prototype.addToEngine=function(a){this.engine=a,this.waitNodes=a.getNodeList(fa),this.gameNodes=a.getNodeList(C),this.asteroids=a.getNodeList(e)},b.prototype.removeFromEngine=function(a){this.waitNodes=null,this.gameNodes=null,this.asteroids=null},b.prototype.update=function(a){var b,c,d,e;if(e=this.waitNodes.head,c=this.gameNodes.head,e&&e.wait.startGame&&c){for(b=this.asteroids.head;b;)d=b.entity.get(v).graphic,this.creator.destroyEntity(b.entity),d.dispose(),b=b.next;c.state.setForStart(),e.wait.startGame=!1,this.engine.removeEntity(e.entity)}},b}(ash.core.System),x=function(){function b(a){this.parent=a,this.createUserBullet=ia(this.createUserBullet,this),this.createSpaceship=ia(this.createSpaceship,this),this.game=this.parent.game,
this.engine=this.parent.engine,this.world=this.parent.world}var c,e,h,j,k,m,n,o,r;return b.ASTEROID=1,b.SPACESHIP=2,b.BULLET=3,b.prototype.LEFT=M.KEY_LEFT,b.prototype.RIGHT=M.KEY_RIGHT,b.prototype.THRUST=M.KEY_UP,b.prototype.FIRE=M.KEY_Z,b.prototype.WARP=M.KEY_SPACE,c=ash.core.Entity,e=ash.fsm.EntityStateMachine,r=function(a){return parseFloat(asteroids.get(a))},h=Box2D.Dynamics.b2Body,j=Box2D.Dynamics.b2BodyDef,k=Box2D.Collision.Shapes.b2CircleShape,m=Box2D.Dynamics.b2FixtureDef,n=Box2D.Collision.Shapes.b2PolygonShape,o=Box2D.Common.Math.b2Vec2,b.prototype.game=null,b.prototype.engine=null,b.prototype.world=null,b.prototype.waitEntity=null,b.prototype.bulletId=0,b.prototype.asteroidId=0,b.prototype.spaceshipId=0,b.prototype.destroyEntity=function(a){this.engine.removeEntity(a)},b.prototype.createGame=function(){var a,b;return b=new L(this.game),a=new c("game").add(new D).add(new I(b)).add(new v(b)).add(new U(0,0,0,0)),this.engine.addEntity(a),a},b.prototype.createWaitForClick=function(){var a;return a=new ha(this.game,this.parent),this.waitEntity=new c("wait").add(new ea(a)).add(new v(a)).add(new U(0,0,0,0)),this.waitEntity.get(ea).startGame=!1,this.engine.addEntity(this.waitEntity),this.waitEntity},b.prototype.createAsteroid=function(l,n,o){var p,t,u,w,x,y,z,A,B;return u=new j,u.type=h.b2_dynamicBody,u.fixedRotation=!0,u.position.x=n,u.position.y=o,A=(rnd.nextDouble()-.5)*r("asteroidLinearVelocity")*(50-l),B=(rnd.nextDouble()-.5)*r("asteroidLinearVelocity")*(50-l),u.linearVelocity.Set(A,B),u.angularVelocity=rnd.nextDouble()*r("asteroidAngularVelocity")-1,u.linearDamping=r("asteroidDamping"),x=new m,x.density=r("asteroidDensity"),x.friction=r("asteroidFriction"),x.restitution=r("asteroidRestitution"),x.shape=new k(l),t=this.world.CreateBody(u),t.CreateFixture(x),p=new c,y=new e(p),z=new g(this.game,l),y.createState("alive").add(Q).withInstance(new Q(t)).add(q).withInstance(new q(l)).add(v).withInstance(new v(z)),w=new f(this.game,l),y.createState("destroyed").add(s).withInstance(new s(3)).add(v).withInstance(new v(w)).add(a).withInstance(new a(w)),p.add(new d(y)).add(new U(n,o,0)).add(new i),t.SetUserData({type:b.ASTEROID,entity:p}),y.changeState("alive"),this.engine.addEntity(p),p},b.prototype.createSpaceship=function(){var d,f,g,k,l,p,t,u,w;return u=rnd.nextInt(this.parent.width),w=rnd.nextInt(this.parent.height),f=new j,f.type=h.b2_dynamicBody,f.fixedRotation=!1,f.position.x=u,f.position.y=w,f.linearVelocity.Set(0,0),f.angularVelocity=0,f.linearDamping=r("spaceshipDamping"),k=new m,k.density=r("spaceshipDensity"),k.friction=r("spaceshipFriction"),k.restitution=r("spaceshipRestitution"),k.shape=new n,k.shape.SetAsArray([new o(.45,0),new o(-.25,.25),new o(-.25,-.25)],3),d=this.world.CreateBody(f),d.CreateFixture(k),t=new c,l=new e(t),p=new ca(this.game),l.createState("playing").add(Q).withInstance(new Q(d)).add(O).withInstance(new O(this.LEFT,this.RIGHT,this.THRUST,this.WARP,100,3)).add(E).withInstance(new E(8,0,.3,2)).add(H).withInstance(new H(this.FIRE)).add(q).withInstance(new q(9)).add(v).withInstance(new v(p)),g=new aa(this.game),l.createState("destroyed").add(s).withInstance(new s(5)).add(v).withInstance(new v(g)).add(a).withInstance(new a(g)),t.add(new _(l)).add(new U(u,w,0)).add(new i),d.SetUserData({type:b.SPACESHIP,entity:t}),l.changeState("playing"),this.engine.addEntity(t),t},b.prototype.createUserBullet=function(a,d){var e,f,g,i,n,o,s,t,u;return n=Math.cos(d.rotation),s=Math.sin(d.rotation),t=n*a.offsetFromParent.x-s*a.offsetFromParent.y+d.position.x,u=s*a.offsetFromParent.x+n*a.offsetFromParent.y+d.position.y,f=new j,f.type=h.b2_dynamicBody,f.fixedRotation=!0,f.bullet=!0,f.position.x=t,f.position.y=u,f.linearVelocity.Set(n*r("bulletLinearVelocity"),s*r("bulletLinearVelocity")),f.angularVelocity=0,f.linearDamping=r("bulletDamping"),o=new m,o.density=r("bulletDensity"),o.friction=r("bulletFriction"),o.restitution=r("bulletRestitution"),o.shape=new k(0),e=this.world.CreateBody(f),e.CreateFixture(o),i=new p(this.game),g=(new c).add(new l(a.bulletLifetime)).add(new U(t,u,0)).add(new q(0)).add(new Q(e)).add(new v(i)),e.SetUserData({type:b.BULLET,entity:g}),this.engine.addEntity(g),g},b}(),h=function(){function a(){this.initializeDb=ia(this.initializeDb,this),this.setPlaySfx=ia(this.setPlaySfx,this),this.setPlayMusic=ia(this.setPlayMusic,this),this.setBackground=ia(this.setBackground,this),this.getBackground=ia(this.getBackground,this),this.set=ia(this.set,this),this.get=ia(this.get,this),this.showLeaderboard=ia(this.showLeaderboard,this),this.pause=ia(this.pause,this),this.fade=ia(this.fade,this),this.getFaderSprite=ia(this.getFaderSprite,this),this.create=ia(this.create,this),this.onLeaderboard=ia(this.onLeaderboard,this),this.onSettings=ia(this.onSettings,this),this.preload=ia(this.preload,this),this.init=ia(this.init,this),this.game=new Phaser.Game(this.width*this.scale,this.height*this.scale,Phaser.CANVAS,"",{init:this.init,preload:this.preload,create:this.create}),window.rnd=new N,this.initializeDb(),this.optBgd=Db.queryAll("settings",{query:{name:"background"}})[0].value,Cocoon.App.WebView.on("load",{success:function(a){return function(){return Cocoon.App.showTheWebView()}}(this),error:function(a){return function(){return console.log("Cannot show the Webview: "+JSON.stringify(arguments))}}(this)})}var b,d,e;return b=Box2D.Common.Math.b2Vec2,d=Box2D.Dynamics.b2World,e=function(a){return a.charAt(0).toUpperCase()+a.substr(1)},a.prototype.game=null,a.prototype.pad=null,a.prototype.profiler=null,a.prototype.engine=null,a.prototype.creator=null,a.prototype.keyPoll=null,a.prototype.config=null,a.prototype.world=null,a.prototype.background=null,a.prototype.physics=null,a.prototype.faderBitmap=null,a.prototype.faderSprite=null,a.prototype.bgdColor=6970061,a.prototype.height=window.innerHeight,a.prototype.width=window.innerWidth,a.prototype.scale=window.devicePixelRatio,a.prototype.playMusic=localStorage.playMusic,a.prototype.playSfx=localStorage.playSfx,a.prototype.optBgd=localStorage.background||"blue",a.prototype.init=function(){this.game.scale.scaleMode=Phaser.ScaleManager.SHOW_ALL,this.game.scale.minWidth=this.width*this.scale,this.game.scale.minHeight=this.height*this.scale,this.game.scale.maxWidth=this.width*this.scale,this.game.scale.maxHeight=this.height*this.scale,this.game.scale.pageAlignVertically=!0,this.game.scale.pageAlignHorizontally=!0},a.prototype.preload=function(){this.game.load.image("dialog-blue","res/dialog-box.png"),this.game.load.image("dialog-star","res/black-dialog.png"),this.game.load.image("button-blue","res/standard-button-on.png"),this.game.load.image("button-star","res/black-button-on.png"),this.game.load.image("background","res/BackdropBlackLittleSparkBlack.png"),this.game.load.image("leaderboard","res/icons/b_Leaderboard.png"),this.game.load.image("settings","res/icons/b_Parameters.png"),this.game.load.image("round","res/round48.png"),this.game.load.image("square","res/square48.png"),this.game.load.audio("asteroid",[y.prototype.src]),this.game.load.audio("ship",[z.prototype.src]),this.game.load.audio("shoot",[Y.prototype.src])},a.prototype.onSettings=function(){this.pause(function(a){return function(){return Cocoon.App.loadInTheWebView("settings.html")}}(this))},a.prototype.onLeaderboard=function(){this.pause(function(a){return function(){return a.showLeaderboard()}}(this))},a.prototype.create=function(){var a,e;this.profiler=this.game.plugins.add(Phaser.Plugin.PerformanceMonitor,{profiler:this.get("profiler")}),this.game.stage.backgroundColor=this.bgdColor,this.background=this.game.add.sprite(0,0,"background"),this.background.width=this.width,this.background.height=this.height,this.background.alpha="blue"===this.optBgd?0:1,this.game.add.button(this.width-50,50,"settings",this.onSettings),this.game.add.button(this.width-50,125,"leaderboard",this.onLeaderboard),y.audio=this.game.add.audio("asteroid"),y.audio.play("",0,0),z.audio=this.game.add.audio("ship"),z.audio.play("",0,0),Y.audio=this.game.add.audio("shoot"),Y.audio.play("",0,0),e=!(!window.ext||"undefined"==typeof window.ext.IDTK_SRV_BOX2D),a=e?A:Z,this.keyPoll=new M(this),this.engine=this.game.plugins.add(ash.core.PhaserEngine),this.world=new d(new b(0,0),!0),this.world.SetContinuousPhysics(!0),this.controller=this.game.plugins.add(Phaser.Plugin.GameControllerPlugin,{force:!1}),this.controller.addDPad("left",60,this.height-60,{up:{width:"10%",height:"7%"},down:!1,left:{width:"7%",height:"10%"},right:{width:"7%",height:"10%"}}),this.controller.addButtons("right",this.width-180,this.height-80,{1:{title:"warp",color:"yellow"},3:{title:"FIRE",color:"red"}}),this.creator=new x(this),this.physics=new a(this),this.engine.addSystem(this.physics,da.move),this.engine.addSystem(new n(this,a),da.update),this.engine.addSystem(new u(this,a),da.update),this.engine.addSystem(new r(this,a),da.resolveCollisions),this.engine.addSystem(new c(this),da.animate),this.engine.addSystem(new K(this),da.animate),this.engine.addSystem(new W(this),da.render),this.engine.addSystem(new k(this),da.render),this.engine.addSystem(new ga(this),da.preUpdate),this.engine.addSystem(new B(this),da.preUpdate),this.engine.addSystem(new X(this),da.update),this.engine.addSystem(new G(this),da.update),this.creator.createWaitForClick(),this.creator.createGame()},a.prototype.getFaderSprite=function(){return null==this.faderSprite&&(this.faderBitmap=this.game.make.bitmapData(this.game.width,this.game.height),this.faderBitmap.rect(0,0,this.game.width,this.game.height,"rgb(0,0,0)"),this.faderSprite=this.game.add.sprite(0,0,this.faderBitmap),this.faderSprite.alpha=0),this.faderSprite.bringToTop()},a.prototype.fade=function(a){var b,c;c=this.getFaderSprite(),b=this.game.add.tween(c),0===c.alpha?(b.to({alpha:1},500),b.onComplete.add(a,this),b.start()):(this.game.paused=!1,b.to({alpha:0},500),b.onComplete.add(a,this),b.start())},a.prototype.pause=function(a){null!=a?(this.faderSprite=null,this.physics.enabled=!1,this.fade(a)):this.fade(function(a){return function(){return a.physics.enabled=!0}}(this))},a.prototype.showLeaderboard=function(){var a,b,c,d,e,f,g,h,i,j,k,l,m;for(b=this.game.add.group(),d=new Phaser.Sprite(this.game,0,0,"dialog-"+this.optBgd),d.width=this.width,d.height=this.height,b.add(d),a={font:"bold 30px opendyslexic",fill:"#ffffff"},g={font:"bold 20px opendyslexic",fill:"#ffffff"},i=new Phaser.Text(this.game,this.width/2,20,"Asteroids",a),i.anchor.x=.5,b.add(i),b.add(new Phaser.Text(this.game,200,80,"Date",g)),b.add(new Phaser.Text(this.game,400,80,"Score",g)),b.add(new Phaser.Text(this.game,200,100,"--------",g)),b.add(new Phaser.Text(this.game,400,100,"--------",g)),j=120,m=Db.queryAll("leaderboard",{limit:10,sort:[["score","DESC"]]}),k=0,l=m.length;l>k;k++)h=m[k],f=h.date.substr(4,2)+"/"+h.date.substr(6,2)+"/"+h.date.substr(0,4),b.add(new Phaser.Text(this.game,200,j,f,g)),b.add(new Phaser.Text(this.game,400,j,h.score,g)),j+=20;c=new Phaser.Button(this.game,this.width/2,this.height-64,"button-"+this.optBgd,function(a){return function(){b.destroy(),b=null,a.pause()}}(this)),c.anchor.x=.5,b.add(c),e=new Phaser.Text(this.game,0,c.height/2,"continue",a),e.anchor.x=.5,e.anchor.y=.5,c.addChild(e)},a.prototype.get=function(a){var b;return b="get"+e(a),null!=this[b]?this[b]():Db.queryAll("settings",{query:{name:a}})[0].value},a.prototype.set=function(a,b){var c;c="set"+e(a),null!=this[c]?this[c](b):(Db.update("settings",{name:a},function(a){return a.value=b,a}),Db.commit())},a.prototype.getBackground=function(){return"blue"===Db.queryAll("settings",{query:{name:"background"}})[0].value?0:1},a.prototype.setBackground=function(a){var b;b=["blue","star"],this.background.alpha=a,this.optBgd=b[a],Db.update("settings",{name:"background"},function(c){return c.value=b[a],c}),Db.commit()},a.prototype.setPlayMusic=function(a){Db.update("settings",{name:"playMusic"},function(b){return b.value=a,b}),Db.commit(),this.playMusic=a},a.prototype.setPlaySfx=function(a){Db.update("settings",{name:"playSfx"},function(b){return b.value=a,b}),Db.commit(),this.playSfx=a,$.volume=a/100},a.prototype.initializeDb=function(){window.Db=new localStorageDB("asteroids",localStorage),Db.isNew()&&(Db.createTable("leaderboard",["date","score"]),Db.createTable("settings",["name","value"]),Db.insert("settings",{name:"profiler",value:"on"}),Db.insert("settings",{name:"background",value:"blue"}),Db.insert("settings",{name:"playMusic",value:"50"}),Db.insert("settings",{name:"playSfx",value:"50"}),Db.insert("settings",{name:"asteroidDensity",value:"1.0"}),Db.insert("settings",{name:"asteroidFriction",value:"1.0"}),Db.insert("settings",{name:"asteroidRestitution",value:"0.2"}),Db.insert("settings",{name:"asteroidDamping",value:"0.0"}),Db.insert("settings",{name:"asteroidLinearVelocity",value:"4.0"}),Db.insert("settings",{name:"asteroidAngularVelocity",value:"2.0"}),Db.insert("settings",{name:"spaceshipDensity",value:"1.0"}),Db.insert("settings",{name:"spaceshipFriction",value:"1.0"}),Db.insert("settings",{name:"spaceshipRestitution",value:"0.2"}),Db.insert("settings",{name:"spaceshipDamping",value:"0.75"}),Db.insert("settings",{name:"bulletDensity",value:"1.0"}),Db.insert("settings",{name:"bulletFriction",value:"0.0"}),Db.insert("settings",{name:"bulletRestitution",value:"0.0"}),Db.insert("settings",{name:"bulletDamping",value:"0.0"}),Db.insert("settings",{name:"bulletLinearVelocity",value:"150"}),Db.commit()),0===Db.queryAll("settings",{query:{name:"profiler"}}).length&&Db.insert("settings",{name:"profiler",value:"off"})},a}(),Phaser.Plugin.PerformanceMonitor=function(a){function b(a,c){b.__super__.constructor.call(this,a,c)}return ka(b,a),b.prototype.stats=null,b.prototype.visible=!1,b.prototype.active=!1,b.prototype.hasPreUpdate=!1,b.prototype.hasPostRender=!1,b.prototype.init=function(a){var b,c,d,e,f,g;return navigator.isCocoonJS||"off"===a.profiler?(this.preUpdate=this.nop,this.postRender=this.nop):"undefined"!=typeof Stats&&null!==Stats?(null!=a.container?b=a.container:(b=document.createElement("div"),document.body.appendChild(b)),this.stats=new Stats,b.appendChild(this.stats.domElement),this.stats.domElement.style.position="absolute",c=null!=(e=a.x)?e:0,d=null!=(f=a.y)?f:0,this.stats.setMode(null!=(g=a.mode)?g:0),this.stats.domElement.style.position="absolute",this.stats.domElement.style.left=""+c+"px",this.stats.domElement.style.top=""+d+"px",this.active=!0,this.visible=!0,this.hasPreUpdate=!0,this.hasPostRender=!0):(this.preUpdate=this.nop,this.postRender=this.nop)},b.prototype.preUpdate=function(){this.stats.begin()},b.prototype.postRender=function(){this.stats.end()},b.prototype.nop=function(){},b}(Phaser.Plugin),function(){return window.addEventListener("load",function(){return window.asteroids=new h})}()}).call(this);