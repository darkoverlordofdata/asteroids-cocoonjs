(function(){"use strict";var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z,$,_,ab,bb,cb,db,eb,fb,gb,hb,ib=function(a,b){return function(){return a.apply(b,arguments)}},jb=[].indexOf||function(a){for(var b=0,c=this.length;c>b;b++)if(b in this&&this[b]===a)return b;return-1},kb={}.hasOwnProperty,lb=function(a,b){function c(){this.constructor=a}for(var d in b)kb.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a};N=function(){function a(a){var c;switch(this.mt=function(){c=[];for(var a=0;e>=0?e>a:a>e;e>=0?a++:a--)c.push(a);return c}.apply(this),typeof a){case"number":this.init_genrand(a);break;case"object":this.init_genrand(a,a.length);break;default:this.init_genrand(Date.now()%b)}}var b,c,d,e,f;return e=624,c=397,d=2567483615,f=2147483648,b=2147483647,a.prototype.mt=null,a.prototype.mti=e+1,a.prototype.nextBool=function(){return 1===(1&this.genrand_int32())},a.prototype.nextDouble=function(){return this.genrand_res53()},a.prototype.nextInt=function(a){return~~(this.genrand_res53()*a)},a.prototype.init_genrand=function(a){for(this.mt[0]=4294967295&a,this.mti=1;this.mti<e;)this.mt[this.mti]=1812433253*(this.mt[this.mti-1]^this.mt[this.mti-1]>>30)+this.mti,this.mt[this.mti]&=4294967295,this.mti++},a.prototype.init_by_array=function(a,b){var c,d,f;for(this.init_genrand(19650218),c=1,d=0,f=e>b?e:b;f>0;)this.mt[c]=(this.mt[c]^1664525*(this.mt[c-1]^this.mt[c-1]>>30))+a[d]+d,this.mt[c]&=4294967295,c++,d++,c>=e&&(this.mt[0]=this.mt[e-1],c=1),d>=b&&(d=0),f--;for(f=e-1;f>0;)this.mt[c]=(this.mt[c]^1566083941*(this.mt[c-1]^this.mt[c-1]>>30))-c,this.mt[c]&=4294967295,c++,c>=e&&(this.mt[0]=this.mt[e-1],c=1),f--;this.mt[0]=2147483648},a.prototype.genrand_int32=function(){var a,g,h;if(g=[0,d],this.mti>=e){for(this.mti===e+1&&this.init_genrand(5489),a=0;e-c>a;)h=this.mt[a]&f|this.mt[a+1]&b,this.mt[a]=this.mt[a+c]^h>>1^g[1&h],a++;for(;e-1>a;)h=this.mt[a]&f|this.mt[a+1]&b,this.mt[a]=this.mt[a+(c-e)]^h>>1^g[1&h],a++;h=this.mt[e-1]&f|this.mt[0]&b,this.mt[e-1]=this.mt[c-1]^h>>1^g[1&h],this.mti=0}return h=this.mt[this.mti++],h^=h>>11,h^=h<<7&2636928640,h^=h<<15&4022730752,h^=h>>18,h>>0},a.prototype.genrand_int31=function(){return this.genrand_int32()>>1},a.prototype.genrand_real1=function(){return this.genrand_int32()*(1/4294967296)},a.prototype.genrand_real2=function(){return this.genrand_int32()*(1/4294967296)},a.prototype.genrand_real3=function(){return(this.genrand_int32()+.5)*(1/4294967296)},a.prototype.genrand_res53=function(){var a,b;return a=this.genrand_int32()>>5,b=this.genrand_int32()>>6,(67108864*a+b)*(1/9007199254740992)},a}(),V=function(){function a(a,b){this.x=null!=a?a:0,this.y=null!=b?b:0}return a.prototype.x=0,a.prototype.y=0,a.distance=function(a,b){var c,d;return c=a.x-b.x,d=a.y-b.y,Math.sqrt(c*c+d*d)},a.prototype.distanceSquaredTo=function(a){var b,c;return b=this.x-a.x,c=this.y-a.y,b*b+c*c},a.prototype.distanceTo=function(a){var b,c;return b=this.x-a.x,c=this.y-a.y,Math.sqrt(b*b+c*c)},a}(),M=function(){function a(a,b){this.stage=a,this.isUp=ib(this.isUp,this),this.isDown=ib(this.isDown,this),this.keyUpListener=ib(this.keyUpListener,this),this.keyDownListener=ib(this.keyDownListener,this),this.states={},window.addEventListener("keydown",this.keyDownListener),window.addEventListener("keyup",this.keyUpListener),(jb.call(window,"ontouchstart")>=0||navigator.msMaxTouchPoints)&&this.gamePad(b)}return a.KEY_LEFT=37,a.KEY_UP=38,a.KEY_RIGHT=39,a.KEY_Z=90,a.prototype.states=null,a.prototype.stage=null,a.prototype.btn0=null,a.prototype.btn1=null,a.prototype.btn2=null,a.prototype.btn3=null,a.prototype.keys=[a.KEY_LEFT,a.KEY_RIGHT,a.KEY_Z,a.KEY_UP],a.prototype.keyDownListener=function(a){this.states[a.keyCode]=!0},a.prototype.keyUpListener=function(a){this.states[a.keyCode]&&(this.states[a.keyCode]=!1)},a.prototype.isDown=function(a){return this.states[a]},a.prototype.isUp=function(a){return!this.states[a]},a.prototype.gamePad=function(a){var b,c;return b=PIXI.Texture.fromImage("res/round.png"),c=PIXI.Texture.fromImage("res/square.png"),this.btn0=new PIXI.Sprite(b),this.btn0.interactive=!0,this.btn0.width*=1.4*window.devicePixelRatio,this.btn0.height*=1.4*window.devicePixelRatio,this.btn0.position.x=0,this.btn0.position.y=a.height-2*this.btn0.height+35,this.btn0.mousedown=this.btn0.touchstart=function(a){return function(){a.states[a.keys[0]]=!0}}(this),this.btn0.mouseup=this.btn0.touchend=function(a){return function(){a.states[a.keys[0]]=!1}}(this),this.btn1=new PIXI.Sprite(b),this.btn1.interactive=!0,this.btn1.width*=1.4*window.devicePixelRatio,this.btn1.height*=1.4*window.devicePixelRatio,this.btn1.position.x=this.btn1.width-35,this.btn1.position.y=a.height-this.btn1.height,this.btn1.mousedown=this.btn1.touchstart=function(a){return function(){a.states[a.keys[1]]=!0}}(this),this.btn1.mouseup=this.btn1.touchend=function(a){return function(){a.states[a.keys[1]]=!1}}(this),this.btn2=new PIXI.Sprite(b),this.btn2.interactive=!0,this.btn2.width*=1.4*window.devicePixelRatio,this.btn2.height*=1.4*window.devicePixelRatio,this.btn2.position.x=a.width-2*this.btn2.width+35,this.btn2.position.y=a.height-this.btn2.height,this.btn2.mousedown=this.btn2.touchstart=function(a){return function(){a.states[a.keys[2]]=!0}}(this),this.btn2.mouseup=this.btn2.touchend=function(a){return function(){a.states[a.keys[2]]=!1}}(this),this.btn3=new PIXI.Sprite(c),this.btn3.interactive=!0,this.btn3.width*=1.4*window.devicePixelRatio,this.btn3.height*=1.4*window.devicePixelRatio,this.btn3.position.x=a.width-this.btn3.width,this.btn3.position.y=a.height-2*this.btn3.height+35,this.btn3.mousedown=this.btn3.touchstart=function(a){return function(){a.states[a.keys[3]]=!0}}(this),this.btn3.mouseup=this.btn3.touchend=function(a){return function(){a.states[a.keys[3]]=!1}}(this),this.stage.addChild(this.btn0),this.stage.addChild(this.btn1),this.stage.addChild(this.btn2),this.stage.addChild(this.btn3)},a}(),$=function(){function a(){this.audio=new window.Audio,this.audio.src=this.src,this.audio.load()}return a.volume=.5,a.enabled=!0,a.preload=function(a){var b;return b=new window.Audio,b.src=a,b.volume=0,b.play(),a},a.prototype.src="",a.prototype.audio=null,a.prototype.loop=function(){return this},a.prototype.play=function(){return a.enabled&&(this.audio.volume=a.volume,this.audio.play()),this},a.prototype.pause=function(){return this.audio.pause(),this},a}(),y=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return lb(b,a),b.prototype.src=$.preload("res/sounds/asteroid.wav"),b}($),z=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return lb(b,a),b.prototype.src=$.preload("res/sounds/ship.wav"),b}($),Z=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return lb(b,a),b.prototype.src=$.preload("res/sounds/shoot.wav"),b}($),g=function(){function a(a,b){var c,d,e,f;for(this.stage=a,this.graphics=new PIXI.Graphics,this.graphics.clear(),c=0,this.graphics.beginFill(16777215),this.graphics.moveTo(b,0);c<2*Math.PI;)d=(.75+.25*rnd.nextDouble())*b,e=Math.cos(c)*d,f=Math.sin(c)*d,this.graphics.lineTo(e,f),c+=.5*rnd.nextDouble();this.graphics.moveTo(b,0),this.graphics.endFill(),this.stage.addChild(this.graphics)}return a.prototype.graphics=null,Object.defineProperties(a.prototype,{x:{get:function(){return this.graphics.x},set:function(a){return this.graphics.x=a}},y:{get:function(){return this.graphics.x},set:function(a){return this.graphics.y=a}},rotation:{get:function(){return this.graphics.rotation},set:function(a){return this.graphics.rotation=a}}}),a.prototype.dispose=function(){return this.stage.removeChild(this.graphics)},a}(),f=function(){function a(a,b){var c,d,e;for(this.stage=a,this.animate=ib(this.animate,this),this.dots=[],d=e=0;8>e;d=++e)c=new w(this.stage,b),this.dots.push(c)}return a.prototype.dots=null,a.prototype.x=0,a.prototype.y=0,a.prototype.rotation=0,a.prototype.stage=null,a.prototype.first=!0,a.prototype.animate=function(a){var b,c,d,e,f,g,h,i;if(this.first)for(this.first=!1,g=this.dots,c=0,e=g.length;e>c;c++)b=g[c],this.stage.addChild(b.graphics),b.graphics.x=this.x,b.graphics.y=this.y;for(h=this.dots,i=[],d=0,f=h.length;f>d;d++)b=h[d],b.graphics.x+=b.velocity.x*a,i.push(b.graphics.y+=b.velocity.y*a);return i},a.prototype.dispose=function(){var a,b,c,d,e;for(d=this.dots,e=[],b=0,c=d.length;c>b;b++)a=d[b],e.push(this.stage.removeChild(a.graphics));return e},a}(),w=function(){function a(a,b){var c,d,e;this.stage=a,this.graphics=new PIXI.Graphics,this.graphics.beginFill(16777215),this.graphics.drawCircle(0,0,1),this.graphics.endFill(),c=2*rnd.nextDouble()*Math.PI,d=rnd.nextDouble()*b,this.graphics.x=Math.cos(c)*d,this.graphics.y=Math.sin(c)*d,e=10*rnd.nextDouble()+10,this.velocity=new V(Math.cos(c)*e,Math.sin(c)*e)}return a.prototype.velocity=null,a.prototype.graphics=null,a.prototype.x=0,a.prototype.y=0,a}(),p=function(){function a(a){this.stage=a,this.graphics=new PIXI.Graphics,this.graphics.beginFill(16777215),this.graphics.drawCircle(0,0,2*window.devicePixelRatio),this.graphics.endFill(),this.stage.addChild(this.graphics)}return a.prototype.graphics=null,Object.defineProperties(a.prototype,{x:{get:function(){return this.graphics.x},set:function(a){return this.graphics.x=a}},y:{get:function(){return this.graphics.x},set:function(a){return this.graphics.y=a}},rotation:{get:function(){return this.graphics.rotation},set:function(a){return this.graphics.rotation=a}}}),a.prototype.dispose=function(){return this.stage.removeChild(this.graphics)},a}(),L=function(){function a(a){this.setScore=ib(this.setScore,this),this.setLives=ib(this.setLives,this),this.graphics=new PIXI.Graphics,this.graphics.x=0,this.graphics.y=200,this.graphics.beginFill(12632256),this.graphics.drawRect(0,0,60,80),this.graphics.endFill(),this.graphics.alpha=.5,a.addChild(this.graphics),this.score=this.createTextField(),this.score.x=window.innerWidth*window.devicePixelRatio-130,this.score.y=20,a.addChild(this.score),this.setScore(0),this.setLives(3)}return a.prototype.graphics=null,a.prototype.score=null,a.prototype.lives=null,a.prototype.x=0,a.prototype.y=0,a.prototype.rotation=0,a.prototype.dispose=function(){return this.stage.removeChild(this.graphics),this.stage.removeChild(this.score)},a.prototype.setLives=function(a){var b,c,d;for(this.graphics.clear(),this.graphics.beginFill(12632256),this.graphics.drawRect(0,0,60,80),this.graphics.endFill(),this.graphics.beginFill(0),c=d=0;a>=0?a>d:d>a;c=a>=0?++d:--d)b=20*c+20,this.graphics.moveTo(10*window.devicePixelRatio+20,0+b),this.graphics.lineTo(-7*window.devicePixelRatio+20,7*window.devicePixelRatio+b),this.graphics.lineTo(-4*window.devicePixelRatio+20,0+b),this.graphics.lineTo(-7*window.devicePixelRatio+20,-7*window.devicePixelRatio+b),this.graphics.lineTo(10*window.devicePixelRatio+20,0+b);this.graphics.endFill(),this.graphics.alpha=.5},a.prototype.setScore=function(a){this.score.setText("SCORE: "+a)},a.prototype.createTextField=function(){return new PIXI.Text("",{font:"bold 22px opendyslexic",fill:"#00ffff"})},a}(),ab=function(){function a(a){this.stage=a,this.animate=ib(this.animate,this),this.shape1=new PIXI.Graphics,this.shape1.clear(),this.shape1.beginFill(16777215),this.shape1.moveTo(10*window.devicePixelRatio,0),this.shape1.lineTo(-7*window.devicePixelRatio,7*window.devicePixelRatio),this.shape1.lineTo(-4*window.devicePixelRatio,0),this.shape1.lineTo(10*window.devicePixelRatio,0),this.shape1.endFill(),this.shape2=new PIXI.Graphics,this.shape2.clear(),this.shape2.beginFill(16777215),this.shape2.moveTo(10*window.devicePixelRatio,0),this.shape2.lineTo(-7*window.devicePixelRatio,-7*window.devicePixelRatio),this.shape2.lineTo(-4*window.devicePixelRatio,0),this.shape2.lineTo(10*window.devicePixelRatio,0),this.shape2.endFill(),this.vel1=new V(10*rnd.nextDouble()-5,10*rnd.nextDouble()+10),this.vel2=new V(10*rnd.nextDouble()-5,-(10*rnd.nextDouble()+10)),this.rot1=300*rnd.nextDouble()-150,this.rot2=300*rnd.nextDouble()-150}return a.prototype.stage=null,a.prototype.shape1=null,a.prototype.shape2=null,a.prototype.vel1=null,a.prototype.vel2=null,a.prototype.rot1=null,a.prototype.rot2=null,a.prototype.first=!0,a.prototype.x=0,a.prototype.y=0,a.prototype.rotation=0,a.prototype.check=!0,a.prototype.dispose=function(){return this.stage.removeChild(this.shape1),this.stage.removeChild(this.shape2)},a.prototype.animate=function(a){this.first&&(this.first=!1,this.stage.addChild(this.shape1),this.stage.addChild(this.shape2),this.shape1.x=this.shape2.x=this.x,this.shape1.y=this.shape2.y=this.y,this.shape1.rotation=this.shape2.rotation=this.rotation),this.shape1.x+=this.vel1.x*a,this.shape1.y+=this.vel1.y*a,this.shape1.rotation+=this.rot1*a,this.shape2.x+=this.vel2.x*a,this.shape2.y+=this.vel2.y*a,this.shape2.rotation+=this.rot2*a},a}(),cb=function(){function a(a){this.stage=a,this.graphics=new PIXI.Graphics,this.graphics.clear(),this.graphics.beginFill(16777215),this.graphics.moveTo(10*window.devicePixelRatio,0),this.graphics.lineTo(-7*window.devicePixelRatio,7*window.devicePixelRatio),this.graphics.lineTo(-4*window.devicePixelRatio,0),this.graphics.lineTo(-7*window.devicePixelRatio,-7*window.devicePixelRatio),this.graphics.lineTo(10*window.devicePixelRatio,0),this.graphics.endFill(),this.stage.addChild(this.graphics)}return a.prototype.stage=null,a.prototype.graphics=null,Object.defineProperties(a.prototype,{x:{get:function(){return this.graphics.x},set:function(a){return this.graphics.x=a}},y:{get:function(){return this.graphics.x},set:function(a){return this.graphics.y=a}},rotation:{get:function(){return this.graphics.rotation},set:function(a){return this.graphics.rotation=a}}}),a.prototype.dispose=function(){return this.stage.removeChild(this.graphics)},a}(),hb=function(){function a(c){this.stage=c,this.start=ib(this.start,this),this.click=new b,this.createText(a.count++)}var b;return a.count=0,b=ash.signals.Signal0,a.prototype.x=0,a.prototype.y=0,a.prototype.rotation=0,a.prototype.text1=null,a.prototype.text2=null,a.prototype.text3=null,a.prototype.click=null,a.prototype.createText=function(a){return this.text1=1===a?new PIXI.Text("GAME OVER",{font:"bold 120px opendyslexic",fill:"white",stroke:"black",strokeThickness:60}):new PIXI.Text("ASTEROIDS",{font:"bold 120px opendyslexic",fill:"white",stroke:"black",strokeThickness:60}),this.text2=new PIXI.Text("CLICK TO START",{font:"bold 24px opendyslexic",fill:"white"}),this.text3=new PIXI.Text("Z to Fire  ~  Arrow Keys to Move",{font:"bold 18px opendyslexic",fill:"white"}),this.text1.anchor.x=.5,this.text1.position.x=Math.floor(window.innerWidth*window.devicePixelRatio/2),this.text1.position.y=175,this.text2.anchor.x=.5,this.text2.position.x=Math.floor(window.innerWidth*window.devicePixelRatio/2),this.text2.position.y=335,this.text3.anchor.x=.5,this.text3.position.x=Math.floor(window.innerWidth*window.devicePixelRatio/2),this.text3.position.y=window.innerHeight*window.devicePixelRatio-40,this.text1.interactive=!0,this.text2.interactive=!0,this.text1.mousedown=this.text1.touchstart=this.text2.mousedown=this.text2.touchstart=this.start,this.stage.addChild(this.text1),this.stage.addChild(this.text2),this.stage.addChild(this.text3)},a.prototype.start=function(){return this.stage.removeChild(this.text1),this.stage.removeChild(this.text2),this.stage.removeChild(this.text3),this.click.dispatch()},a}(),a=function(){function a(a){this.animation=a}return a.prototype.animation=null,a}(),d=function(){function a(a){this.fsm=a}return a.prototype.fsm=null,a}(),i=function(){function a(){this.toPlay=[]}return a.prototype.toPlay=null,a.prototype.play=function(a){return this.toPlay.push(a)},a}(),l=function(){function a(a){this.lifeRemaining=a}return a.prototype.lifeRemaining=0,a}(),q=function(){function a(a){this.radius=a}return a.prototype.radius=0,a}(),s=function(){function a(a){this.countdown=a}return a.prototype.countdown=0,a.prototype.body=null,a}(),v=function(){function a(a){this.graphic=a}return a.prototype.graphic=0,a}(),D=function(){function a(){}return a.prototype.lives=3,a.prototype.level=0,a.prototype.hits=0,a.prototype.playing=!1,a.prototype.setForStart=function(){this.lives=3,this.level=0,this.hits=0,this.playing=!0},a}(),E=function(){function a(a,b,c,d){this.minimumShotInterval=c,this.bulletLifetime=d,this.shooting=!1,this.offsetFromParent=null,this.timeSinceLastShot=0,this.offsetFromParent=new V(a,b)}return a.prototype.shooting=!1,a.prototype.offsetFromParent=null,a.prototype.timeSinceLastShot=0,a.prototype.offsetFromParent=null,a}(),H=function(){function a(a){this.trigger=a}return a.prototype.trigger=0,a}(),I=function(){function a(a){this.view=a}return a.prototype.view=null,a}(),O=function(){function a(a,b,c,d,e){this.left=a,this.right=b,this.accelerate=c,this.accelerationRate=d,this.rotationRate=e}return a.prototype.left=0,a.prototype.right=0,a.prototype.accelerate=0,a.prototype.accelerationRate=0,a.prototype.rotationRate=0,a}(),Q=function(){function a(a){this.body=a}return a.prototype.body=null,a}(),W=function(){function a(a,b,c){this.rotation=c,this.position=new V(a,b)}return a.prototype.position=null,a.prototype.rotation=0,a}(),_=function(){function a(a){this.fsm=a}return a.prototype.fsm=null,a}(),eb=function(){function a(a){this.waitForStart=a,this.setStartGame=ib(this.setStartGame,this),this.waitForStart.click.add(this.setStartGame)}return a.prototype.waitForStart=null,a.prototype.startGame=!1,a.prototype.setStartGame=function(){this.startGame=!0},a}(),b=function(b){function c(){return c.__super__.constructor.apply(this,arguments)}return lb(c,b),c.components={animation:a},c.prototype.animation=null,c}(ash.core.Node),e=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return lb(b,a),b.components={asteroid:d,position:W,collision:q,audio:i,physics:Q},b.prototype.asteroid=null,b.prototype.position=null,b.prototype.collision=null,b.prototype.audio=null,b.prototype.physics=null,b}(ash.core.Node),j=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return lb(b,a),b.components={audio:i},b.prototype.audio=null,b}(ash.core.Node),m=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return lb(b,a),b.components={bullet:l,physics:Q,display:v},b.prototype.bullet=null,b.prototype.physics=null,b.prototype.display=null,b}(ash.core.Node),o=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return lb(b,a),b.components={bullet:l,position:W,physics:Q},b.prototype.bullet=null,b.prototype.physics=null,b}(ash.core.Node),t=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return lb(b,a),b.components={dead:s,display:v},b.prototype.dead=null,b.prototype.display=null,b}(ash.core.Node),C=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return lb(b,a),b.components={state:D},b.prototype.state=null,b}(ash.core.Node),F=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return lb(b,a),b.components={audio:i,control:H,gun:E,position:W},b.prototype.control=null,b.prototype.gun=null,b.prototype.position=null,b.prototype.audio=null,b}(ash.core.Node),J=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return lb(b,a),b.components={state:D,hud:I},b.prototype.state=null,b.prototype.hud=null,b}(ash.core.Node),P=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return lb(b,a),b.components={position:W},b.prototype.position=null,b}(ash.core.Node),R=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return lb(b,a),b.components={control:O,physics:Q},b.prototype.control=null,b.prototype.physics=null,b}(ash.core.Node),T=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return lb(b,a),b.components={position:W,physics:Q},b.prototype.position=null,b.prototype.physics=null,b}(ash.core.Node),X=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return lb(b,a),b.components={position:W,display:v},b.prototype.position=null,b.prototype.display=null,b}(ash.core.Node),bb=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return lb(b,a),b.components={spaceship:_,position:W},b.prototype.spaceship=0,b.prototype.position=0,b}(ash.core.Node),fb=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return lb(b,a),b.components={wait:eb},b.prototype.wait=null,b}(ash.core.Node),U=function(a){function b(a,b,c){this.config=a,this.world=b,this.stage=c,this.updateNode=ib(this.updateNode,this),this.update=ib(this.update,this)}var c,d;return lb(b,a),c=Box2D.Dynamics.b2Body,d=Box2D.Common.Math.b2Vec2,b.prototype.config=null,b.prototype.world=null,b.prototype.stage=null,b.prototype.creator=null,b.prototype.nodes=null,b.prototype.enabled=!0,b.deadPool=[],b.prototype.addToEngine=function(a){this.nodes=a.getNodeList(T)},b.prototype.removeFromEngine=function(){this.nodes=null},b.prototype.update=function(a){var c,d,e;if(this.enabled){for(this.world.Step(a,10,10),this.world.ClearForces(),d=this.nodes.head;d;)this.updateNode(d,a),d=d.next;for(;c=b.deadPool.pop();)e=c.GetUserData(),null!=e.entity&&delete e.entity,c.SetUserData(e),this.world.DestroyBody(c)}},b.prototype.updateNode=function(a){var b,c,e,f,g,h,i,j;e=a.position,c=a.physics,b=c.body,j=b.GetPosition(),f=j.x,h=j.y,g=f>this.config.width?0:0>f?this.config.width:f,i=h>this.config.height?0:0>h?this.config.height:h,(g!==f||i!==h)&&b.SetPosition(new d(g,i)),e.position.x=g,e.position.y=i,e.rotation=b.GetAngularVelocity()},b}(ash.core.System),c=function(a){function c(){this.updateNode=ib(this.updateNode,this),c.__super__.constructor.call(this,b,this.updateNode)}return lb(c,a),c.prototype.updateNode=function(a,b){a.animation.animation.animate(b)},c}(ash.tools.ListIteratingSystem),k=function(a){function b(){this.updateNode=ib(this.updateNode,this),b.__super__.constructor.call(this,j,this.updateNode)}return lb(b,a),b.prototype.updateNode=function(a){var b,c,d,e;e=a.audio.toPlay;for(b in e)d=e[b],c=new d,c.play(0,1);a.audio.toPlay=[]},b}(ash.tools.ListIteratingSystem),n=function(a){function b(a){this.creator=a,this.updateNode=ib(this.updateNode,this),b.__super__.constructor.call(this,m,this.updateNode)}return lb(b,a),b.prototype.creator=null,b.prototype.updateNode=function(a,b){var c;c=a.bullet,c.lifeRemaining-=b,c.lifeRemaining<=0&&(a.display.graphic.dispose(),U.deadPool.push(a.physics.body),this.creator.destroyEntity(a.entity))},b}(ash.tools.ListIteratingSystem),r=function(a){function b(a,b){this.world=a,this.creator=b,this.PostSolve=ib(this.PostSolve,this),this.PreSolve=ib(this.PreSolve,this),this.EndContact=ib(this.EndContact,this),this.BeginContact=ib(this.BeginContact,this),this.update=ib(this.update,this),this.collisions=[],this.world.SetContactListener(this)}var c,e,f;return lb(b,a),f=Box2D.Dynamics.b2ContactListener,e=1,c=2,b.prototype.world=null,b.prototype.creator=null,b.prototype.games=null,b.prototype.collisions=null,b.prototype.update=function(){for(var a,b,f,g,h,j,k;this.collisions.length;)k=this.collisions.pop(),j=k.type,a=k.a,b=k.b,j===e?(null!=a.get(Q)&&(this.creator.destroyEntity(a),a.get(v).graphic.dispose(),U.deadPool.push(a.get(Q).body)),null!=b.get(Q)&&(h=b.get(q).radius,g=b.get(W).position,h>10&&(this.creator.createAsteroid(h-10,g.x+10*rnd.nextDouble()-5,g.y+10*rnd.nextDouble()-5),this.creator.createAsteroid(h-10,g.x+10*rnd.nextDouble()-5,g.y+10*rnd.nextDouble()-5)),f=b.get(Q).body,b.get(v).graphic.dispose(),b.get(d).fsm.changeState("destroyed"),b.get(s).body=f,b.get(i).play(y),this.games.head&&this.games.head.state.hits++)):j===c&&null!=b.get(Q)&&(f=b.get(Q).body,b.get(v).graphic.dispose(),b.get(_).fsm.changeState("destroyed"),b.get(s).body=f,b.get(i).play(z),this.games.head&&this.games.head.state.lives--)},b.prototype.addToEngine=function(a){this.games=a.getNodeList(C)},b.prototype.removeFromEngine=function(){this.games=null},b.prototype.BeginContact=function(a){var b,d;switch(b=a.GetFixtureA().GetBody().GetUserData(),d=a.GetFixtureB().GetBody().GetUserData(),b.type){case"asteroid":switch(d.type){case"bullet":this.collisions.push({type:e,a:d.entity,b:b.entity});break;case"spaceship":this.collisions.push({type:c,a:b.entity,b:d.entity})}break;case"bullet":"asteroid"===d.type&&this.collisions.push({type:e,a:b.entity,b:d.entity});break;case"spaceship":"asteroid"===d.type&&this.collisions.push({type:c,a:d.entity,b:b.entity})}},b.prototype.EndContact=function(){},b.prototype.PreSolve=function(){},b.prototype.PostSolve=function(){},b}(ash.core.System),u=function(a){function b(a){this.creator=a,this.updateNode=ib(this.updateNode,this),b.__super__.constructor.call(this,t,this.updateNode)}return lb(b,a),b.prototype.creator=null,b.prototype.updateNode=function(a,b){var c;c=a.dead,c.countdown-=b,c.countdown<=0&&(this.creator.destroyEntity(a.entity),a.display.graphic.dispose(),U.deadPool.push(c.body))},b}(ash.tools.ListIteratingSystem),B=function(a){function b(a,b){this.creator=a,this.config=b,this.update=ib(this.update,this)}return lb(b,a),b.prototype.config=null,b.prototype.creator=null,b.prototype.gameNodes=null,b.prototype.spaceships=null,b.prototype.asteroids=null,b.prototype.bullets=null,b.prototype.addToEngine=function(a){this.gameNodes=a.getNodeList(C),this.spaceships=a.getNodeList(bb),this.asteroids=a.getNodeList(e),this.bullets=a.getNodeList(o)},b.prototype.update=function(){var a,b,c,d,e,f,g,h;if(f=this.gameNodes.head,f&&f.state.playing){if(this.spaceships.empty)if(f.state.lives>0){for(e=new V(.5*this.config.width,.5*this.config.height),c=!0,a=this.asteroids.head;a;){if(V.distance(a.position.position,e)<=a.collision.radius+50){c=!1;break}a=a.next}c&&this.creator.createSpaceship()}else f.state.playing=!1,this.creator.createWaitForClick(),this.updateScore();if(this.asteroids.empty&&this.bullets.empty&&!this.spaceships.empty)for(h=this.spaceships.head,f.state.level++,b=2+f.state.level,d=0;b>d;){for(;;)if(g=new V(rnd.nextDouble()*this.config.width,rnd.nextDouble()*this.config.height),!(V.distance(g,h.position.position)<=80))break;this.creator.createAsteroid(30,g.x,g.y),++d}}},b.prototype.removeFromEngine=function(){this.gameNodes=null,this.spaceships=null,this.asteroids=null,this.bullets=null},b.prototype.updateScore=function(){localStorage.score=Math.max(node.state.hits,parseInt(localStorage.score||"0",10)),Cocoon.App.loadInTheWebView("leaders.html"),Cocoon.App.WebView.on("load",{success:function(a){return function(){a.pause(!0),Cocoon.App.showTheWebView()}}(this),error:function(){return function(){console.log("Cannot show the Webview for some reason :/"),console.log(JSON.stringify(arguments))}}(this)})},b}(ash.core.System),G=function(a){function b(a,c){this.keyPoll=a,this.creator=c,this.updateNode=ib(this.updateNode,this),b.__super__.constructor.call(this,F,this.updateNode)}return lb(b,a),b.prototype.keyPoll=null,b.prototype.creator=null,b.prototype.updateNode=function(a,b){var c,d,e;c=a.control,e=a.position,d=a.gun,d.shooting=this.keyPoll.isDown(c.trigger),d.timeSinceLastShot+=b,d.shooting&&d.timeSinceLastShot>=d.minimumShotInterval&&(this.creator.createUserBullet(d,e),a.audio.play(Z),d.timeSinceLastShot=0)},b}(ash.tools.ListIteratingSystem),K=function(a){function b(){this.updateNode=ib(this.updateNode,this),b.__super__.constructor.call(this,J,this.updateNode)}return lb(b,a),b.prototype.updateNode=function(a){a.hud.view.setLives(a.state.lives),a.hud.view.setScore(a.state.hits)},b}(ash.tools.ListIteratingSystem),S=function(a){function b(a){this.keyPoll=a,this.updateNode=ib(this.updateNode,this),b.__super__.constructor.call(this,R,this.updateNode)}var c,d,e,f;return lb(b,a),d=window.devicePixelRatio,c=null!=(null!=(f=window.ext)?f.IDTK_SRV_BOX2D:void 0),e=Box2D.Common.Math.b2Vec2,b.prototype.keyPoll=null,b.prototype.updateNode=function(a,b){var e,f,g,h;f=a.control,e=a.physics.body,this.keyPoll.isDown(f.left)&&(g=e.GetAngularVelocity(),e.SetAngularVelocity(g-f.rotationRate*b)),this.keyPoll.isDown(f.right)&&(g=g||e.GetAngularVelocity(),e.SetAngularVelocity(g+f.rotationRate*b)),this.keyPoll.isDown(f.accelerate)&&(g=g||e.GetAngularVelocity(),h=e.GetLinearVelocity(),h.x+=Math.cos(g)*f.accelerationRate*b*d,h.y+=Math.sin(g)*f.accelerationRate*b*d,c||e.SetAwake(!0),e.SetLinearVelocity(h))},b}(ash.tools.ListIteratingSystem),Y=function(a){function b(a,b){this.stage=a,this.renderer=b,this.update=ib(this.update,this)}return lb(b,a),b.prototype.stage=null,b.prototype.renderer=null,b.prototype.nodes=null,b.prototype.addToEngine=function(a){var b;for(this.nodes=a.getNodeList(X),b=this.nodes.head;b;)this.addToDisplay(b),b=b.next},b.prototype.addToDisplay=function(){},b.prototype.removeFromDisplay=function(){},b.prototype.removeFromEngine=function(){this.nodes=null},b.prototype.update=function(){var a,b,c,d;for(c=this.nodes.head;c;)a=c.display,b=a.graphic,d=c.position,b.x=d.position.x,b.y=d.position.y,b.rotation=d.rotation,c=c.next;this.renderer.render(this.stage)},b}(ash.core.System),db=function(){function a(){}return a.preUpdate=1,a.update=2,a.move=3,a.resolveCollisions=4,a.stateMachines=5,a.render=6,a.animate=7,a}(),gb=function(a){function b(a){this.creator=a,this.update=ib(this.update,this)}return lb(b,a),b.prototype.engine=null,b.prototype.creator=null,b.prototype.gameNodes=null,b.prototype.waitNodes=null,b.prototype.asteroids=null,b.prototype.addToEngine=function(a){this.engine=a,this.waitNodes=a.getNodeList(fb),this.gameNodes=a.getNodeList(C),this.asteroids=a.getNodeList(e)},b.prototype.removeFromEngine=function(){this.waitNodes=null,this.gameNodes=null,this.asteroids=null},b.prototype.update=function(){var a,b,c,d;if(d=this.waitNodes.head,b=this.gameNodes.head,d&&d.wait.startGame&&b){for(a=this.asteroids.head;a;)c=a.entity.get(v).graphic,this.creator.destroyEntity(a.entity),c.dispose(),a=a.next;b.state.setForStart(),d.wait.startGame=!1,this.engine.removeEntity(d.entity)}},b}(ash.core.System),x=function(){function b(a,b,c,d){this.engine=a,this.world=b,this.config=c,this.stage=d}var c,e,h,j,k,m,n,o;return c=ash.core.Entity,e=ash.fsm.EntityStateMachine,h=Box2D.Dynamics.b2Body,j=Box2D.Dynamics.b2BodyDef,k=Box2D.Collision.Shapes.b2CircleShape,m=Box2D.Dynamics.b2FixtureDef,n=Box2D.Collision.Shapes.b2PolygonShape,o=Box2D.Common.Math.b2Vec2,b.prototype.engine=null,b.prototype.world=null,b.prototype.waitEntity=null,b.prototype.bulletId=0,b.prototype.asteroidId=0,b.prototype.spaceshipId=0,b.prototype.destroyEntity=function(a){this.engine.removeEntity(a)},b.prototype.createGame=function(){var a,b;return b=new L(this.stage),a=new c("game").add(new D).add(new I(b)).add(new v(b)).add(new W(0,0,0,0)),this.engine.addEntity(a),a},b.prototype.createWaitForClick=function(){var a;return a=new hb(this.stage),this.waitEntity=new c("wait").add(new eb(a)).add(new v(a)).add(new W(0,0,0,0)),this.waitEntity.get(eb).startGame=!1,this.engine.addEntity(this.waitEntity),this.waitEntity},b.prototype.createAsteroid=function(b,l,n){var o,p,r,t,u,w,x,y,z;return r=new j,r.type=h.b2_dynamicBody,r.fixedRotation=!0,r.position.x=l,r.position.y=n,y=4*(rnd.nextDouble()-.5)*(50-b)*2*window.devicePixelRatio,z=4*(rnd.nextDouble()-.5)*(50-b)*2*window.devicePixelRatio,r.linearVelocity.Set(y,z),r.angularVelocity=2*rnd.nextDouble()-1,u=new m,u.density=1,u.friction=1,u.restitution=.2,u.shape=new k(b),p=this.world.CreateBody(r),p.CreateFixture(u),o=new c,w=new e(o),x=new g(this.stage,b),w.createState("alive").add(Q).withInstance(new Q(p)).add(q).withInstance(new q(b)).add(v).withInstance(new v(x)),t=new f(this.stage,b),w.createState("destroyed").add(s).withInstance(new s(3)).add(v).withInstance(new v(t)).add(a).withInstance(new a(t)),o.add(new d(w)).add(new W(l,n,0)).add(new i),p.SetUserData({type:"asteroid",entity:o}),w.changeState("alive"),this.engine.addEntity(o),o},b.prototype.createSpaceship=function(){var b,d,f,g,k,l,p,r,t;return r=rnd.nextInt(this.config.width),t=rnd.nextInt(this.config.height),d=new j,d.type=h.b2_dynamicBody,d.fixedRotation=!1,d.position.x=r,d.position.y=t,d.linearVelocity.Set(0,0),d.angularVelocity=0,d.linearDamping=.75,g=new m,g.density=1,g.friction=1,g.restitution=.2,g.shape=new n,g.shape.SetAsArray([new o(.45*window.devicePixelRatio,0),new o(-.25*window.devicePixelRatio,.25*window.devicePixelRatio),new o(-.25*window.devicePixelRatio,-.25*window.devicePixelRatio)],3),b=this.world.CreateBody(d),b.CreateFixture(g),p=new c,k=new e(p),l=new cb(this.stage),k.createState("playing").add(Q).withInstance(new Q(b)).add(O).withInstance(new O(M.KEY_LEFT,M.KEY_RIGHT,M.KEY_UP,100,3)).add(E).withInstance(new E(8,0,.3,2)).add(H).withInstance(new H(M.KEY_Z)).add(q).withInstance(new q(9*window.devicePixelRatio)).add(v).withInstance(new v(l)),f=new ab(this.stage),k.createState("destroyed").add(s).withInstance(new s(5)).add(v).withInstance(new v(f)).add(a).withInstance(new a(f)),p.add(new _(k)).add(new W(r,t,0)).add(new i),b.SetUserData({type:"spaceship",entity:p}),k.changeState("playing"),this.engine.addEntity(p),p
},b.prototype.createUserBullet=function(a,b){var d,e,f,g,i,n,o,r,s;return i=Math.cos(b.rotation),o=Math.sin(b.rotation),r=i*a.offsetFromParent.x-o*a.offsetFromParent.y+b.position.x,s=o*a.offsetFromParent.x+i*a.offsetFromParent.y+b.position.y,e=new j,e.type=h.b2_dynamicBody,e.fixedRotation=!0,e.position.x=r,e.position.y=s,e.linearVelocity.Set(150*i*window.devicePixelRatio,150*o*window.devicePixelRatio),e.angularVelocity=0,n=new m,n.density=1,n.friction=0,n.restitution=.2,n.shape=new k(0),d=this.world.CreateBody(e),d.CreateFixture(n),g=new p(this.stage),f=(new c).add(new l(a.bulletLifetime*window.devicePixelRatio)).add(new W(r,s,0)).add(new q(0)).add(new Q(d)).add(new v(g)),d.SetUserData({type:"bullet",entity:f}),this.engine.addEntity(f),f},b}(),A=function(){function a(){}return a.prototype.width=0,a.prototype.height=0,a}(),h=function(){function a(){this.setPlaySfx=ib(this.setPlaySfx,this),this.setPlayMusic=ib(this.setPlayMusic,this),this.setBackground=ib(this.setBackground,this),this.pause=ib(this.pause,this)}var b,d,e,f,g;return f=Box2D.Common.Math.b2Vec2,g=Box2D.Dynamics.b2World,e=Box2D.Dynamics.b2DebugDraw,b=ash.core.Engine,d=ash.tick.FrameTickProvider,a.prototype.engine=null,a.prototype.tickProvider=null,a.prototype.creator=null,a.prototype.keyPoll=null,a.prototype.config=null,a.prototype.world=null,a.prototype.stage=null,a.prototype.renderer=null,a.prototype.background=null,a.prototype.physics=null,a.prototype.playMusic=localStorage.playMusic,a.prototype.playSfx=localStorage.playSfx,a.prototype.optBgd=localStorage.background||"blue",a.prototype.bgdColor=6970061,a.prototype.assets=["res/starfield.png","res/b_Leaderboard.png","res/b_More1.png","res/b_Parameters.png","res/round.png","res/square.png"],a.prototype.start=function(a,e){var h,i;i=a.width,h=a.height,"blue"!==this.optBgd&&(this.bgdColor=6970061),this.stage=new PIXI.Stage(this.bgdColor),this.renderer=new PIXI.CanvasRenderer(i,h,{view:a}),this.background=PIXI.Sprite.fromImage("res/starfield.png"),this.background.width=window.innerWidth*window.devicePixelRatio,this.background.height=window.innerHeight*window.devicePixelRatio,this.background.x=0,this.background.y=0,"blue"===this.optBgd&&(this.background.alpha=0),this.stage.addChild(this.background),this.config=new A,this.config.height=h,this.config.width=i,this.options(),this.world=new g(new f(0,0),!0),this.engine=new b,this.creator=new x(this.engine,this.world,this.config,this.stage),this.keyPoll=new M(this.stage,this.config),this.engine.addSystem(new gb(this.creator),db.preUpdate),this.engine.addSystem(new B(this.creator,this.config),db.preUpdate),this.engine.addSystem(new S(this.keyPoll),db.update),this.engine.addSystem(new G(this.keyPoll,this.creator),db.update),this.engine.addSystem(new n(this.creator),db.update),this.engine.addSystem(new u(this.creator),db.update),this.engine.addSystem(this.physics=new U(this.config,this.world,this.stage),db.move),this.engine.addSystem(new r(this.world,this.creator),db.resolveCollisions),this.engine.addSystem(new c,db.animate),this.engine.addSystem(new K,db.animate),this.engine.addSystem(new Y(this.stage,this.renderer),db.render),this.engine.addSystem(new k,db.render),this.creator.createWaitForClick(),this.creator.createGame(),this.tickProvider=new d(e),this.tickProvider.add(this.engine.update),this.tickProvider.start()},a.prototype.options=function(){var a,b,c;c=PIXI.Sprite.fromImage("res/b_Parameters.png"),c.interactive=!0,c.mousedown=c.touchstart=function(){return Cocoon.App.loadInTheWebView("options.html")},c.anchor.x=.5,c.anchor.y=.5,c.position.x=this.config.width-c.width,c.position.y=2*c.height,this.stage.addChild(c),a=PIXI.Sprite.fromImage("res/b_Leaderboard.png"),a.interactive=!0,a.mousedown=a.touchstart=function(){return Cocoon.App.loadInTheWebView("leaders.html")},a.anchor.x=.5,a.anchor.y=.5,a.position.x=this.config.width-c.width,a.position.y=3*a.height+40,this.stage.addChild(a),b=PIXI.Sprite.fromImage("res/b_More1.png"),b.interactive=!0,b.mousedown=b.touchstart=function(){return Cocoon.App.loadInTheWebView("more.html")},b.anchor.x=.5,b.anchor.y=.5,b.position.x=this.config.width-c.width,b.position.y=4*a.height+80,this.stage.addChild(b),Cocoon.App.WebView.on("load",{success:function(a){return function(){return a.pause(!0),Cocoon.App.showTheWebView()}}(this),error:function(){return function(){return console.log("Cannot show the Webview for some reason :/"),console.log(JSON.stringify(arguments))}}(this)})},a.prototype.pause=function(a){this.physics.enabled=!a},a.prototype.setBackground=function(a){1===a?(this.background.alpha=1,this.optBgd="star",localStorage.background="star"):(this.background.alpha=0,this.optBgd="blue",localStorage.background="blue")},a.prototype.setPlayMusic=function(a){this.playMusic=a,localStorage.playMusic=a},a.prototype.setPlaySfx=function(a){this.playSfx=a,$.volume=a/100,localStorage.playSfx=a},a}(),function(){return window.rnd=new N,window.requestAnimationFrame||(window.requestAnimationFrame=function(){return window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a){window.setTimeout(a,1e3/60)}}()),window.addEventListener("load",function(){var a,b,c,d,e,f;navigator.isCocoonJS?d=null:(d=new Stats,b=document.createElement("div"),document.body.appendChild(b),b.appendChild(d.domElement),d.domElement.style.position="absolute",e=0,f=0,d.setMode(0),d.domElement.style.position="absolute",d.domElement.style.left=""+e+"px",d.domElement.style.top=""+f+"px",document.body.appendChild(d.domElement)),a=document.createElement(navigator.isCocoonJS?"screencanvas":"canvas"),a.width=window.innerWidth*window.devicePixelRatio,a.height=window.innerHeight*window.devicePixelRatio,a.style.width="100%",a.style.height="100%",document.body.appendChild(a),window.game=new h,c=new PIXI.AssetLoader(game.assets),c.onComplete=function(){return game.start(a,d)},c.load()})}()}).call(this);