var Box2D=function(){"use strict";var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z,$,_,ab,bb,cb,db,eb,fb,gb,hb,ib,jb,kb,lb,mb,nb,ob,pb,qb,rb,sb,tb,ub,vb,wb,xb,yb,zb,Ab,Bb,Cb,Db,Eb,Fb,Gb,Hb,Ib,Jb,Kb,Lb,Mb,Nb,Ob,Pb,Qb,Rb,Sb,Tb,Ub,Vb,Wb=function(a){if(!a)throw"Assertion Failed"},Xb={Common:{Math:{}},Collision:{Shapes:{}},Dynamics:{Contacts:{},Controllers:{},Joints:{}}};return l=Xb.Common.b2Color=function(a,b,c){this.Set(a,b,c)},l.constructor=l,l.prototype={_r:0,_g:0,_b:0,Set:function(a,b,c){this._r=Math.abs(255*lb.Clamp(a,0,1),10),this._g=Math.abs(255*lb.Clamp(b,0,1),10),this._b=Math.abs(255*lb.Clamp(c,0,1),10)}},Fb=Xb.Common.b2Settings=function(){},Fb.constructor=Fb,Fb.VERSION="2.1alpha",Fb.b2_maxFloat=Number.MAX_VALUE,Fb.b2_epsilon=Number.MIN_VALUE,Fb.b2_pi=Math.PI,Fb.b2_maxManifoldPoints=2,Fb.b2_aabbExtension=.1,Fb.b2_aabbMultiplier=2,Fb.b2_linearSlop=.005,Fb.b2_maxTOIContactsPerIsland=32,Fb.b2_maxTOIJointsPerIsland=32,Fb.b2_velocityThreshold=1,Fb.b2_maxLinearCorrection=.2,Fb.b2_maxTranslation=2,Fb.b2_contactBaumgarte=.2,Fb.b2_timeToSleep=.5,Fb.b2_linearSleepTolerance=.01,Fb.b2_angularSleepTolerance=2/180*Fb.b2_pi,Fb.b2_maxRotationSquared=Fb.b2_maxRotation*Fb.b2_maxRotation,Fb.b2_maxRotation=.5*Fb.b2_pi,Fb.b2_maxTranslationSquared=Fb.b2_maxTranslation*Fb.b2_maxTranslation,Fb.b2_maxAngularCorrection=8/180*Fb.b2_pi,Fb.b2_toiSlop=8*Fb.b2_linearSlop,Fb.b2_angularSlop=2/180*Fb.b2_pi,Fb.b2_polygonRadius=2*Fb.b2_linearSlop,Fb.b2MixFriction=function(a,b){return Math.sqrt(a*b)},Fb.b2MixRestitution=function(a,b){return a>b?a:b},Qb=Xb.Common.Math.b2Vec2=function(a,b){this.x=a,this.y=b},Qb.Make=function(a,b){return new Qb(a,b)},Qb.constructor=Qb,Qb.prototype={x:0,y:0,SetZero:function(){return this.x=0,this.y=0,this},Set:function(a,b){return this.x=a,this.y=b,this},SetV:function(a){return this.x=a.x,this.y=a.y,this},GetNegative:function(){return new Qb(-this.x,-this.y)},NegativeSelf:function(){return this.x=-this.x,this.y=-this.y,this},Copy:function(){return new Qb(this.x,this.y)},Add:function(a){return this.x+=a.x,this.y+=a.y,this},Subtract:function(a){return this.x-=a.x,this.y-=a.y,this},Multiply:function(a){return this.x*=a,this.y*=a,this},MulM:function(a){var b=this.x;return this.x=a.col1.x*b+a.col2.x*this.y,this.y=a.col1.y*b+a.col2.y*this.y,this},MulTM:function(a){var b=lb.Dot(this,a.col1);return this.y=lb.Dot(this,a.col2),this.x=b,this},CrossVF:function(a){var b=this.x;return this.x=a*this.y,this.y=-a*b,this},CrossFV:function(a){var b=this.x;return this.x=-a*this.y,this.y=a*b,this},MinV:function(a){return this.x=this.x<a.x?this.x:a.x,this.y=this.y<a.y?this.y:a.y,this},MaxV:function(a){return this.x=this.x>a.x?this.x:a.x,this.y=this.y>a.y?this.y:a.y,this},Abs:function(){return this.x<0&&(this.x=-this.x),this.y<0&&(this.y=-this.y),this},Length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},LengthSquared:function(){return this.x*this.x+this.y*this.y},Normalize:function(){var a=Math.sqrt(this.x*this.x+this.y*this.y);if(a<Fb.b2_epsilon)return 0;var b=1/a;return this.x*=b,this.y*=b,a},IsValid:function(){return lb.IsValid(this.x)&&lb.IsValid(this.y)}},Rb=Xb.Common.Math.b2Vec3=function(a,b,c){this.x=a,this.y=b,this.z=c},Rb.constructor=Rb,Rb.prototype={x:0,y:0,z:0,SetZero:function(){return this.x=this.y=this.z=0,this},Set:function(a,b,c){return this.x=a,this.y=b,this.z=c,this},SetV:function(a){return this.x=a.x,this.y=a.y,this.z=a.z,this},GetNegative:function(){return new Rb(-this.x,-this.y,-this.z)},NegativeSelf:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},Copy:function(){return new Rb(this.x,this.y,this.z)},Add:function(a){return this.x+=a.x,this.y+=a.y,this.z+=a.z,this},Subtract:function(a){return this.x-=a.x,this.y-=a.y,this.z-=a.z,this},Multiply:function(a){return this.x*=a,this.y*=a,this.z*=a,this}},jb=Xb.Common.Math.b2Mat22=function(){this.col1=new Qb(0,0),this.col2=new Qb(0,0),this.SetIdentity()},jb.FromAngle=function(a){var b=new jb;return b.Set(a),b},jb.FromVV=function(a,b){var c=new jb;return c.SetVV(a,b),c},jb.constructor=jb,jb.prototype={col1:null,col2:null,Set:function(a){var b=Math.cos(a),c=Math.sin(a);return this.col1.x=b,this.col2.x=-c,this.col1.y=c,this.col2.y=b,this},SetVV:function(a,b){return this.col1.SetV(a),this.col2.SetV(b),this},Copy:function(){var a=new jb;return a.SetM(this),a},SetM:function(a){return this.col1.SetV(a.col1),this.col2.SetV(a.col2),this},AddM:function(a){return this.col1.x+=a.col1.x,this.col1.y+=a.col1.y,this.col2.x+=a.col2.x,this.col2.y+=a.col2.y,this},SetIdentity:function(){return this.col1.x=1,this.col2.x=0,this.col1.y=0,this.col2.y=1,this},SetZero:function(){return this.col1.x=0,this.col2.x=0,this.col1.y=0,this.col2.y=0,this},GetAngle:function(){return Math.atan2(this.col1.y,this.col1.x)},GetInverse:function(a){var b=this.col1.x,c=this.col2.x,d=this.col1.y,e=this.col2.y,f=b*e-c*d;return 0!==f&&(f=1/f),a.col1.x=f*e,a.col2.x=-f*c,a.col1.y=-f*d,a.col2.y=f*b,a},Solve:function(a,b,c){var d=this.col1.x,e=this.col2.x,f=this.col1.y,g=this.col2.y,h=d*g-e*f;return 0!==h&&(h=1/h),a.x=h*(g*b-e*c),a.y=h*(d*c-f*b),a},Abs:function(){return this.col1.Abs(),this.col2.Abs(),this}},kb=Xb.Common.Math.b2Mat33=function(a,b,c){this.col1=new Rb(0,0,0),this.col2=new Rb(0,0,0),this.col3=new Rb(0,0,0),a||b||c?(this.col1.SetV(a),this.col2.SetV(b),this.col3.SetV(c)):(this.col1.SetZero(),this.col2.SetZero(),this.col3.SetZero())},kb.constructor=kb,kb.prototype={col1:null,col2:null,col3:null,SetVVV:function(a,b,c){return this.col1.SetV(a),this.col2.SetV(b),this.col3.SetV(c),this},Copy:function(){return new kb(this.col1,this.col2,this.col3)},SetM:function(a){return this.col1.SetV(a.col1),this.col2.SetV(a.col2),this.col3.SetV(a.col3),this},AddM:function(a){return this.col1.x+=a.col1.x,this.col1.y+=a.col1.y,this.col1.z+=a.col1.z,this.col2.x+=a.col2.x,this.col2.y+=a.col2.y,this.col2.z+=a.col2.z,this.col3.x+=a.col3.x,this.col3.y+=a.col3.y,this.col3.z+=a.col3.z,this},SetIdentity:function(){return this.col1.x=1,this.col2.x=0,this.col3.x=0,this.col1.y=0,this.col2.y=1,this.col3.y=0,this.col1.z=0,this.col2.z=0,this.col3.z=1,this},SetZero:function(){return this.col1.x=0,this.col2.x=0,this.col3.x=0,this.col1.y=0,this.col2.y=0,this.col3.y=0,this.col1.z=0,this.col2.z=0,this.col3.z=0,this},Solve22:function(a,b,c){var d=this.col1.x,e=this.col2.x,f=this.col1.y,g=this.col2.y,h=d*g-e*f;return 0!==h&&(h=1/h),a.x=h*(g*b-e*c),a.y=h*(d*c-f*b),a},Solve33:function(a,b,c,d){var e=this.col1.x,f=this.col1.y,g=this.col1.z,h=this.col2.x,i=this.col2.y,j=this.col2.z,k=this.col3.x,l=this.col3.y,m=this.col3.z,n=e*(i*m-j*l)+f*(j*k-h*m)+g*(h*l-i*k);return 0!==n&&(n=1/n),a.x=n*(b*(i*m-j*l)+c*(j*k-h*m)+d*(h*l-i*k)),a.y=n*(e*(c*m-d*l)+f*(d*k-b*m)+g*(b*l-c*k)),a.z=n*(e*(i*d-j*c)+f*(j*b-h*d)+g*(h*c-i*b)),a}},Kb=Xb.Common.Math.b2Sweep=function(){this.localCenter=new Qb(0,0),this.c0=new Qb(0,0),this.c=new Qb(0,0)},Kb.constructor=Kb,Kb.prototype={localCenter:null,c:null,c0:null,a:0,a0:0,t0:0,Set:function(a){return this.localCenter.SetV(a.localCenter),this.c0.SetV(a.c0),this.c.SetV(a.c),this.a0=a.a0,this.a=a.a,this.t0=a.t0,this},Copy:function(){var a=new Kb;return a.localCenter.SetV(this.localCenter),a.c0.SetV(this.c0),a.c.SetV(this.c),a.a0=this.a0,a.a=this.a,a.t0=this.t0,a},GetTransform:function(a,b){b=b||0,a.position.x=(1-b)*this.c0.x+b*this.c.x,a.position.y=(1-b)*this.c0.y+b*this.c.y;var c=(1-b)*this.a0+b*this.a;a.R.Set(c);var d=a.R;a.position.x-=d.col1.x*this.localCenter.x+d.col2.x*this.localCenter.y,a.position.y-=d.col1.y*this.localCenter.x+d.col2.y*this.localCenter.y},Advance:function(a){if(a=a||0,this.t0<a&&1-this.t0>Fb.b2_epsilon){var b=(a-this.t0)/(1-this.t0);this.c0.x=(1-b)*this.c0.x+b*this.c.x,this.c0.y=(1-b)*this.c0.y+b*this.c.y,this.a0=(1-b)*this.a0+b*this.a,this.t0=a}}},Pb=Xb.Common.Math.b2Transform=function(a,b){this.position=new Qb(0,0),this.R=new jb,a&&(this.position.SetV(a),this.R.SetM(b))},Pb.constructor=Pb,Pb.prototype={position:null,R:null,Initialize:function(a,b){return this.position.SetV(a),this.R.SetM(b),this},SetIdentity:function(){return this.position.SetZero(),this.R.SetIdentity(),this},Set:function(a){return this.position.SetV(a.position),this.R.SetM(a.R),this},GetAngle:function(){return Math.atan2(this.R.col1.y,this.R.col1.x)}},lb=Xb.Common.Math.b2Math=function(){},lb.constructor=lb,lb.b2Vec2_zero=new Qb(0,0),lb.b2Mat22_identity=jb.FromVV(new Qb(1,0),new Qb(0,1)),lb.IsValid=function(a){return isFinite(a)},lb.Dot=function(a,b){return a.x*b.x+a.y*b.y},lb.CrossVV=function(a,b){return a.x*b.y-a.y*b.x},lb.CrossVF=function(a,b){return new Qb(b*a.y,-b*a.x)},lb.CrossFV=function(a,b){return new Qb(-a*b.y,a*b.x)},lb.MulMV=function(a,b){return new Qb(a.col1.x*b.x+a.col2.x*b.y,a.col1.y*b.x+a.col2.y*b.y)},lb.MulTMV=function(a,b){return new Qb(lb.Dot(b,a.col1),lb.Dot(b,a.col2))},lb.MulX=function(a,b){var c=lb.MulMV(a.R,b);return c.x+=a.position.x,c.y+=a.position.y,c},lb.MulXT=function(a,b){var c=lb.SubtractVV(b,a.position),d=c.x*a.R.col1.x+c.y*a.R.col1.y;return c.y=c.x*a.R.col2.x+c.y*a.R.col2.y,c.x=d,c},lb.AddVV=function(a,b){return new Qb(a.x+b.x,a.y+b.y)},lb.SubtractVV=function(a,b){return new Qb(a.x-b.x,a.y-b.y)},lb.Distance=function(a,b){var c=a.x-b.x,d=a.y-b.y;return Math.sqrt(c*c+d*d)},lb.DistanceSquared=function(a,b){var c=a.x-b.x,d=a.y-b.y;return c*c+d*d},lb.MulFV=function(a,b){return new Qb(a*b.x,a*b.y)},lb.AddMM=function(a,b){return jb.FromVV(lb.AddVV(a.col1,b.col1),lb.AddVV(a.col2,b.col2))},lb.MulMM=function(a,b){return jb.FromVV(lb.MulMV(a,b.col1),lb.MulMV(a,b.col2))},lb.MulTMM=function(a,b){var c=new Qb(lb.Dot(a.col1,b.col1),lb.Dot(a.col2,b.col1)),d=new Qb(lb.Dot(a.col1,b.col2),lb.Dot(a.col2,b.col2));return jb.FromVV(c,d)},lb.Abs=function(a){return a>0?a:-a},lb.AbsV=function(a){return new Qb(lb.Abs(a.x),lb.Abs(a.y))},lb.AbsM=function(a){return jb.FromVV(lb.AbsV(a.col1),lb.AbsV(a.col2))},lb.Min=function(a,b){return b>a?a:b},lb.MinV=function(a,b){return new Qb(lb.Min(a.x,b.x),lb.Min(a.y,b.y))},lb.Max=function(a,b){return a>b?a:b},lb.MaxV=function(a,b){return new Qb(lb.Max(a.x,b.x),lb.Max(a.y,b.y))},lb.Clamp=function(a,b,c){return b>a?b:a>c?c:a},lb.ClampV=function(a,b,c){return lb.MaxV(b,lb.MinV(a,c))},lb.Swap=function(a,b){var c=a[0];a[0]=b[0],b[0]=c},lb.Random=function(){return 2*Math.random()-1},lb.RandomRange=function(a,b){return(b-a)*Math.random()+a},lb.NextPowerOfTwo=function(a){return a|=a>>1&2147483647,a|=a>>2&1073741823,a|=a>>4&268435455,a|=a>>8&16777215,a|=a>>16&65535,a+1},lb.IsPowerOfTwo=function(a){return a>0&&0===(a&a-1)},lb.b2Transform_identity=new Pb(lb.b2Vec2_zero,lb.b2Mat22_identity),Gb=Xb.Collision.Shapes.b2Shape=function(){},Gb.prototype.m_type=Gb.e_unknownShape,Gb.prototype.m_radius=Fb.b2_linearSlop,Gb.e_unknownShape=-1,Gb.e_circleShape=0,Gb.e_polygonShape=1,Gb.e_edgeShape=2,Gb.e_shapeTypeCount=3,Gb.e_hitCollide=1,Gb.e_missCollide=0,Gb.e_startsInsideCollide=-1,Gb.TestOverlap=function(a,b,c,d){var e=new H;e.proxyA=new L,e.proxyA.Set(a),e.proxyB=new L,e.proxyB.Set(c),e.transformA=b,e.transformB=d,e.useRadii=!0;var f=new Ib;f.count=0;var g=new K;return G.Distance(g,f,e),g.distance<10*Fb.b2_epsilon},Gb.prototype.Set=function(a){this.m_radius=a.m_radius},Gb.prototype.GetType=function(){return this.m_type},j=Xb.Collision.Shapes.b2CircleShape=function(a){this.m_p=new Qb(0,0),a=a||0,this.m_type=Gb.e_circleShape,this.m_radius=a},j.prototype=Object.create(Gb.prototype),j.prototype.m_type=Gb.e_circleShape,j.prototype.m_p=null,j.prototype.Copy=function(){var a=new j;return a.Set(this),a},j.prototype.Set=function(a){if(Gb.prototype.Set.call(this,a),a instanceof j){var b=a instanceof j?a:null;this.m_p.SetV(b.m_p)}},j.prototype.TestPoint=function(a,b){var c=a.R,d=a.position.x+(c.col1.x*this.m_p.x+c.col2.x*this.m_p.y),e=a.position.y+(c.col1.y*this.m_p.x+c.col2.y*this.m_p.y);return d=b.x-d,e=b.y-e,d*d+e*e<=this.m_radius*this.m_radius},j.prototype.RayCast=function(a,b,c){var d=c.R,e=c.position.x+(d.col1.x*this.m_p.x+d.col2.x*this.m_p.y),f=c.position.y+(d.col1.y*this.m_p.x+d.col2.y*this.m_p.y),g=b.p1.x-e,h=b.p1.y-f,i=g*g+h*h-this.m_radius*this.m_radius,j=b.p2.x-b.p1.x,k=b.p2.y-b.p1.y,l=g*j+h*k,m=j*j+k*k,n=l*l-m*i;if(0>n||m<Fb.b2_epsilon)return!1;var o=-(l+Math.sqrt(n));return o>=0&&o<=b.maxFraction*m?(o/=m,a.fraction=o,a.normal.x=g+o*j,a.normal.y=h+o*k,a.normal.Normalize(),!0):!1},j.prototype.ComputeAABB=function(a,b){var c=b.R,d=b.position.x+(c.col1.x*this.m_p.x+c.col2.x*this.m_p.y),e=b.position.y+(c.col1.y*this.m_p.x+c.col2.y*this.m_p.y);a.lowerBound.Set(d-this.m_radius,e-this.m_radius),a.upperBound.Set(d+this.m_radius,e+this.m_radius)},j.prototype.ComputeMass=function(a,b){b=b||0,a.mass=b*Fb.b2_pi*this.m_radius*this.m_radius,a.center.SetV(this.m_p),a.I=a.mass*(.5*this.m_radius*this.m_radius+(this.m_p.x*this.m_p.x+this.m_p.y*this.m_p.y))},j.prototype.ComputeSubmergedArea=function(a,b,c,d){b=b||0;var e=lb.MulX(c,this.m_p),f=-(lb.Dot(a,e)-b);if(f<-this.m_radius+Fb.b2_epsilon)return 0;if(f>this.m_radius)return d.SetV(e),Math.PI*this.m_radius*this.m_radius;var g=this.m_radius*this.m_radius,h=f*f,i=g*(Math.asin(f/this.m_radius)+Math.PI/2)+f*Math.sqrt(g-h),j=-2/3*Math.pow(g-h,1.5)/i;return d.x=e.x+a.x*j,d.y=e.y+a.y*j,i},j.prototype.GetLocalPosition=function(){return this.m_p},j.prototype.SetLocalPosition=function(a){this.m_p.SetV(a)},j.prototype.GetRadius=function(){return this.m_radius},j.prototype.SetRadius=function(a){this.m_radius=a},tb=Xb.Collision.Shapes.b2PolygonShape=function(){Gb.call(this),this.m_type=Gb.e_polygonShape,this.m_centroid=new Qb(0,0),this.m_vertices=[],this.m_normals=[]},tb.constructor=tb,tb.prototype=Object.create(Gb.prototype),tb.s_mat=new jb,tb.AsArray=function(a,b){var c=new tb;return c.SetAsArray(a,b),c},tb.AsVector=function(a,b){var c=new tb;return c.SetAsVector(a,b),c},tb.AsBox=function(a,b){var c=new tb;return c.SetAsBox(a,b),c},tb.AsOrientedBox=function(a,b,c,d){a=a||0,b=b||0,c=c||null,d=d||0;var e=new tb;return e.SetAsOrientedBox(a,b,c,d),e},tb.AsEdge=function(a,b){var c=new tb;return c.SetAsEdge(a,b),c},tb.ComputeCentroid=function(a,b){for(var c=new Qb(0,0),d=0,e=0,f=0,g=1/3,h=0;b>h;++h){var i=a[h],j=b>h+1?a[h+1]:a[0],k=i.x-e,l=i.y-f,m=j.x-e,n=j.y-f,o=k*n-l*m,p=.5*o;d+=p,c.x+=p*g*(e+i.x+j.x),c.y+=p*g*(f+i.y+j.y)}return c.x*=1/d,c.y*=1/d,c},tb.ComputeOBB=function(a,b,c){var d,e=[];for(d=0;c>d;++d)e.push(b[d]);e.push(e[0]);var f=Fb.b2_maxFloat;for(d=1;c>=d;++d){var g=e[d-1],h=e[d].x-g.x,i=e[d].y-g.y,j=Math.sqrt(h*h+i*i);h/=j,i/=j;for(var k=-i,l=h,m=Fb.b2_maxFloat,n=Fb.b2_maxFloat,o=-Fb.b2_maxFloat,p=-Fb.b2_maxFloat,q=0;c>q;++q){var r=e[q].x-g.x,s=e[q].y-g.y,t=h*r+i*s,u=k*r+l*s;m>t&&(m=t),n>u&&(n=u),t>o&&(o=t),u>p&&(p=u)}var v=(o-m)*(p-n);if(.95*f>v){f=v,a.R.col1.x=h,a.R.col1.y=i,a.R.col2.x=k,a.R.col2.y=l;var w=.5*(m+o),x=.5*(n+p),y=a.R;a.center.x=g.x+(y.col1.x*w+y.col2.x*x),a.center.y=g.y+(y.col1.y*w+y.col2.y*x),a.extents.x=.5*(o-m),a.extents.y=.5*(p-n)}}},tb.prototype.Copy=function(){var a=new tb;return a.Set(this),a},tb.prototype.Set=function(a){if(Gb.prototype.Set.call(this,a),a instanceof tb){var b=a instanceof tb?a:null;this.m_centroid.SetV(b.m_centroid),this.m_vertexCount=b.m_vertexCount,this.Reserve(this.m_vertexCount);for(var c=0;c<this.m_vertexCount;c++)this.m_vertices[c].SetV(b.m_vertices[c]),this.m_normals[c].SetV(b.m_normals[c])}},tb.prototype.SetAsArray=function(a,b){b=b||0;var c,d,e=[];for(c=0;c<a.length;++c)d=a[c],e.push(d);this.SetAsVector(e,b)},tb.prototype.SetAsVector=function(a,b){b=b||0,0===b&&(b=a.length),Wb(b>=2),this.m_vertexCount=b,this.Reserve(b);var c=0;for(c=0;c<this.m_vertexCount;c++)this.m_vertices[c].SetV(a[c]);for(c=0;c<this.m_vertexCount;++c){var d=c,e=c+1<this.m_vertexCount?c+1:0,f=lb.SubtractVV(this.m_vertices[e],this.m_vertices[d]);Wb(f.LengthSquared()>Fb.b2_epsilon),this.m_normals[c].SetV(lb.CrossVF(f,1)),this.m_normals[c].Normalize()}this.m_centroid=tb.ComputeCentroid(this.m_vertices,this.m_vertexCount)},tb.prototype.SetAsBox=function(a,b){a=a||0,b=b||0,this.m_vertexCount=4,this.Reserve(4),this.m_vertices[0].Set(-a,-b),this.m_vertices[1].Set(a,-b),this.m_vertices[2].Set(a,b),this.m_vertices[3].Set(-a,b),this.m_normals[0].Set(0,-1),this.m_normals[1].Set(1,0),this.m_normals[2].Set(0,1),this.m_normals[3].Set(-1,0),this.m_centroid.SetZero()},tb.prototype.SetAsOrientedBox=function(a,b,c,d){a=a||0,b=b||0,c=c||null,d=d||0,this.m_vertexCount=4,this.Reserve(4),this.m_vertices[0].Set(-a,-b),this.m_vertices[1].Set(a,-b),this.m_vertices[2].Set(a,b),this.m_vertices[3].Set(-a,b),this.m_normals[0].Set(0,-1),this.m_normals[1].Set(1,0),this.m_normals[2].Set(0,1),this.m_normals[3].Set(-1,0),this.m_centroid=c;var e=new Pb;e.position=c,e.R.Set(d);for(var f=0;f<this.m_vertexCount;++f)this.m_vertices[f]=lb.MulX(e,this.m_vertices[f]),this.m_normals[f]=lb.MulMV(e.R,this.m_normals[f])},tb.prototype.SetAsEdge=function(a,b){this.m_vertexCount=2,this.Reserve(2),this.m_vertices[0].SetV(a),this.m_vertices[1].SetV(b),this.m_centroid.x=.5*(a.x+b.x),this.m_centroid.y=.5*(a.y+b.y),this.m_normals[0]=lb.CrossVF(lb.SubtractVV(b,a),1),this.m_normals[0].Normalize(),this.m_normals[1].x=-this.m_normals[0].x,this.m_normals[1].y=-this.m_normals[0].y},tb.prototype.TestPoint=function(a,b){for(var c,d=a.R,e=b.x-a.position.x,f=b.y-a.position.y,g=e*d.col1.x+f*d.col1.y,h=e*d.col2.x+f*d.col2.y,i=0;i<this.m_vertexCount;++i){c=this.m_vertices[i],e=g-c.x,f=h-c.y,c=this.m_normals[i];var j=c.x*e+c.y*f;if(j>0)return!1}return!0},tb.prototype.RayCast=function(a,b,c){var d,e,f=0,g=b.maxFraction,h=0,i=0;h=b.p1.x-c.position.x,i=b.p1.y-c.position.y,d=c.R;var j=h*d.col1.x+i*d.col1.y,k=h*d.col2.x+i*d.col2.y;h=b.p2.x-c.position.x,i=b.p2.y-c.position.y,d=c.R;for(var l=h*d.col1.x+i*d.col1.y,m=h*d.col2.x+i*d.col2.y,n=l-j,o=m-k,p=-1,q=0;q<this.m_vertexCount;++q){e=this.m_vertices[q],h=e.x-j,i=e.y-k,e=this.m_normals[q];var r=e.x*h+e.y*i,s=e.x*n+e.y*o;if(0===s){if(0>r)return!1}else 0>s&&f*s>r?(f=r/s,p=q):s>0&&g*s>r&&(g=r/s);if(g<f-Fb.b2_epsilon)return!1}return p>=0?(a.fraction=f,d=c.R,e=this.m_normals[p],a.normal.x=d.col1.x*e.x+d.col2.x*e.y,a.normal.y=d.col1.y*e.x+d.col2.y*e.y,!0):!1},tb.prototype.ComputeAABB=function(a,b){for(var c=b.R,d=this.m_vertices[0],e=b.position.x+(c.col1.x*d.x+c.col2.x*d.y),f=b.position.y+(c.col1.y*d.x+c.col2.y*d.y),g=e,h=f,i=1;i<this.m_vertexCount;++i){d=this.m_vertices[i];var j=b.position.x+(c.col1.x*d.x+c.col2.x*d.y),k=b.position.y+(c.col1.y*d.x+c.col2.y*d.y);e=j>e?e:j,f=k>f?f:k,g=g>j?g:j,h=h>k?h:k}a.lowerBound.x=e-this.m_radius,a.lowerBound.y=f-this.m_radius,a.upperBound.x=g+this.m_radius,a.upperBound.y=h+this.m_radius},tb.prototype.ComputeMass=function(a,b){if(2===this.m_vertexCount)return a.center.x=.5*(this.m_vertices[0].x+this.m_vertices[1].x),a.center.y=.5*(this.m_vertices[0].y+this.m_vertices[1].y),a.mass=0,void(a.I=0);for(var c=0,d=0,e=0,f=0,g=0,h=0,i=1/3,j=0;j<this.m_vertexCount;++j){var k=this.m_vertices[j],l=j+1<this.m_vertexCount?this.m_vertices[j+1]:this.m_vertices[0],m=k.x-g,n=k.y-h,o=l.x-g,p=l.y-h,q=m*p-n*o,r=.5*q;e+=r,c+=r*i*(g+k.x+l.x),d+=r*i*(h+k.y+l.y);var s=g,t=h,u=m,v=n,w=o,x=p,y=i*(.25*(u*u+w*u+w*w)+(s*u+s*w))+.5*s*s,z=i*(.25*(v*v+x*v+x*x)+(t*v+t*x))+.5*t*t;f+=q*(y+z)}a.mass=b*e,c*=1/e,d*=1/e,a.center.Set(c,d),a.I=b*f},tb.prototype.ComputeSubmergedArea=function(a,b,c,d){var e=lb.MulTMV(c.R,a),f=b-lb.Dot(a,c.position),g=[],h=0,i=-1,j=-1,k=!1,l=0;for(l=0;l<this.m_vertexCount;++l){g[l]=lb.Dot(e,this.m_vertices[l])-f;var m=g[l]<-Fb.b2_epsilon;l>0&&(m?k||(i=l-1,h++):k&&(j=l-1,h++)),k=m}switch(h){case 0:if(k){var n=new ib;return this.ComputeMass(n,1),d.SetV(lb.MulX(c,n.center)),n.mass}return 0;case 1:-1===i?i=this.m_vertexCount-1:j=this.m_vertexCount-1}var o,p=(i+1)%this.m_vertexCount,q=(j+1)%this.m_vertexCount,r=(0-g[i])/(g[p]-g[i]),s=(0-g[j])/(g[q]-g[j]),t=new Qb(this.m_vertices[i].x*(1-r)+this.m_vertices[p].x*r,this.m_vertices[i].y*(1-r)+this.m_vertices[p].y*r),u=new Qb(this.m_vertices[j].x*(1-s)+this.m_vertices[q].x*s,this.m_vertices[j].y*(1-s)+this.m_vertices[q].y*s),v=0,w=new Qb(0,0),x=this.m_vertices[p];for(l=p;l!==q;){l=(l+1)%this.m_vertexCount,o=l===q?u:this.m_vertices[l];var y=.5*((x.x-t.x)*(o.y-t.y)-(x.y-t.y)*(o.x-t.x));v+=y,w.x+=y*(t.x+x.x+o.x)/3,w.y+=y*(t.y+x.y+o.y)/3,x=o}return w.Multiply(1/v),d.SetV(lb.MulX(c,w)),v},tb.prototype.GetVertexCount=function(){return this.m_vertexCount},tb.prototype.GetVertices=function(){return this.m_vertices},tb.prototype.GetNormals=function(){return this.m_normals},tb.prototype.GetSupport=function(a){for(var b=0,c=this.m_vertices[0].x*a.x+this.m_vertices[0].y*a.y,d=1;d<this.m_vertexCount;++d){var e=this.m_vertices[d].x*a.x+this.m_vertices[d].y*a.y;e>c&&(b=d,c=e)}return b},tb.prototype.GetSupportVertex=function(a){for(var b=0,c=this.m_vertices[0].x*a.x+this.m_vertices[0].y*a.y,d=1;d<this.m_vertexCount;++d){var e=this.m_vertices[d].x*a.x+this.m_vertices[d].y*a.y;e>c&&(b=d,c=e)}return this.m_vertices[b]},tb.prototype.Validate=function(){return!1},tb.prototype.Reserve=function(a){for(var b=this.m_vertices.length;a>b;b++)this.m_vertices[b]=new Qb(0,0),this.m_normals[b]=new Qb(0,0)},R=Xb.Collision.Shapes.b2EdgeChainDef=function(){this.vertexCount=0,this.isALoop=!0,this.vertices=[]},R.constructor=R,S=Xb.Collision.Shapes.b2EdgeShape=function(a,b){this.s_supportVec=new Qb(0,0),this.m_v1=new Qb(0,0),this.m_v2=new Qb(0,0),this.m_coreV1=new Qb(0,0),this.m_coreV2=new Qb(0,0),this.m_normal=new Qb(0,0),this.m_direction=new Qb(0,0),this.m_cornerDir1=new Qb(0,0),this.m_cornerDir2=new Qb(0,0),Gb.call(this),this.m_type=Gb.e_edgeShape,this.m_prevEdge=null,this.m_nextEdge=null,this.m_v1=a,this.m_v2=b,this.m_direction.Set(this.m_v2.x-this.m_v1.x,this.m_v2.y-this.m_v1.y),this.m_length=this.m_direction.Normalize(),this.m_normal.Set(this.m_direction.y,-this.m_direction.x),this.m_coreV1.Set(-Fb.b2_toiSlop*(this.m_normal.x-this.m_direction.x)+this.m_v1.x,-Fb.b2_toiSlop*(this.m_normal.y-this.m_direction.y)+this.m_v1.y),this.m_coreV2.Set(-Fb.b2_toiSlop*(this.m_normal.x+this.m_direction.x)+this.m_v2.x,-Fb.b2_toiSlop*(this.m_normal.y+this.m_direction.y)+this.m_v2.y),this.m_cornerDir1=this.m_normal,this.m_cornerDir2.Set(-this.m_normal.x,-this.m_normal.y)},S.constructor=S,S.prototype=Object.create(Gb.prototype),S.prototype.TestPoint=function(){return!1},S.prototype.RayCast=function(a,b,c){var d,e=b.p2.x-b.p1.x,f=b.p2.y-b.p1.y;d=c.R;var g=c.position.x+(d.col1.x*this.m_v1.x+d.col2.x*this.m_v1.y),h=c.position.y+(d.col1.y*this.m_v1.x+d.col2.y*this.m_v1.y),i=c.position.y+(d.col1.y*this.m_v2.x+d.col2.y*this.m_v2.y)-h,j=-(c.position.x+(d.col1.x*this.m_v2.x+d.col2.x*this.m_v2.y)-g),k=100*Fb.b2_epsilon,l=-(e*i+f*j);if(l>k){var m=b.p1.x-g,n=b.p1.y-h,o=m*i+n*j;if(o>=0&&o<=b.maxFraction*l){var p=-e*n+f*m;if(p>=-k*l&&l*(1+k)>=p){o/=l,a.fraction=o;var q=Math.sqrt(i*i+j*j);return a.normal.x=i/q,a.normal.y=j/q,!0}}}return!1},S.prototype.ComputeAABB=function(a,b){var c=b.R,d=b.position.x+(c.col1.x*this.m_v1.x+c.col2.x*this.m_v1.y),e=b.position.y+(c.col1.y*this.m_v1.x+c.col2.y*this.m_v1.y),f=b.position.x+(c.col1.x*this.m_v2.x+c.col2.x*this.m_v2.y),g=b.position.y+(c.col1.y*this.m_v2.x+c.col2.y*this.m_v2.y);f>d?(a.lowerBound.x=d,a.upperBound.x=f):(a.lowerBound.x=f,a.upperBound.x=d),g>e?(a.lowerBound.y=e,a.upperBound.y=g):(a.lowerBound.y=g,a.upperBound.y=e)},S.prototype.ComputeMass=function(a,b){b=b||0,a.mass=0,a.center.SetV(this.m_v1),a.I=0},S.prototype.ComputeSubmergedArea=function(a,b,c,d){b=b||0;var e=new Qb(a.x*b,a.y*b),f=lb.MulX(c,this.m_v1),g=lb.MulX(c,this.m_v2),h=lb.Dot(a,f)-b,i=lb.Dot(a,g)-b;if(h>0){if(i>0)return 0;f.x=-i/(h-i)*f.x+h/(h-i)*g.x,f.y=-i/(h-i)*f.y+h/(h-i)*g.y}else i>0&&(g.x=-i/(h-i)*f.x+h/(h-i)*g.x,g.y=-i/(h-i)*f.y+h/(h-i)*g.y);return d.x=(e.x+f.x+g.x)/3,d.y=(e.y+f.y+g.y)/3,.5*((f.x-e.x)*(g.y-e.y)-(f.y-e.y)*(g.x-e.x))},S.prototype.GetLength=function(){return this.m_length},S.prototype.GetVertex1=function(){return this.m_v1},S.prototype.GetVertex2=function(){return this.m_v2},S.prototype.GetCoreVertex1=function(){return this.m_coreV1},S.prototype.GetCoreVertex2=function(){return this.m_coreV2},S.prototype.GetNormalVector=function(){return this.m_normal},S.prototype.GetDirectionVector=function(){return this.m_direction},S.prototype.GetCorner1Vector=function(){return this.m_cornerDir1},S.prototype.GetCorner2Vector=function(){return this.m_cornerDir2},S.prototype.Corner1IsConvex=function(){return this.m_cornerConvex1},S.prototype.Corner2IsConvex=function(){return this.m_cornerConvex2},S.prototype.GetFirstVertex=function(a){var b=a.R;return new Qb(a.position.x+(b.col1.x*this.m_coreV1.x+b.col2.x*this.m_coreV1.y),a.position.y+(b.col1.y*this.m_coreV1.x+b.col2.y*this.m_coreV1.y))},S.prototype.GetNextEdge=function(){return this.m_nextEdge},S.prototype.GetPrevEdge=function(){return this.m_prevEdge},S.prototype.Support=function(a,b,c){b=b||0,c=c||0;var d=a.R,e=a.position.x+(d.col1.x*this.m_coreV1.x+d.col2.x*this.m_coreV1.y),f=a.position.y+(d.col1.y*this.m_coreV1.x+d.col2.y*this.m_coreV1.y),g=a.position.x+(d.col1.x*this.m_coreV2.x+d.col2.x*this.m_coreV2.y),h=a.position.y+(d.col1.y*this.m_coreV2.x+d.col2.y*this.m_coreV2.y);return e*b+f*c>g*b+h*c?(this.s_supportVec.x=e,this.s_supportVec.y=f):(this.s_supportVec.x=g,this.s_supportVec.y=h),this.s_supportVec},S.prototype.SetPrevEdge=function(a,b,c,d){this.m_prevEdge=a,this.m_coreV1=b,this.m_cornerDir1=c,this.m_cornerConvex1=d},S.prototype.SetNextEdge=function(a,b,c,d){this.m_nextEdge=a,this.m_coreV2=b,this.m_cornerDir2=c,this.m_cornerConvex2=d},S.prototype.Copy=function(){return null},ib=Xb.Collision.Shapes.b2MassData=function(){this.mass=0,this.center=new Qb(0,0),this.I=0},ib.constructor=ib,b=Xb.Collision.Features=function(){},b.constructor=b,b.prototype={_m_id:null,_referenceEdge:0,_incidentEdge:0,_incidentVertex:0,_flip:0},Object.defineProperties(b.prototype,{referenceEdge:{enumerable:!1,configurable:!0,get:function(){return this._referenceEdge},set:function(a){this._referenceEdge=a,this._m_id.key=4294967040&this._m_id.key|255&this._referenceEdge}},incidentEdge:{enumerable:!1,configurable:!0,get:function(){return this._incidentEdge},set:function(a){this._incidentEdge=a,this._m_id.key=4294902015&this._m_id.key|this._incidentEdge<<8&65280}},incidentVertex:{enumerable:!1,configurable:!0,get:function(){return this._incidentVertex},set:function(a){this._incidentVertex=a,this._m_id.key=4278255615&this._m_id.key|this._incidentVertex<<16&16711680}},flip:{enumerable:!1,configurable:!0,get:function(){return this._flip},set:function(a){this._flip=a,this._m_id.key=16777215&this._m_id.key|this._flip<<24&4278190080}}}),u=Xb.Collision.b2ContactID=function(){this.features=new b,this.features._m_id=this},u.constructor=u,u.prototype._key=0,u.prototype.features=null,u.prototype.Set=function(a){this.key=a._key},u.prototype.Copy=function(){var a=new u;return a.key=this.key,a},Object.defineProperties(u.prototype,{key:{enumerable:!1,configurable:!0,get:function(){return this._key},set:function(a){this._key=a,this.features._referenceEdge=255&this._key,this.features._incidentEdge=(65280&this._key)>>8&255,this.features._incidentVertex=(16711680&this._key)>>16&255,this.features._flip=(4278190080&this._key)>>24&255}}}),a=Xb.Collision.ClipVertex=function(){this.v=new Qb(0,0),this.id=new u},a.constructor=a,a.prototype.v=null,a.prototype.id=null,a.prototype.Set=function(a){this.v.SetV(a.v),this.id.Set(a.id)},c=Xb.Collision.b2AABB=function(){this.lowerBound=new Qb(0,0),this.upperBound=new Qb(0,0)},c.constructor=c,c.prototype.lowerBound=null,c.prototype.upperBound=null,c.Combine=function(a,b){var d=new c;return d.Combine(a,b),d},c.prototype.IsValid=function(){var a=this.upperBound.x-this.lowerBound.x,b=this.upperBound.y-this.lowerBound.y,c=a>=0&&b>=0;return c=c&&this.lowerBound.IsValid()&&this.upperBound.IsValid()},c.prototype.GetCenter=function(){return new Qb((this.lowerBound.x+this.upperBound.x)/2,(this.lowerBound.y+this.upperBound.y)/2)},c.prototype.GetExtents=function(){return new Qb((this.upperBound.x-this.lowerBound.x)/2,(this.upperBound.y-this.lowerBound.y)/2)},c.prototype.Contains=function(a){var b=!0;return b=b&&this.lowerBound.x<=a.lowerBound.x,b=b&&this.lowerBound.y<=a.lowerBound.y,b=b&&a.upperBound.x<=this.upperBound.x,b=b&&a.upperBound.y<=this.upperBound.y},c.prototype.RayCast=function(a,b){var c=-Fb.b2_maxFloat,d=Fb.b2_maxFloat,e=b.p1.x,f=b.p1.y,g=b.p2.x-b.p1.x,h=b.p2.y-b.p1.y,i=Math.abs(g),j=Math.abs(h),k=a.normal,l=0,m=0,n=0,o=0,p=0;if(i<Fb.b2_epsilon){if(e<this.lowerBound.x||this.upperBound.x<e)return!1}else if(l=1/g,m=(this.lowerBound.x-e)*l,n=(this.upperBound.x-e)*l,p=-1,m>n&&(o=m,m=n,n=o,p=1),m>c&&(k.x=p,k.y=0,c=m),d=Math.min(d,n),c>d)return!1;if(j<Fb.b2_epsilon){if(f<this.lowerBound.y||this.upperBound.y<f)return!1}else if(l=1/h,m=(this.lowerBound.y-f)*l,n=(this.upperBound.y-f)*l,p=-1,m>n&&(o=m,m=n,n=o,p=1),m>c&&(k.y=p,k.x=0,c=m),d=Math.min(d,n),c>d)return!1;return a.fraction=c,!0},c.prototype.TestOverlap=function(a){var b=a.lowerBound.x-this.upperBound.x,c=a.lowerBound.y-this.upperBound.y,d=this.lowerBound.x-a.upperBound.x,e=this.lowerBound.y-a.upperBound.y;return b>0||c>0?!1:d>0||e>0?!1:!0},c.prototype.Combine=function(a,b){this.lowerBound.x=Math.min(a.lowerBound.x,b.lowerBound.x),this.lowerBound.y=Math.min(a.lowerBound.y,b.lowerBound.y),this.upperBound.x=Math.max(a.upperBound.x,b.upperBound.x),this.upperBound.y=Math.max(a.upperBound.y,b.upperBound.y)},Ib=Xb.Collision.b2SimplexCache=function(){this.indexA=[0,0,0],this.indexB=[0,0,0]},Ib.constructor=Ib,Ib.prototype.indexA=null,Ib.prototype.indexB=null,f=Xb.Collision.b2Bound=function(){},f.constructor=f,f.prototype.value=0,f.prototype.proxy=null,f.prototype.stabbingCount=0,f.prototype.IsLower=function(){return 0===(1&this.value)},f.prototype.IsUpper=function(){return 1===(1&this.value)},f.prototype.Swap=function(a){var b=this.value,c=this.proxy,d=this.stabbingCount;this.value=a.value,this.proxy=a.proxy,this.stabbingCount=a.stabbingCount,a.value=b,a.proxy=c,a.stabbingCount=d},g=Xb.Collision.b2BoundValues=function(){this.lowerValues=[],this.lowerValues[0]=0,this.lowerValues[1]=0,this.upperValues=[],this.upperValues[0]=0,this.upperValues[1]=0},g.constructor=g,g.prototype.lowerValues=null,g.prototype.upperValues=null,hb=Xb.Collision.b2ManifoldPoint=function(){this.m_localPoint=new Qb(0,0),this.m_id=new u,this.Reset()},hb.constructor=hb,hb.prototype.m_localPoint=null,hb.prototype.m_id=null,hb.prototype.m_localPoint=null,hb.prototype.m_normalImpulse=0,hb.prototype.m_tangentImpulse=0,hb.prototype.Reset=function(){this.m_localPoint.SetZero(),this.m_normalImpulse=0,this.m_tangentImpulse=0,this.m_id.key=0},hb.prototype.Set=function(a){this.m_localPoint.SetV(a.m_localPoint),this.m_normalImpulse=a.m_normalImpulse,this.m_tangentImpulse=a.m_tangentImpulse,this.m_id.Set(a.m_id)},gb=Xb.Collision.b2Manifold=function(){this.m_pointCount=0,this.m_points=[];for(var a=0;a<Fb.b2_maxManifoldPoints;a++)this.m_points.push(new hb);this.m_localPlaneNormal=new Qb(0,0),this.m_localPoint=new Qb(0,0)},gb.constructor=gb,gb.e_circles=1,gb.e_faceA=2,gb.e_faceB=4,gb.prototype.m_type=0,gb.prototype.m_pointCount=0,gb.prototype.m_points=null,gb.prototype.m_localPlaneNormal=null,gb.prototype.m_localPoint=null,gb.prototype.Reset=function(){for(var a=0;a<Fb.b2_maxManifoldPoints;a++)(this.m_points[a]instanceof hb?this.m_points[a]:null).Reset();this.m_localPlaneNormal.SetZero(),this.m_localPoint.SetZero(),this.m_type=0,this.m_pointCount=0},gb.prototype.Set=function(a){this.m_pointCount=a.m_pointCount;for(var b=0;b<Fb.b2_maxManifoldPoints;b++)(this.m_points[b]instanceof hb?this.m_points[b]:null).Set(a.m_points[b]);this.m_localPlaneNormal.SetV(a.m_localPlaneNormal),this.m_localPoint.SetV(a.m_localPoint),this.m_type=a.m_type},gb.prototype.Copy=function(){var a=new gb;return a.Set(this),a},k=Xb.Collision.b2Collision=function(){},k.constructor=k,k.s_edgeAO=[0],k.s_edgeBO=[0],k.s_localTangent=new Qb(0,0),k.s_localNormal=new Qb(0,0),k.s_planePoint=new Qb(0,0),k.s_normal=new Qb(0,0),k.s_tangent=new Qb(0,0),k.s_tangent2=new Qb(0,0),k.s_v11=new Qb(0,0),k.s_v12=new Qb(0,0),k.b2CollidePolyTempVec=new Qb(0,0),k.b2_nullFeature=255,k.ClipSegmentToLine=function(a,b,c,d){d=d||0;var e,f=0;e=b[0];var g=e.v;e=b[1];var h=e.v,i=c.x*g.x+c.y*g.y-d,j=c.x*h.x+c.y*h.y-d;
if(0>=i&&a[f++].Set(b[0]),0>=j&&a[f++].Set(b[1]),0>i*j){var k=i/(i-j);e=a[f];var l=e.v;l.x=g.x+k*(h.x-g.x),l.y=g.y+k*(h.y-g.y),e=a[f];var m;i>0?(m=b[0],e.id=m.id):(m=b[1],e.id=m.id),++f}return f},k.EdgeSeparation=function(a,b,c,d,e){c=c||0;var f,g,h=a.m_vertices,i=a.m_normals,j=d.m_vertexCount,k=d.m_vertices;f=b.R,g=i[c];var l=f.col1.x*g.x+f.col2.x*g.y,m=f.col1.y*g.x+f.col2.y*g.y;f=e.R;for(var n=f.col1.x*l+f.col1.y*m,o=f.col2.x*l+f.col2.y*m,p=0,q=Fb.b2_maxFloat,r=0;j>r;++r){g=k[r];var s=g.x*n+g.y*o;q>s&&(q=s,p=r)}g=h[c],f=b.R;var t=b.position.x+(f.col1.x*g.x+f.col2.x*g.y),u=b.position.y+(f.col1.y*g.x+f.col2.y*g.y);g=k[p],f=e.R;var v=e.position.x+(f.col1.x*g.x+f.col2.x*g.y),w=e.position.y+(f.col1.y*g.x+f.col2.y*g.y);return v-=t,w-=u,v*l+w*m},k.FindMaxSeparation=function(a,b,c,d,e){var f,g,h=b.m_vertexCount,i=b.m_normals;g=e.R,f=d.m_centroid;var j=e.position.x+(g.col1.x*f.x+g.col2.x*f.y),l=e.position.y+(g.col1.y*f.x+g.col2.y*f.y);g=c.R,f=b.m_centroid,j-=c.position.x+(g.col1.x*f.x+g.col2.x*f.y),l-=c.position.y+(g.col1.y*f.x+g.col2.y*f.y);for(var m=j*c.R.col1.x+l*c.R.col1.y,n=j*c.R.col2.x+l*c.R.col2.y,o=0,p=-Fb.b2_maxFloat,q=0;h>q;++q){f=i[q];var r=f.x*m+f.y*n;r>p&&(p=r,o=q)}var s=k.EdgeSeparation(b,c,o,d,e),t=o-1>=0?o-1:h-1,u=k.EdgeSeparation(b,c,t,d,e),v=h>o+1?o+1:0,w=k.EdgeSeparation(b,c,v,d,e),x=0,y=0,z=0;if(u>s&&u>w)z=-1,x=t,y=u;else{if(!(w>s))return a[0]=o,s;z=1,x=v,y=w}for(;;){if(o=-1===z?x-1>=0?x-1:h-1:h>x+1?x+1:0,s=k.EdgeSeparation(b,c,o,d,e),!(s>y))break;x=o,y=s}return a[0]=x,y},k.FindIncidentEdge=function(a,b,c,d,e,f){d=d||0;var g,h,i=b.m_normals,j=e.m_vertexCount,k=e.m_vertices,l=e.m_normals;g=c.R,h=i[d];var m=g.col1.x*h.x+g.col2.x*h.y,n=g.col1.y*h.x+g.col2.y*h.y;g=f.R;var o=g.col1.x*m+g.col1.y*n;n=g.col2.x*m+g.col2.y*n,m=o;for(var p=0,q=Fb.b2_maxFloat,r=0;j>r;++r){h=l[r];var s=m*h.x+n*h.y;q>s&&(q=s,p=r)}var t,u=p,v=j>u+1?u+1:0;t=a[0],h=k[u],g=f.R,t.v.x=f.position.x+(g.col1.x*h.x+g.col2.x*h.y),t.v.y=f.position.y+(g.col1.y*h.x+g.col2.y*h.y),t.id.features.referenceEdge=d,t.id.features.incidentEdge=u,t.id.features.incidentVertex=0,t=a[1],h=k[v],g=f.R,t.v.x=f.position.x+(g.col1.x*h.x+g.col2.x*h.y),t.v.y=f.position.y+(g.col1.y*h.x+g.col2.y*h.y),t.id.features.referenceEdge=d,t.id.features.incidentEdge=v,t.id.features.incidentVertex=1},k.MakeClipPointVector=function(){return[new a,new a]},k.CollidePolygons=function(a,b,c,d,e){var f;a.m_pointCount=0;var g=b.m_radius+d.m_radius,h=0;k.s_edgeAO[0]=h;var i=k.FindMaxSeparation(k.s_edgeAO,b,c,d,e);if(h=k.s_edgeAO[0],!(i>g)){var j=0;k.s_edgeBO[0]=j;var l=k.FindMaxSeparation(k.s_edgeBO,d,e,b,c);if(j=k.s_edgeBO[0],!(l>g)){var m,n,o,p,q,r=0,s=0,t=.98,u=.001;l>t*i+u?(m=d,n=b,o=e,p=c,r=j,a.m_type=gb.e_faceB,s=1):(m=b,n=d,o=c,p=e,r=h,a.m_type=gb.e_faceA,s=0);var v=k.s_incidentEdge;k.FindIncidentEdge(v,m,o,r,n,p);var w,x=m.m_vertexCount,y=m.m_vertices,z=y[r];w=x>r+1?y[r+1]:y[0];var A=k.s_localTangent;A.Set(w.x-z.x,w.y-z.y),A.Normalize();var B=k.s_localNormal;B.x=A.y,B.y=-A.x;var C=k.s_planePoint;C.Set(.5*(z.x+w.x),.5*(z.y+w.y));var D=k.s_tangent;q=o.R,D.x=q.col1.x*A.x+q.col2.x*A.y,D.y=q.col1.y*A.x+q.col2.y*A.y;var E=k.s_tangent2;E.x=-D.x,E.y=-D.y;var F=k.s_normal;F.x=D.y,F.y=-D.x;var G=k.s_v11,H=k.s_v12;G.x=o.position.x+(q.col1.x*z.x+q.col2.x*z.y),G.y=o.position.y+(q.col1.y*z.x+q.col2.y*z.y),H.x=o.position.x+(q.col1.x*w.x+q.col2.x*w.y),H.y=o.position.y+(q.col1.y*w.x+q.col2.y*w.y);var I=F.x*G.x+F.y*G.y,J=-D.x*G.x-D.y*G.y+g,K=D.x*H.x+D.y*H.y+g,L=k.s_clipPoints1,M=k.s_clipPoints2,N=0;if(N=k.ClipSegmentToLine(L,v,E,J),!(2>N||(N=k.ClipSegmentToLine(M,L,D,K),2>N))){a.m_localPlaneNormal.SetV(B),a.m_localPoint.SetV(C);for(var O=0,P=0;P<Fb.b2_maxManifoldPoints;++P){f=M[P];var Q=F.x*f.v.x+F.y*f.v.y-I;if(g>=Q){var R=a.m_points[O];q=p.R;var S=f.v.x-p.position.x,T=f.v.y-p.position.y;R.m_localPoint.x=S*q.col1.x+T*q.col1.y,R.m_localPoint.y=S*q.col2.x+T*q.col2.y,R.m_id.Set(f.id),R.m_id.features.flip=s,++O}}a.m_pointCount=O}}}},k.CollideCircles=function(a,b,c,d,e){a.m_pointCount=0;var f,g;f=c.R,g=b.m_p;var h=c.position.x+(f.col1.x*g.x+f.col2.x*g.y),i=c.position.y+(f.col1.y*g.x+f.col2.y*g.y);f=e.R,g=d.m_p;var j=e.position.x+(f.col1.x*g.x+f.col2.x*g.y),k=e.position.y+(f.col1.y*g.x+f.col2.y*g.y),l=j-h,m=k-i,n=l*l+m*m,o=b.m_radius+d.m_radius;n>o*o||(a.m_type=gb.e_circles,a.m_localPoint.SetV(b.m_p),a.m_localPlaneNormal.SetZero(),a.m_pointCount=1,a.m_points[0].m_localPoint.SetV(d.m_p),a.m_points[0].m_id.key=0)},k.CollidePolygonAndCircle=function(a,b,c,d,e){a.m_pointCount=0;var f,g,h=0,i=0;g=e.R,f=d.m_p;var j=e.position.x+(g.col1.x*f.x+g.col2.x*f.y),k=e.position.y+(g.col1.y*f.x+g.col2.y*f.y);h=j-c.position.x,i=k-c.position.y,g=c.R;for(var l=h*g.col1.x+i*g.col1.y,m=h*g.col2.x+i*g.col2.y,n=0,o=-Fb.b2_maxFloat,p=b.m_radius+d.m_radius,q=b.m_vertexCount,r=b.m_vertices,s=b.m_normals,t=0;q>t;++t){f=r[t],h=l-f.x,i=m-f.y,f=s[t];var u=f.x*h+f.y*i;if(u>p)return;u>o&&(o=u,n=t)}var v=n,w=q>v+1?v+1:0,x=r[v],y=r[w];if(o<Fb.b2_epsilon)return a.m_pointCount=1,a.m_type=gb.e_faceA,a.m_localPlaneNormal.SetV(s[n]),a.m_localPoint.x=.5*(x.x+y.x),a.m_localPoint.y=.5*(x.y+y.y),a.m_points[0].m_localPoint.SetV(d.m_p),void(a.m_points[0].m_id.key=0);var z=(l-x.x)*(y.x-x.x)+(m-x.y)*(y.y-x.y),A=(l-y.x)*(x.x-y.x)+(m-y.y)*(x.y-y.y);if(0>=z){if((l-x.x)*(l-x.x)+(m-x.y)*(m-x.y)>p*p)return;a.m_pointCount=1,a.m_type=gb.e_faceA,a.m_localPlaneNormal.x=l-x.x,a.m_localPlaneNormal.y=m-x.y,a.m_localPlaneNormal.Normalize(),a.m_localPoint.SetV(x),a.m_points[0].m_localPoint.SetV(d.m_p),a.m_points[0].m_id.key=0}else if(0>=A){if((l-y.x)*(l-y.x)+(m-y.y)*(m-y.y)>p*p)return;a.m_pointCount=1,a.m_type=gb.e_faceA,a.m_localPlaneNormal.x=l-y.x,a.m_localPlaneNormal.y=m-y.y,a.m_localPlaneNormal.Normalize(),a.m_localPoint.SetV(y),a.m_points[0].m_localPoint.SetV(d.m_p),a.m_points[0].m_id.key=0}else{var B=.5*(x.x+y.x),C=.5*(x.y+y.y);if(o=(l-B)*s[v].x+(m-C)*s[v].y,o>p)return;a.m_pointCount=1,a.m_type=gb.e_faceA,a.m_localPlaneNormal.x=s[v].x,a.m_localPlaneNormal.y=s[v].y,a.m_localPlaneNormal.Normalize(),a.m_localPoint.Set(B,C),a.m_points[0].m_localPoint.SetV(d.m_p),a.m_points[0].m_id.key=0}},k.TestOverlap=function(a,b){var c=b.lowerBound,d=a.upperBound,e=c.x-d.x,f=c.y-d.y;c=a.lowerBound,d=b.upperBound;var g=c.x-d.x,h=c.y-d.y;return e>0||f>0?!1:g>0||h>0?!1:!0},k.s_clipPoints2=k.MakeClipPointVector(),k.s_clipPoints1=k.MakeClipPointVector(),k.s_incidentEdge=k.MakeClipPointVector(),y=Xb.Collision.b2ContactPoint=function(){this.position=new Qb(0,0),this.velocity=new Qb(0,0),this.normal=new Qb(0,0),this.id=new u},y.constructor=y,y.prototype.position=null,y.prototype.velocity=null,y.prototype.normal=null,y.prototype.id=null,Jb=Xb.Collision.b2SimplexVertex=function(){},Jb.constructor=Jb,Jb.prototype.wA=null,Jb.prototype.wB=null,Jb.prototype.w=null,Jb.prototype.a=null,Jb.prototype.indexA=null,Jb.prototype.indexB=null,Jb.prototype.Set=function(a){this.wA.SetV(a.wA),this.wB.SetV(a.wB),this.w.SetV(a.w),this.a=a.a,this.indexA=a.indexA,this.indexB=a.indexB},Hb=Xb.Collision.b2Simplex=function(){this.m_v1=new Jb,this.m_v2=new Jb,this.m_v3=new Jb,this.m_vertices=[this.m_v1,this.m_v2,this.m_v3]},Hb.constructor=Hb,Hb.prototype.m_v1=null,Hb.prototype.m_v2=null,Hb.prototype.m_v3=null,Hb.prototype.m_vertices=null,Hb.prototype.m_count=0,Hb.prototype.ReadCache=function(a,b,c,d,e){Wb(0<=a.count&&a.count<=3);var f,g;this.m_count=a.count;for(var h=this.m_vertices,i=0;i<this.m_count;i++){var j=h[i];j.indexA=a.indexA[i],j.indexB=a.indexB[i],f=b.GetVertex(j.indexA),g=d.GetVertex(j.indexB),j.wA=lb.MulX(c,f),j.wB=lb.MulX(e,g),j.w=lb.SubtractVV(j.wB,j.wA),j.a=0}if(this.m_count>1){var k=a.metric,l=this.GetMetric();(.5*k>l||l>2*k||l<Fb.b2_epsilon)&&(this.m_count=0)}0===this.m_count&&(j=h[0],j.indexA=0,j.indexB=0,f=b.GetVertex(0),g=d.GetVertex(0),j.wA=lb.MulX(c,f),j.wB=lb.MulX(e,g),j.w=lb.SubtractVV(j.wB,j.wA),this.m_count=1)},Hb.prototype.WriteCache=function(a){a.metric=this.GetMetric(),a.count=Math.abs(this.m_count);for(var b=this.m_vertices,c=0;c<this.m_count;c++)a.indexA[c]=Math.abs(b[c].indexA),a.indexB[c]=Math.abs(b[c].indexB)},Hb.prototype.GetSearchDirection=function(){switch(this.m_count){case 1:return this.m_v1.w.GetNegative();case 2:var a=lb.SubtractVV(this.m_v2.w,this.m_v1.w),b=lb.CrossVV(a,this.m_v1.w.GetNegative());return b>0?lb.CrossFV(1,a):lb.CrossVF(a,1);default:return Wb(!1),new Qb(0,0)}},Hb.prototype.GetClosestPoint=function(){switch(this.m_count){case 0:return Wb(!1),new Qb(0,0);case 1:return this.m_v1.w;case 2:return new Qb(this.m_v1.a*this.m_v1.w.x+this.m_v2.a*this.m_v2.w.x,this.m_v1.a*this.m_v1.w.y+this.m_v2.a*this.m_v2.w.y);default:return Wb(!1),new Qb(0,0)}},Hb.prototype.GetWitnessPoints=function(a,b){switch(this.m_count){case 0:Wb(!1);break;case 1:a.SetV(this.m_v1.wA),b.SetV(this.m_v1.wB);break;case 2:a.x=this.m_v1.a*this.m_v1.wA.x+this.m_v2.a*this.m_v2.wA.x,a.y=this.m_v1.a*this.m_v1.wA.y+this.m_v2.a*this.m_v2.wA.y,b.x=this.m_v1.a*this.m_v1.wB.x+this.m_v2.a*this.m_v2.wB.x,b.y=this.m_v1.a*this.m_v1.wB.y+this.m_v2.a*this.m_v2.wB.y;break;case 3:b.x=a.x=this.m_v1.a*this.m_v1.wA.x+this.m_v2.a*this.m_v2.wA.x+this.m_v3.a*this.m_v3.wA.x,b.y=a.y=this.m_v1.a*this.m_v1.wA.y+this.m_v2.a*this.m_v2.wA.y+this.m_v3.a*this.m_v3.wA.y;break;default:Wb(!1)}},Hb.prototype.GetMetric=function(){switch(this.m_count){case 0:return Wb(!1),0;case 1:return 0;case 2:return lb.SubtractVV(this.m_v1.w,this.m_v2.w).Length();case 3:return lb.CrossVV(lb.SubtractVV(this.m_v2.w,this.m_v1.w),lb.SubtractVV(this.m_v3.w,this.m_v1.w));default:return Wb(!1),0}},Hb.prototype.Solve2=function(){var a=this.m_v1.w,b=this.m_v2.w,c=lb.SubtractVV(b,a),d=-(a.x*c.x+a.y*c.y);if(0>=d)return this.m_v1.a=1,void(this.m_count=1);var e=b.x*c.x+b.y*c.y;if(0>=e)return this.m_v2.a=1,this.m_count=1,void this.m_v1.Set(this.m_v2);var f=1/(e+d);this.m_v1.a=e*f,this.m_v2.a=d*f,this.m_count=2},Hb.prototype.Solve3=function(){var a=this.m_v1.w,b=this.m_v2.w,c=this.m_v3.w,d=lb.SubtractVV(b,a),e=lb.Dot(a,d),f=lb.Dot(b,d),g=f,h=-e,i=lb.SubtractVV(c,a),j=lb.Dot(a,i),k=lb.Dot(c,i),l=k,m=-j,n=lb.SubtractVV(c,b),o=lb.Dot(b,n),p=lb.Dot(c,n),q=p,r=-o,s=lb.CrossVV(d,i),t=s*lb.CrossVV(b,c),u=s*lb.CrossVV(c,a),v=s*lb.CrossVV(a,b);if(0>=h&&0>=m)return this.m_v1.a=1,void(this.m_count=1);if(g>0&&h>0&&0>=v){var w=1/(g+h);return this.m_v1.a=g*w,this.m_v2.a=h*w,void(this.m_count=2)}if(l>0&&m>0&&0>=u){var x=1/(l+m);return this.m_v1.a=l*x,this.m_v3.a=m*x,this.m_count=2,void this.m_v2.Set(this.m_v3)}if(0>=g&&0>=r)return this.m_v2.a=1,this.m_count=1,void this.m_v1.Set(this.m_v2);if(0>=l&&0>=q)return this.m_v3.a=1,this.m_count=1,void this.m_v1.Set(this.m_v3);if(q>0&&r>0&&0>=t){var y=1/(q+r);return this.m_v2.a=q*y,this.m_v3.a=r*y,this.m_count=2,void this.m_v1.Set(this.m_v3)}var z=1/(t+u+v);this.m_v1.a=t*z,this.m_v2.a=u*z,this.m_v3.a=v*z,this.m_count=3},G=Xb.Collision.b2Distance=function(){},G.constructor=G,G.s_simplex=new Hb,G.s_saveA=[0,0,0],G.s_saveB=[0,0,0],G.Distance=function(a,b,c){var d=c.proxyA,e=c.proxyB,f=c.transformA,g=c.transformB,h=G.s_simplex;h.ReadCache(b,d,f,e,g);for(var i,j=h.m_vertices,k=20,l=G.s_saveA,m=G.s_saveB,n=0,o=h.GetClosestPoint(),p=o.LengthSquared(),q=p,r=0,s=0;k>s;){for(n=h.m_count,r=0;n>r;r++)l[r]=j[r].indexA,m[r]=j[r].indexB;switch(h.m_count){case 1:break;case 2:h.Solve2();break;case 3:h.Solve3();break;default:Wb(!1)}if(3===h.m_count)break;i=h.GetClosestPoint(),q=i.LengthSquared(),p=q;var t=h.GetSearchDirection();if(t.LengthSquared()<Fb.b2_epsilon*Fb.b2_epsilon)break;var u=j[h.m_count];u.indexA=d.GetSupport(lb.MulTMV(f.R,t.GetNegative())),u.wA=lb.MulX(f,d.GetVertex(u.indexA)),u.indexB=e.GetSupport(lb.MulTMV(g.R,t)),u.wB=lb.MulX(g,e.GetVertex(u.indexB)),u.w=lb.SubtractVV(u.wB,u.wA),++s,++G.b2_gjkIters;var v=!1;for(r=0;n>r;r++)if(u.indexA===l[r]&&u.indexB===m[r]){v=!0;break}if(v)break;++h.m_count}if(G.b2_gjkMaxIters=lb.Max(G.b2_gjkMaxIters,s),h.GetWitnessPoints(a.pointA,a.pointB),a.distance=lb.SubtractVV(a.pointA,a.pointB).Length(),a.iterations=s,h.WriteCache(b),c.useRadii){var w=d.m_radius,x=e.m_radius;if(a.distance>w+x&&a.distance>Fb.b2_epsilon){a.distance-=w+x;var y=lb.SubtractVV(a.pointB,a.pointA);y.Normalize(),a.pointA.x+=w*y.x,a.pointA.y+=w*y.y,a.pointB.x-=x*y.x,a.pointB.y-=x*y.y}else i=new Qb(0,0),i.x=.5*(a.pointA.x+a.pointB.x),i.y=.5*(a.pointA.y+a.pointB.y),a.pointA.x=a.pointB.x=i.x,a.pointA.y=a.pointB.y=i.y,a.distance=0}},H=Xb.Collision.b2DistanceInput=function(){},H.constructor=H,K=Xb.Collision.b2DistanceOutput=function(){this.pointA=new Qb(0,0),this.pointB=new Qb(0,0)},K.constructor=K,K.prototype.pointA=null,K.prototype.pointB=null,L=Xb.Collision.b2DistanceProxy=function(){},L.constructor=L,L.prototype.m_vertices=null,L.prototype.m_count=0,L.prototype.m_radius=0,L.prototype.Set=function(a){switch(a.GetType()){case Gb.e_circleShape:var b=a instanceof j?a:null;this.m_vertices=[!0],this.m_vertices[0]=b.m_p,this.m_count=1,this.m_radius=b.m_radius;break;case Gb.e_polygonShape:var c=a instanceof tb?a:null;this.m_vertices=c.m_vertices,this.m_count=c.m_vertexCount,this.m_radius=c.m_radius;break;default:Wb(!1)}},L.prototype.GetSupport=function(a){for(var b=0,c=this.m_vertices[0].x*a.x+this.m_vertices[0].y*a.y,d=1;d<this.m_count;++d){var e=this.m_vertices[d].x*a.x+this.m_vertices[d].y*a.y;e>c&&(b=d,c=e)}return b},L.prototype.GetSupportVertex=function(a){for(var b=0,c=this.m_vertices[0].x*a.x+this.m_vertices[0].y*a.y,d=1;d<this.m_count;++d){var e=this.m_vertices[d].x*a.x+this.m_vertices[d].y*a.y;e>c&&(b=d,c=e)}return this.m_vertices[b]},L.prototype.GetVertexCount=function(){return this.m_count},L.prototype.GetVertex=function(a){return a=a||0,Wb(a>=0&&a<this.m_count),this.m_vertices[a]},O=Xb.Collision.b2DynamicTreeNode=function(){this.aabb=new c},O.constructor=O,O.prototype.aabb=null,O.prototype.child1=null,O.prototype.IsLeaf=function(){return null==this.child1},M=Xb.Collision.b2DynamicTree=function(){this.m_root=null,this.m_freeList=null,this.m_path=0,this.m_insertionCount=0},M.constructor=M,M.prototype.m_root=null,M.prototype.m_freeList=null,M.prototype.m_path=0,M.prototype.m_insertionCount=0,M.prototype.CreateProxy=function(a,b){var c=this.AllocateNode(),d=Fb.b2_aabbExtension,e=Fb.b2_aabbExtension;return c.aabb.lowerBound.x=a.lowerBound.x-d,c.aabb.lowerBound.y=a.lowerBound.y-e,c.aabb.upperBound.x=a.upperBound.x+d,c.aabb.upperBound.y=a.upperBound.y+e,c.userData=b,this.InsertLeaf(c),c},M.prototype.DestroyProxy=function(a){this.RemoveLeaf(a),this.FreeNode(a)},M.prototype.MoveProxy=function(a,b,c){if(Wb(a.IsLeaf()),a.aabb.Contains(b))return!1;this.RemoveLeaf(a);var d=Fb.b2_aabbExtension+Fb.b2_aabbMultiplier*(c.x>0?c.x:-c.x),e=Fb.b2_aabbExtension+Fb.b2_aabbMultiplier*(c.y>0?c.y:-c.y);return a.aabb.lowerBound.x=b.lowerBound.x-d,a.aabb.lowerBound.y=b.lowerBound.y-e,a.aabb.upperBound.x=b.upperBound.x+d,a.aabb.upperBound.y=b.upperBound.y+e,this.InsertLeaf(a),!0},M.prototype.Rebalance=function(a){if(a=a||0,null!=this.m_root)for(var b=0;a>b;b++){for(var c=this.m_root,d=0;c.IsLeaf()===!1;)c=this.m_path>>d&1?c.child2:c.child1,d=d+1&31;++this.m_path,this.RemoveLeaf(c),this.InsertLeaf(c)}},M.prototype.GetFatAABB=function(a){return a.aabb},M.prototype.GetUserData=function(a){return a.userData},M.prototype.Query=function(a,b){if(null!=this.m_root){var c=[],d=0;for(c[d++]=this.m_root;d>0;){var e=c[--d];if(e.aabb.TestOverlap(b))if(e.IsLeaf()){var f=a(e);if(!f)return}else c[d++]=e.child1,c[d++]=e.child2}}},M.prototype.RayCast=function(a,b){if(null!=this.m_root){var d=b.p1,e=b.p2,f=lb.SubtractVV(d,e);f.Normalize();var g=lb.CrossFV(1,f),h=lb.AbsV(g),i=b.maxFraction,j=new c,k=0,l=0;k=d.x+i*(e.x-d.x),l=d.y+i*(e.y-d.y),j.lowerBound.x=Math.min(d.x,k),j.lowerBound.y=Math.min(d.y,l),j.upperBound.x=Math.max(d.x,k),j.upperBound.y=Math.max(d.y,l);var m=[],n=0;for(m[n++]=this.m_root;n>0;){var o=m[--n];if(o.aabb.TestOverlap(j)!==!1){var p=o.aabb.GetCenter(),q=o.aabb.GetExtents(),r=Math.abs(g.x*(d.x-p.x)+g.y*(d.y-p.y))-h.x*q.x-h.y*q.y;if(!(r>0))if(o.IsLeaf()){var s=new zb;if(s.p1=b.p1,s.p2=b.p2,s.maxFraction=b.maxFraction,i=a(s,o),0===i)return;i>0&&(k=d.x+i*(e.x-d.x),l=d.y+i*(e.y-d.y),j.lowerBound.x=Math.min(d.x,k),j.lowerBound.y=Math.min(d.y,l),j.upperBound.x=Math.max(d.x,k),j.upperBound.y=Math.max(d.y,l))}else m[n++]=o.child1,m[n++]=o.child2}}}},M.prototype.AllocateNode=function(){if(this.m_freeList){var a=this.m_freeList;return this.m_freeList=a.parent,a.parent=null,a.child1=null,a.child2=null,a}return new O},M.prototype.FreeNode=function(a){a.parent=this.m_freeList,this.m_freeList=a},M.prototype.InsertLeaf=function(a){if(++this.m_insertionCount,null==this.m_root)return this.m_root=a,void(this.m_root.parent=null);var b=a.aabb.GetCenter(),c=this.m_root;if(c.IsLeaf()===!1)do{var d=c.child1,e=c.child2,f=Math.abs((d.aabb.lowerBound.x+d.aabb.upperBound.x)/2-b.x)+Math.abs((d.aabb.lowerBound.y+d.aabb.upperBound.y)/2-b.y),g=Math.abs((e.aabb.lowerBound.x+e.aabb.upperBound.x)/2-b.x)+Math.abs((e.aabb.lowerBound.y+e.aabb.upperBound.y)/2-b.y);c=g>f?d:e}while(c.IsLeaf()===!1);var h=c.parent,i=this.AllocateNode();if(i.parent=h,i.userData=null,i.aabb.Combine(a.aabb,c.aabb),h){c.parent.child1===c?h.child1=i:h.child2=i,i.child1=c,i.child2=a,c.parent=i,a.parent=i;do{if(h.aabb.Contains(i.aabb))break;h.aabb.Combine(h.child1.aabb,h.child2.aabb),i=h,h=h.parent}while(h)}else i.child1=c,i.child2=a,c.parent=i,a.parent=i,this.m_root=i},M.prototype.RemoveLeaf=function(a){if(a===this.m_root)return void(this.m_root=null);var b,d=a.parent,e=d.parent;if(b=d.child1===a?d.child2:d.child1,e)for(e.child1===d?e.child1=b:e.child2=b,b.parent=e,this.FreeNode(d);e;){var f=e.aabb;if(e.aabb=c.Combine(e.child1.aabb,e.child2.aabb),f.Contains(e.aabb))break;e=e.parent}else this.m_root=b,b.parent=null,this.FreeNode(d)},P=Xb.Collision.b2DynamicTreePair=function(){},P.constructor=P,N=Xb.Collision.b2DynamicTreeBroadPhase=function(){this.m_tree=new M,this.m_moveBuffer=[],this.m_pairBuffer=[],this.m_pairCount=0},N.constructor=N,N.prototype.m_tree=null,N.prototype.m_moveBuffer=null,N.prototype.m_pairBuffer=null,N.prototype.m_pairCount=null,N.prototype.CreateProxy=function(a,b){var c=this.m_tree.CreateProxy(a,b);return++this.m_proxyCount,this.BufferMove(c),c},N.prototype.DestroyProxy=function(a){this.UnBufferMove(a),--this.m_proxyCount,this.m_tree.DestroyProxy(a)},N.prototype.MoveProxy=function(a,b,c){var d=this.m_tree.MoveProxy(a,b,c);d&&this.BufferMove(a)},N.prototype.TestOverlap=function(a,b){var c=this.m_tree.GetFatAABB(a),d=this.m_tree.GetFatAABB(b);return c.TestOverlap(d)},N.prototype.GetUserData=function(a){return this.m_tree.GetUserData(a)},N.prototype.GetFatAABB=function(a){return this.m_tree.GetFatAABB(a)},N.prototype.GetProxyCount=function(){return this.m_proxyCount},N.prototype.UpdatePairs=function(a){function b(a){if(a===d)return!0;c.m_pairCount===c.m_pairBuffer.length&&(c.m_pairBuffer[c.m_pairCount]=new P);var b=c.m_pairBuffer[c.m_pairCount];return b.proxyA=d>a?a:d,b.proxyB=a>=d?a:d,++c.m_pairCount,!0}var c=this;c.m_pairCount=0;var d,e=0;for(e=0;e<c.m_moveBuffer.length;++e){d=c.m_moveBuffer[e];var f=c.m_tree.GetFatAABB(d);c.m_tree.Query(b,f)}c.m_moveBuffer.length=0;for(var e=0;e<c.m_pairCount;){var g=c.m_pairBuffer[e],h=c.m_tree.GetUserData(g.proxyA),i=c.m_tree.GetUserData(g.proxyB);for(a(h,i),++e;e<c.m_pairCount;){var j=c.m_pairBuffer[e];if(j.proxyA!==g.proxyA||j.proxyB!==g.proxyB)break;++e}}},N.prototype.Query=function(a,b){this.m_tree.Query(a,b)},N.prototype.RayCast=function(a,b){this.m_tree.RayCast(a,b)},N.prototype.Validate=function(){},N.prototype.Rebalance=function(a){a=a||0,this.m_tree.Rebalance(a)},N.prototype.BufferMove=function(a){this.m_moveBuffer[this.m_moveBuffer.length]=a},N.prototype.UnBufferMove=function(a){var b=this.m_moveBuffer.indexOf(a);this.m_moveBuffer.splice(b,1)},N.prototype.ComparePairs=function(){return 0},pb=Xb.Collision.b2Point=function(){this.p=new Qb(0,0)},pb.constructor=pb,pb.prototype.p=null,pb.prototype.Support=function(){return this.p},pb.prototype.GetFirstVertex=function(){return this.p},zb=Xb.Collision.b2RayCastInput=function(a,b,c){this.p1=new Qb(0,0),this.p2=new Qb(0,0),a=a||null,b=b||null,c=c||1,a&&this.p1.SetV(a),b&&this.p2.SetV(b),this.maxFraction=c},zb.constructor=zb,zb.prototype.p1=null,zb.prototype.p2=null,zb.prototype.maxFraction=1,Ab=Xb.Collision.b2RayCastOutput=function(){this.normal=new Qb(0,0)},Ab.constructor=Ab,Ab.prototype.normal=null,Db=Xb.Collision.b2Segment=function(){this.p1=new Qb(0,0),this.p2=new Qb(0,0)},Db.constructor=Db,Db.prototype.p1=null,Db.prototype.p2=null,Db.prototype.TestSegment=function(a,b,c,d){d=d||0;var e=c.p1,f=c.p2.x-e.x,g=c.p2.y-e.y,h=this.p2.x-this.p1.x,i=this.p2.y-this.p1.y,j=i,k=-h,l=100*Fb.b2_epsilon,m=-(f*j+g*k);if(m>l){var n=e.x-this.p1.x,o=e.y-this.p1.y,p=n*j+o*k;if(p>=0&&d*m>=p){var q=-f*o+g*n;if(q>=-l*m&&m*(1+l)>=q){p/=m;var r=Math.sqrt(j*j+k*k);return j/=r,k/=r,a[0]=p,b.Set(j,k),!0}}}return!1},Db.prototype.Extend=function(a){this.ExtendForward(a),this.ExtendBackward(a)},Db.prototype.ExtendForward=function(a){var b=this.p2.x-this.p1.x,c=this.p2.y-this.p1.y,d=Math.min(b>0?(a.upperBound.x-this.p1.x)/b:0>b?(a.lowerBound.x-this.p1.x)/b:Number.POSITIVE_INFINITY,c>0?(a.upperBound.y-this.p1.y)/c:0>c?(a.lowerBound.y-this.p1.y)/c:Number.POSITIVE_INFINITY);this.p2.x=this.p1.x+b*d,this.p2.y=this.p1.y+c*d},Db.prototype.ExtendBackward=function(a){var b=-this.p2.x+this.p1.x,c=-this.p2.y+this.p1.y,d=Math.min(b>0?(a.upperBound.x-this.p2.x)/b:0>b?(a.lowerBound.x-this.p2.x)/b:Number.POSITIVE_INFINITY,c>0?(a.upperBound.y-this.p2.y)/c:0>c?(a.lowerBound.y-this.p2.y)/c:Number.POSITIVE_INFINITY);this.p1.x=this.p2.x+b*d,this.p1.y=this.p2.y+c*d},Eb=Xb.Collision.b2SeparationFunction=function(){this.m_localPoint=new Qb(0,0),this.m_axis=new Qb(0,0)},Eb.constructor=Eb,Eb.e_points=1,Eb.e_faceA=2,Eb.e_faceB=4,Eb.prototype.m_localPoint=null,Eb.prototype.m_axis=null,Eb.prototype.m_proxyA=null,Eb.prototype.m_proxyB=null,Eb.prototype.Initialize=function(a,b,c,d,e){this.m_proxyA=b,this.m_proxyB=d;var f=a.count;Wb(f>0&&3>f);var g,h,i,j,k,l,m,n,o=0,p=0,q=0,r=0,s=0,t=0,u=0,v=0;if(1===f)this.m_type=Eb.e_points,g=this.m_proxyA.GetVertex(a.indexA[0]),j=this.m_proxyB.GetVertex(a.indexB[0]),n=g,m=c.R,o=c.position.x+(m.col1.x*n.x+m.col2.x*n.y),p=c.position.y+(m.col1.y*n.x+m.col2.y*n.y),n=j,m=e.R,q=e.position.x+(m.col1.x*n.x+m.col2.x*n.y),r=e.position.y+(m.col1.y*n.x+m.col2.y*n.y),this.m_axis.x=q-o,this.m_axis.y=r-p,this.m_axis.Normalize();else if(a.indexB[0]===a.indexB[1])this.m_type=Eb.e_faceA,h=this.m_proxyA.GetVertex(a.indexA[0]),i=this.m_proxyA.GetVertex(a.indexA[1]),j=this.m_proxyB.GetVertex(a.indexB[0]),this.m_localPoint.x=.5*(h.x+i.x),this.m_localPoint.y=.5*(h.y+i.y),this.m_axis=lb.CrossVF(lb.SubtractVV(i,h),1),this.m_axis.Normalize(),n=this.m_axis,m=c.R,s=m.col1.x*n.x+m.col2.x*n.y,t=m.col1.y*n.x+m.col2.y*n.y,n=this.m_localPoint,m=c.R,o=c.position.x+(m.col1.x*n.x+m.col2.x*n.y),p=c.position.y+(m.col1.y*n.x+m.col2.y*n.y),n=j,m=e.R,q=e.position.x+(m.col1.x*n.x+m.col2.x*n.y),r=e.position.y+(m.col1.y*n.x+m.col2.y*n.y),u=(q-o)*s+(r-p)*t,0>u&&this.m_axis.NegativeSelf();else if(a.indexA[0]===a.indexA[0])this.m_type=Eb.e_faceB,k=this.m_proxyB.GetVertex(a.indexB[0]),l=this.m_proxyB.GetVertex(a.indexB[1]),g=this.m_proxyA.GetVertex(a.indexA[0]),this.m_localPoint.x=.5*(k.x+l.x),this.m_localPoint.y=.5*(k.y+l.y),this.m_axis=lb.CrossVF(lb.SubtractVV(l,k),1),this.m_axis.Normalize(),n=this.m_axis,m=e.R,s=m.col1.x*n.x+m.col2.x*n.y,t=m.col1.y*n.x+m.col2.y*n.y,n=this.m_localPoint,m=e.R,q=e.position.x+(m.col1.x*n.x+m.col2.x*n.y),r=e.position.y+(m.col1.y*n.x+m.col2.y*n.y),n=g,m=c.R,o=c.position.x+(m.col1.x*n.x+m.col2.x*n.y),p=c.position.y+(m.col1.y*n.x+m.col2.y*n.y),u=(o-q)*s+(p-r)*t,0>u&&this.m_axis.NegativeSelf();else{h=this.m_proxyA.GetVertex(a.indexA[0]),i=this.m_proxyA.GetVertex(a.indexA[1]),k=this.m_proxyB.GetVertex(a.indexB[0]),l=this.m_proxyB.GetVertex(a.indexB[1]);var w=(lb.MulX(c,g),lb.MulMV(c.R,lb.SubtractVV(i,h))),x=(lb.MulX(e,j),lb.MulMV(e.R,lb.SubtractVV(l,k))),y=w.x*w.x+w.y*w.y,z=x.x*x.x+x.y*x.y,A=lb.SubtractVV(x,w),B=w.x*A.x+w.y*A.y,C=x.x*A.x+x.y*A.y,D=w.x*x.x+w.y*x.y,E=y*z-D*D;u=0,0!==E&&(u=lb.Clamp((D*C-B*z)/E,0,1));var F=(D*u+C)/z;0>F&&(F=0,u=lb.Clamp((D-B)/y,0,1)),g=new Qb(0,0),g.x=h.x+u*(i.x-h.x),g.y=h.y+u*(i.y-h.y),j=new Qb(0,0),j.x=k.x+u*(l.x-k.x),j.y=k.y+u*(l.y-k.y),0===u||1===u?(this.m_type=Eb.e_faceB,this.m_axis=lb.CrossVF(lb.SubtractVV(l,k),1),this.m_axis.Normalize(),this.m_localPoint=j,n=this.m_axis,m=e.R,s=m.col1.x*n.x+m.col2.x*n.y,t=m.col1.y*n.x+m.col2.y*n.y,n=this.m_localPoint,m=e.R,q=e.position.x+(m.col1.x*n.x+m.col2.x*n.y),r=e.position.y+(m.col1.y*n.x+m.col2.y*n.y),n=g,m=c.R,o=c.position.x+(m.col1.x*n.x+m.col2.x*n.y),p=c.position.y+(m.col1.y*n.x+m.col2.y*n.y),v=(o-q)*s+(p-r)*t,0>u&&this.m_axis.NegativeSelf()):(this.m_type=Eb.e_faceA,this.m_axis=lb.CrossVF(lb.SubtractVV(i,h),1),this.m_localPoint=g,n=this.m_axis,m=c.R,s=m.col1.x*n.x+m.col2.x*n.y,t=m.col1.y*n.x+m.col2.y*n.y,n=this.m_localPoint,m=c.R,o=c.position.x+(m.col1.x*n.x+m.col2.x*n.y),p=c.position.y+(m.col1.y*n.x+m.col2.y*n.y),n=j,m=e.R,q=e.position.x+(m.col1.x*n.x+m.col2.x*n.y),r=e.position.y+(m.col1.y*n.x+m.col2.y*n.y),v=(q-o)*s+(r-p)*t,0>u&&this.m_axis.NegativeSelf())}},Eb.prototype.Evaluate=function(a,b){var c,d,e,f,g,h,i,j=0;switch(this.m_type){case Eb.e_points:return c=lb.MulTMV(a.R,this.m_axis),d=lb.MulTMV(b.R,this.m_axis.GetNegative()),e=this.m_proxyA.GetSupportVertex(c),f=this.m_proxyB.GetSupportVertex(d),g=lb.MulX(a,e),h=lb.MulX(b,f),j=(h.x-g.x)*this.m_axis.x+(h.y-g.y)*this.m_axis.y;case Eb.e_faceA:return i=lb.MulMV(a.R,this.m_axis),g=lb.MulX(a,this.m_localPoint),d=lb.MulTMV(b.R,i.GetNegative()),f=this.m_proxyB.GetSupportVertex(d),h=lb.MulX(b,f),j=(h.x-g.x)*i.x+(h.y-g.y)*i.y;case Eb.e_faceB:return i=lb.MulMV(b.R,this.m_axis),h=lb.MulX(b,this.m_localPoint),c=lb.MulTMV(a.R,i.GetNegative()),e=this.m_proxyA.GetSupportVertex(c),g=lb.MulX(a,e),j=(g.x-h.x)*i.x+(g.y-h.y)*i.y;default:return Wb(!1),0}},Nb=Xb.Collision.b2TimeOfImpact=function(){},Nb.constructor=Nb,Nb.b2_toiCalls=0,Nb.b2_toiIters=0,Nb.b2_toiMaxIters=0,Nb.b2_toiRootIters=0,Nb.b2_toiMaxRootIters=0,Nb.s_cache=new Ib,Nb.s_distanceInput=new H,Nb.s_xfA=new Pb,Nb.s_xfB=new Pb,Nb.s_fcn=new Eb,Nb.s_distanceOutput=new K,Nb.TimeOfImpact=function(a){++Nb.b2_toiCalls;var b=a.proxyA,c=a.proxyB,d=a.sweepA,e=a.sweepB;Wb(d.t0===e.t0),Wb(1-d.t0>Fb.b2_epsilon);var f=b.m_radius+c.m_radius,g=a.tolerance,h=0,i=1e3,j=0,k=0;for(Nb.s_cache.count=0,Nb.s_distanceInput.useRadii=!1;;){if(d.GetTransform(Nb.s_xfA,h),e.GetTransform(Nb.s_xfB,h),Nb.s_distanceInput.proxyA=b,Nb.s_distanceInput.proxyB=c,Nb.s_distanceInput.transformA=Nb.s_xfA,Nb.s_distanceInput.transformB=Nb.s_xfB,G.Distance(Nb.s_distanceOutput,Nb.s_cache,Nb.s_distanceInput),Nb.s_distanceOutput.distance<=0){h=1;break}Nb.s_fcn.Initialize(Nb.s_cache,b,Nb.s_xfA,c,Nb.s_xfB);var l=Nb.s_fcn.Evaluate(Nb.s_xfA,Nb.s_xfB);if(0>=l){h=1;break}if(0===j&&(k=l>f?lb.Max(f-g,.75*f):lb.Max(l-g,.02*f)),.5*g>l-k){if(0===j){h=1;break}break}var m=h,n=h,o=1,p=l;d.GetTransform(Nb.s_xfA,o),e.GetTransform(Nb.s_xfB,o);var q=Nb.s_fcn.Evaluate(Nb.s_xfA,Nb.s_xfB);if(q>=k){h=1;break}for(var r=0;;){var s=0;s=1&r?n+(k-p)*(o-n)/(q-p):.5*(n+o),d.GetTransform(Nb.s_xfA,s),e.GetTransform(Nb.s_xfB,s);var t=Nb.s_fcn.Evaluate(Nb.s_xfA,Nb.s_xfB);if(lb.Abs(t-k)<.025*g){m=s;break}if(t>k?(n=s,p=t):(o=s,q=t),++r,++Nb.b2_toiRootIters,50===r)break}if(Nb.b2_toiMaxRootIters=lb.Max(Nb.b2_toiMaxRootIters,r),m<(1+100*Fb.b2_epsilon)*h)break;if(h=m,j++,++Nb.b2_toiIters,j===i)break}return Nb.b2_toiMaxIters=lb.Max(Nb.b2_toiMaxIters,j),h},Lb=Xb.Collision.b2TOIInput=function(){this.proxyA=new L,this.proxyB=new L,this.sweepA=new Kb,this.sweepB=new Kb},Lb.constructor=Lb,Lb.prototype.proxyA=null,Lb.prototype.proxyB=null,Lb.prototype.sweepA=null,Lb.prototype.sweepB=null,Vb=Xb.Collision.b2WorldManifold=function(){this.m_normal=new Qb(0,0),this.m_points=[];for(var a=0;a<Fb.b2_maxManifoldPoints;a++)this.m_points.push(new Qb(0,0))},Vb.constructor=Vb,Vb.prototype.m_normal=null,Vb.prototype.m_points=null,Vb.prototype.Initialize=function(a,b,c,d,e){if(c=c||0,e=e||0,0!==a.m_pointCount){var f,g,h=0,i=0,j=0,k=0,l=0,m=0,n=0;switch(a.m_type){case gb.e_circles:g=b.R,f=a.m_localPoint;var o=b.position.x+g.col1.x*f.x+g.col2.x*f.y,p=b.position.y+g.col1.y*f.x+g.col2.y*f.y;g=d.R,f=a.m_points[0].m_localPoint;var q=d.position.x+g.col1.x*f.x+g.col2.x*f.y,r=d.position.y+g.col1.y*f.x+g.col2.y*f.y,s=q-o,t=r-p,u=s*s+t*t;if(u>Fb.b2_epsilon*Fb.b2_epsilon){var v=Math.sqrt(u);this.m_normal.x=s/v,this.m_normal.y=t/v}else this.m_normal.x=1,this.m_normal.y=0;var w=o+c*this.m_normal.x,x=p+c*this.m_normal.y,y=q-e*this.m_normal.x,z=r-e*this.m_normal.y;this.m_points[0].x=.5*(w+y),this.m_points[0].y=.5*(x+z);break;case gb.e_faceA:for(g=b.R,f=a.m_localPlaneNormal,i=g.col1.x*f.x+g.col2.x*f.y,j=g.col1.y*f.x+g.col2.y*f.y,g=b.R,f=a.m_localPoint,k=b.position.x+g.col1.x*f.x+g.col2.x*f.y,l=b.position.y+g.col1.y*f.x+g.col2.y*f.y,this.m_normal.x=i,this.m_normal.y=j,h=0;h<a.m_pointCount;h++)g=d.R,f=a.m_points[h].m_localPoint,m=d.position.x+g.col1.x*f.x+g.col2.x*f.y,n=d.position.y+g.col1.y*f.x+g.col2.y*f.y,this.m_points[h].x=m+.5*(c-(m-k)*i-(n-l)*j-e)*i,this.m_points[h].y=n+.5*(c-(m-k)*i-(n-l)*j-e)*j;break;case gb.e_faceB:for(g=d.R,f=a.m_localPlaneNormal,i=g.col1.x*f.x+g.col2.x*f.y,j=g.col1.y*f.x+g.col2.y*f.y,g=d.R,f=a.m_localPoint,k=d.position.x+g.col1.x*f.x+g.col2.x*f.y,l=d.position.y+g.col1.y*f.x+g.col2.y*f.y,this.m_normal.x=-i,this.m_normal.y=-j,h=0;h<a.m_pointCount;h++)g=b.R,f=a.m_points[h].m_localPoint,m=b.position.x+g.col1.x*f.x+g.col2.x*f.y,n=b.position.y+g.col1.y*f.x+g.col2.y*f.y,this.m_points[h].x=m+.5*(e-(m-k)*i-(n-l)*j-c)*i,this.m_points[h].y=n+.5*(e-(m-k)*i-(n-l)*j-c)*j}}},T=Xb.Dynamics.b2FilterData=function(){},T.constructor=T,T.prototype={categoryBits:1,maskBits:65535,groupIndex:0,Copy:function(){var a=new T;return a.categoryBits=this.categoryBits,a.maskBits=this.maskBits,a.groupIndex=this.groupIndex,a}},Ob=Xb.Dynamics.b2TimeStep=function(){},Ob.constructor=Ob,Ob.prototype={dt:0,inv_dt:0,positionIterations:0,velocityIterations:0,warmStarting:0,Set:function(a){this.dt=a.dt,this.inv_dt=a.inv_dt,this.positionIterations=a.positionIterations,this.velocityIterations=a.velocityIterations,this.warmStarting=a.warmStarting}},z=Xb.Dynamics.Contacts.b2ContactRegister=function(){},z.constructor=z,A=Xb.Dynamics.Contacts.b2ContactResult=function(){this.position=new Qb(0,0),this.normal=new Qb(0,0),this.id=new u},A.constructor=A,A.prototype.position=null,A.prototype.normal=null,A.prototype.id=null,r=Xb.Dynamics.Contacts.b2ContactEdge=function(){},r.constructor=r,q=Xb.Dynamics.Contacts.b2ContactConstraintPoint=function(){this.localPoint=new Qb(0,0),this.rA=new Qb(0,0),this.rB=new Qb(0,0)},q.constructor=q,q.prototype.localPoint=null,q.prototype.rA=null,q.prototype.rB=null,p=Xb.Dynamics.Contacts.b2ContactConstraint=function(){this.localPlaneNormal=new Qb(0,0),this.localPoint=new Qb(0,0),this.normal=new Qb(0,0),this.normalMass=new jb,this.K=new jb,this.points=[];for(var a=0;a<Fb.b2_maxManifoldPoints;a++)this.points.push(new q)},p.constructor=p,p.prototype.localPlaneNormal=null,p.prototype.localPoint=null,p.prototype.normal=null,p.prototype.normalMass=null,p.prototype.K=null,p.prototype.points=null,o=Xb.Dynamics.Contacts.b2Contact=function(){this.m_nodeA=new r,this.m_nodeB=new r,this.m_manifold=new gb,this.m_oldManifold=new gb},o.constructor=o,o.e_sensorFlag=1,o.e_continuousFlag=2,o.e_islandFlag=4,o.e_toiFlag=8,o.e_touchingFlag=16,o.e_enabledFlag=32,o.e_filterFlag=64,o.s_input=new Lb,o.prototype.m_flags=0,o.prototype.m_next=null,o.prototype.m_prev=null,o.prototype.m_nodeA=null,o.prototype.m_nodeB=null,o.prototype.m_manifold=null,o.prototype.m_oldManifold=null,o.prototype.m_fixtureA=null,o.prototype.m_fixtureB=null,o.prototype.m_touching=!1,o.prototype.GetManifold=function(){return this.m_manifold},o.prototype.GetWorldManifold=function(a){var b=this.m_fixtureA.GetBody(),c=this.m_fixtureB.GetBody(),d=this.m_fixtureA.GetShape(),e=this.m_fixtureB.GetShape();a.Initialize(this.m_manifold,b.GetTransform(),d.m_radius,c.GetTransform(),e.m_radius)},o.prototype.IsTouching=function(){return(this.m_flags&o.e_touchingFlag)===o.e_touchingFlag},o.prototype.IsContinuous=function(){return(this.m_flags&o.e_continuousFlag)===o.e_continuousFlag
},o.prototype.SetSensor=function(a){a?this.m_flags|=o.e_sensorFlag:this.m_flags&=~o.e_sensorFlag},o.prototype.IsSensor=function(){return(this.m_flags&o.e_sensorFlag)===o.e_sensorFlag},o.prototype.SetEnabled=function(a){a?this.m_flags|=o.e_enabledFlag:this.m_flags&=~o.e_enabledFlag},o.prototype.IsEnabled=function(){return(this.m_flags&o.e_enabledFlag)===o.e_enabledFlag},o.prototype.GetNext=function(){return this.m_next},o.prototype.GetFixtureA=function(){return this.m_fixtureA},o.prototype.GetFixtureB=function(){return this.m_fixtureB},o.prototype.FlagForFiltering=function(){this.m_flags|=o.e_filterFlag},o.prototype.Reset=function(a,b){if(a=a||null,b=b||null,this.m_flags=o.e_enabledFlag,!a||!b)return this.m_fixtureA=null,void(this.m_fixtureB=null);(a.IsSensor()||b.IsSensor())&&(this.m_flags|=o.e_sensorFlag);var c=a.GetBody(),e=b.GetBody();(c.GetType()!==d.b2_dynamicBody||c.IsBullet()||e.GetType()!==d.b2_dynamicBody||e.IsBullet())&&(this.m_flags|=o.e_continuousFlag),this.m_fixtureA=a,this.m_fixtureB=b,this.m_manifold.m_pointCount=0,this.m_prev=null,this.m_next=null,this.m_nodeA.contact=null,this.m_nodeA.prev=null,this.m_nodeA.next=null,this.m_nodeA.other=null,this.m_nodeB.contact=null,this.m_nodeB.prev=null,this.m_nodeB.next=null,this.m_nodeB.other=null},o.prototype.Update=function(a){var b=this.m_oldManifold;this.m_oldManifold=this.m_manifold,this.m_manifold=b,this.m_flags|=o.e_enabledFlag;var c=!1,e=(this.m_flags&o.e_touchingFlag)===o.e_touchingFlag,f=this.m_fixtureA.m_body,g=this.m_fixtureB.m_body,h=this.m_fixtureA.m_aabb.TestOverlap(this.m_fixtureB.m_aabb);if(this.m_flags&o.e_sensorFlag){if(h){var i=this.m_fixtureA.GetShape(),j=this.m_fixtureB.GetShape(),k=f.GetTransform(),l=g.GetTransform();c=Gb.TestOverlap(i,k,j,l)}this.m_manifold.m_pointCount=0}else{if(f.GetType()!==d.b2_dynamicBody||f.IsBullet()||g.GetType()!==d.b2_dynamicBody||g.IsBullet()?this.m_flags|=o.e_continuousFlag:this.m_flags&=~o.e_continuousFlag,h){this.Evaluate(),c=this.m_manifold.m_pointCount>0;for(var m=0;m<this.m_manifold.m_pointCount;++m){var n=this.m_manifold.m_points[m];n.m_normalImpulse=0,n.m_tangentImpulse=0;for(var p=n.m_id,q=0;q<this.m_oldManifold.m_pointCount;++q){var r=this.m_oldManifold.m_points[q];if(r.m_id.key===p.key){n.m_normalImpulse=r.m_normalImpulse,n.m_tangentImpulse=r.m_tangentImpulse;break}}}}else this.m_manifold.m_pointCount=0;c!==e&&(f.SetAwake(!0),g.SetAwake(!0))}c?this.m_flags|=o.e_touchingFlag:this.m_flags&=~o.e_touchingFlag,e===!1&&c===!0&&a.BeginContact(this),e===!0&&c===!1&&a.EndContact(this),0===(this.m_flags&o.e_sensorFlag)&&a.PreSolve(this,this.m_oldManifold)},o.prototype.Evaluate=function(){},o.prototype.ComputeTOI=function(a,b){return o.s_input.proxyA.Set(this.m_fixtureA.GetShape()),o.s_input.proxyB.Set(this.m_fixtureB.GetShape()),o.s_input.sweepA=a,o.s_input.sweepB=b,o.s_input.tolerance=Fb.b2_linearSlop,Nb.TimeOfImpact(o.s_input)},i=Xb.Dynamics.Contacts.b2CircleContact=function(){o.apply(this,arguments)},i.constructor=i,i.prototype=Object.create(o.prototype),i.Create=function(){return new i},i.Destroy=function(){},i.prototype.Reset=function(a,b){o.prototype.Reset.call(this,a,b)},i.prototype.Evaluate=function(){var a=this.m_fixtureA.GetBody(),b=this.m_fixtureB.GetBody();k.CollideCircles(this.m_manifold,this.m_fixtureA.GetShape()instanceof j?this.m_fixtureA.GetShape():null,a.m_xf,this.m_fixtureB.GetShape()instanceof j?this.m_fixtureB.GetShape():null,b.m_xf)},i.prototype.GetManifold=function(){return this.m_manifold},i.prototype.GetWorldManifold=function(a){var b=this.m_fixtureA.GetBody(),c=this.m_fixtureB.GetBody(),d=this.m_fixtureA.GetShape(),e=this.m_fixtureB.GetShape();a.Initialize(this.m_manifold,b.GetTransform(),d.m_radius,c.GetTransform(),e.m_radius)},i.prototype.IsTouching=function(){return(this.m_flags&o.e_touchingFlag)===o.e_touchingFlag},i.prototype.IsContinuous=function(){return(this.m_flags&o.e_continuousFlag)===o.e_continuousFlag},i.prototype.SetSensor=function(a){a?this.m_flags|=o.e_sensorFlag:this.m_flags&=~o.e_sensorFlag},i.prototype.IsSensor=function(){return(this.m_flags&o.e_sensorFlag)===o.e_sensorFlag},i.prototype.SetEnabled=function(a){a?this.m_flags|=o.e_enabledFlag:this.m_flags&=~o.e_enabledFlag},i.prototype.IsEnabled=function(){return(this.m_flags&o.e_enabledFlag)===o.e_enabledFlag},i.prototype.GetNext=function(){return this.m_next},i.prototype.GetFixtureA=function(){return this.m_fixtureA},i.prototype.GetFixtureB=function(){return this.m_fixtureB},i.prototype.FlagForFiltering=function(){this.m_flags|=o.e_filterFlag},i.prototype.b2Contact=function(){},i.prototype.Update=function(a){var b=this.m_oldManifold;this.m_oldManifold=this.m_manifold,this.m_manifold=b,this.m_flags|=o.e_enabledFlag;var c=!1,e=(this.m_flags&o.e_touchingFlag)===o.e_touchingFlag,f=this.m_fixtureA.m_body,g=this.m_fixtureB.m_body,h=this.m_fixtureA.m_aabb.TestOverlap(this.m_fixtureB.m_aabb);if(this.m_flags&o.e_sensorFlag){if(h){var i=this.m_fixtureA.GetShape(),j=this.m_fixtureB.GetShape(),k=f.GetTransform(),l=g.GetTransform();c=Gb.TestOverlap(i,k,j,l)}this.m_manifold.m_pointCount=0}else{if(f.GetType()!==d.b2_dynamicBody||f.IsBullet()||g.GetType()!==d.b2_dynamicBody||g.IsBullet()?this.m_flags|=o.e_continuousFlag:this.m_flags&=~o.e_continuousFlag,h){this.Evaluate(),c=this.m_manifold.m_pointCount>0;for(var m=0;m<this.m_manifold.m_pointCount;++m){var n=this.m_manifold.m_points[m];n.m_normalImpulse=0,n.m_tangentImpulse=0;for(var p=n.m_id,q=0;q<this.m_oldManifold.m_pointCount;++q){var r=this.m_oldManifold.m_points[q];if(r.m_id.key===p.key){n.m_normalImpulse=r.m_normalImpulse,n.m_tangentImpulse=r.m_tangentImpulse;break}}}}else this.m_manifold.m_pointCount=0;c!==e&&(f.SetAwake(!0),g.SetAwake(!0))}c?this.m_flags|=o.e_touchingFlag:this.m_flags&=~o.e_touchingFlag,e===!1&&c===!0&&a.BeginContact(this),e===!0&&c===!1&&a.EndContact(this),0===(this.m_flags&o.e_sensorFlag)&&a.PreSolve(this,this.m_oldManifold)},i.prototype.ComputeTOI=function(a,b){return o.s_input.proxyA.Set(this.m_fixtureA.GetShape()),o.s_input.proxyB.Set(this.m_fixtureB.GetShape()),o.s_input.sweepA=a,o.s_input.sweepB=b,o.s_input.tolerance=Fb.b2_linearSlop,Nb.TimeOfImpact(o.s_input)},ub=Xb.Dynamics.Contacts.b2PositionSolverManifold=function(){this.m_normal=new Qb(0,0),this.m_separations=[];for(var a=Fb.b2_maxManifoldPoints;a;)this.m_separations.push(0),a--;for(this.m_points=[],a=0;a<Fb.b2_maxManifoldPoints;a++)this.m_points.push(new Qb(0,0))},ub.constructor=ub,ub.circlePointA=new Qb(0,0),ub.circlePointB=new Qb(0,0),ub.prototype.m_normal=null,ub.prototype.m_separations=null,ub.prototype.m_points=null,ub.prototype.Initialize=function(a){Wb(a.pointCount>0);var b,c,d=0,e=0,f=0,g=0,h=0;switch(a.type){case gb.e_circles:b=a.bodyA.m_xf.R,c=a.localPoint;var i=a.bodyA.m_xf.position.x+(b.col1.x*c.x+b.col2.x*c.y),j=a.bodyA.m_xf.position.y+(b.col1.y*c.x+b.col2.y*c.y);b=a.bodyB.m_xf.R,c=a.points[0].localPoint;var k=a.bodyB.m_xf.position.x+(b.col1.x*c.x+b.col2.x*c.y),l=a.bodyB.m_xf.position.y+(b.col1.y*c.x+b.col2.y*c.y),m=k-i,n=l-j,o=m*m+n*n;if(o>Fb.b2_epsilon*Fb.b2_epsilon){var p=Math.sqrt(o);this.m_normal.x=m/p,this.m_normal.y=n/p}else this.m_normal.x=1,this.m_normal.y=0;this.m_points[0].x=.5*(i+k),this.m_points[0].y=.5*(j+l),this.m_separations[0]=m*this.m_normal.x+n*this.m_normal.y-a.radius;break;case gb.e_faceA:for(b=a.bodyA.m_xf.R,c=a.localPlaneNormal,this.m_normal.x=b.col1.x*c.x+b.col2.x*c.y,this.m_normal.y=b.col1.y*c.x+b.col2.y*c.y,b=a.bodyA.m_xf.R,c=a.localPoint,g=a.bodyA.m_xf.position.x+(b.col1.x*c.x+b.col2.x*c.y),h=a.bodyA.m_xf.position.y+(b.col1.y*c.x+b.col2.y*c.y),b=a.bodyB.m_xf.R,d=0;d<a.pointCount;++d)c=a.points[d].localPoint,e=a.bodyB.m_xf.position.x+(b.col1.x*c.x+b.col2.x*c.y),f=a.bodyB.m_xf.position.y+(b.col1.y*c.x+b.col2.y*c.y),this.m_separations[d]=(e-g)*this.m_normal.x+(f-h)*this.m_normal.y-a.radius,this.m_points[d].x=e,this.m_points[d].y=f;break;case gb.e_faceB:for(b=a.bodyB.m_xf.R,c=a.localPlaneNormal,this.m_normal.x=b.col1.x*c.x+b.col2.x*c.y,this.m_normal.y=b.col1.y*c.x+b.col2.y*c.y,b=a.bodyB.m_xf.R,c=a.localPoint,g=a.bodyB.m_xf.position.x+(b.col1.x*c.x+b.col2.x*c.y),h=a.bodyB.m_xf.position.y+(b.col1.y*c.x+b.col2.y*c.y),b=a.bodyA.m_xf.R,d=0;d<a.pointCount;++d)c=a.points[d].localPoint,e=a.bodyA.m_xf.position.x+(b.col1.x*c.x+b.col2.x*c.y),f=a.bodyA.m_xf.position.y+(b.col1.y*c.x+b.col2.y*c.y),this.m_separations[d]=(e-g)*this.m_normal.x+(f-h)*this.m_normal.y-a.radius,this.m_points[d].Set(e,f);this.m_normal.x*=-1,this.m_normal.y*=-1}},B=Xb.Dynamics.Contacts.b2ContactSolver=function(){this.m_step=new Ob,this.m_constraints=[]},B.constructor=B,B.prototype.m_step=null,B.prototype.m_constraints=null,B.prototype.m_allocator=null,B.prototype.m_constraintCount=0,B.s_worldManifold=new Vb,B.s_psm=new ub,B.prototype.Initialize=function(a,b,c,d){c=c||0;var e;this.m_step.Set(a),this.m_allocator=d;var f=0;for(this.m_constraintCount=c;this.m_constraints.length<this.m_constraintCount;)this.m_constraints[this.m_constraints.length]=new p;for(f=0;c>f;++f){e=b[f];var g=e.m_fixtureA,h=e.m_fixtureB,i=g.m_shape,j=h.m_shape,k=i.m_radius,l=j.m_radius,m=g.m_body,n=h.m_body,o=e.GetManifold(),q=Fb.b2MixFriction(g.GetFriction(),h.GetFriction()),r=Fb.b2MixRestitution(g.GetRestitution(),h.GetRestitution()),s=m.m_linearVelocity.x,t=m.m_linearVelocity.y,u=n.m_linearVelocity.x,v=n.m_linearVelocity.y,w=m.m_angularVelocity,x=n.m_angularVelocity;Wb(o.m_pointCount>0),B.s_worldManifold.Initialize(o,m.m_xf,k,n.m_xf,l);var y=B.s_worldManifold.m_normal.x,z=B.s_worldManifold.m_normal.y,A=this.m_constraints[f];A.bodyA=m,A.bodyB=n,A.manifold=o,A.normal.x=y,A.normal.y=z,A.pointCount=o.m_pointCount,A.friction=q,A.restitution=r,A.localPlaneNormal.x=o.m_localPlaneNormal.x,A.localPlaneNormal.y=o.m_localPlaneNormal.y,A.localPoint.x=o.m_localPoint.x,A.localPoint.y=o.m_localPoint.y,A.radius=k+l,A.type=o.m_type;for(var C=0;C<A.pointCount;++C){var D=o.m_points[C],E=A.points[C];E.normalImpulse=D.m_normalImpulse,E.tangentImpulse=D.m_tangentImpulse,E.localPoint.SetV(D.m_localPoint);var F=E.rA.x=B.s_worldManifold.m_points[C].x-m.m_sweep.c.x,G=E.rA.y=B.s_worldManifold.m_points[C].y-m.m_sweep.c.y,H=E.rB.x=B.s_worldManifold.m_points[C].x-n.m_sweep.c.x,I=E.rB.y=B.s_worldManifold.m_points[C].y-n.m_sweep.c.y,J=F*z-G*y,K=H*z-I*y;J*=J,K*=K;var L=m.m_invMass+n.m_invMass+m.m_invI*J+n.m_invI*K;E.normalMass=1/L;var M=m.m_mass*m.m_invMass+n.m_mass*n.m_invMass;M+=m.m_mass*m.m_invI*J+n.m_mass*n.m_invI*K,E.equalizedMass=1/M;var N=z,O=-y,P=F*O-G*N,Q=H*O-I*N;P*=P,Q*=Q;var R=m.m_invMass+n.m_invMass+m.m_invI*P+n.m_invI*Q;E.tangentMass=1/R,E.velocityBias=0;var S=u+-x*I-s- -w*G,T=v+x*H-t-w*F,U=A.normal.x*S+A.normal.y*T;U<-Fb.b2_velocityThreshold&&(E.velocityBias+=-A.restitution*U)}if(2===A.pointCount){var V=A.points[0],W=A.points[1],X=m.m_invMass,Y=m.m_invI,Z=n.m_invMass,$=n.m_invI,_=V.rA.x*z-V.rA.y*y,ab=V.rB.x*z-V.rB.y*y,bb=W.rA.x*z-W.rA.y*y,cb=W.rB.x*z-W.rB.y*y,db=X+Z+Y*_*_+$*ab*ab,eb=X+Z+Y*bb*bb+$*cb*cb,fb=X+Z+Y*_*bb+$*ab*cb,gb=100;gb*(db*eb-fb*fb)>db*db?(A.K.col1.Set(db,fb),A.K.col2.Set(fb,eb),A.K.GetInverse(A.normalMass)):A.pointCount=1}}},B.prototype.InitVelocityConstraints=function(a){for(var b=0;b<this.m_constraintCount;++b){var c=this.m_constraints[b],d=c.bodyA,e=c.bodyB,f=d.m_invMass,g=d.m_invI,h=e.m_invMass,i=e.m_invI,j=c.normal.x,k=c.normal.y,l=k,m=-j,n=0,o=0;if(a.warmStarting)for(o=c.pointCount,n=0;o>n;++n){var p=c.points[n];p.normalImpulse*=a.dtRatio,p.tangentImpulse*=a.dtRatio;var q=p.normalImpulse*j+p.tangentImpulse*l,r=p.normalImpulse*k+p.tangentImpulse*m;d.m_angularVelocity-=g*(p.rA.x*r-p.rA.y*q),d.m_linearVelocity.x-=f*q,d.m_linearVelocity.y-=f*r,e.m_angularVelocity+=i*(p.rB.x*r-p.rB.y*q),e.m_linearVelocity.x+=h*q,e.m_linearVelocity.y+=h*r}else for(o=c.pointCount,n=0;o>n;++n){var s=c.points[n];s.normalImpulse=0,s.tangentImpulse=0}}},B.prototype.SolveVelocityConstraints=function(){for(var a,b,c=0,d=0,e=0,f=0,g=0,h=0,i=0,j=0,k=0,l=0,m=0,n=0,o=0,p=0,q=0,r=0,s=0;s<this.m_constraintCount;++s){var t=this.m_constraints[s],u=t.bodyA,v=t.bodyB,w=u.m_angularVelocity,x=v.m_angularVelocity,y=u.m_linearVelocity,z=v.m_linearVelocity,A=u.m_invMass,B=u.m_invI,C=v.m_invMass,D=v.m_invI,E=t.normal.x,F=t.normal.y,G=F,H=-E,I=t.friction;for(c=0;c<t.pointCount;c++)a=t.points[c],d=z.x-x*a.rB.y-y.x+w*a.rA.y,e=z.y+x*a.rB.x-y.y-w*a.rA.x,g=d*G+e*H,h=a.tangentMass*-g,i=I*a.normalImpulse,j=lb.Clamp(a.tangentImpulse+h,-i,i),h=j-a.tangentImpulse,k=h*G,l=h*H,y.x-=A*k,y.y-=A*l,w-=B*(a.rA.x*l-a.rA.y*k),z.x+=C*k,z.y+=C*l,x+=D*(a.rB.x*l-a.rB.y*k),a.tangentImpulse=j;{t.pointCount}if(1===t.pointCount)a=t.points[0],d=z.x+-x*a.rB.y-y.x- -w*a.rA.y,e=z.y+x*a.rB.x-y.y-w*a.rA.x,f=d*E+e*F,h=-a.normalMass*(f-a.velocityBias),j=a.normalImpulse+h,j=j>0?j:0,h=j-a.normalImpulse,k=h*E,l=h*F,y.x-=A*k,y.y-=A*l,w-=B*(a.rA.x*l-a.rA.y*k),z.x+=C*k,z.y+=C*l,x+=D*(a.rB.x*l-a.rB.y*k),a.normalImpulse=j;else{var J=t.points[0],K=t.points[1],L=J.normalImpulse,M=K.normalImpulse,N=z.x-x*J.rB.y-y.x+w*J.rA.y,O=z.y+x*J.rB.x-y.y-w*J.rA.x,P=z.x-x*K.rB.y-y.x+w*K.rA.y,Q=z.y+x*K.rB.x-y.y-w*K.rA.x,R=N*E+O*F,S=P*E+Q*F,T=R-J.velocityBias,U=S-K.velocityBias;b=t.K,T-=b.col1.x*L+b.col2.x*M,U-=b.col1.y*L+b.col2.y*M;for(;;){b=t.normalMass;var V=-(b.col1.x*T+b.col2.x*U),W=-(b.col1.y*T+b.col2.y*U);if(V>=0&&W>=0){m=V-L,n=W-M,o=m*E,p=m*F,q=n*E,r=n*F,y.x-=A*(o+q),y.y-=A*(p+r),w-=B*(J.rA.x*p-J.rA.y*o+K.rA.x*r-K.rA.y*q),z.x+=C*(o+q),z.y+=C*(p+r),x+=D*(J.rB.x*p-J.rB.y*o+K.rB.x*r-K.rB.y*q),J.normalImpulse=V,K.normalImpulse=W;break}if(V=-J.normalMass*T,W=0,R=0,S=t.K.col1.y*V+U,V>=0&&S>=0){m=V-L,n=W-M,o=m*E,p=m*F,q=n*E,r=n*F,y.x-=A*(o+q),y.y-=A*(p+r),w-=B*(J.rA.x*p-J.rA.y*o+K.rA.x*r-K.rA.y*q),z.x+=C*(o+q),z.y+=C*(p+r),x+=D*(J.rB.x*p-J.rB.y*o+K.rB.x*r-K.rB.y*q),J.normalImpulse=V,K.normalImpulse=W;break}if(V=0,W=-K.normalMass*U,R=t.K.col2.x*W+T,S=0,W>=0&&R>=0){m=V-L,n=W-M,o=m*E,p=m*F,q=n*E,r=n*F,y.x-=A*(o+q),y.y-=A*(p+r),w-=B*(J.rA.x*p-J.rA.y*o+K.rA.x*r-K.rA.y*q),z.x+=C*(o+q),z.y+=C*(p+r),x+=D*(J.rB.x*p-J.rB.y*o+K.rB.x*r-K.rB.y*q),J.normalImpulse=V,K.normalImpulse=W;break}if(V=0,W=0,R=T,S=U,R>=0&&S>=0){m=V-L,n=W-M,o=m*E,p=m*F,q=n*E,r=n*F,y.x-=A*(o+q),y.y-=A*(p+r),w-=B*(J.rA.x*p-J.rA.y*o+K.rA.x*r-K.rA.y*q),z.x+=C*(o+q),z.y+=C*(p+r),x+=D*(J.rB.x*p-J.rB.y*o+K.rB.x*r-K.rB.y*q),J.normalImpulse=V,K.normalImpulse=W;break}break}}u.m_angularVelocity=w,v.m_angularVelocity=x}},B.prototype.FinalizeVelocityConstraints=function(){for(var a=0;a<this.m_constraintCount;++a)for(var b=this.m_constraints[a],c=b.manifold,d=0;d<b.pointCount;++d){var e=c.m_points[d],f=b.points[d];e.m_normalImpulse=f.normalImpulse,e.m_tangentImpulse=f.tangentImpulse}},B.prototype.SolvePositionConstraints=function(a){a=a||0;for(var b=0,c=0;c<this.m_constraintCount;c++){var d=this.m_constraints[c],e=d.bodyA,f=d.bodyB,g=e.m_mass*e.m_invMass,h=e.m_mass*e.m_invI,i=f.m_mass*f.m_invMass,j=f.m_mass*f.m_invI;B.s_psm.Initialize(d);for(var k=B.s_psm.m_normal,l=0;l<d.pointCount;l++){var m=d.points[l],n=B.s_psm.m_points[l],o=B.s_psm.m_separations[l],p=n.x-e.m_sweep.c.x,q=n.y-e.m_sweep.c.y,r=n.x-f.m_sweep.c.x,s=n.y-f.m_sweep.c.y;b=o>b?b:o;var t=lb.Clamp(a*(o+Fb.b2_linearSlop),-Fb.b2_maxLinearCorrection,0),u=-m.equalizedMass*t,v=u*k.x,w=u*k.y;e.m_sweep.c.x-=g*v,e.m_sweep.c.y-=g*w,e.m_sweep.a-=h*(p*w-q*v),e.SynchronizeTransform(),f.m_sweep.c.x+=i*v,f.m_sweep.c.y+=i*w,f.m_sweep.a+=j*(r*w-s*v),f.SynchronizeTransform()}}return b>-1.5*Fb.b2_linearSlop},Q=Xb.Dynamics.Contacts.b2EdgeAndCircleContact=function(){o.call(this)},Q.constructor=Q,Q.prototype=Object.create(o.prototype),Q.Create=function(){return new Q},Q.Destroy=function(){},Q.prototype.Reset=function(a,b){o.prototype.Reset.call(this,a,b)},Q.prototype.Evaluate=function(){var a=this.m_fixtureA.GetBody(),b=this.m_fixtureB.GetBody();this.b2CollideEdgeAndCircle(this.m_manifold,this.m_fixtureA.GetShape()instanceof S?this.m_fixtureA.GetShape():null,a.m_xf,this.m_fixtureB.GetShape()instanceof j?this.m_fixtureB.GetShape():null,b.m_xf)},Q.prototype.b2CollideEdgeAndCircle=function(){},Q.prototype.GetManifold=function(){return this.m_manifold},Q.prototype.GetWorldManifold=function(a){var b=this.m_fixtureA.GetBody(),c=this.m_fixtureB.GetBody(),d=this.m_fixtureA.GetShape(),e=this.m_fixtureB.GetShape();a.Initialize(this.m_manifold,b.GetTransform(),d.m_radius,c.GetTransform(),e.m_radius)},Q.prototype.IsTouching=function(){return(this.m_flags&o.e_touchingFlag)===o.e_touchingFlag},Q.prototype.IsContinuous=function(){return(this.m_flags&o.e_continuousFlag)===o.e_continuousFlag},Q.prototype.SetSensor=function(a){a?this.m_flags|=o.e_sensorFlag:this.m_flags&=~o.e_sensorFlag},Q.prototype.IsSensor=function(){return(this.m_flags&o.e_sensorFlag)===o.e_sensorFlag},Q.prototype.SetEnabled=function(a){a?this.m_flags|=o.e_enabledFlag:this.m_flags&=~o.e_enabledFlag},Q.prototype.IsEnabled=function(){return(this.m_flags&o.e_enabledFlag)===o.e_enabledFlag},Q.prototype.GetNext=function(){return this.m_next},Q.prototype.GetFixtureA=function(){return this.m_fixtureA},Q.prototype.GetFixtureB=function(){return this.m_fixtureB},Q.prototype.FlagForFiltering=function(){this.m_flags|=o.e_filterFlag},Q.prototype.b2Contact=function(){},Q.prototype.Update=function(a){var b=this.m_oldManifold;this.m_oldManifold=this.m_manifold,this.m_manifold=b,this.m_flags|=o.e_enabledFlag;var c=!1,e=(this.m_flags&o.e_touchingFlag)===o.e_touchingFlag,f=this.m_fixtureA.m_body,g=this.m_fixtureB.m_body,h=this.m_fixtureA.m_aabb.TestOverlap(this.m_fixtureB.m_aabb);if(this.m_flags&o.e_sensorFlag){if(h){var i=this.m_fixtureA.GetShape(),j=this.m_fixtureB.GetShape(),k=f.GetTransform(),l=g.GetTransform();c=Gb.TestOverlap(i,k,j,l)}this.m_manifold.m_pointCount=0}else{if(f.GetType()!==d.b2_dynamicBody||f.IsBullet()||g.GetType()!==d.b2_dynamicBody||g.IsBullet()?this.m_flags|=o.e_continuousFlag:this.m_flags&=~o.e_continuousFlag,h){this.Evaluate(),c=this.m_manifold.m_pointCount>0;for(var m=0;m<this.m_manifold.m_pointCount;++m){var n=this.m_manifold.m_points[m];n.m_normalImpulse=0,n.m_tangentImpulse=0;for(var p=n.m_id,q=0;q<this.m_oldManifold.m_pointCount;++q){var r=this.m_oldManifold.m_points[q];if(r.m_id.key===p.key){n.m_normalImpulse=r.m_normalImpulse,n.m_tangentImpulse=r.m_tangentImpulse;break}}}}else this.m_manifold.m_pointCount=0;c!==e&&(f.SetAwake(!0),g.SetAwake(!0))}c?this.m_flags|=o.e_touchingFlag:this.m_flags&=~o.e_touchingFlag,e===!1&&c===!0&&a.BeginContact(this),e===!0&&c===!1&&a.EndContact(this),0===(this.m_flags&o.e_sensorFlag)&&a.PreSolve(this,this.m_oldManifold)},Q.prototype.ComputeTOI=function(a,b){return o.s_input.proxyA.Set(this.m_fixtureA.GetShape()),o.s_input.proxyB.Set(this.m_fixtureB.GetShape()),o.s_input.sweepA=a,o.s_input.sweepB=b,o.s_input.tolerance=Fb.b2_linearSlop,Nb.TimeOfImpact(o.s_input)},ob=Xb.Dynamics.Contacts.b2NullContact=function(){o.call(this)},ob.constructor=ob,ob.prototype=Object.create(o.prototype),ob.prototype.Evaluate=function(){},ob.prototype.GetManifold=function(){return this.m_manifold},ob.prototype.GetWorldManifold=function(a){var b=this.m_fixtureA.GetBody(),c=this.m_fixtureB.GetBody(),d=this.m_fixtureA.GetShape(),e=this.m_fixtureB.GetShape();a.Initialize(this.m_manifold,b.GetTransform(),d.m_radius,c.GetTransform(),e.m_radius)},ob.prototype.IsTouching=function(){return(this.m_flags&o.e_touchingFlag)===o.e_touchingFlag},ob.prototype.IsContinuous=function(){return(this.m_flags&o.e_continuousFlag)===o.e_continuousFlag},ob.prototype.SetSensor=function(a){a?this.m_flags|=o.e_sensorFlag:this.m_flags&=~o.e_sensorFlag},ob.prototype.IsSensor=function(){return(this.m_flags&o.e_sensorFlag)===o.e_sensorFlag},ob.prototype.SetEnabled=function(a){a?this.m_flags|=o.e_enabledFlag:this.m_flags&=~o.e_enabledFlag},ob.prototype.IsEnabled=function(){return(this.m_flags&o.e_enabledFlag)===o.e_enabledFlag},ob.prototype.GetNext=function(){return this.m_next},ob.prototype.GetFixtureA=function(){return this.m_fixtureA},ob.prototype.GetFixtureB=function(){return this.m_fixtureB},ob.prototype.FlagForFiltering=function(){this.m_flags|=o.e_filterFlag},ob.prototype.b2Contact=function(){},ob.prototype.Reset=function(a,b){if(a=a||null,b=b||null,this.m_flags=o.e_enabledFlag,!a||!b)return this.m_fixtureA=null,void(this.m_fixtureB=null);(a.IsSensor()||b.IsSensor())&&(this.m_flags|=o.e_sensorFlag);var c=a.GetBody(),e=b.GetBody();(c.GetType()!==d.b2_dynamicBody||c.IsBullet()||e.GetType()!==d.b2_dynamicBody||e.IsBullet())&&(this.m_flags|=o.e_continuousFlag),this.m_fixtureA=a,this.m_fixtureB=b,this.m_manifold.m_pointCount=0,this.m_prev=null,this.m_next=null,this.m_nodeA.contact=null,this.m_nodeA.prev=null,this.m_nodeA.next=null,this.m_nodeA.other=null,this.m_nodeB.contact=null,this.m_nodeB.prev=null,this.m_nodeB.next=null,this.m_nodeB.other=null},ob.prototype.Update=function(a){var b=this.m_oldManifold;this.m_oldManifold=this.m_manifold,this.m_manifold=b,this.m_flags|=o.e_enabledFlag;var c=!1,e=(this.m_flags&o.e_touchingFlag)===o.e_touchingFlag,f=this.m_fixtureA.m_body,g=this.m_fixtureB.m_body,h=this.m_fixtureA.m_aabb.TestOverlap(this.m_fixtureB.m_aabb);if(this.m_flags&o.e_sensorFlag){if(h){var i=this.m_fixtureA.GetShape(),j=this.m_fixtureB.GetShape(),k=f.GetTransform(),l=g.GetTransform();c=Gb.TestOverlap(i,k,j,l)}this.m_manifold.m_pointCount=0}else{if(f.GetType()!==d.b2_dynamicBody||f.IsBullet()||g.GetType()!==d.b2_dynamicBody||g.IsBullet()?this.m_flags|=o.e_continuousFlag:this.m_flags&=~o.e_continuousFlag,h){this.Evaluate(),c=this.m_manifold.m_pointCount>0;for(var m=0;m<this.m_manifold.m_pointCount;++m){var n=this.m_manifold.m_points[m];n.m_normalImpulse=0,n.m_tangentImpulse=0;for(var p=n.m_id,q=0;q<this.m_oldManifold.m_pointCount;++q){var r=this.m_oldManifold.m_points[q];if(r.m_id.key===p.key){n.m_normalImpulse=r.m_normalImpulse,n.m_tangentImpulse=r.m_tangentImpulse;break}}}}else this.m_manifold.m_pointCount=0;c!==e&&(f.SetAwake(!0),g.SetAwake(!0))}c?this.m_flags|=o.e_touchingFlag:this.m_flags&=~o.e_touchingFlag,e===!1&&c===!0&&a.BeginContact(this),e===!0&&c===!1&&a.EndContact(this),0===(this.m_flags&o.e_sensorFlag)&&a.PreSolve(this,this.m_oldManifold)},ob.prototype.ComputeTOI=function(a,b){return o.s_input.proxyA.Set(this.m_fixtureA.GetShape()),o.s_input.proxyB.Set(this.m_fixtureB.GetShape()),o.s_input.sweepA=a,o.s_input.sweepB=b,o.s_input.tolerance=Fb.b2_linearSlop,Nb.TimeOfImpact(o.s_input)},qb=Xb.Dynamics.Contacts.b2PolyAndCircleContact=function(){o.call(this)},qb.constructor=qb,qb.prototype=Object.create(o.prototype),qb.Create=function(){return new qb},qb.Destroy=function(){},qb.prototype.Reset=function(a,b){o.prototype.Reset.call(this,a,b),Wb(a.GetType()===Gb.e_polygonShape),Wb(b.GetType()===Gb.e_circleShape)},qb.prototype.Evaluate=function(){var a=this.m_fixtureA.m_body,b=this.m_fixtureB.m_body;k.CollidePolygonAndCircle(this.m_manifold,this.m_fixtureA.GetShape()instanceof tb?this.m_fixtureA.GetShape():null,a.m_xf,this.m_fixtureB.GetShape()instanceof j?this.m_fixtureB.GetShape():null,b.m_xf)},qb.prototype.GetManifold=function(){return this.m_manifold},qb.prototype.GetWorldManifold=function(a){var b=this.m_fixtureA.GetBody(),c=this.m_fixtureB.GetBody(),d=this.m_fixtureA.GetShape(),e=this.m_fixtureB.GetShape();a.Initialize(this.m_manifold,b.GetTransform(),d.m_radius,c.GetTransform(),e.m_radius)},qb.prototype.IsTouching=function(){return(this.m_flags&o.e_touchingFlag)===o.e_touchingFlag},qb.prototype.IsContinuous=function(){return(this.m_flags&o.e_continuousFlag)===o.e_continuousFlag},qb.prototype.SetSensor=function(a){a?this.m_flags|=o.e_sensorFlag:this.m_flags&=~o.e_sensorFlag},qb.prototype.IsSensor=function(){return(this.m_flags&o.e_sensorFlag)===o.e_sensorFlag},qb.prototype.SetEnabled=function(a){a?this.m_flags|=o.e_enabledFlag:this.m_flags&=~o.e_enabledFlag},qb.prototype.IsEnabled=function(){return(this.m_flags&o.e_enabledFlag)===o.e_enabledFlag},qb.prototype.GetNext=function(){return this.m_next},qb.prototype.GetFixtureA=function(){return this.m_fixtureA},qb.prototype.GetFixtureB=function(){return this.m_fixtureB},qb.prototype.FlagForFiltering=function(){this.m_flags|=o.e_filterFlag},qb.prototype.b2Contact=function(){},qb.prototype.Update=function(a){var b=this.m_oldManifold;this.m_oldManifold=this.m_manifold,this.m_manifold=b,this.m_flags|=o.e_enabledFlag;var c=!1,e=(this.m_flags&o.e_touchingFlag)===o.e_touchingFlag,f=this.m_fixtureA.m_body,g=this.m_fixtureB.m_body,h=this.m_fixtureA.m_aabb.TestOverlap(this.m_fixtureB.m_aabb);if(this.m_flags&o.e_sensorFlag){if(h){var i=this.m_fixtureA.GetShape(),j=this.m_fixtureB.GetShape(),k=f.GetTransform(),l=g.GetTransform();c=Gb.TestOverlap(i,k,j,l)}this.m_manifold.m_pointCount=0}else{if(f.GetType()!==d.b2_dynamicBody||f.IsBullet()||g.GetType()!==d.b2_dynamicBody||g.IsBullet()?this.m_flags|=o.e_continuousFlag:this.m_flags&=~o.e_continuousFlag,h){this.Evaluate(),c=this.m_manifold.m_pointCount>0;for(var m=0;m<this.m_manifold.m_pointCount;++m){var n=this.m_manifold.m_points[m];n.m_normalImpulse=0,n.m_tangentImpulse=0;for(var p=n.m_id,q=0;q<this.m_oldManifold.m_pointCount;++q){var r=this.m_oldManifold.m_points[q];if(r.m_id.key===p.key){n.m_normalImpulse=r.m_normalImpulse,n.m_tangentImpulse=r.m_tangentImpulse;break}}}}else this.m_manifold.m_pointCount=0;c!==e&&(f.SetAwake(!0),g.SetAwake(!0))}c?this.m_flags|=o.e_touchingFlag:this.m_flags&=~o.e_touchingFlag,e===!1&&c===!0&&a.BeginContact(this),e===!0&&c===!1&&a.EndContact(this),0===(this.m_flags&o.e_sensorFlag)&&a.PreSolve(this,this.m_oldManifold)},qb.prototype.ComputeTOI=function(a,b){return o.s_input.proxyA.Set(this.m_fixtureA.GetShape()),o.s_input.proxyB.Set(this.m_fixtureB.GetShape()),o.s_input.sweepA=a,o.s_input.sweepB=b,o.s_input.tolerance=Fb.b2_linearSlop,Nb.TimeOfImpact(o.s_input)},rb=Xb.Dynamics.Contacts.b2PolyAndEdgeContact=function(){o.call(this)},rb.constructor=rb,rb.prototype=Object.create(o.prototype),rb.Create=function(){return new rb},rb.Destroy=function(){},rb.prototype.Reset=function(a,b){o.prototype.Reset.call(this,a,b),Wb(a.GetType()===Gb.e_polygonShape),Wb(b.GetType()===Gb.e_edgeShape)},rb.prototype.Evaluate=function(){var a=this.m_fixtureA.GetBody(),b=this.m_fixtureB.GetBody();this.b2CollidePolyAndEdge(this.m_manifold,this.m_fixtureA.GetShape()instanceof tb?this.m_fixtureA.GetShape():null,a.m_xf,this.m_fixtureB.GetShape()instanceof S?this.m_fixtureB.GetShape():null,b.m_xf)},rb.prototype.b2CollidePolyAndEdge=function(){},rb.prototype.GetManifold=function(){return this.m_manifold},rb.prototype.GetWorldManifold=function(a){var b=this.m_fixtureA.GetBody(),c=this.m_fixtureB.GetBody(),d=this.m_fixtureA.GetShape(),e=this.m_fixtureB.GetShape();a.Initialize(this.m_manifold,b.GetTransform(),d.m_radius,c.GetTransform(),e.m_radius)},rb.prototype.IsTouching=function(){return(this.m_flags&o.e_touchingFlag)===o.e_touchingFlag},rb.prototype.IsContinuous=function(){return(this.m_flags&o.e_continuousFlag)===o.e_continuousFlag},rb.prototype.SetSensor=function(a){a?this.m_flags|=o.e_sensorFlag:this.m_flags&=~o.e_sensorFlag},rb.prototype.IsSensor=function(){return(this.m_flags&o.e_sensorFlag)===o.e_sensorFlag},rb.prototype.SetEnabled=function(a){a?this.m_flags|=o.e_enabledFlag:this.m_flags&=~o.e_enabledFlag},rb.prototype.IsEnabled=function(){return(this.m_flags&o.e_enabledFlag)===o.e_enabledFlag},rb.prototype.GetNext=function(){return this.m_next},rb.prototype.GetFixtureA=function(){return this.m_fixtureA},rb.prototype.GetFixtureB=function(){return this.m_fixtureB},rb.prototype.FlagForFiltering=function(){this.m_flags|=o.e_filterFlag},rb.prototype.b2Contact=function(){},rb.prototype.Update=function(a){var b=this.m_oldManifold;this.m_oldManifold=this.m_manifold,this.m_manifold=b,this.m_flags|=o.e_enabledFlag;var c=!1,e=(this.m_flags&o.e_touchingFlag)===o.e_touchingFlag,f=this.m_fixtureA.m_body,g=this.m_fixtureB.m_body,h=this.m_fixtureA.m_aabb.TestOverlap(this.m_fixtureB.m_aabb);if(this.m_flags&o.e_sensorFlag){if(h){var i=this.m_fixtureA.GetShape(),j=this.m_fixtureB.GetShape(),k=f.GetTransform(),l=g.GetTransform();c=Gb.TestOverlap(i,k,j,l)}this.m_manifold.m_pointCount=0}else{if(f.GetType()!==d.b2_dynamicBody||f.IsBullet()||g.GetType()!==d.b2_dynamicBody||g.IsBullet()?this.m_flags|=o.e_continuousFlag:this.m_flags&=~o.e_continuousFlag,h){this.Evaluate(),c=this.m_manifold.m_pointCount>0;for(var m=0;m<this.m_manifold.m_pointCount;++m){var n=this.m_manifold.m_points[m];n.m_normalImpulse=0,n.m_tangentImpulse=0;for(var p=n.m_id,q=0;q<this.m_oldManifold.m_pointCount;++q){var r=this.m_oldManifold.m_points[q];if(r.m_id.key===p.key){n.m_normalImpulse=r.m_normalImpulse,n.m_tangentImpulse=r.m_tangentImpulse;break}}}}else this.m_manifold.m_pointCount=0;c!==e&&(f.SetAwake(!0),g.SetAwake(!0))}c?this.m_flags|=o.e_touchingFlag:this.m_flags&=~o.e_touchingFlag,e===!1&&c===!0&&a.BeginContact(this),e===!0&&c===!1&&a.EndContact(this),0===(this.m_flags&o.e_sensorFlag)&&a.PreSolve(this,this.m_oldManifold)},rb.prototype.ComputeTOI=function(a,b){return o.s_input.proxyA.Set(this.m_fixtureA.GetShape()),o.s_input.proxyB.Set(this.m_fixtureB.GetShape()),o.s_input.sweepA=a,o.s_input.sweepB=b,o.s_input.tolerance=Fb.b2_linearSlop,Nb.TimeOfImpact(o.s_input)},sb=Xb.Dynamics.Contacts.b2PolygonContact=function(){o.call(this)},sb.constructor=sb,sb.prototype=Object.create(o.prototype),sb.Create=function(){return new sb},sb.Destroy=function(){},sb.prototype.Reset=function(a,b){o.prototype.Reset.call(this,a,b)},sb.prototype.Evaluate=function(){var a=this.m_fixtureA.GetBody(),b=this.m_fixtureB.GetBody();k.CollidePolygons(this.m_manifold,this.m_fixtureA.GetShape()instanceof tb?this.m_fixtureA.GetShape():null,a.m_xf,this.m_fixtureB.GetShape()instanceof tb?this.m_fixtureB.GetShape():null,b.m_xf)},sb.prototype.GetManifold=function(){return this.m_manifold},sb.prototype.GetWorldManifold=function(a){var b=this.m_fixtureA.GetBody(),c=this.m_fixtureB.GetBody(),d=this.m_fixtureA.GetShape(),e=this.m_fixtureB.GetShape();a.Initialize(this.m_manifold,b.GetTransform(),d.m_radius,c.GetTransform(),e.m_radius)},sb.prototype.IsTouching=function(){return(this.m_flags&o.e_touchingFlag)===o.e_touchingFlag},sb.prototype.IsContinuous=function(){return(this.m_flags&o.e_continuousFlag)===o.e_continuousFlag},sb.prototype.SetSensor=function(a){a?this.m_flags|=o.e_sensorFlag:this.m_flags&=~o.e_sensorFlag},sb.prototype.IsSensor=function(){return(this.m_flags&o.e_sensorFlag)===o.e_sensorFlag},sb.prototype.SetEnabled=function(a){a?this.m_flags|=o.e_enabledFlag:this.m_flags&=~o.e_enabledFlag},sb.prototype.IsEnabled=function(){return(this.m_flags&o.e_enabledFlag)===o.e_enabledFlag},sb.prototype.GetNext=function(){return this.m_next},sb.prototype.GetFixtureA=function(){return this.m_fixtureA},sb.prototype.GetFixtureB=function(){return this.m_fixtureB},sb.prototype.FlagForFiltering=function(){this.m_flags|=o.e_filterFlag},sb.prototype.b2Contact=function(){},sb.prototype.Update=function(a){var b=this.m_oldManifold;this.m_oldManifold=this.m_manifold,this.m_manifold=b,this.m_flags|=o.e_enabledFlag;var c=!1,e=(this.m_flags&o.e_touchingFlag)===o.e_touchingFlag,f=this.m_fixtureA.m_body,g=this.m_fixtureB.m_body,h=this.m_fixtureA.m_aabb.TestOverlap(this.m_fixtureB.m_aabb);if(this.m_flags&o.e_sensorFlag){if(h){var i=this.m_fixtureA.GetShape(),j=this.m_fixtureB.GetShape(),k=f.GetTransform(),l=g.GetTransform();c=Gb.TestOverlap(i,k,j,l)}this.m_manifold.m_pointCount=0}else{if(f.GetType()!==d.b2_dynamicBody||f.IsBullet()||g.GetType()!==d.b2_dynamicBody||g.IsBullet()?this.m_flags|=o.e_continuousFlag:this.m_flags&=~o.e_continuousFlag,h){this.Evaluate(),c=this.m_manifold.m_pointCount>0;for(var m=0;m<this.m_manifold.m_pointCount;++m){var n=this.m_manifold.m_points[m];n.m_normalImpulse=0,n.m_tangentImpulse=0;for(var p=n.m_id,q=0;q<this.m_oldManifold.m_pointCount;++q){var r=this.m_oldManifold.m_points[q];if(r.m_id.key===p.key){n.m_normalImpulse=r.m_normalImpulse,n.m_tangentImpulse=r.m_tangentImpulse;break}}}}else this.m_manifold.m_pointCount=0;c!==e&&(f.SetAwake(!0),g.SetAwake(!0))}c?this.m_flags|=o.e_touchingFlag:this.m_flags&=~o.e_touchingFlag,e===!1&&c===!0&&a.BeginContact(this),e===!0&&c===!1&&a.EndContact(this),0===(this.m_flags&o.e_sensorFlag)&&a.PreSolve(this,this.m_oldManifold)},sb.prototype.ComputeTOI=function(a,b){return o.s_input.proxyA.Set(this.m_fixtureA.GetShape()),o.s_input.proxyB.Set(this.m_fixtureB.GetShape()),o.s_input.sweepA=a,o.s_input.sweepB=b,o.s_input.tolerance=Fb.b2_linearSlop,Nb.TimeOfImpact(o.s_input)
},s=Xb.Dynamics.Contacts.b2ContactFactory=function(a){this.m_allocator=a,this.InitializeRegisters()},s.constructor=s,s.prototype.m_allocator=null,s.prototype.m_registers=null,s.prototype.AddType=function(a,b,c,d){this.m_registers[c][d].createFcn=a,this.m_registers[c][d].destroyFcn=b,this.m_registers[c][d].primary=!0,c!==d&&(this.m_registers[d][c].createFcn=a,this.m_registers[d][c].destroyFcn=b,this.m_registers[d][c].primary=!1)},s.prototype.InitializeRegisters=function(){this.m_registers=[];for(var a=0;a<Gb.e_shapeTypeCount;a++){this.m_registers.push([]);for(var b=0;b<Gb.e_shapeTypeCount;b++)this.m_registers[a].push(new z)}this.AddType(i.Create,i.Destroy,Gb.e_circleShape,Gb.e_circleShape),this.AddType(qb.Create,qb.Destroy,Gb.e_polygonShape,Gb.e_circleShape),this.AddType(sb.Create,sb.Destroy,Gb.e_polygonShape,Gb.e_polygonShape),this.AddType(Q.Create,Q.Destroy,Gb.e_edgeShape,Gb.e_circleShape),this.AddType(rb.Create,rb.Destroy,Gb.e_polygonShape,Gb.e_edgeShape)},s.prototype.Create=function(a,b){var c,d=a.GetType(),e=b.GetType(),f=this.m_registers[d][e];if(f.pool)return c=f.pool,f.pool=c.m_next,f.poolCount--,c.Reset(a,b),c;var g=f.createFcn;return null!=g?f.primary?(c=g(this.m_allocator),c.Reset(a,b),c):(c=g(this.m_allocator),c.Reset(b,a),c):null},s.prototype.Destroy=function(a){a.m_manifold.m_pointCount>0&&(a.m_fixtureA.m_body.SetAwake(!0),a.m_fixtureB.m_body.SetAwake(!0));var b=a.m_fixtureA.GetType(),c=a.m_fixtureB.GetType(),d=this.m_registers[b][c];d.poolCount++,a.m_next=d.pool,d.pool=a;var e=d.destroyFcn;e(a,this.m_allocator)},D=Xb.Dynamics.Controllers.b2ControllerEdge=function(){},D.constructor=D,C=Xb.Dynamics.Controllers.b2Controller=function(){},C.constructor=C,C.prototype.m_bodyList=null,C.prototype.m_bodyCount=0,C.prototype.m_next=null,C.prototype.m_world=null,C.prototype.Step=function(){},C.prototype.Draw=function(){},C.prototype.AddBody=function(a){var b=new D;b.controller=this,b.body=a,b.nextBody=this.m_bodyList,b.prevBody=null,this.m_bodyList=b,b.nextBody&&(b.nextBody.prevBody=b),this.m_bodyCount++,b.nextController=a.m_controllerList,b.prevController=null,a.m_controllerList=b,b.nextController&&(b.nextController.prevController=b),a.m_controllerCount++},C.prototype.RemoveBody=function(a){for(var b=a.m_controllerList;b&&b.controller!==this;)b=b.nextController;b.prevBody&&(b.prevBody.nextBody=b.nextBody),b.nextBody&&(b.nextBody.prevBody=b.prevBody),b.nextController&&(b.nextController.prevController=b.prevController),b.prevController&&(b.prevController.nextController=b.nextController),this.m_bodyList===b&&(this.m_bodyList=b.nextBody),a.m_controllerList===b&&(a.m_controllerList=b.nextController),a.m_controllerCount--,this.m_bodyCount--},C.prototype.Clear=function(){for(;this.m_bodyList;)this.RemoveBody(this.m_bodyList.body)},C.prototype.GetNext=function(){return this.m_next},C.prototype.GetWorld=function(){return this.m_world},C.prototype.GetBodyList=function(){return this.m_bodyList},h=Xb.Dynamics.Controllers.b2BuoyancyController=function(){this.normal=new Qb(0,-1),this.velocity=new Qb(0,0)},h.constructor=h,h.prototype=Object.create(C.prototype),h.prototype.normal=null,h.prototype.offset=0,h.prototype.density=0,h.prototype.velocity=null,h.prototype.linearDrag=2,h.prototype.angularDrag=1,h.prototype.useDensity=!1,h.prototype.useWorldGravity=!0,h.prototype.gravity=null,h.prototype.Step=function(){if(this.m_bodyList){this.useWorldGravity&&(this.gravity=this.GetWorld().GetGravity().Copy());for(var a=this.m_bodyList;a;a=a.nextBody){var b=a.body;if(b.IsAwake()!==!1){for(var c=new Qb(0,0),d=new Qb(0,0),e=0,f=0,g=b.GetFixtureList();g;g=g.GetNext()){var h=new Qb(0,0),i=g.GetShape().ComputeSubmergedArea(this.normal,this.offset,b.GetTransform(),h);e+=i,c.x+=i*h.x,c.y+=i*h.y;var j=0;j=(this.useDensity,1),f+=i*j,d.x+=i*h.x*j,d.y+=i*h.y*j}if(c.x/=e,c.y/=e,d.x/=f,d.y/=f,!(e<Fb.b2_epsilon)){var k=this.gravity.GetNegative();k.Multiply(this.density*e),b.ApplyForce(k,d);var l=b.GetLinearVelocityFromWorldPoint(c);l.Subtract(this.velocity),l.Multiply(-this.linearDrag*e),b.ApplyForce(l,c),b.ApplyTorque(-b.GetInertia()/b.GetMass()*e*b.GetAngularVelocity()*this.angularDrag)}}}}},h.prototype.Draw=function(a){var b=1e3,c=new Qb(0,0),d=new Qb(0,0);c.x=this.normal.x*this.offset+this.normal.y*b,c.y=this.normal.y*this.offset-this.normal.x*b,d.x=this.normal.x*this.offset-this.normal.y*b,d.y=this.normal.y*this.offset+this.normal.x*b;var e=new l(0,0,1);a.DrawSegment(c,d,e)},h.prototype.AddBody=function(a){var b=new D;b.controller=this,b.body=a,b.nextBody=this.m_bodyList,b.prevBody=null,this.m_bodyList=b,b.nextBody&&(b.nextBody.prevBody=b),this.m_bodyCount++,b.nextController=a.m_controllerList,b.prevController=null,a.m_controllerList=b,b.nextController&&(b.nextController.prevController=b),a.m_controllerCount++},h.prototype.RemoveBody=function(a){for(var b=a.m_controllerList;b&&b.controller!==this;)b=b.nextController;b.prevBody&&(b.prevBody.nextBody=b.nextBody),b.nextBody&&(b.nextBody.prevBody=b.prevBody),b.nextController&&(b.nextController.prevController=b.prevController),b.prevController&&(b.prevController.nextController=b.nextController),this.m_bodyList===b&&(this.m_bodyList=b.nextBody),a.m_controllerList===b&&(a.m_controllerList=b.nextController),a.m_controllerCount--,this.m_bodyCount--},h.prototype.Clear=function(){for(;this.m_bodyList;)this.RemoveBody(this.m_bodyList.body)},h.prototype.GetNext=function(){return this.m_next},h.prototype.GetWorld=function(){return this.m_world},h.prototype.GetBodyList=function(){return this.m_bodyList},m=Xb.Dynamics.Controllers.b2ConstantAccelController=function(){this.A=new Qb(0,0)},m.constructor=m,m.prototype=Object.create(C.prototype),m.prototype.A=null,m.prototype.Step=function(a){for(var b=new Qb(this.A.x*a.dt,this.A.y*a.dt),c=this.m_bodyList;c;c=c.nextBody){var d=c.body;d.IsAwake()&&d.SetLinearVelocity(new Qb(d.GetLinearVelocity().x+b.x,d.GetLinearVelocity().y+b.y))}},m.prototype.Draw=function(){},m.prototype.AddBody=function(a){var b=new D;b.controller=this,b.body=a,b.nextBody=this.m_bodyList,b.prevBody=null,this.m_bodyList=b,b.nextBody&&(b.nextBody.prevBody=b),this.m_bodyCount++,b.nextController=a.m_controllerList,b.prevController=null,a.m_controllerList=b,b.nextController&&(b.nextController.prevController=b),a.m_controllerCount++},m.prototype.RemoveBody=function(a){for(var b=a.m_controllerList;b&&b.controller!==this;)b=b.nextController;b.prevBody&&(b.prevBody.nextBody=b.nextBody),b.nextBody&&(b.nextBody.prevBody=b.prevBody),b.nextController&&(b.nextController.prevController=b.prevController),b.prevController&&(b.prevController.nextController=b.nextController),this.m_bodyList===b&&(this.m_bodyList=b.nextBody),a.m_controllerList===b&&(a.m_controllerList=b.nextController),a.m_controllerCount--,this.m_bodyCount--},m.prototype.Clear=function(){for(;this.m_bodyList;)this.RemoveBody(this.m_bodyList.body)},m.prototype.GetNext=function(){return this.m_next},m.prototype.GetWorld=function(){return this.m_world},m.prototype.GetBodyList=function(){return this.m_bodyList},n=Xb.Dynamics.Controllers.b2ConstantForceController=function(){this.F=new Qb(0,0)},n.constructor=n,n.prototype=Object.create(C.prototype),n.prototype.F=null,n.prototype.Step=function(){for(var a=this.m_bodyList;a;a=a.nextBody){var b=a.body;b.IsAwake()&&b.ApplyForce(this.F,b.GetWorldCenter())}},n.prototype.Draw=function(){},n.prototype.AddBody=function(a){var b=new D;b.controller=this,b.body=a,b.nextBody=this.m_bodyList,b.prevBody=null,this.m_bodyList=b,b.nextBody&&(b.nextBody.prevBody=b),this.m_bodyCount++,b.nextController=a.m_controllerList,b.prevController=null,a.m_controllerList=b,b.nextController&&(b.nextController.prevController=b),a.m_controllerCount++},n.prototype.RemoveBody=function(a){for(var b=a.m_controllerList;b&&b.controller!==this;)b=b.nextController;b.prevBody&&(b.prevBody.nextBody=b.nextBody),b.nextBody&&(b.nextBody.prevBody=b.prevBody),b.nextController&&(b.nextController.prevController=b.prevController),b.prevController&&(b.prevController.nextController=b.nextController),this.m_bodyList===b&&(this.m_bodyList=b.nextBody),a.m_controllerList===b&&(a.m_controllerList=b.nextController),a.m_controllerCount--,this.m_bodyCount--},n.prototype.Clear=function(){for(;this.m_bodyList;)this.RemoveBody(this.m_bodyList.body)},n.prototype.GetNext=function(){return this.m_next},n.prototype.GetWorld=function(){return this.m_world},n.prototype.GetBodyList=function(){return this.m_bodyList},$=Xb.Dynamics.Controllers.b2GravityController=function(){},$.constructor=$,$.prototype=Object.create(C.prototype),$.prototype.G=1,$.prototype.invSqr=!0,$.prototype.Step=function(){var a=null,b=null,c=null,d=0,e=null,f=null,g=null,h=0,i=0,j=0,k=null;if(this.invSqr)for(a=this.m_bodyList;a;a=a.nextBody)for(b=a.body,c=b.GetWorldCenter(),d=b.GetMass(),e=this.m_bodyList;e!==a;e=e.nextBody)f=e.body,g=f.GetWorldCenter(),h=g.x-c.x,i=g.y-c.y,j=h*h+i*i,j<Fb.b2_epsilon||(k=new Qb(h,i),k.Multiply(this.G/j/Math.sqrt(j)*d*f.GetMass()),b.IsAwake()&&b.ApplyForce(k,c),k.Multiply(-1),f.IsAwake()&&f.ApplyForce(k,g));else for(a=this.m_bodyList;a;a=a.nextBody)for(b=a.body,c=b.GetWorldCenter(),d=b.GetMass(),e=this.m_bodyList;e!==a;e=e.nextBody)f=e.body,g=f.GetWorldCenter(),h=g.x-c.x,i=g.y-c.y,j=h*h+i*i,j<Fb.b2_epsilon||(k=new Qb(h,i),k.Multiply(this.G/j*d*f.GetMass()),b.IsAwake()&&b.ApplyForce(k,c),k.Multiply(-1),f.IsAwake()&&f.ApplyForce(k,g))},$.prototype.Draw=function(){},$.prototype.AddBody=function(a){var b=new D;b.controller=this,b.body=a,b.nextBody=this.m_bodyList,b.prevBody=null,this.m_bodyList=b,b.nextBody&&(b.nextBody.prevBody=b),this.m_bodyCount++,b.nextController=a.m_controllerList,b.prevController=null,a.m_controllerList=b,b.nextController&&(b.nextController.prevController=b),a.m_controllerCount++},$.prototype.RemoveBody=function(a){for(var b=a.m_controllerList;b&&b.controller!==this;)b=b.nextController;b.prevBody&&(b.prevBody.nextBody=b.nextBody),b.nextBody&&(b.nextBody.prevBody=b.prevBody),b.nextController&&(b.nextController.prevController=b.prevController),b.prevController&&(b.prevController.nextController=b.nextController),this.m_bodyList===b&&(this.m_bodyList=b.nextBody),a.m_controllerList===b&&(a.m_controllerList=b.nextController),a.m_controllerCount--,this.m_bodyCount--},$.prototype.Clear=function(){for(;this.m_bodyList;)this.RemoveBody(this.m_bodyList.body)},$.prototype.GetNext=function(){return this.m_next},$.prototype.GetWorld=function(){return this.m_world},$.prototype.GetBodyList=function(){return this.m_bodyList},Mb=Xb.Dynamics.Controllers.b2TensorDampingController=function(){this.T=new jb},Mb.constructor=Mb,Mb.prototype=Object.create(C.prototype),Mb.prototype.T=null,Mb.prototype.maxTimestep=0,Mb.prototype.SetAxisAligned=function(a,b){a=a||0,b=b||0,this.T.col1.x=-a,this.T.col1.y=0,this.T.col2.x=0,this.T.col2.y=-b,this.maxTimestep=a>0||b>0?1/Math.max(a,b):0},Mb.prototype.Step=function(a){var b=a.dt;if(!(b<=Fb.b2_epsilon)){b>this.maxTimestep&&this.maxTimestep>0&&(b=this.maxTimestep);for(var c=this.m_bodyList;c;c=c.nextBody){var d=c.body;if(d.IsAwake()){var e=d.GetWorldVector(lb.MulMV(this.T,d.GetLocalVector(d.GetLinearVelocity())));d.SetLinearVelocity(new Qb(d.GetLinearVelocity().x+e.x*b,d.GetLinearVelocity().y+e.y*b))}}}},Mb.prototype.Draw=function(){},Mb.prototype.AddBody=function(a){var b=new D;b.controller=this,b.body=a,b.nextBody=this.m_bodyList,b.prevBody=null,this.m_bodyList=b,b.nextBody&&(b.nextBody.prevBody=b),this.m_bodyCount++,b.nextController=a.m_controllerList,b.prevController=null,a.m_controllerList=b,b.nextController&&(b.nextController.prevController=b),a.m_controllerCount++},Mb.prototype.RemoveBody=function(a){for(var b=a.m_controllerList;b&&b.controller!==this;)b=b.nextController;b.prevBody&&(b.prevBody.nextBody=b.nextBody),b.nextBody&&(b.nextBody.prevBody=b.prevBody),b.nextController&&(b.nextController.prevController=b.prevController),b.prevController&&(b.prevController.nextController=b.nextController),this.m_bodyList===b&&(this.m_bodyList=b.nextBody),a.m_controllerList===b&&(a.m_controllerList=b.nextController),a.m_controllerCount--,this.m_bodyCount--},Mb.prototype.Clear=function(){for(;this.m_bodyList;)this.RemoveBody(this.m_bodyList.body)},Mb.prototype.GetNext=function(){return this.m_next},Mb.prototype.GetWorld=function(){return this.m_world},Mb.prototype.GetBodyList=function(){return this.m_bodyList},bb=Xb.Dynamics.Joints.b2Joint=function(a){this.m_edgeA=new db,this.m_edgeB=new db,this.m_localCenterA=new Qb(0,0),this.m_localCenterB=new Qb(0,0),Wb(a.bodyA!==a.bodyB),this.m_type=a.type,this.m_bodyA=a.bodyA,this.m_bodyB=a.bodyB,this.m_collideConnected=a.collideConnected,this.m_userData=a.userData},bb.constructor=bb,bb.e_unknownJoint=0,bb.e_revoluteJoint=1,bb.e_prismaticJoint=2,bb.e_distanceJoint=3,bb.e_pulleyJoint=4,bb.e_mouseJoint=5,bb.e_gearJoint=6,bb.e_lineJoint=7,bb.e_weldJoint=8,bb.e_frictionJoint=9,bb.e_inactiveLimit=0,bb.e_atLowerLimit=1,bb.e_atUpperLimit=2,bb.e_equalLimits=3,bb.prototype.m_type=bb.e_unknownJoint,bb.prototype.m_edgeA=null,bb.prototype.m_edgeB=null,bb.prototype.m_localAnchor1=null,bb.prototype.m_localAnchor2=null,bb.prototype.m_localCenterA=null,bb.prototype.m_localCenterB=null,bb.prototype.m_prev=null,bb.prototype.m_next=null,bb.prototype.m_bodyA=null,bb.prototype.m_bodyB=null,bb.prototype.m_collideConnected=!1,bb.prototype.m_islandFlag=!1,bb.prototype.m_userData=null,bb.Create=function(a){var b=null;switch(a.type){case bb.e_distanceJoint:b=new I(a instanceof J?a:null);break;case bb.e_mouseJoint:b=new mb(a instanceof nb?a:null);break;case bb.e_prismaticJoint:b=new vb(a instanceof wb?a:null);break;case bb.e_revoluteJoint:b=new Bb(a instanceof Cb?a:null);break;case bb.e_pulleyJoint:b=new xb(a instanceof yb?a:null);break;case bb.e_gearJoint:b=new Y(a instanceof Z?a:null);break;case bb.e_lineJoint:b=new eb(a instanceof fb?a:null);break;case bb.e_weldJoint:b=new Sb(a instanceof Tb?a:null);break;case bb.e_frictionJoint:b=new W(a instanceof X?a:null)}return b},bb.Destroy=function(){},bb.prototype.GetType=function(){return this.m_type},bb.prototype.GetAnchorA=function(){return null},bb.prototype.GetAnchorB=function(){return null},bb.prototype.GetReactionForce=function(a){return a=a||0,null},bb.prototype.GetReactionTorque=function(a){return a=a||0,0},bb.prototype.GetBodyA=function(){return this.m_bodyA},bb.prototype.GetBodyB=function(){return this.m_bodyB},bb.prototype.GetNext=function(){return this.m_next},bb.prototype.GetUserData=function(){return this.m_userData},bb.prototype.SetUserData=function(a){this.m_userData=a},bb.prototype.IsActive=function(){return this.m_bodyA.IsActive()&&this.m_bodyB.IsActive()},bb.prototype.InitVelocityConstraints=function(){},bb.prototype.SolveVelocityConstraints=function(){},bb.prototype.FinalizeVelocityConstraints=function(){},bb.prototype.SolvePositionConstraints=function(a){return a=a||0,!1},cb=Xb.Dynamics.Joints.b2JointDef=function(){},cb.constructor=cb,cb.prototype.type=bb.e_unknownJoint,cb.prototype.userData=null,cb.prototype.bodyA=null,cb.prototype.bodyB=null,cb.prototype.collideConnected=!1,db=Xb.Dynamics.Joints.b2JointEdge=function(){},db.constructor=db,ab=Xb.Dynamics.Joints.b2Jacobian=function(){this.linearA=new Qb(0,0),this.linearB=new Qb(0,0)},ab.constructor=ab,ab.prototype.linearA=null,ab.prototype.linearB=null,ab.prototype.angularA=null,ab.prototype.angularB=null,ab.prototype.SetZero=function(){this.linearA.SetZero(),this.angularA=0,this.linearB.SetZero(),this.angularB=0},ab.prototype.Set=function(a,b,c,d){b=b||0,d=d||0,this.linearA.SetV(a),this.angularA=b,this.linearB.SetV(c),this.angularB=d},ab.prototype.Compute=function(a,b,c,d){return b=b||0,d=d||0,this.linearA.x*a.x+this.linearA.y*a.y+this.angularA*b+(this.linearB.x*c.x+this.linearB.y*c.y)+this.angularB*d},I=Xb.Dynamics.Joints.b2DistanceJoint=function(a){this.m_localAnchor1=new Qb(0,0),this.m_localAnchor2=new Qb(0,0),this.m_u=new Qb(0,0),bb.call(this,a),this.m_localAnchor1.SetV(a.localAnchorA),this.m_localAnchor2.SetV(a.localAnchorB),this.m_length=a.length,this.m_frequencyHz=a.frequencyHz,this.m_dampingRatio=a.dampingRatio},I.constructor=I,I.prototype=Object.create(bb.prototype),I.prototype.m_u=null,I.prototype.m_length=0,I.prototype.m_frequencyHz=0,I.prototype.m_dampingRatio=0,I.prototype.m_impulse=0,I.prototype.m_gamma=0,I.prototype.m_bias=0,I.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)},I.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)},I.prototype.GetReactionForce=function(a){return a=a||0,new Qb(a*this.m_impulse*this.m_u.x,a*this.m_impulse*this.m_u.y)},I.prototype.GetReactionTorque=function(a){return a=a||0,0},I.prototype.GetLength=function(){return this.m_length},I.prototype.SetLength=function(a){a=a||0,this.m_length=a},I.prototype.GetFrequency=function(){return this.m_frequencyHz},I.prototype.SetFrequency=function(a){a=a||0,this.m_frequencyHz=a},I.prototype.GetDampingRatio=function(){return this.m_dampingRatio},I.prototype.SetDampingRatio=function(a){a=a||0,this.m_dampingRatio=a},I.prototype.InitVelocityConstraints=function(a){var b,c=0,d=this.m_bodyA,e=this.m_bodyB;b=d.m_xf.R;var f=this.m_localAnchor1.x-d.m_sweep.localCenter.x,g=this.m_localAnchor1.y-d.m_sweep.localCenter.y;c=b.col1.x*f+b.col2.x*g,g=b.col1.y*f+b.col2.y*g,f=c,b=e.m_xf.R;var h=this.m_localAnchor2.x-e.m_sweep.localCenter.x,i=this.m_localAnchor2.y-e.m_sweep.localCenter.y;c=b.col1.x*h+b.col2.x*i,i=b.col1.y*h+b.col2.y*i,h=c,this.m_u.x=e.m_sweep.c.x+h-d.m_sweep.c.x-f,this.m_u.y=e.m_sweep.c.y+i-d.m_sweep.c.y-g;var j=Math.sqrt(this.m_u.x*this.m_u.x+this.m_u.y*this.m_u.y);j>Fb.b2_linearSlop?this.m_u.Multiply(1/j):this.m_u.SetZero();var k=f*this.m_u.y-g*this.m_u.x,l=h*this.m_u.y-i*this.m_u.x,m=d.m_invMass+d.m_invI*k*k+e.m_invMass+e.m_invI*l*l;if(this.m_mass=0!==m?1/m:0,this.m_frequencyHz>0){var n=j-this.m_length,o=2*Math.PI*this.m_frequencyHz,p=2*this.m_mass*this.m_dampingRatio*o,q=this.m_mass*o*o;this.m_gamma=a.dt*(p+a.dt*q),this.m_gamma=0!==this.m_gamma?1/this.m_gamma:0,this.m_bias=n*a.dt*q*this.m_gamma,this.m_mass=m+this.m_gamma,this.m_mass=0!==this.m_mass?1/this.m_mass:0}if(a.warmStarting){this.m_impulse*=a.dtRatio;var r=this.m_impulse*this.m_u.x,s=this.m_impulse*this.m_u.y;d.m_linearVelocity.x-=d.m_invMass*r,d.m_linearVelocity.y-=d.m_invMass*s,d.m_angularVelocity-=d.m_invI*(f*s-g*r),e.m_linearVelocity.x+=e.m_invMass*r,e.m_linearVelocity.y+=e.m_invMass*s,e.m_angularVelocity+=e.m_invI*(h*s-i*r)}else this.m_impulse=0},I.prototype.SolveVelocityConstraints=function(){var a,b=this.m_bodyA,c=this.m_bodyB;a=b.m_xf.R;var d=this.m_localAnchor1.x-b.m_sweep.localCenter.x,e=this.m_localAnchor1.y-b.m_sweep.localCenter.y,f=a.col1.x*d+a.col2.x*e;e=a.col1.y*d+a.col2.y*e,d=f,a=c.m_xf.R;var g=this.m_localAnchor2.x-c.m_sweep.localCenter.x,h=this.m_localAnchor2.y-c.m_sweep.localCenter.y;f=a.col1.x*g+a.col2.x*h,h=a.col1.y*g+a.col2.y*h,g=f;var i=b.m_linearVelocity.x+-b.m_angularVelocity*e,j=b.m_linearVelocity.y+b.m_angularVelocity*d,k=c.m_linearVelocity.x+-c.m_angularVelocity*h,l=c.m_linearVelocity.y+c.m_angularVelocity*g,m=this.m_u.x*(k-i)+this.m_u.y*(l-j),n=-this.m_mass*(m+this.m_bias+this.m_gamma*this.m_impulse);this.m_impulse+=n;var o=n*this.m_u.x,p=n*this.m_u.y;b.m_linearVelocity.x-=b.m_invMass*o,b.m_linearVelocity.y-=b.m_invMass*p,b.m_angularVelocity-=b.m_invI*(d*p-e*o),c.m_linearVelocity.x+=c.m_invMass*o,c.m_linearVelocity.y+=c.m_invMass*p,c.m_angularVelocity+=c.m_invI*(g*p-h*o)},I.prototype.SolvePositionConstraints=function(a){a=a||0;var b;if(this.m_frequencyHz>0)return!0;var c=this.m_bodyA,d=this.m_bodyB;b=c.m_xf.R;var e=this.m_localAnchor1.x-c.m_sweep.localCenter.x,f=this.m_localAnchor1.y-c.m_sweep.localCenter.y,g=b.col1.x*e+b.col2.x*f;f=b.col1.y*e+b.col2.y*f,e=g,b=d.m_xf.R;var h=this.m_localAnchor2.x-d.m_sweep.localCenter.x,i=this.m_localAnchor2.y-d.m_sweep.localCenter.y;g=b.col1.x*h+b.col2.x*i,i=b.col1.y*h+b.col2.y*i,h=g;var j=d.m_sweep.c.x+h-c.m_sweep.c.x-e,k=d.m_sweep.c.y+i-c.m_sweep.c.y-f,l=Math.sqrt(j*j+k*k);j/=l,k/=l;var m=l-this.m_length;m=lb.Clamp(m,-Fb.b2_maxLinearCorrection,Fb.b2_maxLinearCorrection);var n=-this.m_mass*m;this.m_u.Set(j,k);var o=n*this.m_u.x,p=n*this.m_u.y;return c.m_sweep.c.x-=c.m_invMass*o,c.m_sweep.c.y-=c.m_invMass*p,c.m_sweep.a-=c.m_invI*(e*p-f*o),d.m_sweep.c.x+=d.m_invMass*o,d.m_sweep.c.y+=d.m_invMass*p,d.m_sweep.a+=d.m_invI*(h*p-i*o),c.SynchronizeTransform(),d.SynchronizeTransform(),lb.Abs(m)<Fb.b2_linearSlop},I.prototype.GetType=function(){return this.m_type},I.prototype.GetBodyA=function(){return this.m_bodyA},I.prototype.GetBodyB=function(){return this.m_bodyB},I.prototype.GetNext=function(){return this.m_next},I.prototype.GetUserData=function(){return this.m_userData},I.prototype.SetUserData=function(a){this.m_userData=a},I.prototype.IsActive=function(){return this.m_bodyA.IsActive()&&this.m_bodyB.IsActive()},I.prototype.b2Joint=function(a){Wb(a.bodyA!==a.bodyB),this.m_type=a.type,this.m_prev=null,this.m_next=null,this.m_bodyA=a.bodyA,this.m_bodyB=a.bodyB,this.m_collideConnected=a.collideConnected,this.m_islandFlag=!1,this.m_userData=a.userData},I.prototype.FinalizeVelocityConstraints=function(){},J=Xb.Dynamics.Joints.b2DistanceJointDef=function(){this.localAnchorA=new Qb(0,0),this.localAnchorB=new Qb(0,0)},J.constructor=J,J.prototype=Object.create(cb.prototype),J.prototype.type=bb.e_distanceJoint,J.prototype.localAnchorA=null,J.prototype.localAnchorB=null,J.prototype.length=1,J.prototype.frequencyHz=0,J.prototype.dampingRatio=0,J.prototype.Initialize=function(a,b,c,d){this.bodyA=a,this.bodyB=b,this.localAnchorA.SetV(this.bodyA.GetLocalPoint(c)),this.localAnchorB.SetV(this.bodyB.GetLocalPoint(d));var e=d.x-c.x,f=d.y-c.y;this.length=Math.sqrt(e*e+f*f),this.frequencyHz=0,this.dampingRatio=0},J.prototype.b2JointDef=function(){this.type=bb.e_unknownJoint,this.userData=null,this.bodyA=null,this.bodyB=null,this.collideConnected=!1},W=Xb.Dynamics.Joints.b2FrictionJoint=function(a){this.m_localAnchorA=new Qb(0,0),this.m_localAnchorB=new Qb(0,0),this.m_linearMass=new jb,this.m_linearImpulse=new Qb(0,0),bb.call(this,a),this.m_localAnchorA.SetV(a.localAnchorA),this.m_localAnchorB.SetV(a.localAnchorB),this.m_linearMass.SetZero(),this.m_linearImpulse.SetZero(),this.m_maxForce=a.maxForce,this.m_maxTorque=a.maxTorque},W.constructor=W,W.prototype=Object.create(bb.prototype),W.prototype.m_linearMass=null,W.prototype.m_linearImpulse=null,W.prototype.m_angularMass=0,W.prototype.m_angularImpulse=0,W.prototype.m_maxForce=0,W.prototype.m_maxTorque=0,W.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA)},W.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB)},W.prototype.GetReactionForce=function(a){return a=a||0,new Qb(a*this.m_linearImpulse.x,a*this.m_linearImpulse.y)},W.prototype.GetReactionTorque=function(a){return a=a||0,a*this.m_angularImpulse},W.prototype.SetMaxForce=function(a){a=a||0,this.m_maxForce=a},W.prototype.GetMaxForce=function(){return this.m_maxForce},W.prototype.SetMaxTorque=function(a){a=a||0,this.m_maxTorque=a},W.prototype.GetMaxTorque=function(){return this.m_maxTorque},W.prototype.InitVelocityConstraints=function(a){var b,c=0,d=this.m_bodyA,e=this.m_bodyB;b=d.m_xf.R;var f=this.m_localAnchorA.x-d.m_sweep.localCenter.x,g=this.m_localAnchorA.y-d.m_sweep.localCenter.y;c=b.col1.x*f+b.col2.x*g,g=b.col1.y*f+b.col2.y*g,f=c,b=e.m_xf.R;var h=this.m_localAnchorB.x-e.m_sweep.localCenter.x,i=this.m_localAnchorB.y-e.m_sweep.localCenter.y;c=b.col1.x*h+b.col2.x*i,i=b.col1.y*h+b.col2.y*i,h=c;var j=d.m_invMass,k=e.m_invMass,l=d.m_invI,m=e.m_invI,n=new jb;if(n.col1.x=j+k,n.col2.x=0,n.col1.y=0,n.col2.y=j+k,n.col1.x+=l*g*g,n.col2.x+=-l*f*g,n.col1.y+=-l*f*g,n.col2.y+=l*f*f,n.col1.x+=m*i*i,n.col2.x+=-m*h*i,n.col1.y+=-m*h*i,n.col2.y+=m*h*h,n.GetInverse(this.m_linearMass),this.m_angularMass=l+m,this.m_angularMass>0&&(this.m_angularMass=1/this.m_angularMass),a.warmStarting){this.m_linearImpulse.x*=a.dtRatio,this.m_linearImpulse.y*=a.dtRatio,this.m_angularImpulse*=a.dtRatio;var o=this.m_linearImpulse;d.m_linearVelocity.x-=j*o.x,d.m_linearVelocity.y-=j*o.y,d.m_angularVelocity-=l*(f*o.y-g*o.x+this.m_angularImpulse),e.m_linearVelocity.x+=k*o.x,e.m_linearVelocity.y+=k*o.y,e.m_angularVelocity+=m*(h*o.y-i*o.x+this.m_angularImpulse)}else this.m_linearImpulse.SetZero(),this.m_angularImpulse=0},W.prototype.SolveVelocityConstraints=function(a){var b,c=0,d=this.m_bodyA,e=this.m_bodyB,f=d.m_linearVelocity,g=d.m_angularVelocity,h=e.m_linearVelocity,i=e.m_angularVelocity,j=d.m_invMass,k=e.m_invMass,l=d.m_invI,m=e.m_invI;b=d.m_xf.R;var n=this.m_localAnchorA.x-d.m_sweep.localCenter.x,o=this.m_localAnchorA.y-d.m_sweep.localCenter.y;c=b.col1.x*n+b.col2.x*o,o=b.col1.y*n+b.col2.y*o,n=c,b=e.m_xf.R;var p=this.m_localAnchorB.x-e.m_sweep.localCenter.x,q=this.m_localAnchorB.y-e.m_sweep.localCenter.y;c=b.col1.x*p+b.col2.x*q,q=b.col1.y*p+b.col2.y*q,p=c;var r=0,s=i-g,t=-this.m_angularMass*s,u=this.m_angularImpulse;r=a.dt*this.m_maxTorque,this.m_angularImpulse=lb.Clamp(this.m_angularImpulse+t,-r,r),t=this.m_angularImpulse-u,g-=l*t,i+=m*t;var v=h.x-i*q-f.x+g*o,w=h.y+i*p-f.y-g*n,x=lb.MulMV(this.m_linearMass,new Qb(-v,-w)),y=this.m_linearImpulse.Copy();this.m_linearImpulse.Add(x),r=a.dt*this.m_maxForce,this.m_linearImpulse.LengthSquared()>r*r&&(this.m_linearImpulse.Normalize(),this.m_linearImpulse.Multiply(r)),x=lb.SubtractVV(this.m_linearImpulse,y),f.x-=j*x.x,f.y-=j*x.y,g-=l*(n*x.y-o*x.x),h.x+=k*x.x,h.y+=k*x.y,i+=m*(p*x.y-q*x.x),d.m_angularVelocity=g,e.m_angularVelocity=i},W.prototype.SolvePositionConstraints=function(a){return a=a||0,!0},W.prototype.GetType=function(){return this.m_type},W.prototype.GetBodyA=function(){return this.m_bodyA},W.prototype.GetBodyB=function(){return this.m_bodyB},W.prototype.GetNext=function(){return this.m_next},W.prototype.GetUserData=function(){return this.m_userData},W.prototype.SetUserData=function(a){this.m_userData=a},W.prototype.IsActive=function(){return this.m_bodyA.IsActive()&&this.m_bodyB.IsActive()},W.prototype.b2Joint=function(a){Wb(a.bodyA!==a.bodyB),this.m_type=a.type,this.m_prev=null,this.m_next=null,this.m_bodyA=a.bodyA,this.m_bodyB=a.bodyB,this.m_collideConnected=a.collideConnected,this.m_islandFlag=!1,this.m_userData=a.userData},W.prototype.FinalizeVelocityConstraints=function(){},X=Xb.Dynamics.Joints.b2FrictionJointDef=function(){this.localAnchorA=new Qb(0,0),this.localAnchorB=new Qb(0,0)},X.constructor=X,X.prototype=Object.create(cb.prototype),X.prototype.type=bb.e_frictionJoint,X.prototype.localAnchorA=null,X.prototype.localAnchorB=null,X.prototype.maxForce=0,X.prototype.maxTorque=0,X.prototype.Initialize=function(a,b,c){this.bodyA=a,this.bodyB=b,this.localAnchorA.SetV(this.bodyA.GetLocalPoint(c)),this.localAnchorB.SetV(this.bodyB.GetLocalPoint(c))},X.prototype.b2JointDef=function(){this.type=bb.e_unknownJoint,this.userData=null,this.bodyA=null,this.bodyB=null,this.collideConnected=!1},Y=Xb.Dynamics.Joints.b2GearJoint=function(a){this.m_groundAnchor1=new Qb(0,0),this.m_groundAnchor2=new Qb(0,0),this.m_localAnchor1=new Qb(0,0),this.m_localAnchor2=new Qb(0,0),this.m_J=new ab,bb.call(this,a);var b=a.joint1.m_type,c=a.joint2.m_type,d=0,e=0;this.m_ground1=a.joint1.GetBodyA(),this.m_bodyA=a.joint1.GetBodyB(),b===bb.e_revoluteJoint?(this.m_revolute1=a.joint1 instanceof Bb?a.joint1:null,this.m_groundAnchor1.SetV(this.m_revolute1.m_localAnchor1),this.m_localAnchor1.SetV(this.m_revolute1.m_localAnchor2),d=this.m_revolute1.GetJointAngle()):(this.m_prismatic1=a.joint1 instanceof vb?a.joint1:null,this.m_groundAnchor1.SetV(this.m_prismatic1.m_localAnchor1),this.m_localAnchor1.SetV(this.m_prismatic1.m_localAnchor2),d=this.m_prismatic1.GetJointTranslation()),this.m_ground2=a.joint2.GetBodyA(),this.m_bodyB=a.joint2.GetBodyB(),c===bb.e_revoluteJoint?(this.m_revolute2=a.joint2 instanceof Bb?a.joint2:null,this.m_groundAnchor2.SetV(this.m_revolute2.m_localAnchor1),this.m_localAnchor2.SetV(this.m_revolute2.m_localAnchor2),e=this.m_revolute2.GetJointAngle()):(this.m_prismatic2=a.joint2 instanceof vb?a.joint2:null,this.m_groundAnchor2.SetV(this.m_prismatic2.m_localAnchor1),this.m_localAnchor2.SetV(this.m_prismatic2.m_localAnchor2),e=this.m_prismatic2.GetJointTranslation()),this.m_ratio=a.ratio,this.m_constant=d+this.m_ratio*e},Y.constructor=Y,Y.prototype=Object.create(bb.prototype),Y.prototype.m_groundAnchor1=null,Y.prototype.m_groundAnchor2=null,Y.prototype.m_J=null,Y.prototype.m_revolute1=null,Y.prototype.m_prismatic1=null,Y.prototype.m_revolute2=null,Y.prototype.m_prismatic2=null,Y.prototype.m_ground1=null,Y.prototype.m_ground2=null,Y.prototype.m_ratio=0,Y.prototype.m_constant=0,Y.prototype.m_impulse=0,Y.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)},Y.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)},Y.prototype.GetReactionForce=function(a){return a=a||0,new Qb(a*this.m_impulse*this.m_J.linearB.x,a*this.m_impulse*this.m_J.linearB.y)},Y.prototype.GetReactionTorque=function(a){a=a||0;var b=this.m_bodyB.m_xf.R,c=this.m_localAnchor1.x-this.m_bodyB.m_sweep.localCenter.x,d=this.m_localAnchor1.y-this.m_bodyB.m_sweep.localCenter.y,e=b.col1.x*c+b.col2.x*d;d=b.col1.y*c+b.col2.y*d,c=e;var f=this.m_impulse*this.m_J.linearB.x,g=this.m_impulse*this.m_J.linearB.y;return a*(this.m_impulse*this.m_J.angularB-c*g+d*f)},Y.prototype.GetRatio=function(){return this.m_ratio},Y.prototype.SetRatio=function(a){a=a||0,this.m_ratio=a},Y.prototype.InitVelocityConstraints=function(a){var b,c,d=this.m_ground1,e=this.m_ground2,f=this.m_bodyA,g=this.m_bodyB,h=0,i=0,j=0,k=0,l=0,m=0,n=0;this.m_J.SetZero(),this.m_revolute1?(this.m_J.angularA=-1,n+=f.m_invI):(b=d.m_xf.R,c=this.m_prismatic1.m_localXAxis1,h=b.col1.x*c.x+b.col2.x*c.y,i=b.col1.y*c.x+b.col2.y*c.y,b=f.m_xf.R,j=this.m_localAnchor1.x-f.m_sweep.localCenter.x,k=this.m_localAnchor1.y-f.m_sweep.localCenter.y,m=b.col1.x*j+b.col2.x*k,k=b.col1.y*j+b.col2.y*k,j=m,l=j*i-k*h,this.m_J.linearA.Set(-h,-i),this.m_J.angularA=-l,n+=f.m_invMass+f.m_invI*l*l),this.m_revolute2?(this.m_J.angularB=-this.m_ratio,n+=this.m_ratio*this.m_ratio*g.m_invI):(b=e.m_xf.R,c=this.m_prismatic2.m_localXAxis1,h=b.col1.x*c.x+b.col2.x*c.y,i=b.col1.y*c.x+b.col2.y*c.y,b=g.m_xf.R,j=this.m_localAnchor2.x-g.m_sweep.localCenter.x,k=this.m_localAnchor2.y-g.m_sweep.localCenter.y,m=b.col1.x*j+b.col2.x*k,k=b.col1.y*j+b.col2.y*k,j=m,l=j*i-k*h,this.m_J.linearB.Set(-this.m_ratio*h,-this.m_ratio*i),this.m_J.angularB=-this.m_ratio*l,n+=this.m_ratio*this.m_ratio*(g.m_invMass+g.m_invI*l*l)),this.m_mass=n>0?1/n:0,a.warmStarting?(f.m_linearVelocity.x+=f.m_invMass*this.m_impulse*this.m_J.linearA.x,f.m_linearVelocity.y+=f.m_invMass*this.m_impulse*this.m_J.linearA.y,f.m_angularVelocity+=f.m_invI*this.m_impulse*this.m_J.angularA,g.m_linearVelocity.x+=g.m_invMass*this.m_impulse*this.m_J.linearB.x,g.m_linearVelocity.y+=g.m_invMass*this.m_impulse*this.m_J.linearB.y,g.m_angularVelocity+=g.m_invI*this.m_impulse*this.m_J.angularB):this.m_impulse=0},Y.prototype.SolveVelocityConstraints=function(){var a=this.m_bodyA,b=this.m_bodyB,c=this.m_J.Compute(a.m_linearVelocity,a.m_angularVelocity,b.m_linearVelocity,b.m_angularVelocity),d=-this.m_mass*c;this.m_impulse+=d,a.m_linearVelocity.x+=a.m_invMass*d*this.m_J.linearA.x,a.m_linearVelocity.y+=a.m_invMass*d*this.m_J.linearA.y,a.m_angularVelocity+=a.m_invI*d*this.m_J.angularA,b.m_linearVelocity.x+=b.m_invMass*d*this.m_J.linearB.x,b.m_linearVelocity.y+=b.m_invMass*d*this.m_J.linearB.y,b.m_angularVelocity+=b.m_invI*d*this.m_J.angularB},Y.prototype.SolvePositionConstraints=function(a){a=a||0;var b=0,c=this.m_bodyA,d=this.m_bodyB,e=0,f=0;e=this.m_revolute1?this.m_revolute1.GetJointAngle():this.m_prismatic1.GetJointTranslation(),f=this.m_revolute2?this.m_revolute2.GetJointAngle():this.m_prismatic2.GetJointTranslation();var g=this.m_constant-(e+this.m_ratio*f),h=-this.m_mass*g;return c.m_sweep.c.x+=c.m_invMass*h*this.m_J.linearA.x,c.m_sweep.c.y+=c.m_invMass*h*this.m_J.linearA.y,c.m_sweep.a+=c.m_invI*h*this.m_J.angularA,d.m_sweep.c.x+=d.m_invMass*h*this.m_J.linearB.x,d.m_sweep.c.y+=d.m_invMass*h*this.m_J.linearB.y,d.m_sweep.a+=d.m_invI*h*this.m_J.angularB,c.SynchronizeTransform(),d.SynchronizeTransform(),b<Fb.b2_linearSlop
},Y.prototype.GetType=function(){return this.m_type},Y.prototype.GetBodyA=function(){return this.m_bodyA},Y.prototype.GetBodyB=function(){return this.m_bodyB},Y.prototype.GetNext=function(){return this.m_next},Y.prototype.GetUserData=function(){return this.m_userData},Y.prototype.SetUserData=function(a){this.m_userData=a},Y.prototype.IsActive=function(){return this.m_bodyA.IsActive()&&this.m_bodyB.IsActive()},Y.prototype.b2Joint=function(a){Wb(a.bodyA!==a.bodyB),this.m_type=a.type,this.m_prev=null,this.m_next=null,this.m_bodyA=a.bodyA,this.m_bodyB=a.bodyB,this.m_collideConnected=a.collideConnected,this.m_islandFlag=!1,this.m_userData=a.userData},Y.prototype.FinalizeVelocityConstraints=function(){},Z=Xb.Dynamics.Joints.b2GearJointDef=function(){},Z.constructor=Z,Z.prototype=Object.create(cb.prototype),Z.prototype.type=bb.e_gearJoint,Z.prototype.joint1=null,Z.prototype.joint2=null,Z.prototype.ratio=1,eb=Xb.Dynamics.Joints.b2LineJoint=function(a){this.m_localAnchor1=new Qb(0,0),this.m_localAnchor2=new Qb(0,0),this.m_localXAxis1=new Qb(0,0),this.m_localYAxis1=new Qb(0,0),this.m_axis=new Qb(0,0),this.m_perp=new Qb(0,0),this.m_K=new jb,this.m_impulse=new Qb(0,0),bb.call(this,a),this.m_localAnchor1.SetV(a.localAnchorA),this.m_localAnchor2.SetV(a.localAnchorB),this.m_localXAxis1.SetV(a.localAxisA),this.m_localYAxis1.x=-this.m_localXAxis1.y,this.m_localYAxis1.y=this.m_localXAxis1.x,this.m_impulse.SetZero(),this.m_lowerTranslation=a.lowerTranslation,this.m_upperTranslation=a.upperTranslation,this.m_maxMotorForce=a.maxMotorForce,this.m_motorSpeed=a.motorSpeed,this.m_enableLimit=a.enableLimit,this.m_enableMotor=a.enableMotor,this.m_limitState=bb.e_inactiveLimit,this.m_axis.SetZero(),this.m_perp.SetZero()},eb.constructor=eb,eb.prototype=Object.create(bb.prototype),eb.prototype.m_localXAxis1=null,eb.prototype.m_localYAxis1=null,eb.prototype.m_axis=null,eb.prototype.m_perp=null,eb.prototype.m_K=null,eb.prototype.m_impulse=null,eb.prototype.m_motorMass=0,eb.prototype.m_motorImpulse=0,eb.prototype.m_lowerTranslation=0,eb.prototype.m_upperTranslation=0,eb.prototype.m_maxMotorForce=0,eb.prototype.m_motorSpeed=0,eb.prototype.m_enableLimit=!1,eb.prototype.m_enableMotor=!1,eb.prototype.m_limitState=bb.e_inactiveLimit,eb.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)},eb.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)},eb.prototype.GetReactionForce=function(a){return a=a||0,new Qb(a*(this.m_impulse.x*this.m_perp.x+(this.m_motorImpulse+this.m_impulse.y)*this.m_axis.x),a*(this.m_impulse.x*this.m_perp.y+(this.m_motorImpulse+this.m_impulse.y)*this.m_axis.y))},eb.prototype.GetReactionTorque=function(a){return a*this.m_impulse.y},eb.prototype.GetJointTranslation=function(){var a=this.m_bodyA,b=this.m_bodyB,c=a.GetWorldPoint(this.m_localAnchor1),d=b.GetWorldPoint(this.m_localAnchor2),e=d.x-c.x,f=d.y-c.y,g=a.GetWorldVector(this.m_localXAxis1);return g.x*e+g.y*f},eb.prototype.GetJointSpeed=function(){var a,b=this.m_bodyA,c=this.m_bodyB;a=b.m_xf.R;var d=this.m_localAnchor1.x-b.m_sweep.localCenter.x,e=this.m_localAnchor1.y-b.m_sweep.localCenter.y,f=a.col1.x*d+a.col2.x*e;e=a.col1.y*d+a.col2.y*e,d=f,a=c.m_xf.R;var g=this.m_localAnchor2.x-c.m_sweep.localCenter.x,h=this.m_localAnchor2.y-c.m_sweep.localCenter.y;f=a.col1.x*g+a.col2.x*h,h=a.col1.y*g+a.col2.y*h,g=f;var i=b.m_sweep.c.x+d,j=b.m_sweep.c.y+e,k=c.m_sweep.c.x+g,l=c.m_sweep.c.y+h,m=k-i,n=l-j,o=b.GetWorldVector(this.m_localXAxis1),p=b.m_linearVelocity,q=c.m_linearVelocity,r=b.m_angularVelocity,s=c.m_angularVelocity;return m*-r*o.y+n*r*o.x+(o.x*(q.x+-s*h-p.x- -r*e)+o.y*(q.y+s*g-p.y-r*d))},eb.prototype.IsLimitEnabled=function(){return this.m_enableLimit},eb.prototype.EnableLimit=function(a){this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableLimit=a},eb.prototype.GetLowerLimit=function(){return this.m_lowerTranslation},eb.prototype.GetUpperLimit=function(){return this.m_upperTranslation},eb.prototype.SetLimits=function(a,b){a=a||0,b=b||0,this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_lowerTranslation=a,this.m_upperTranslation=b},eb.prototype.IsMotorEnabled=function(){return this.m_enableMotor},eb.prototype.EnableMotor=function(a){this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableMotor=a},eb.prototype.SetMotorSpeed=function(a){a=a||0,this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_motorSpeed=a},eb.prototype.GetMotorSpeed=function(){return this.m_motorSpeed},eb.prototype.SetMaxMotorForce=function(a){a=a||0,this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_maxMotorForce=a},eb.prototype.GetMaxMotorForce=function(){return this.m_maxMotorForce},eb.prototype.GetMotorForce=function(){return this.m_motorImpulse},eb.prototype.InitVelocityConstraints=function(a){var b,c=this.m_bodyA,d=this.m_bodyB,e=0;this.m_localCenterA.SetV(c.GetLocalCenter()),this.m_localCenterB.SetV(d.GetLocalCenter());{var f=c.GetTransform();d.GetTransform()}b=c.m_xf.R;var g=this.m_localAnchor1.x-this.m_localCenterA.x,h=this.m_localAnchor1.y-this.m_localCenterA.y;e=b.col1.x*g+b.col2.x*h,h=b.col1.y*g+b.col2.y*h,g=e,b=d.m_xf.R;var i=this.m_localAnchor2.x-this.m_localCenterB.x,j=this.m_localAnchor2.y-this.m_localCenterB.y;e=b.col1.x*i+b.col2.x*j,j=b.col1.y*i+b.col2.y*j,i=e;var k=d.m_sweep.c.x+i-c.m_sweep.c.x-g,l=d.m_sweep.c.y+j-c.m_sweep.c.y-h;this.m_invMassA=c.m_invMass,this.m_invMassB=d.m_invMass,this.m_invIA=c.m_invI,this.m_invIB=d.m_invI,this.m_axis.SetV(lb.MulMV(f.R,this.m_localXAxis1)),this.m_a1=(k+g)*this.m_axis.y-(l+h)*this.m_axis.x,this.m_a2=i*this.m_axis.y-j*this.m_axis.x,this.m_motorMass=this.m_invMassA+this.m_invMassB+this.m_invIA*this.m_a1*this.m_a1+this.m_invIB*this.m_a2*this.m_a2,this.m_motorMass=this.m_motorMass>Fb.b2_epsilon?1/this.m_motorMass:0,this.m_perp.SetV(lb.MulMV(f.R,this.m_localYAxis1)),this.m_s1=(k+g)*this.m_perp.y-(l+h)*this.m_perp.x,this.m_s2=i*this.m_perp.y-j*this.m_perp.x;var m=this.m_invMassA,n=this.m_invMassB,o=this.m_invIA,p=this.m_invIB;if(this.m_K.col1.x=m+n+o*this.m_s1*this.m_s1+p*this.m_s2*this.m_s2,this.m_K.col1.y=o*this.m_s1*this.m_a1+p*this.m_s2*this.m_a2,this.m_K.col2.x=this.m_K.col1.y,this.m_K.col2.y=m+n+o*this.m_a1*this.m_a1+p*this.m_a2*this.m_a2,this.m_enableLimit){var q=this.m_axis.x*k+this.m_axis.y*l;lb.Abs(this.m_upperTranslation-this.m_lowerTranslation)<2*Fb.b2_linearSlop?this.m_limitState=bb.e_equalLimits:q<=this.m_lowerTranslation?this.m_limitState!==bb.e_atLowerLimit&&(this.m_limitState=bb.e_atLowerLimit,this.m_impulse.y=0):q>=this.m_upperTranslation?this.m_limitState!==bb.e_atUpperLimit&&(this.m_limitState=bb.e_atUpperLimit,this.m_impulse.y=0):(this.m_limitState=bb.e_inactiveLimit,this.m_impulse.y=0)}else this.m_limitState=bb.e_inactiveLimit;if(this.m_enableMotor===!1&&(this.m_motorImpulse=0),a.warmStarting){this.m_impulse.x*=a.dtRatio,this.m_impulse.y*=a.dtRatio,this.m_motorImpulse*=a.dtRatio;var r=this.m_impulse.x*this.m_perp.x+(this.m_motorImpulse+this.m_impulse.y)*this.m_axis.x,s=this.m_impulse.x*this.m_perp.y+(this.m_motorImpulse+this.m_impulse.y)*this.m_axis.y,t=this.m_impulse.x*this.m_s1+(this.m_motorImpulse+this.m_impulse.y)*this.m_a1,u=this.m_impulse.x*this.m_s2+(this.m_motorImpulse+this.m_impulse.y)*this.m_a2;c.m_linearVelocity.x-=this.m_invMassA*r,c.m_linearVelocity.y-=this.m_invMassA*s,c.m_angularVelocity-=this.m_invIA*t,d.m_linearVelocity.x+=this.m_invMassB*r,d.m_linearVelocity.y+=this.m_invMassB*s,d.m_angularVelocity+=this.m_invIB*u}else this.m_impulse.SetZero(),this.m_motorImpulse=0},eb.prototype.SolveVelocityConstraints=function(a){var b=this.m_bodyA,c=this.m_bodyB,d=b.m_linearVelocity,e=b.m_angularVelocity,f=c.m_linearVelocity,g=c.m_angularVelocity,h=0,i=0,j=0,k=0;if(this.m_enableMotor&&this.m_limitState!==bb.e_equalLimits){var l=this.m_axis.x*(f.x-d.x)+this.m_axis.y*(f.y-d.y)+this.m_a2*g-this.m_a1*e,m=this.m_motorMass*(this.m_motorSpeed-l),n=this.m_motorImpulse,o=a.dt*this.m_maxMotorForce;this.m_motorImpulse=lb.Clamp(this.m_motorImpulse+m,-o,o),m=this.m_motorImpulse-n,h=m*this.m_axis.x,i=m*this.m_axis.y,j=m*this.m_a1,k=m*this.m_a2,d.x-=this.m_invMassA*h,d.y-=this.m_invMassA*i,e-=this.m_invIA*j,f.x+=this.m_invMassB*h,f.y+=this.m_invMassB*i,g+=this.m_invIB*k}var p=this.m_perp.x*(f.x-d.x)+this.m_perp.y*(f.y-d.y)+this.m_s2*g-this.m_s1*e;if(this.m_enableLimit&&this.m_limitState!==bb.e_inactiveLimit){var q=this.m_axis.x*(f.x-d.x)+this.m_axis.y*(f.y-d.y)+this.m_a2*g-this.m_a1*e,r=this.m_impulse.Copy(),s=this.m_K.Solve(new Qb(0,0),-p,-q);this.m_impulse.Add(s),this.m_limitState===bb.e_atLowerLimit?this.m_impulse.y=lb.Max(this.m_impulse.y,0):this.m_limitState===bb.e_atUpperLimit&&(this.m_impulse.y=lb.Min(this.m_impulse.y,0));var t=-p-(this.m_impulse.y-r.y)*this.m_K.col2.x,u=0;u=0!==this.m_K.col1.x?t/this.m_K.col1.x+r.x:r.x,this.m_impulse.x=u,s.x=this.m_impulse.x-r.x,s.y=this.m_impulse.y-r.y,h=s.x*this.m_perp.x+s.y*this.m_axis.x,i=s.x*this.m_perp.y+s.y*this.m_axis.y,j=s.x*this.m_s1+s.y*this.m_a1,k=s.x*this.m_s2+s.y*this.m_a2,d.x-=this.m_invMassA*h,d.y-=this.m_invMassA*i,e-=this.m_invIA*j,f.x+=this.m_invMassB*h,f.y+=this.m_invMassB*i,g+=this.m_invIB*k}else{var v=0;v=0!==this.m_K.col1.x?-p/this.m_K.col1.x:0,this.m_impulse.x+=v,h=v*this.m_perp.x,i=v*this.m_perp.y,j=v*this.m_s1,k=v*this.m_s2,d.x-=this.m_invMassA*h,d.y-=this.m_invMassA*i,e-=this.m_invIA*j,f.x+=this.m_invMassB*h,f.y+=this.m_invMassB*i,g+=this.m_invIB*k}b.m_linearVelocity.SetV(d),b.m_angularVelocity=e,c.m_linearVelocity.SetV(f),c.m_angularVelocity=g},eb.prototype.SolvePositionConstraints=function(a){a=a||0;var b,c=this.m_bodyA,d=this.m_bodyB,e=c.m_sweep.c,f=c.m_sweep.a,g=d.m_sweep.c,h=d.m_sweep.a,i=0,j=0,k=0,l=0,m=0,n=0,o=0,p=!1,q=0,r=jb.FromAngle(f),s=jb.FromAngle(h);b=r;var t=this.m_localAnchor1.x-this.m_localCenterA.x,u=this.m_localAnchor1.y-this.m_localCenterA.y;i=b.col1.x*t+b.col2.x*u,u=b.col1.y*t+b.col2.y*u,t=i,b=s;var v=this.m_localAnchor2.x-this.m_localCenterB.x,w=this.m_localAnchor2.y-this.m_localCenterB.y;i=b.col1.x*v+b.col2.x*w,w=b.col1.y*v+b.col2.y*w,v=i;var x=g.x+v-e.x-t,y=g.y+w-e.y-u;if(this.m_enableLimit){this.m_axis=lb.MulMV(r,this.m_localXAxis1),this.m_a1=(x+t)*this.m_axis.y-(y+u)*this.m_axis.x,this.m_a2=v*this.m_axis.y-w*this.m_axis.x;var z=this.m_axis.x*x+this.m_axis.y*y;lb.Abs(this.m_upperTranslation-this.m_lowerTranslation)<2*Fb.b2_linearSlop?(q=lb.Clamp(z,-Fb.b2_maxLinearCorrection,Fb.b2_maxLinearCorrection),n=lb.Abs(z),p=!0):z<=this.m_lowerTranslation?(q=lb.Clamp(z-this.m_lowerTranslation+Fb.b2_linearSlop,-Fb.b2_maxLinearCorrection,0),n=this.m_lowerTranslation-z,p=!0):z>=this.m_upperTranslation&&(q=lb.Clamp(z-this.m_upperTranslation+Fb.b2_linearSlop,0,Fb.b2_maxLinearCorrection),n=z-this.m_upperTranslation,p=!0)}this.m_perp=lb.MulMV(r,this.m_localYAxis1),this.m_s1=(x+t)*this.m_perp.y-(y+u)*this.m_perp.x,this.m_s2=v*this.m_perp.y-w*this.m_perp.x;var A=new Qb(0,0),B=this.m_perp.x*x+this.m_perp.y*y;if(n=lb.Max(n,lb.Abs(B)),o=0,p)j=this.m_invMassA,k=this.m_invMassB,l=this.m_invIA,m=this.m_invIB,this.m_K.col1.x=j+k+l*this.m_s1*this.m_s1+m*this.m_s2*this.m_s2,this.m_K.col1.y=l*this.m_s1*this.m_a1+m*this.m_s2*this.m_a2,this.m_K.col2.x=this.m_K.col1.y,this.m_K.col2.y=j+k+l*this.m_a1*this.m_a1+m*this.m_a2*this.m_a2,this.m_K.Solve(A,-B,-q);else{j=this.m_invMassA,k=this.m_invMassB,l=this.m_invIA,m=this.m_invIB;var C=j+k+l*this.m_s1*this.m_s1+m*this.m_s2*this.m_s2,D=0;D=0!==C?-B/C:0,A.x=D,A.y=0}var E=A.x*this.m_perp.x+A.y*this.m_axis.x,F=A.x*this.m_perp.y+A.y*this.m_axis.y,G=A.x*this.m_s1+A.y*this.m_a1,H=A.x*this.m_s2+A.y*this.m_a2;return e.x-=this.m_invMassA*E,e.y-=this.m_invMassA*F,f-=this.m_invIA*G,g.x+=this.m_invMassB*E,g.y+=this.m_invMassB*F,h+=this.m_invIB*H,c.m_sweep.a=f,d.m_sweep.a=h,c.SynchronizeTransform(),d.SynchronizeTransform(),n<=Fb.b2_linearSlop&&o<=Fb.b2_angularSlop},eb.prototype.GetType=function(){return this.m_type},eb.prototype.GetBodyA=function(){return this.m_bodyA},eb.prototype.GetBodyB=function(){return this.m_bodyB},eb.prototype.GetNext=function(){return this.m_next},eb.prototype.GetUserData=function(){return this.m_userData},eb.prototype.SetUserData=function(a){this.m_userData=a},eb.prototype.IsActive=function(){return this.m_bodyA.IsActive()&&this.m_bodyB.IsActive()},eb.prototype.b2Joint=function(a){Wb(a.bodyA!==a.bodyB),this.m_type=a.type,this.m_prev=null,this.m_next=null,this.m_bodyA=a.bodyA,this.m_bodyB=a.bodyB,this.m_collideConnected=a.collideConnected,this.m_islandFlag=!1,this.m_userData=a.userData},eb.prototype.FinalizeVelocityConstraints=function(){},fb=Xb.Dynamics.Joints.b2LineJointDef=function(){this.localAnchorA=new Qb(0,0),this.localAnchorB=new Qb(0,0),this.localAxisA=new Qb(0,0),this.localAxisA.Set(1,0)},fb.constructor=fb,fb.prototype=Object.create(cb.prototype),fb.prototype.type=bb.e_lineJoint,fb.prototype.localAnchorA=null,fb.prototype.localAnchorB=null,fb.prototype.localAxisA=null,fb.prototype.enableLimit=!1,fb.prototype.lowerTranslation=0,fb.prototype.upperTranslation=0,fb.prototype.enableMotor=!1,fb.prototype.maxMotorForce=0,fb.prototype.motorSpeed=0,fb.prototype.Initialize=function(a,b,c,d){this.bodyA=a,this.bodyB=b,this.localAnchorA=this.bodyA.GetLocalPoint(c),this.localAnchorB=this.bodyB.GetLocalPoint(c),this.localAxisA=this.bodyA.GetLocalVector(d)},fb.prototype.b2JointDef=function(){this.type=bb.e_unknownJoint,this.userData=null,this.bodyA=null,this.bodyB=null,this.collideConnected=!1},mb=Xb.Dynamics.Joints.b2MouseJoint=function(a){this.K=new jb,this.K1=new jb,this.K2=new jb,this.m_localAnchor=new Qb(0,0),this.m_target=new Qb(0,0),this.m_impulse=new Qb(0,0),this.m_mass=new jb,this.m_C=new Qb(0,0),bb.call(this,a),this.m_target.SetV(a.target);var b=this.m_target.x-this.m_bodyB.m_xf.position.x,c=this.m_target.y-this.m_bodyB.m_xf.position.y,d=this.m_bodyB.m_xf.R;this.m_localAnchor.x=b*d.col1.x+c*d.col1.y,this.m_localAnchor.y=b*d.col2.x+c*d.col2.y,this.m_maxForce=a.maxForce,this.m_impulse.SetZero(),this.m_frequencyHz=a.frequencyHz,this.m_dampingRatio=a.dampingRatio},mb.constructor=mb,mb.prototype=Object.create(bb.prototype),mb.prototype.K=null,mb.prototype.K1=null,mb.prototype.K2=null,mb.prototype.m_localAnchor=null,mb.prototype.m_target=null,mb.prototype.m_impulse=null,mb.prototype.m_mass=null,mb.prototype.m_C=null,mb.prototype.m_frequencyHz=0,mb.prototype.m_dampingRatio=0,mb.prototype.m_beta=0,mb.prototype.m_gamma=0,mb.prototype.GetAnchorA=function(){return this.m_target},mb.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor)},mb.prototype.GetReactionForce=function(a){return a=a||0,new Qb(a*this.m_impulse.x,a*this.m_impulse.y)},mb.prototype.GetReactionTorque=function(a){return a=a||0,0},mb.prototype.GetTarget=function(){return this.m_target},mb.prototype.SetTarget=function(a){this.m_bodyB.IsAwake()===!1&&this.m_bodyB.SetAwake(!0),this.m_target=a},mb.prototype.GetMaxForce=function(){return this.m_maxForce},mb.prototype.SetMaxForce=function(a){a=a||0,this.m_maxForce=a},mb.prototype.GetFrequency=function(){return this.m_frequencyHz},mb.prototype.SetFrequency=function(a){a=a||0,this.m_frequencyHz=a},mb.prototype.GetDampingRatio=function(){return this.m_dampingRatio},mb.prototype.SetDampingRatio=function(a){a=a||0,this.m_dampingRatio=a},mb.prototype.InitVelocityConstraints=function(a){var b,c,d,e=this.m_bodyB,f=e.GetMass(),g=2*Math.PI*this.m_frequencyHz,h=2*f*this.m_dampingRatio*g,i=f*g*g;this.m_gamma=a.dt*(h+a.dt*i),this.m_gamma=0!==this.m_gamma?1/this.m_gamma:0,this.m_beta=a.dt*i*this.m_gamma;var j;j=e.m_xf.R,b=this.m_localAnchor.x-e.m_sweep.localCenter.x,c=this.m_localAnchor.y-e.m_sweep.localCenter.y,d=j.col1.x*b+j.col2.x*c,c=j.col1.y*b+j.col2.y*c,b=d;var k=e.m_invMass,l=e.m_invI;this.K1.col1.x=k,this.K1.col2.x=0,this.K1.col1.y=0,this.K1.col2.y=k,this.K2.col1.x=l*c*c,this.K2.col2.x=-l*b*c,this.K2.col1.y=-l*b*c,this.K2.col2.y=l*b*b,this.K.SetM(this.K1),this.K.AddM(this.K2),this.K.col1.x+=this.m_gamma,this.K.col2.y+=this.m_gamma,this.K.GetInverse(this.m_mass),this.m_C.x=e.m_sweep.c.x+b-this.m_target.x,this.m_C.y=e.m_sweep.c.y+c-this.m_target.y,e.m_angularVelocity*=.98,this.m_impulse.x*=a.dtRatio,this.m_impulse.y*=a.dtRatio,e.m_linearVelocity.x+=k*this.m_impulse.x,e.m_linearVelocity.y+=k*this.m_impulse.y,e.m_angularVelocity+=l*(b*this.m_impulse.y-c*this.m_impulse.x)},mb.prototype.SolveVelocityConstraints=function(a){var b,c=this.m_bodyB,d=0,e=0;b=c.m_xf.R;var f=this.m_localAnchor.x-c.m_sweep.localCenter.x,g=this.m_localAnchor.y-c.m_sweep.localCenter.y;d=b.col1.x*f+b.col2.x*g,g=b.col1.y*f+b.col2.y*g,f=d;var h=c.m_linearVelocity.x+-c.m_angularVelocity*g,i=c.m_linearVelocity.y+c.m_angularVelocity*f;b=this.m_mass,d=h+this.m_beta*this.m_C.x+this.m_gamma*this.m_impulse.x,e=i+this.m_beta*this.m_C.y+this.m_gamma*this.m_impulse.y;var j=-(b.col1.x*d+b.col2.x*e),k=-(b.col1.y*d+b.col2.y*e),l=this.m_impulse.x,m=this.m_impulse.y;this.m_impulse.x+=j,this.m_impulse.y+=k;var n=a.dt*this.m_maxForce;this.m_impulse.LengthSquared()>n*n&&this.m_impulse.Multiply(n/this.m_impulse.Length()),j=this.m_impulse.x-l,k=this.m_impulse.y-m,c.m_linearVelocity.x+=c.m_invMass*j,c.m_linearVelocity.y+=c.m_invMass*k,c.m_angularVelocity+=c.m_invI*(f*k-g*j)},mb.prototype.SolvePositionConstraints=function(a){return a=a||0,!0},mb.prototype.GetType=function(){return this.m_type},mb.prototype.GetBodyA=function(){return this.m_bodyA},mb.prototype.GetBodyB=function(){return this.m_bodyB},mb.prototype.GetNext=function(){return this.m_next},mb.prototype.GetUserData=function(){return this.m_userData},mb.prototype.SetUserData=function(a){this.m_userData=a},mb.prototype.IsActive=function(){return this.m_bodyA.IsActive()&&this.m_bodyB.IsActive()},mb.prototype.b2Joint=function(a){Wb(a.bodyA!==a.bodyB),this.m_type=a.type,this.m_prev=null,this.m_next=null,this.m_bodyA=a.bodyA,this.m_bodyB=a.bodyB,this.m_collideConnected=a.collideConnected,this.m_islandFlag=!1,this.m_userData=a.userData},mb.prototype.FinalizeVelocityConstraints=function(){},nb=Xb.Dynamics.Joints.b2MouseJointDef=function(){this.target=new Qb(0,0)},nb.constructor=nb,nb.prototype=Object.create(cb.prototype),nb.prototype.type=bb.e_mouseJoint,nb.prototype.target=null,nb.prototype.maxForce=0,nb.prototype.frequencyHz=5,nb.prototype.dampingRatio=.7,nb.prototype.b2JointDef=function(){this.type=bb.e_unknownJoint,this.userData=null,this.bodyA=null,this.bodyB=null,this.collideConnected=!1},vb=Xb.Dynamics.Joints.b2PrismaticJoint=function(a){this.m_localAnchor1=new Qb(0,0),this.m_localAnchor2=new Qb(0,0),this.m_localXAxis1=new Qb(0,0),this.m_localYAxis1=new Qb(0,0),this.m_axis=new Qb(0,0),this.m_perp=new Qb(0,0),this.m_K=new kb,this.m_impulse=new Rb(0,0,0),bb.call(this,a),this.m_localAnchor1.SetV(a.localAnchorA),this.m_localAnchor2.SetV(a.localAnchorB),this.m_localXAxis1.SetV(a.localAxisA),this.m_localYAxis1.x=-this.m_localXAxis1.y,this.m_localYAxis1.y=this.m_localXAxis1.x,this.m_refAngle=a.referenceAngle,this.m_impulse.SetZero(),this.m_lowerTranslation=a.lowerTranslation,this.m_upperTranslation=a.upperTranslation,this.m_maxMotorForce=a.maxMotorForce,this.m_motorSpeed=a.motorSpeed,this.m_enableLimit=a.enableLimit,this.m_enableMotor=a.enableMotor,this.m_limitState=bb.e_inactiveLimit,this.m_axis.SetZero(),this.m_perp.SetZero()},vb.constructor=vb,vb.prototype=Object.create(bb.prototype),vb.prototype.m_localXAxis1=null,vb.prototype.m_localYAxis1=null,vb.prototype.m_axis=null,vb.prototype.m_perp=null,vb.prototype.m_K=null,vb.prototype.m_refAngle=null,vb.prototype.m_impulse=null,vb.prototype.m_motorMass=0,vb.prototype.m_motorImpulse=0,vb.prototype.m_lowerTranslation=0,vb.prototype.m_upperTranslation=0,vb.prototype.m_maxMotorForce=0,vb.prototype.m_motorSpeed=0,vb.prototype.m_enableLimit=!1,vb.prototype.m_enableMotor=!1,vb.prototype.m_limitState=bb.e_inactiveLimit,vb.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)},vb.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)},vb.prototype.GetReactionForce=function(a){return a=a||0,new Qb(a*(this.m_impulse.x*this.m_perp.x+(this.m_motorImpulse+this.m_impulse.z)*this.m_axis.x),a*(this.m_impulse.x*this.m_perp.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_axis.y))},vb.prototype.GetReactionTorque=function(a){return a=a||0,a*this.m_impulse.y},vb.prototype.GetJointTranslation=function(){var a=this.m_bodyA,b=this.m_bodyB,c=a.GetWorldPoint(this.m_localAnchor1),d=b.GetWorldPoint(this.m_localAnchor2),e=d.x-c.x,f=d.y-c.y,g=a.GetWorldVector(this.m_localXAxis1);return g.x*e+g.y*f},vb.prototype.GetJointSpeed=function(){var a,b=this.m_bodyA,c=this.m_bodyB;a=b.m_xf.R;var d=this.m_localAnchor1.x-b.m_sweep.localCenter.x,e=this.m_localAnchor1.y-b.m_sweep.localCenter.y,f=a.col1.x*d+a.col2.x*e;e=a.col1.y*d+a.col2.y*e,d=f,a=c.m_xf.R;var g=this.m_localAnchor2.x-c.m_sweep.localCenter.x,h=this.m_localAnchor2.y-c.m_sweep.localCenter.y;f=a.col1.x*g+a.col2.x*h,h=a.col1.y*g+a.col2.y*h,g=f;var i=b.m_sweep.c.x+d,j=b.m_sweep.c.y+e,k=c.m_sweep.c.x+g,l=c.m_sweep.c.y+h,m=k-i,n=l-j,o=b.GetWorldVector(this.m_localXAxis1),p=b.m_linearVelocity,q=c.m_linearVelocity,r=b.m_angularVelocity,s=c.m_angularVelocity;return m*-r*o.y+n*r*o.x+(o.x*(q.x+-s*h-p.x- -r*e)+o.y*(q.y+s*g-p.y-r*d))},vb.prototype.IsLimitEnabled=function(){return this.m_enableLimit},vb.prototype.EnableLimit=function(a){this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableLimit=a},vb.prototype.GetLowerLimit=function(){return this.m_lowerTranslation},vb.prototype.GetUpperLimit=function(){return this.m_upperTranslation},vb.prototype.SetLimits=function(a,b){a=a||0,b=b||0,this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_lowerTranslation=a,this.m_upperTranslation=b},vb.prototype.IsMotorEnabled=function(){return this.m_enableMotor},vb.prototype.EnableMotor=function(a){this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableMotor=a},vb.prototype.SetMotorSpeed=function(a){a=a||0,this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_motorSpeed=a},vb.prototype.GetMotorSpeed=function(){return this.m_motorSpeed},vb.prototype.SetMaxMotorForce=function(a){a=a||0,this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_maxMotorForce=a},vb.prototype.GetMotorForce=function(){return this.m_motorImpulse},vb.prototype.InitVelocityConstraints=function(a){var b,c=this.m_bodyA,d=this.m_bodyB,e=0;this.m_localCenterA.SetV(c.GetLocalCenter()),this.m_localCenterB.SetV(d.GetLocalCenter());{var f=c.GetTransform();d.GetTransform()}b=c.m_xf.R;var g=this.m_localAnchor1.x-this.m_localCenterA.x,h=this.m_localAnchor1.y-this.m_localCenterA.y;e=b.col1.x*g+b.col2.x*h,h=b.col1.y*g+b.col2.y*h,g=e,b=d.m_xf.R;var i=this.m_localAnchor2.x-this.m_localCenterB.x,j=this.m_localAnchor2.y-this.m_localCenterB.y;e=b.col1.x*i+b.col2.x*j,j=b.col1.y*i+b.col2.y*j,i=e;var k=d.m_sweep.c.x+i-c.m_sweep.c.x-g,l=d.m_sweep.c.y+j-c.m_sweep.c.y-h;this.m_invMassA=c.m_invMass,this.m_invMassB=d.m_invMass,this.m_invIA=c.m_invI,this.m_invIB=d.m_invI,this.m_axis.SetV(lb.MulMV(f.R,this.m_localXAxis1)),this.m_a1=(k+g)*this.m_axis.y-(l+h)*this.m_axis.x,this.m_a2=i*this.m_axis.y-j*this.m_axis.x,this.m_motorMass=this.m_invMassA+this.m_invMassB+this.m_invIA*this.m_a1*this.m_a1+this.m_invIB*this.m_a2*this.m_a2,this.m_motorMass>Fb.b2_epsilon&&(this.m_motorMass=1/this.m_motorMass),this.m_perp.SetV(lb.MulMV(f.R,this.m_localYAxis1)),this.m_s1=(k+g)*this.m_perp.y-(l+h)*this.m_perp.x,this.m_s2=i*this.m_perp.y-j*this.m_perp.x;var m=this.m_invMassA,n=this.m_invMassB,o=this.m_invIA,p=this.m_invIB;if(this.m_K.col1.x=m+n+o*this.m_s1*this.m_s1+p*this.m_s2*this.m_s2,this.m_K.col1.y=o*this.m_s1+p*this.m_s2,this.m_K.col1.z=o*this.m_s1*this.m_a1+p*this.m_s2*this.m_a2,this.m_K.col2.x=this.m_K.col1.y,this.m_K.col2.y=o+p,this.m_K.col2.z=o*this.m_a1+p*this.m_a2,this.m_K.col3.x=this.m_K.col1.z,this.m_K.col3.y=this.m_K.col2.z,this.m_K.col3.z=m+n+o*this.m_a1*this.m_a1+p*this.m_a2*this.m_a2,this.m_enableLimit){var q=this.m_axis.x*k+this.m_axis.y*l;lb.Abs(this.m_upperTranslation-this.m_lowerTranslation)<2*Fb.b2_linearSlop?this.m_limitState=bb.e_equalLimits:q<=this.m_lowerTranslation?this.m_limitState!==bb.e_atLowerLimit&&(this.m_limitState=bb.e_atLowerLimit,this.m_impulse.z=0):q>=this.m_upperTranslation?this.m_limitState!==bb.e_atUpperLimit&&(this.m_limitState=bb.e_atUpperLimit,this.m_impulse.z=0):(this.m_limitState=bb.e_inactiveLimit,this.m_impulse.z=0)}else this.m_limitState=bb.e_inactiveLimit;if(this.m_enableMotor===!1&&(this.m_motorImpulse=0),a.warmStarting){this.m_impulse.x*=a.dtRatio,this.m_impulse.y*=a.dtRatio,this.m_motorImpulse*=a.dtRatio;var r=this.m_impulse.x*this.m_perp.x+(this.m_motorImpulse+this.m_impulse.z)*this.m_axis.x,s=this.m_impulse.x*this.m_perp.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_axis.y,t=this.m_impulse.x*this.m_s1+this.m_impulse.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_a1,u=this.m_impulse.x*this.m_s2+this.m_impulse.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_a2;c.m_linearVelocity.x-=this.m_invMassA*r,c.m_linearVelocity.y-=this.m_invMassA*s,c.m_angularVelocity-=this.m_invIA*t,d.m_linearVelocity.x+=this.m_invMassB*r,d.m_linearVelocity.y+=this.m_invMassB*s,d.m_angularVelocity+=this.m_invIB*u}else this.m_impulse.SetZero(),this.m_motorImpulse=0},vb.prototype.SolveVelocityConstraints=function(a){var b=this.m_bodyA,c=this.m_bodyB,d=b.m_linearVelocity,e=b.m_angularVelocity,f=c.m_linearVelocity,g=c.m_angularVelocity,h=0,i=0,j=0,k=0;if(this.m_enableMotor&&this.m_limitState!==bb.e_equalLimits){var l=this.m_axis.x*(f.x-d.x)+this.m_axis.y*(f.y-d.y)+this.m_a2*g-this.m_a1*e,m=this.m_motorMass*(this.m_motorSpeed-l),n=this.m_motorImpulse,o=a.dt*this.m_maxMotorForce;this.m_motorImpulse=lb.Clamp(this.m_motorImpulse+m,-o,o),m=this.m_motorImpulse-n,h=m*this.m_axis.x,i=m*this.m_axis.y,j=m*this.m_a1,k=m*this.m_a2,d.x-=this.m_invMassA*h,d.y-=this.m_invMassA*i,e-=this.m_invIA*j,f.x+=this.m_invMassB*h,f.y+=this.m_invMassB*i,g+=this.m_invIB*k}var p=this.m_perp.x*(f.x-d.x)+this.m_perp.y*(f.y-d.y)+this.m_s2*g-this.m_s1*e,q=g-e;if(this.m_enableLimit&&this.m_limitState!==bb.e_inactiveLimit){var r=this.m_axis.x*(f.x-d.x)+this.m_axis.y*(f.y-d.y)+this.m_a2*g-this.m_a1*e,s=this.m_impulse.Copy(),t=this.m_K.Solve33(new Rb(0,0,0),-p,-q,-r);this.m_impulse.Add(t),this.m_limitState===bb.e_atLowerLimit?this.m_impulse.z=lb.Max(this.m_impulse.z,0):this.m_limitState===bb.e_atUpperLimit&&(this.m_impulse.z=lb.Min(this.m_impulse.z,0));var u=-p-(this.m_impulse.z-s.z)*this.m_K.col3.x,v=-q-(this.m_impulse.z-s.z)*this.m_K.col3.y,w=this.m_K.Solve22(new Qb(0,0),u,v);w.x+=s.x,w.y+=s.y,this.m_impulse.x=w.x,this.m_impulse.y=w.y,t.x=this.m_impulse.x-s.x,t.y=this.m_impulse.y-s.y,t.z=this.m_impulse.z-s.z,h=t.x*this.m_perp.x+t.z*this.m_axis.x,i=t.x*this.m_perp.y+t.z*this.m_axis.y,j=t.x*this.m_s1+t.y+t.z*this.m_a1,k=t.x*this.m_s2+t.y+t.z*this.m_a2,d.x-=this.m_invMassA*h,d.y-=this.m_invMassA*i,e-=this.m_invIA*j,f.x+=this.m_invMassB*h,f.y+=this.m_invMassB*i,g+=this.m_invIB*k}else{var x=this.m_K.Solve22(new Qb(0,0),-p,-q);this.m_impulse.x+=x.x,this.m_impulse.y+=x.y,h=x.x*this.m_perp.x,i=x.x*this.m_perp.y,j=x.x*this.m_s1+x.y,k=x.x*this.m_s2+x.y,d.x-=this.m_invMassA*h,d.y-=this.m_invMassA*i,e-=this.m_invIA*j,f.x+=this.m_invMassB*h,f.y+=this.m_invMassB*i,g+=this.m_invIB*k}b.m_linearVelocity.SetV(d),b.m_angularVelocity=e,c.m_linearVelocity.SetV(f),c.m_angularVelocity=g},vb.prototype.SolvePositionConstraints=function(a){a=a||0;var b,c=this.m_bodyA,d=this.m_bodyB,e=c.m_sweep.c,f=c.m_sweep.a,g=d.m_sweep.c,h=d.m_sweep.a,i=0,j=0,k=0,l=0,m=0,n=0,o=0,p=!1,q=0,r=jb.FromAngle(f),s=jb.FromAngle(h);b=r;var t=this.m_localAnchor1.x-this.m_localCenterA.x,u=this.m_localAnchor1.y-this.m_localCenterA.y;i=b.col1.x*t+b.col2.x*u,u=b.col1.y*t+b.col2.y*u,t=i,b=s;var v=this.m_localAnchor2.x-this.m_localCenterB.x,w=this.m_localAnchor2.y-this.m_localCenterB.y;i=b.col1.x*v+b.col2.x*w,w=b.col1.y*v+b.col2.y*w,v=i;var x=g.x+v-e.x-t,y=g.y+w-e.y-u;if(this.m_enableLimit){this.m_axis=lb.MulMV(r,this.m_localXAxis1),this.m_a1=(x+t)*this.m_axis.y-(y+u)*this.m_axis.x,this.m_a2=v*this.m_axis.y-w*this.m_axis.x;var z=this.m_axis.x*x+this.m_axis.y*y;lb.Abs(this.m_upperTranslation-this.m_lowerTranslation)<2*Fb.b2_linearSlop?(q=lb.Clamp(z,-Fb.b2_maxLinearCorrection,Fb.b2_maxLinearCorrection),n=lb.Abs(z),p=!0):z<=this.m_lowerTranslation?(q=lb.Clamp(z-this.m_lowerTranslation+Fb.b2_linearSlop,-Fb.b2_maxLinearCorrection,0),n=this.m_lowerTranslation-z,p=!0):z>=this.m_upperTranslation&&(q=lb.Clamp(z-this.m_upperTranslation+Fb.b2_linearSlop,0,Fb.b2_maxLinearCorrection),n=z-this.m_upperTranslation,p=!0)}this.m_perp=lb.MulMV(r,this.m_localYAxis1),this.m_s1=(x+t)*this.m_perp.y-(y+u)*this.m_perp.x,this.m_s2=v*this.m_perp.y-w*this.m_perp.x;var A=new Rb(0,0,0),B=this.m_perp.x*x+this.m_perp.y*y,C=h-f-this.m_refAngle;if(n=lb.Max(n,lb.Abs(B)),o=lb.Abs(C),p)j=this.m_invMassA,k=this.m_invMassB,l=this.m_invIA,m=this.m_invIB,this.m_K.col1.x=j+k+l*this.m_s1*this.m_s1+m*this.m_s2*this.m_s2,this.m_K.col1.y=l*this.m_s1+m*this.m_s2,this.m_K.col1.z=l*this.m_s1*this.m_a1+m*this.m_s2*this.m_a2,this.m_K.col2.x=this.m_K.col1.y,this.m_K.col2.y=l+m,this.m_K.col2.z=l*this.m_a1+m*this.m_a2,this.m_K.col3.x=this.m_K.col1.z,this.m_K.col3.y=this.m_K.col2.z,this.m_K.col3.z=j+k+l*this.m_a1*this.m_a1+m*this.m_a2*this.m_a2,this.m_K.Solve33(A,-B,-C,-q);else{j=this.m_invMassA,k=this.m_invMassB,l=this.m_invIA,m=this.m_invIB;var D=j+k+l*this.m_s1*this.m_s1+m*this.m_s2*this.m_s2,E=l*this.m_s1+m*this.m_s2,F=l+m;this.m_K.col1.Set(D,E,0),this.m_K.col2.Set(E,F,0);var G=this.m_K.Solve22(new Qb(0,0),-B,-C);A.x=G.x,A.y=G.y,A.z=0}var H=A.x*this.m_perp.x+A.z*this.m_axis.x,I=A.x*this.m_perp.y+A.z*this.m_axis.y,J=A.x*this.m_s1+A.y+A.z*this.m_a1,K=A.x*this.m_s2+A.y+A.z*this.m_a2;return e.x-=this.m_invMassA*H,e.y-=this.m_invMassA*I,f-=this.m_invIA*J,g.x+=this.m_invMassB*H,g.y+=this.m_invMassB*I,h+=this.m_invIB*K,c.m_sweep.a=f,d.m_sweep.a=h,c.SynchronizeTransform(),d.SynchronizeTransform(),n<=Fb.b2_linearSlop&&o<=Fb.b2_angularSlop},vb.prototype.GetType=function(){return this.m_type},vb.prototype.GetBodyA=function(){return this.m_bodyA},vb.prototype.GetBodyB=function(){return this.m_bodyB},vb.prototype.GetNext=function(){return this.m_next},vb.prototype.GetUserData=function(){return this.m_userData},vb.prototype.SetUserData=function(a){this.m_userData=a},vb.prototype.IsActive=function(){return this.m_bodyA.IsActive()&&this.m_bodyB.IsActive()},vb.prototype.b2Joint=function(a){Wb(a.bodyA!==a.bodyB),this.m_type=a.type,this.m_prev=null,this.m_next=null,this.m_bodyA=a.bodyA,this.m_bodyB=a.bodyB,this.m_collideConnected=a.collideConnected,this.m_islandFlag=!1,this.m_userData=a.userData},vb.prototype.FinalizeVelocityConstraints=function(){},wb=Xb.Dynamics.Joints.b2PrismaticJointDef=function(){this.localAnchorA=new Qb(0,0),this.localAnchorB=new Qb(0,0),this.localAxisA=new Qb(0,0),cb.call(this),this.type=bb.e_prismaticJoint,this.localAxisA.Set(1,0)},wb.constructor=wb,wb.prototype=Object.create(cb.prototype),wb.prototype.type=bb.e_prismaticJoint,wb.prototype.localAnchorA=null,wb.prototype.localAnchorB=null,wb.prototype.localAxisA=null,wb.prototype.referenceAngle=0,wb.prototype.enableLimit=!1,wb.prototype.lowerTranslation=0,wb.prototype.upperTranslation=0,wb.prototype.enableMotor=!1,wb.prototype.maxMotorForce=0,wb.prototype.motorSpeed=0,wb.prototype.Initialize=function(a,b,c,d){this.bodyA=a,this.bodyB=b,this.localAnchorA=this.bodyA.GetLocalPoint(c),this.localAnchorB=this.bodyB.GetLocalPoint(c),this.localAxisA=this.bodyA.GetLocalVector(d),this.referenceAngle=this.bodyB.GetAngle()-this.bodyA.GetAngle()},wb.prototype.b2JointDef=function(){this.type=bb.e_unknownJoint,this.userData=null,this.bodyA=null,this.bodyB=null,this.collideConnected=!1},xb=Xb.Dynamics.Joints.b2PulleyJoint=function Yb(a){this.m_groundAnchor1=new Qb(0,0),this.m_groundAnchor2=new Qb(0,0),this.m_localAnchor1=new Qb(0,0),this.m_localAnchor2=new Qb(0,0),this.m_u1=new Qb(0,0),this.m_u2=new Qb(0,0),bb.call(this,a),this.m_ground=this.m_bodyA.m_world.m_groundBody,this.m_groundAnchor1.x=a.groundAnchorA.x-this.m_ground.m_xf.position.x,this.m_groundAnchor1.y=a.groundAnchorA.y-this.m_ground.m_xf.position.y,this.m_groundAnchor2.x=a.groundAnchorB.x-this.m_ground.m_xf.position.x,this.m_groundAnchor2.y=a.groundAnchorB.y-this.m_ground.m_xf.position.y,this.m_localAnchor1.SetV(a.localAnchorA),this.m_localAnchor2.SetV(a.localAnchorB),this.m_ratio=a.ratio,this.m_constant=a.lengthA+this.m_ratio*a.lengthB,this.m_maxLength1=lb.Min(a.maxLengthA,this.m_constant-this.m_ratio*Yb.b2_minPulleyLength),this.m_maxLength2=lb.Min(a.maxLengthB,(this.m_constant-Yb.b2_minPulleyLength)/this.m_ratio)
},xb.constructor=xb,xb.b2_minPulleyLength=2,xb.prototype=Object.create(bb.prototype),xb.prototype.m_localXAxis1=null,xb.prototype.m_localYAxis1=null,xb.prototype.m_u1=null,xb.prototype.m_u2=null,xb.prototype.m_ground=null,xb.prototype.m_ratio=0,xb.prototype.m_constant=0,xb.prototype.m_maxLength1=0,xb.prototype.m_maxLength2=0,xb.prototype.m_impulse=0,xb.prototype.m_limitImpulse1=0,xb.prototype.m_limitImpulse2=0,xb.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)},xb.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)},xb.prototype.GetReactionForce=function(a){return a=a||0,new Qb(a*this.m_impulse*this.m_u2.x,a*this.m_impulse*this.m_u2.y)},xb.prototype.GetReactionTorque=function(a){return a=a||0,0},xb.prototype.GetGroundAnchorA=function(){var a=this.m_ground.m_xf.position.Copy();return a.Add(this.m_groundAnchor1),a},xb.prototype.GetGroundAnchorB=function(){var a=this.m_ground.m_xf.position.Copy();return a.Add(this.m_groundAnchor2),a},xb.prototype.GetLength1=function(){var a=this.m_bodyA.GetWorldPoint(this.m_localAnchor1),b=this.m_ground.m_xf.position.x+this.m_groundAnchor1.x,c=this.m_ground.m_xf.position.y+this.m_groundAnchor1.y,d=a.x-b,e=a.y-c;return Math.sqrt(d*d+e*e)},xb.prototype.GetLength2=function(){var a=this.m_bodyB.GetWorldPoint(this.m_localAnchor2),b=this.m_ground.m_xf.position.x+this.m_groundAnchor2.x,c=this.m_ground.m_xf.position.y+this.m_groundAnchor2.y,d=a.x-b,e=a.y-c;return Math.sqrt(d*d+e*e)},xb.prototype.GetRatio=function(){return this.m_ratio},xb.prototype.InitVelocityConstraints=function(a){var b,c=this.m_bodyA,d=this.m_bodyB;b=c.m_xf.R;var e=this.m_localAnchor1.x-c.m_sweep.localCenter.x,f=this.m_localAnchor1.y-c.m_sweep.localCenter.y,g=b.col1.x*e+b.col2.x*f;f=b.col1.y*e+b.col2.y*f,e=g,b=d.m_xf.R;var h=this.m_localAnchor2.x-d.m_sweep.localCenter.x,i=this.m_localAnchor2.y-d.m_sweep.localCenter.y;g=b.col1.x*h+b.col2.x*i,i=b.col1.y*h+b.col2.y*i,h=g;var j=c.m_sweep.c.x+e,k=c.m_sweep.c.y+f,l=d.m_sweep.c.x+h,m=d.m_sweep.c.y+i,n=this.m_ground.m_xf.position.x+this.m_groundAnchor1.x,o=this.m_ground.m_xf.position.y+this.m_groundAnchor1.y,p=this.m_ground.m_xf.position.x+this.m_groundAnchor2.x,q=this.m_ground.m_xf.position.y+this.m_groundAnchor2.y;this.m_u1.Set(j-n,k-o),this.m_u2.Set(l-p,m-q);var r=this.m_u1.Length(),s=this.m_u2.Length();r>Fb.b2_linearSlop?this.m_u1.Multiply(1/r):this.m_u1.SetZero(),s>Fb.b2_linearSlop?this.m_u2.Multiply(1/s):this.m_u2.SetZero();var t=this.m_constant-r-this.m_ratio*s;t>0?(this.m_state=bb.e_inactiveLimit,this.m_impulse=0):this.m_state=bb.e_atUpperLimit,r<this.m_maxLength1?(this.m_limitState1=bb.e_inactiveLimit,this.m_limitImpulse1=0):this.m_limitState1=bb.e_atUpperLimit,s<this.m_maxLength2?(this.m_limitState2=bb.e_inactiveLimit,this.m_limitImpulse2=0):this.m_limitState2=bb.e_atUpperLimit;var u=e*this.m_u1.y-f*this.m_u1.x,v=h*this.m_u2.y-i*this.m_u2.x;if(this.m_limitMass1=c.m_invMass+c.m_invI*u*u,this.m_limitMass2=d.m_invMass+d.m_invI*v*v,this.m_pulleyMass=this.m_limitMass1+this.m_ratio*this.m_ratio*this.m_limitMass2,this.m_limitMass1=1/this.m_limitMass1,this.m_limitMass2=1/this.m_limitMass2,this.m_pulleyMass=1/this.m_pulleyMass,a.warmStarting){this.m_impulse*=a.dtRatio,this.m_limitImpulse1*=a.dtRatio,this.m_limitImpulse2*=a.dtRatio;var w=(-this.m_impulse-this.m_limitImpulse1)*this.m_u1.x,x=(-this.m_impulse-this.m_limitImpulse1)*this.m_u1.y,y=(-this.m_ratio*this.m_impulse-this.m_limitImpulse2)*this.m_u2.x,z=(-this.m_ratio*this.m_impulse-this.m_limitImpulse2)*this.m_u2.y;c.m_linearVelocity.x+=c.m_invMass*w,c.m_linearVelocity.y+=c.m_invMass*x,c.m_angularVelocity+=c.m_invI*(e*x-f*w),d.m_linearVelocity.x+=d.m_invMass*y,d.m_linearVelocity.y+=d.m_invMass*z,d.m_angularVelocity+=d.m_invI*(h*z-i*y)}else this.m_impulse=0,this.m_limitImpulse1=0,this.m_limitImpulse2=0},xb.prototype.SolveVelocityConstraints=function(){var a,b=this.m_bodyA,c=this.m_bodyB;a=b.m_xf.R;var d=this.m_localAnchor1.x-b.m_sweep.localCenter.x,e=this.m_localAnchor1.y-b.m_sweep.localCenter.y,f=a.col1.x*d+a.col2.x*e;e=a.col1.y*d+a.col2.y*e,d=f,a=c.m_xf.R;var g=this.m_localAnchor2.x-c.m_sweep.localCenter.x,h=this.m_localAnchor2.y-c.m_sweep.localCenter.y;f=a.col1.x*g+a.col2.x*h,h=a.col1.y*g+a.col2.y*h,g=f;var i=0,j=0,k=0,l=0,m=0,n=0,o=0,p=0,q=0,r=0,s=0;this.m_state===bb.e_atUpperLimit&&(i=b.m_linearVelocity.x+-b.m_angularVelocity*e,j=b.m_linearVelocity.y+b.m_angularVelocity*d,k=c.m_linearVelocity.x+-c.m_angularVelocity*h,l=c.m_linearVelocity.y+c.m_angularVelocity*g,q=-(this.m_u1.x*i+this.m_u1.y*j)-this.m_ratio*(this.m_u2.x*k+this.m_u2.y*l),r=this.m_pulleyMass*-q,s=this.m_impulse,this.m_impulse=lb.Max(0,this.m_impulse+r),r=this.m_impulse-s,m=-r*this.m_u1.x,n=-r*this.m_u1.y,o=-this.m_ratio*r*this.m_u2.x,p=-this.m_ratio*r*this.m_u2.y,b.m_linearVelocity.x+=b.m_invMass*m,b.m_linearVelocity.y+=b.m_invMass*n,b.m_angularVelocity+=b.m_invI*(d*n-e*m),c.m_linearVelocity.x+=c.m_invMass*o,c.m_linearVelocity.y+=c.m_invMass*p,c.m_angularVelocity+=c.m_invI*(g*p-h*o)),this.m_limitState1===bb.e_atUpperLimit&&(i=b.m_linearVelocity.x+-b.m_angularVelocity*e,j=b.m_linearVelocity.y+b.m_angularVelocity*d,q=-(this.m_u1.x*i+this.m_u1.y*j),r=-this.m_limitMass1*q,s=this.m_limitImpulse1,this.m_limitImpulse1=lb.Max(0,this.m_limitImpulse1+r),r=this.m_limitImpulse1-s,m=-r*this.m_u1.x,n=-r*this.m_u1.y,b.m_linearVelocity.x+=b.m_invMass*m,b.m_linearVelocity.y+=b.m_invMass*n,b.m_angularVelocity+=b.m_invI*(d*n-e*m)),this.m_limitState2===bb.e_atUpperLimit&&(k=c.m_linearVelocity.x+-c.m_angularVelocity*h,l=c.m_linearVelocity.y+c.m_angularVelocity*g,q=-(this.m_u2.x*k+this.m_u2.y*l),r=-this.m_limitMass2*q,s=this.m_limitImpulse2,this.m_limitImpulse2=lb.Max(0,this.m_limitImpulse2+r),r=this.m_limitImpulse2-s,o=-r*this.m_u2.x,p=-r*this.m_u2.y,c.m_linearVelocity.x+=c.m_invMass*o,c.m_linearVelocity.y+=c.m_invMass*p,c.m_angularVelocity+=c.m_invI*(g*p-h*o))},xb.prototype.SolvePositionConstraints=function(a){a=a||0;var b,c=this.m_bodyA,d=this.m_bodyB,e=this.m_ground.m_xf.position.x+this.m_groundAnchor1.x,f=this.m_ground.m_xf.position.y+this.m_groundAnchor1.y,g=this.m_ground.m_xf.position.x+this.m_groundAnchor2.x,h=this.m_ground.m_xf.position.y+this.m_groundAnchor2.y,i=0,j=0,k=0,l=0,m=0,n=0,o=0,p=0,q=0,r=0,s=0,t=0,u=0,v=0;return this.m_state===bb.e_atUpperLimit&&(b=c.m_xf.R,i=this.m_localAnchor1.x-c.m_sweep.localCenter.x,j=this.m_localAnchor1.y-c.m_sweep.localCenter.y,u=b.col1.x*i+b.col2.x*j,j=b.col1.y*i+b.col2.y*j,i=u,b=d.m_xf.R,k=this.m_localAnchor2.x-d.m_sweep.localCenter.x,l=this.m_localAnchor2.y-d.m_sweep.localCenter.y,u=b.col1.x*k+b.col2.x*l,l=b.col1.y*k+b.col2.y*l,k=u,m=c.m_sweep.c.x+i,n=c.m_sweep.c.y+j,o=d.m_sweep.c.x+k,p=d.m_sweep.c.y+l,this.m_u1.Set(m-e,n-f),this.m_u2.Set(o-g,p-h),q=this.m_u1.Length(),r=this.m_u2.Length(),q>Fb.b2_linearSlop?this.m_u1.Multiply(1/q):this.m_u1.SetZero(),r>Fb.b2_linearSlop?this.m_u2.Multiply(1/r):this.m_u2.SetZero(),s=this.m_constant-q-this.m_ratio*r,v=lb.Max(v,-s),s=lb.Clamp(s+Fb.b2_linearSlop,-Fb.b2_maxLinearCorrection,0),t=-this.m_pulleyMass*s,m=-t*this.m_u1.x,n=-t*this.m_u1.y,o=-this.m_ratio*t*this.m_u2.x,p=-this.m_ratio*t*this.m_u2.y,c.m_sweep.c.x+=c.m_invMass*m,c.m_sweep.c.y+=c.m_invMass*n,c.m_sweep.a+=c.m_invI*(i*n-j*m),d.m_sweep.c.x+=d.m_invMass*o,d.m_sweep.c.y+=d.m_invMass*p,d.m_sweep.a+=d.m_invI*(k*p-l*o),c.SynchronizeTransform(),d.SynchronizeTransform()),this.m_limitState1===bb.e_atUpperLimit&&(b=c.m_xf.R,i=this.m_localAnchor1.x-c.m_sweep.localCenter.x,j=this.m_localAnchor1.y-c.m_sweep.localCenter.y,u=b.col1.x*i+b.col2.x*j,j=b.col1.y*i+b.col2.y*j,i=u,m=c.m_sweep.c.x+i,n=c.m_sweep.c.y+j,this.m_u1.Set(m-e,n-f),q=this.m_u1.Length(),q>Fb.b2_linearSlop?(this.m_u1.x*=1/q,this.m_u1.y*=1/q):this.m_u1.SetZero(),s=this.m_maxLength1-q,v=lb.Max(v,-s),s=lb.Clamp(s+Fb.b2_linearSlop,-Fb.b2_maxLinearCorrection,0),t=-this.m_limitMass1*s,m=-t*this.m_u1.x,n=-t*this.m_u1.y,c.m_sweep.c.x+=c.m_invMass*m,c.m_sweep.c.y+=c.m_invMass*n,c.m_sweep.a+=c.m_invI*(i*n-j*m),c.SynchronizeTransform()),this.m_limitState2===bb.e_atUpperLimit&&(b=d.m_xf.R,k=this.m_localAnchor2.x-d.m_sweep.localCenter.x,l=this.m_localAnchor2.y-d.m_sweep.localCenter.y,u=b.col1.x*k+b.col2.x*l,l=b.col1.y*k+b.col2.y*l,k=u,o=d.m_sweep.c.x+k,p=d.m_sweep.c.y+l,this.m_u2.Set(o-g,p-h),r=this.m_u2.Length(),r>Fb.b2_linearSlop?(this.m_u2.x*=1/r,this.m_u2.y*=1/r):this.m_u2.SetZero(),s=this.m_maxLength2-r,v=lb.Max(v,-s),s=lb.Clamp(s+Fb.b2_linearSlop,-Fb.b2_maxLinearCorrection,0),t=-this.m_limitMass2*s,o=-t*this.m_u2.x,p=-t*this.m_u2.y,d.m_sweep.c.x+=d.m_invMass*o,d.m_sweep.c.y+=d.m_invMass*p,d.m_sweep.a+=d.m_invI*(k*p-l*o),d.SynchronizeTransform()),v<Fb.b2_linearSlop},xb.prototype.GetType=function(){return this.m_type},xb.prototype.GetBodyA=function(){return this.m_bodyA},xb.prototype.GetBodyB=function(){return this.m_bodyB},xb.prototype.GetNext=function(){return this.m_next},xb.prototype.GetUserData=function(){return this.m_userData},xb.prototype.SetUserData=function(a){this.m_userData=a},xb.prototype.IsActive=function(){return this.m_bodyA.IsActive()&&this.m_bodyB.IsActive()},xb.prototype.b2Joint=function(a){Wb(a.bodyA!==a.bodyB),this.m_type=a.type,this.m_prev=null,this.m_next=null,this.m_bodyA=a.bodyA,this.m_bodyB=a.bodyB,this.m_collideConnected=a.collideConnected,this.m_islandFlag=!1,this.m_userData=a.userData},xb.prototype.FinalizeVelocityConstraints=function(){},yb=Xb.Dynamics.Joints.b2PulleyJointDef=function(){this.groundAnchorA=new Qb(0,0),this.groundAnchorB=new Qb(0,0),this.localAnchorA=new Qb(0,0),this.localAnchorB=new Qb(0,0),this.groundAnchorA.Set(-1,1),this.groundAnchorB.Set(1,1),this.localAnchorA.Set(-1,0),this.localAnchorB.Set(1,0)},yb.constructor=yb,yb.prototype=Object.create(cb.prototype),yb.prototype.type=bb.e_pulleyJoint,yb.prototype.groundAnchorA=null,yb.prototype.groundAnchorB=null,yb.prototype.localAnchorA=null,yb.prototype.localAnchorB=null,yb.prototype.lengthA=0,yb.prototype.maxLengthA=0,yb.prototype.lengthB=0,yb.prototype.maxLengthB=0,yb.prototype.ratio=1,yb.prototype.collideConnected=!0,yb.prototype.Initialize=function(a,b,c,d,e,f,g){g=g||0,this.bodyA=a,this.bodyB=b,this.groundAnchorA.SetV(c),this.groundAnchorB.SetV(d),this.localAnchorA=this.bodyA.GetLocalPoint(e),this.localAnchorB=this.bodyB.GetLocalPoint(f);var h=e.x-c.x,i=e.y-c.y;this.lengthA=Math.sqrt(h*h+i*i);var j=f.x-d.x,k=f.y-d.y;this.lengthB=Math.sqrt(j*j+k*k),this.ratio=g;var l=this.lengthA+this.ratio*this.lengthB;this.maxLengthA=l-this.ratio*xb.b2_minPulleyLength,this.maxLengthB=(l-xb.b2_minPulleyLength)/this.ratio},yb.prototype.b2JointDef=function(){this.type=bb.e_unknownJoint,this.userData=null,this.bodyA=null,this.bodyB=null,this.collideConnected=!1},Bb=Xb.Dynamics.Joints.b2RevoluteJoint=function(a){this.K=new jb,this.K1=new jb,this.K2=new jb,this.K3=new jb,this.impulse3=new Rb(0,0,0),this.impulse2=new Qb(0,0),this.reduced=new Qb(0,0),this.m_localAnchor1=new Qb(0,0),this.m_localAnchor2=new Qb(0,0),this.m_impulse=new Rb(0,0,0),this.m_mass=new kb,bb.call(this,a),this.m_localAnchor1.SetV(a.localAnchorA),this.m_localAnchor2.SetV(a.localAnchorB),this.m_referenceAngle=a.referenceAngle,this.m_impulse.SetZero(),this.m_lowerAngle=a.lowerAngle,this.m_upperAngle=a.upperAngle,this.m_maxMotorTorque=a.maxMotorTorque,this.m_motorSpeed=a.motorSpeed,this.m_enableLimit=a.enableLimit,this.m_enableMotor=a.enableMotor,this.m_limitState=bb.e_inactiveLimit},Bb.constructor=Bb,Bb.prototype=Object.create(bb.prototype),Bb.prototype.K=null,Bb.prototype.K1=null,Bb.prototype.K2=null,Bb.prototype.K3=null,Bb.prototype.impulse2=null,Bb.prototype.impulse3=null,Bb.prototype.reduced=null,Bb.prototype.m_impulse=null,Bb.prototype.m_mass=0,Bb.prototype.m_referenceAngle=0,Bb.prototype.m_motorImpulse=0,Bb.prototype.m_lowerAngle=0,Bb.prototype.m_upperAngle=0,Bb.prototype.m_maxMotorTorque=0,Bb.prototype.m_motorSpeed=0,Bb.prototype.m_enableLimit=0,Bb.prototype.m_enableMotor=!1,Bb.prototype.m_limitState=bb.e_inactiveLimit,Bb.tImpulse=new Qb(0,0),Bb.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)},Bb.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)},Bb.prototype.GetReactionForce=function(a){return a=a||0,new Qb(a*this.m_impulse.x,a*this.m_impulse.y)},Bb.prototype.GetReactionTorque=function(a){return a=a||0,a*this.m_impulse.z},Bb.prototype.GetJointAngle=function(){return this.m_bodyB.m_sweep.a-this.m_bodyA.m_sweep.a-this.m_referenceAngle},Bb.prototype.GetJointSpeed=function(){return this.m_bodyB.m_angularVelocity-this.m_bodyA.m_angularVelocity},Bb.prototype.IsLimitEnabled=function(){return this.m_enableLimit},Bb.prototype.EnableLimit=function(a){this.m_enableLimit=a},Bb.prototype.GetLowerLimit=function(){return this.m_lowerAngle},Bb.prototype.GetUpperLimit=function(){return this.m_upperAngle},Bb.prototype.SetLimits=function(a,b){a=a||0,b=b||0,this.m_lowerAngle=a,this.m_upperAngle=b},Bb.prototype.IsMotorEnabled=function(){return this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableMotor},Bb.prototype.EnableMotor=function(a){this.m_enableMotor=a},Bb.prototype.SetMotorSpeed=function(a){a=a||0,this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_motorSpeed=a},Bb.prototype.GetMotorSpeed=function(){return this.m_motorSpeed},Bb.prototype.SetMaxMotorTorque=function(a){a=a||0,this.m_maxMotorTorque=a},Bb.prototype.GetMotorTorque=function(){return this.m_maxMotorTorque},Bb.prototype.InitVelocityConstraints=function(a){var b,c=this.m_bodyA,d=this.m_bodyB,e=0;(this.m_enableMotor||this.m_enableLimit)&&Wb(c.m_invI>0||d.m_invI>0),b=c.m_xf.R;var f=this.m_localAnchor1.x-c.m_sweep.localCenter.x,g=this.m_localAnchor1.y-c.m_sweep.localCenter.y;e=b.col1.x*f+b.col2.x*g,g=b.col1.y*f+b.col2.y*g,f=e,b=d.m_xf.R;var h=this.m_localAnchor2.x-d.m_sweep.localCenter.x,i=this.m_localAnchor2.y-d.m_sweep.localCenter.y;e=b.col1.x*h+b.col2.x*i,i=b.col1.y*h+b.col2.y*i,h=e;var j=c.m_invMass,k=d.m_invMass,l=c.m_invI,m=d.m_invI;if(this.m_mass.col1.x=j+k+g*g*l+i*i*m,this.m_mass.col2.x=-g*f*l-i*h*m,this.m_mass.col3.x=-g*l-i*m,this.m_mass.col1.y=this.m_mass.col2.x,this.m_mass.col2.y=j+k+f*f*l+h*h*m,this.m_mass.col3.y=f*l+h*m,this.m_mass.col1.z=this.m_mass.col3.x,this.m_mass.col2.z=this.m_mass.col3.y,this.m_mass.col3.z=l+m,this.m_motorMass=1/(l+m),this.m_enableMotor===!1&&(this.m_motorImpulse=0),this.m_enableLimit){var n=d.m_sweep.a-c.m_sweep.a-this.m_referenceAngle;lb.Abs(this.m_upperAngle-this.m_lowerAngle)<2*Fb.b2_angularSlop?this.m_limitState=bb.e_equalLimits:n<=this.m_lowerAngle?(this.m_limitState!==bb.e_atLowerLimit&&(this.m_impulse.z=0),this.m_limitState=bb.e_atLowerLimit):n>=this.m_upperAngle?(this.m_limitState!==bb.e_atUpperLimit&&(this.m_impulse.z=0),this.m_limitState=bb.e_atUpperLimit):(this.m_limitState=bb.e_inactiveLimit,this.m_impulse.z=0)}else this.m_limitState=bb.e_inactiveLimit;if(a.warmStarting){this.m_impulse.x*=a.dtRatio,this.m_impulse.y*=a.dtRatio,this.m_motorImpulse*=a.dtRatio;var o=this.m_impulse.x,p=this.m_impulse.y;c.m_linearVelocity.x-=j*o,c.m_linearVelocity.y-=j*p,c.m_angularVelocity-=l*(f*p-g*o+this.m_motorImpulse+this.m_impulse.z),d.m_linearVelocity.x+=k*o,d.m_linearVelocity.y+=k*p,d.m_angularVelocity+=m*(h*p-i*o+this.m_motorImpulse+this.m_impulse.z)}else this.m_impulse.SetZero(),this.m_motorImpulse=0},Bb.prototype.SolveVelocityConstraints=function(a){var b,c=this.m_bodyA,d=this.m_bodyB,e=0,f=0,g=0,h=0,i=0,j=0,k=c.m_linearVelocity,l=c.m_angularVelocity,m=d.m_linearVelocity,n=d.m_angularVelocity,o=c.m_invMass,p=d.m_invMass,q=c.m_invI,r=d.m_invI;if(this.m_enableMotor&&this.m_limitState!==bb.e_equalLimits){var s=n-l-this.m_motorSpeed,t=this.m_motorMass*-s,u=this.m_motorImpulse,v=a.dt*this.m_maxMotorTorque;this.m_motorImpulse=lb.Clamp(this.m_motorImpulse+t,-v,v),t=this.m_motorImpulse-u,l-=q*t,n+=r*t}if(this.m_enableLimit&&this.m_limitState!==bb.e_inactiveLimit){b=c.m_xf.R,g=this.m_localAnchor1.x-c.m_sweep.localCenter.x,h=this.m_localAnchor1.y-c.m_sweep.localCenter.y,e=b.col1.x*g+b.col2.x*h,h=b.col1.y*g+b.col2.y*h,g=e,b=d.m_xf.R,i=this.m_localAnchor2.x-d.m_sweep.localCenter.x,j=this.m_localAnchor2.y-d.m_sweep.localCenter.y,e=b.col1.x*i+b.col2.x*j,j=b.col1.y*i+b.col2.y*j,i=e;var w=m.x+-n*j-k.x- -l*h,x=m.y+n*i-k.y-l*g,y=n-l;this.m_mass.Solve33(this.impulse3,-w,-x,-y),this.m_limitState===bb.e_equalLimits?this.m_impulse.Add(this.impulse3):this.m_limitState===bb.e_atLowerLimit?(f=this.m_impulse.z+this.impulse3.z,0>f&&(this.m_mass.Solve22(this.reduced,-w,-x),this.impulse3.x=this.reduced.x,this.impulse3.y=this.reduced.y,this.impulse3.z=-this.m_impulse.z,this.m_impulse.x+=this.reduced.x,this.m_impulse.y+=this.reduced.y,this.m_impulse.z=0)):this.m_limitState===bb.e_atUpperLimit&&(f=this.m_impulse.z+this.impulse3.z,f>0&&(this.m_mass.Solve22(this.reduced,-w,-x),this.impulse3.x=this.reduced.x,this.impulse3.y=this.reduced.y,this.impulse3.z=-this.m_impulse.z,this.m_impulse.x+=this.reduced.x,this.m_impulse.y+=this.reduced.y,this.m_impulse.z=0)),k.x-=o*this.impulse3.x,k.y-=o*this.impulse3.y,l-=q*(g*this.impulse3.y-h*this.impulse3.x+this.impulse3.z),m.x+=p*this.impulse3.x,m.y+=p*this.impulse3.y,n+=r*(i*this.impulse3.y-j*this.impulse3.x+this.impulse3.z)}else{b=c.m_xf.R,g=this.m_localAnchor1.x-c.m_sweep.localCenter.x,h=this.m_localAnchor1.y-c.m_sweep.localCenter.y,e=b.col1.x*g+b.col2.x*h,h=b.col1.y*g+b.col2.y*h,g=e,b=d.m_xf.R,i=this.m_localAnchor2.x-d.m_sweep.localCenter.x,j=this.m_localAnchor2.y-d.m_sweep.localCenter.y,e=b.col1.x*i+b.col2.x*j,j=b.col1.y*i+b.col2.y*j,i=e;var z=m.x+-n*j-k.x- -l*h,A=m.y+n*i-k.y-l*g;this.m_mass.Solve22(this.impulse2,-z,-A),this.m_impulse.x+=this.impulse2.x,this.m_impulse.y+=this.impulse2.y,k.x-=o*this.impulse2.x,k.y-=o*this.impulse2.y,l-=q*(g*this.impulse2.y-h*this.impulse2.x),m.x+=p*this.impulse2.x,m.y+=p*this.impulse2.y,n+=r*(i*this.impulse2.y-j*this.impulse2.x)}c.m_linearVelocity.SetV(k),c.m_angularVelocity=l,d.m_linearVelocity.SetV(m),d.m_angularVelocity=n},Bb.prototype.SolvePositionConstraints=function(){var a,b=0,c=this.m_bodyA,d=this.m_bodyB,e=0,f=0,g=0,h=0,i=0;if(this.m_enableLimit&&this.m_limitState!==bb.e_inactiveLimit){var j=d.m_sweep.a-c.m_sweep.a-this.m_referenceAngle,k=0;this.m_limitState===bb.e_equalLimits?(b=lb.Clamp(j-this.m_lowerAngle,-Fb.b2_maxAngularCorrection,Fb.b2_maxAngularCorrection),k=-this.m_motorMass*b,e=lb.Abs(b)):this.m_limitState===bb.e_atLowerLimit?(b=j-this.m_lowerAngle,e=-b,b=lb.Clamp(b+Fb.b2_angularSlop,-Fb.b2_maxAngularCorrection,0),k=-this.m_motorMass*b):this.m_limitState===bb.e_atUpperLimit&&(b=j-this.m_upperAngle,e=b,b=lb.Clamp(b-Fb.b2_angularSlop,0,Fb.b2_maxAngularCorrection),k=-this.m_motorMass*b),c.m_sweep.a-=c.m_invI*k,d.m_sweep.a+=d.m_invI*k,c.SynchronizeTransform(),d.SynchronizeTransform()}a=c.m_xf.R;var l=this.m_localAnchor1.x-c.m_sweep.localCenter.x,m=this.m_localAnchor1.y-c.m_sweep.localCenter.y;g=a.col1.x*l+a.col2.x*m,m=a.col1.y*l+a.col2.y*m,l=g,a=d.m_xf.R;var n=this.m_localAnchor2.x-d.m_sweep.localCenter.x,o=this.m_localAnchor2.y-d.m_sweep.localCenter.y;g=a.col1.x*n+a.col2.x*o,o=a.col1.y*n+a.col2.y*o,n=g;var p=d.m_sweep.c.x+n-c.m_sweep.c.x-l,q=d.m_sweep.c.y+o-c.m_sweep.c.y-m,r=p*p+q*q,s=Math.sqrt(r);f=s;var t=c.m_invMass,u=d.m_invMass,v=c.m_invI,w=d.m_invI,x=10*Fb.b2_linearSlop;if(r>x*x){var y=t+u,z=1/y;h=z*-p,i=z*-q;var A=.5;c.m_sweep.c.x-=A*t*h,c.m_sweep.c.y-=A*t*i,d.m_sweep.c.x+=A*u*h,d.m_sweep.c.y+=A*u*i,p=d.m_sweep.c.x+n-c.m_sweep.c.x-l,q=d.m_sweep.c.y+o-c.m_sweep.c.y-m}return this.K1.col1.x=t+u,this.K1.col2.x=0,this.K1.col1.y=0,this.K1.col2.y=t+u,this.K2.col1.x=v*m*m,this.K2.col2.x=-v*l*m,this.K2.col1.y=-v*l*m,this.K2.col2.y=v*l*l,this.K3.col1.x=w*o*o,this.K3.col2.x=-w*n*o,this.K3.col1.y=-w*n*o,this.K3.col2.y=w*n*n,this.K.SetM(this.K1),this.K.AddM(this.K2),this.K.AddM(this.K3),this.K.Solve(Bb.tImpulse,-p,-q),h=Bb.tImpulse.x,i=Bb.tImpulse.y,c.m_sweep.c.x-=c.m_invMass*h,c.m_sweep.c.y-=c.m_invMass*i,c.m_sweep.a-=c.m_invI*(l*i-m*h),d.m_sweep.c.x+=d.m_invMass*h,d.m_sweep.c.y+=d.m_invMass*i,d.m_sweep.a+=d.m_invI*(n*i-o*h),c.SynchronizeTransform(),d.SynchronizeTransform(),f<=Fb.b2_linearSlop&&e<=Fb.b2_angularSlop},Bb.prototype.GetType=function(){return this.m_type},Bb.prototype.GetBodyA=function(){return this.m_bodyA},Bb.prototype.GetBodyB=function(){return this.m_bodyB},Bb.prototype.GetNext=function(){return this.m_next},Bb.prototype.GetUserData=function(){return this.m_userData},Bb.prototype.SetUserData=function(a){this.m_userData=a},Bb.prototype.IsActive=function(){return this.m_bodyA.IsActive()&&this.m_bodyB.IsActive()},Bb.prototype.b2Joint=function(a){Wb(a.bodyA!==a.bodyB),this.m_type=a.type,this.m_prev=null,this.m_next=null,this.m_bodyA=a.bodyA,this.m_bodyB=a.bodyB,this.m_collideConnected=a.collideConnected,this.m_islandFlag=!1,this.m_userData=a.userData},Bb.prototype.FinalizeVelocityConstraints=function(){},Cb=Xb.Dynamics.Joints.b2RevoluteJointDef=function(){this.localAnchorA=new Qb(0,0),this.localAnchorB=new Qb(0,0),cb.call(this),this.type=bb.e_revoluteJoint,this.localAnchorA.Set(0,0),this.localAnchorB.Set(0,0)},Cb.constructor=Cb,Cb.prototype=Object.create(cb.prototype),Cb.prototype.type=bb.e_revoluteJoint,Cb.prototype.localAnchorA=null,Cb.prototype.localAnchorB=null,Cb.prototype.referenceAngle=0,Cb.prototype.lowerAngle=0,Cb.prototype.upperAngle=0,Cb.prototype.maxMotorTorque=0,Cb.prototype.motorSpeed=0,Cb.prototype.enableLimit=!1,Cb.prototype.enableMotor=!1,Cb.prototype.Initialize=function(a,b,c){this.bodyA=a,this.bodyB=b,this.localAnchorA=this.bodyA.GetLocalPoint(c),this.localAnchorB=this.bodyB.GetLocalPoint(c),this.referenceAngle=this.bodyB.GetAngle()-this.bodyA.GetAngle()},Cb.prototype.b2JointDef=function(){this.type=bb.e_unknownJoint,this.userData=null,this.bodyA=null,this.bodyB=null,this.collideConnected=!1},Sb=Xb.Dynamics.Joints.b2WeldJoint=function(a){this.m_localAnchorA=new Qb(0,0),this.m_localAnchorB=new Qb(0,0),this.m_impulse=new Rb(0,0,0),this.m_mass=new kb,bb.call(this,a),this.m_localAnchorA.SetV(a.localAnchorA),this.m_localAnchorB.SetV(a.localAnchorB),this.m_referenceAngle=a.referenceAngle,this.m_impulse.SetZero(),this.m_mass=new kb},Sb.constructor=Sb,Sb.prototype=Object.create(bb.prototype),Sb.prototype.m_impulse=null,Sb.prototype.m_mass=null,Sb.prototype.m_referenceAngle=0,Sb.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA)},Sb.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB)},Sb.prototype.GetReactionForce=function(a){return a=a||0,new Qb(a*this.m_impulse.x,a*this.m_impulse.y)},Sb.prototype.GetReactionTorque=function(a){return a=a||0,a*this.m_impulse.z},Sb.prototype.InitVelocityConstraints=function(a){var b,c=0,d=this.m_bodyA,e=this.m_bodyB;b=d.m_xf.R;var f=this.m_localAnchorA.x-d.m_sweep.localCenter.x,g=this.m_localAnchorA.y-d.m_sweep.localCenter.y;c=b.col1.x*f+b.col2.x*g,g=b.col1.y*f+b.col2.y*g,f=c,b=e.m_xf.R;var h=this.m_localAnchorB.x-e.m_sweep.localCenter.x,i=this.m_localAnchorB.y-e.m_sweep.localCenter.y;c=b.col1.x*h+b.col2.x*i,i=b.col1.y*h+b.col2.y*i,h=c;var j=d.m_invMass,k=e.m_invMass,l=d.m_invI,m=e.m_invI;this.m_mass.col1.x=j+k+g*g*l+i*i*m,this.m_mass.col2.x=-g*f*l-i*h*m,this.m_mass.col3.x=-g*l-i*m,this.m_mass.col1.y=this.m_mass.col2.x,this.m_mass.col2.y=j+k+f*f*l+h*h*m,this.m_mass.col3.y=f*l+h*m,this.m_mass.col1.z=this.m_mass.col3.x,this.m_mass.col2.z=this.m_mass.col3.y,this.m_mass.col3.z=l+m,a.warmStarting?(this.m_impulse.x*=a.dtRatio,this.m_impulse.y*=a.dtRatio,this.m_impulse.z*=a.dtRatio,d.m_linearVelocity.x-=j*this.m_impulse.x,d.m_linearVelocity.y-=j*this.m_impulse.y,d.m_angularVelocity-=l*(f*this.m_impulse.y-g*this.m_impulse.x+this.m_impulse.z),e.m_linearVelocity.x+=k*this.m_impulse.x,e.m_linearVelocity.y+=k*this.m_impulse.y,e.m_angularVelocity+=m*(h*this.m_impulse.y-i*this.m_impulse.x+this.m_impulse.z)):this.m_impulse.SetZero()},Sb.prototype.SolveVelocityConstraints=function(){var a,b=0,c=this.m_bodyA,d=this.m_bodyB,e=c.m_linearVelocity,f=c.m_angularVelocity,g=d.m_linearVelocity,h=d.m_angularVelocity,i=c.m_invMass,j=d.m_invMass,k=c.m_invI,l=d.m_invI;a=c.m_xf.R;var m=this.m_localAnchorA.x-c.m_sweep.localCenter.x,n=this.m_localAnchorA.y-c.m_sweep.localCenter.y;b=a.col1.x*m+a.col2.x*n,n=a.col1.y*m+a.col2.y*n,m=b,a=d.m_xf.R;var o=this.m_localAnchorB.x-d.m_sweep.localCenter.x,p=this.m_localAnchorB.y-d.m_sweep.localCenter.y;b=a.col1.x*o+a.col2.x*p,p=a.col1.y*o+a.col2.y*p,o=b;var q=g.x-h*p-e.x+f*n,r=g.y+h*o-e.y-f*m,s=h-f,t=new Rb(0,0,0);this.m_mass.Solve33(t,-q,-r,-s),this.m_impulse.Add(t),e.x-=i*t.x,e.y-=i*t.y,f-=k*(m*t.y-n*t.x+t.z),g.x+=j*t.x,g.y+=j*t.y,h+=l*(o*t.y-p*t.x+t.z),c.m_angularVelocity=f,d.m_angularVelocity=h},Sb.prototype.SolvePositionConstraints=function(a){a=a||0;var b,c=0,d=this.m_bodyA,e=this.m_bodyB;b=d.m_xf.R;var f=this.m_localAnchorA.x-d.m_sweep.localCenter.x,g=this.m_localAnchorA.y-d.m_sweep.localCenter.y;c=b.col1.x*f+b.col2.x*g,g=b.col1.y*f+b.col2.y*g,f=c,b=e.m_xf.R;var h=this.m_localAnchorB.x-e.m_sweep.localCenter.x,i=this.m_localAnchorB.y-e.m_sweep.localCenter.y;c=b.col1.x*h+b.col2.x*i,i=b.col1.y*h+b.col2.y*i,h=c;var j=d.m_invMass,k=e.m_invMass,l=d.m_invI,m=e.m_invI,n=e.m_sweep.c.x+h-d.m_sweep.c.x-f,o=e.m_sweep.c.y+i-d.m_sweep.c.y-g,p=e.m_sweep.a-d.m_sweep.a-this.m_referenceAngle,q=10*Fb.b2_linearSlop,r=Math.sqrt(n*n+o*o),s=lb.Abs(p);r>q&&(l*=1,m*=1),this.m_mass.col1.x=j+k+g*g*l+i*i*m,this.m_mass.col2.x=-g*f*l-i*h*m,this.m_mass.col3.x=-g*l-i*m,this.m_mass.col1.y=this.m_mass.col2.x,this.m_mass.col2.y=j+k+f*f*l+h*h*m,this.m_mass.col3.y=f*l+h*m,this.m_mass.col1.z=this.m_mass.col3.x,this.m_mass.col2.z=this.m_mass.col3.y,this.m_mass.col3.z=l+m;var t=new Rb(0,0,0);return this.m_mass.Solve33(t,-n,-o,-p),d.m_sweep.c.x-=j*t.x,d.m_sweep.c.y-=j*t.y,d.m_sweep.a-=l*(f*t.y-g*t.x+t.z),e.m_sweep.c.x+=k*t.x,e.m_sweep.c.y+=k*t.y,e.m_sweep.a+=m*(h*t.y-i*t.x+t.z),d.SynchronizeTransform(),e.SynchronizeTransform(),r<=Fb.b2_linearSlop&&s<=Fb.b2_angularSlop},Sb.prototype.GetType=function(){return this.m_type},Sb.prototype.GetBodyA=function(){return this.m_bodyA},Sb.prototype.GetBodyB=function(){return this.m_bodyB},Sb.prototype.GetNext=function(){return this.m_next},Sb.prototype.GetUserData=function(){return this.m_userData},Sb.prototype.SetUserData=function(a){this.m_userData=a},Sb.prototype.IsActive=function(){return this.m_bodyA.IsActive()&&this.m_bodyB.IsActive()},Sb.prototype.b2Joint=function(a){Wb(a.bodyA!==a.bodyB),this.m_type=a.type,this.m_prev=null,this.m_next=null,this.m_bodyA=a.bodyA,this.m_bodyB=a.bodyB,this.m_collideConnected=a.collideConnected,this.m_islandFlag=!1,this.m_userData=a.userData},Sb.prototype.FinalizeVelocityConstraints=function(){},Tb=Xb.Dynamics.Joints.b2WeldJointDef=function(){this.localAnchorA=new Qb(0,0),this.localAnchorB=new Qb(0,0)},Tb.constructor=Tb,Tb.prototype=Object.create(cb.prototype),Tb.prototype.type=bb.e_weldJoint,Tb.prototype.referenceAngle=0,Tb.prototype.localAnchorA=null,Tb.prototype.localAnchorB=null,Tb.prototype.Initialize=function(a,b,c){this.bodyA=a,this.bodyB=b,this.localAnchorA.SetV(this.bodyA.GetLocalPoint(c)),this.localAnchorB.SetV(this.bodyB.GetLocalPoint(c)),this.referenceAngle=this.bodyB.GetAngle()-this.bodyA.GetAngle()},Tb.prototype.b2JointDef=function(){this.type=bb.e_unknownJoint,this.userData=null,this.bodyA=null,this.bodyB=null,this.collideConnected=!1},w=Xb.Dynamics.b2ContactListener=function(){},w.constructor=w,w.prototype={BeginContact:function(){},EndContact:function(){},PreSolve:function(){},PostSolve:function(){}},w.b2_defaultListener=new w,t=Xb.Dynamics.b2ContactFilter=function(){},t.constructor=t,t.prototype={ShouldCollide:function(a,b){var c=a.GetFilterData(),d=b.GetFilterData();return c.groupIndex===d.groupIndex&&0!==c.groupIndex?c.groupIndex>0:0!==(c.maskBits&d.categoryBits)&&0!==(c.categoryBits&d.maskBits)},RayCollide:function(a,b){return a?this.ShouldCollide(a instanceof U?a:null,b):!0}},t.b2_defaultFilter=new t,U=Xb.Dynamics.b2Fixture=function(){this.m_filter=new T,this.m_aabb=new c},U.constructor=U,U.prototype={m_filter:null,m_shape:null,m_isSensor:!1,m_body:null,m_next:null,m_userData:null,m_density:0,m_friction:0,m_restitution:0,m_aabb:null,m_proxy:null,GetType:function(){return this.m_shape.GetType()},GetShape:function(){return this.m_shape},SetSensor:function(a){if(this.m_isSensor!==a&&(this.m_isSensor=a,null!=this.m_body))for(var b=this.m_body.GetContactList();b;){var c=b.contact,d=c.GetFixtureA(),e=c.GetFixtureB();(d===this||e===this)&&c.SetSensor(d.IsSensor()||e.IsSensor()),b=b.next}},IsSensor:function(){return this.m_isSensor},SetFilterData:function(a){if(this.m_filter=a.Copy(),!this.m_body)for(var b=this.m_body.GetContactList();b;){var c=b.contact,d=c.GetFixtureA(),e=c.GetFixtureB();(d===this||e===this)&&c.FlagForFiltering(),b=b.next}},GetFilterData:function(){return this.m_filter.Copy()},GetBody:function(){return this.m_body},GetNext:function(){return this.m_next},GetUserData:function(){return this.m_userData},SetUserData:function(a){this.m_userData=a},TestPoint:function(a){return this.m_shape.TestPoint(this.m_body.GetTransform(),a)},RayCast:function(a,b){return this.m_shape.RayCast(a,b,this.m_body.GetTransform())},GetMassData:function(a){return a=a||null,null==a&&(a=new ib),this.m_shape.ComputeMass(a,this.m_density),a},SetDensity:function(a){a=a||0,this.m_density=a},GetDensity:function(){return this.m_density},GetFriction:function(){return this.m_friction},SetFriction:function(a){a=a||0,this.m_friction=a},GetRestitution:function(){return this.m_restitution},SetRestitution:function(a){a=a||0,this.m_restitution=a},GetAABB:function(){return this.m_aabb},Create:function(a,b,c){this.m_userData=c.userData,this.m_friction=c.friction,this.m_restitution=c.restitution,this.m_body=a,this.m_next=null,this.m_filter=c.filter.Copy(),this.m_isSensor=c.isSensor,this.m_shape=c.shape.Copy(),this.m_density=c.density},Destroy:function(){this.m_shape=null},CreateProxy:function(a,b){this.m_shape.ComputeAABB(this.m_aabb,b),this.m_proxy=a.CreateProxy(this.m_aabb,this)},DestroyProxy:function(a){null!=this.m_proxy&&(a.DestroyProxy(this.m_proxy),this.m_proxy=null)},Synchronize:function(a,b,d){if(this.m_proxy){var e=new c,f=new c;this.m_shape.ComputeAABB(e,b),this.m_shape.ComputeAABB(f,d),this.m_aabb.Combine(e,f);var g=lb.SubtractVV(d.position,b.position);a.MoveProxy(this.m_proxy,this.m_aabb,g)}}},x=Xb.Dynamics.b2ContactManager=function(){this.m_world=null,this.m_contactCount=0,this.m_contactFilter=t.b2_defaultFilter,this.m_contactListener=w.b2_defaultListener,this.m_contactFactory=new s(this.m_allocator),this.m_broadPhase=new N},x.s_evalCP=new y,x.constructor=x,x.prototype={m_world:null,m_contactCount:null,m_contactFilter:null,m_contactListener:null,m_contactFactory:null,m_broadPhase:null,AddPair:function(a,b){var c=a instanceof U?a:null,d=b instanceof U?b:null,e=c.GetBody(),f=d.GetBody();if(e!==f){for(var g=f.GetContactList();g;){if(g.other===e){var h=g.contact.GetFixtureA(),i=g.contact.GetFixtureB();if(h===c&&i===d)return;if(h===d&&i===c)return}g=g.next}if(f.ShouldCollide(e)!==!1&&this.m_contactFilter.ShouldCollide(c,d)!==!1){var j=this.m_contactFactory.Create(c,d);c=j.GetFixtureA(),d=j.GetFixtureB(),e=c.m_body,f=d.m_body,j.m_prev=null,j.m_next=this.m_world.m_contactList,null!=this.m_world.m_contactList&&(this.m_world.m_contactList.m_prev=j),this.m_world.m_contactList=j,j.m_nodeA.contact=j,j.m_nodeA.other=f,j.m_nodeA.prev=null,j.m_nodeA.next=e.m_contactList,null!=e.m_contactList&&(e.m_contactList.prev=j.m_nodeA),e.m_contactList=j.m_nodeA,j.m_nodeB.contact=j,j.m_nodeB.other=e,j.m_nodeB.prev=null,j.m_nodeB.next=f.m_contactList,null!=f.m_contactList&&(f.m_contactList.prev=j.m_nodeB),f.m_contactList=j.m_nodeB,++this.m_world.m_contactCount}}},FindNewContacts:function(){var a=function(a,b){return function(){b.apply(a,arguments)}};this.m_broadPhase.UpdatePairs(a(this,this.AddPair))},Destroy:function(a){var b=a.GetFixtureA(),c=a.GetFixtureB(),d=b.GetBody(),e=c.GetBody();a.IsTouching()&&this.m_contactListener.EndContact(a),a.m_prev&&(a.m_prev.m_next=a.m_next),a.m_next&&(a.m_next.m_prev=a.m_prev),a===this.m_world.m_contactList&&(this.m_world.m_contactList=a.m_next),a.m_nodeA.prev&&(a.m_nodeA.prev.next=a.m_nodeA.next),a.m_nodeA.next&&(a.m_nodeA.next.prev=a.m_nodeA.prev),a.m_nodeA===d.m_contactList&&(d.m_contactList=a.m_nodeA.next),a.m_nodeB.prev&&(a.m_nodeB.prev.next=a.m_nodeB.next),a.m_nodeB.next&&(a.m_nodeB.next.prev=a.m_nodeB.prev),a.m_nodeB===e.m_contactList&&(e.m_contactList=a.m_nodeB.next),this.m_contactFactory.Destroy(a),--this.m_contactCount
},Collide:function(){for(var a=this.m_world.m_contactList;a;){var b=a.GetFixtureA(),c=a.GetFixtureB(),d=b.GetBody(),e=c.GetBody();if(d.IsAwake()!==!1||e.IsAwake()!==!1){if(a.m_flags&o.e_filterFlag){if(e.ShouldCollide(d)===!1){var f=a;a=f.GetNext(),this.Destroy(f);continue}if(this.m_contactFilter.ShouldCollide(b,c)===!1){f=a,a=f.GetNext(),this.Destroy(f);continue}a.m_flags&=~o.e_filterFlag}var g=b.m_proxy,h=c.m_proxy,i=this.m_broadPhase.TestOverlap(g,h);i!==!1?(a.Update(this.m_contactListener),a=a.GetNext()):(f=a,a=f.GetNext(),this.Destroy(f))}else a=a.GetNext()}}},d=Xb.Dynamics.b2Body=function Zb(a,b){this.m_xf=new Pb,this.m_sweep=new Kb,this.m_linearVelocity=new Qb(0,0),this.m_force=new Qb(0,0),a.bullet&&(this.m_flags|=Zb.e_bulletFlag),a.fixedRotation&&(this.m_flags|=Zb.e_fixedRotationFlag),a.allowSleep&&(this.m_flags|=Zb.e_allowSleepFlag),a.awake&&(this.m_flags|=Zb.e_awakeFlag),a.active&&(this.m_flags|=Zb.e_activeFlag),this.m_world=b,this.m_xf.position.SetV(a.position),this.m_xf.R.Set(a.angle),this.m_sweep.localCenter.SetZero(),this.m_sweep.t0=1,this.m_sweep.a0=this.m_sweep.a=a.angle;var c=this.m_xf.R,d=this.m_sweep.localCenter;this.m_sweep.c.x=c.col1.x*d.x+c.col2.x*d.y,this.m_sweep.c.y=c.col1.y*d.x+c.col2.y*d.y,this.m_sweep.c.x+=this.m_xf.position.x,this.m_sweep.c.y+=this.m_xf.position.y,this.m_sweep.c0.SetV(this.m_sweep.c),this.m_linearVelocity.SetV(a.linearVelocity),this.m_angularVelocity=a.angularVelocity,this.m_linearDamping=a.linearDamping,this.m_angularDamping=a.angularDamping,this.m_force.Set(0,0),this.m_type=a.type,this.m_type===Zb.b2_dynamicBody&&(this.m_mass=1,this.m_invMass=1),this.m_inertiaScale=a.inertiaScale,this.m_userData=a.userData},d.s_xf1=new Pb,d.e_islandFlag=1,d.e_awakeFlag=2,d.e_allowSleepFlag=4,d.e_bulletFlag=8,d.e_fixedRotationFlag=16,d.e_activeFlag=32,d.b2_staticBody=0,d.b2_kinematicBody=1,d.b2_dynamicBody=2,d.constructor=d,d.prototype={m_xf:null,m_sweep:null,m_flags:0,m_world:null,m_jointList:null,m_controllerList:null,m_contactList:null,m_controllerCount:0,m_prev:null,m_next:null,m_linearVelocity:null,m_angularVelocity:null,m_linearDamping:null,m_angularDamping:null,m_force:null,m_torque:0,m_sleepTime:0,m_type:0,m_mass:0,m_invMass:0,m_I:0,m_invI:0,m_inertiaScale:0,m_userData:null,m_fixtureList:null,m_fixtureCount:0,connectEdges:function(a,b,c){c=c||0;var d=Math.atan2(b.GetDirectionVector().y,b.GetDirectionVector().x),e=Math.tan(.5*(d-c)),f=lb.MulFV(e,b.GetDirectionVector());f=lb.SubtractVV(f,b.GetNormalVector()),f=lb.MulFV(Fb.b2_toiSlop,f),f=lb.AddVV(f,b.GetVertex1());var g=lb.AddVV(a.GetDirectionVector(),b.GetDirectionVector());g.Normalize();var h=lb.Dot(a.GetDirectionVector(),b.GetNormalVector())>0;return a.SetNextEdge(b,f,g,h),b.SetPrevEdge(a,f,g,h),d},CreateFixture:function(a){if(this.m_world.IsLocked()===!0)return null;var b=new U;if(b.Create(this,this.m_xf,a),this.m_flags&d.e_activeFlag){var c=this.m_world.m_contactManager.m_broadPhase;b.CreateProxy(c,this.m_xf)}return b.m_next=this.m_fixtureList,this.m_fixtureList=b,++this.m_fixtureCount,b.m_body=this,b.m_density>0&&this.ResetMassData(),this.m_world.m_flags|=Ub.e_newFixture,b},CreateFixture2:function(a,b){b=b||0;var c=new V;return c.shape=a,c.density=b,this.CreateFixture(c)},DestroyFixture:function(a){if(this.m_world.IsLocked()!==!0){for(var b=this.m_fixtureList,c=null,e=!1;null!=b;){if(b===a){c?c.m_next=a.m_next:this.m_fixtureList=a.m_next,e=!0;break}c=b,b=b.m_next}for(var f=this.m_contactList;f;){var g=f.contact;f=f.next;var h=g.GetFixtureA(),i=g.GetFixtureB();(a===h||a===i)&&this.m_world.m_contactManager.Destroy(g)}if(this.m_flags&d.e_activeFlag){var j=this.m_world.m_contactManager.m_broadPhase;a.DestroyProxy(j)}a.Destroy(),a.m_body=null,a.m_next=null,--this.m_fixtureCount,this.ResetMassData()}},SetPositionAndAngle:function(a,b){b=b||0;var c;if(this.m_world.IsLocked()!==!0){this.m_xf.R.Set(b),this.m_xf.position.SetV(a);var d=this.m_xf.R,e=this.m_sweep.localCenter;this.m_sweep.c.x=d.col1.x*e.x+d.col2.x*e.y,this.m_sweep.c.y=d.col1.y*e.x+d.col2.y*e.y,this.m_sweep.c.x+=this.m_xf.position.x,this.m_sweep.c.y+=this.m_xf.position.y,this.m_sweep.c0.SetV(this.m_sweep.c),this.m_sweep.a0=this.m_sweep.a=b;var f=this.m_world.m_contactManager.m_broadPhase;for(c=this.m_fixtureList;c;c=c.m_next)c.Synchronize(f,this.m_xf,this.m_xf);this.m_world.m_contactManager.FindNewContacts()}},SetTransform:function(a){this.SetPositionAndAngle(a.position,a.GetAngle())},GetTransform:function(){return this.m_xf},GetPosition:function(){return this.m_xf.position},SetPosition:function(a){this.SetPositionAndAngle(a,this.GetAngle())},GetAngle:function(){return this.m_sweep.a},SetAngle:function(a){a=a||0,this.SetPositionAndAngle(this.GetPosition(),a)},GetWorldCenter:function(){return this.m_sweep.c},GetLocalCenter:function(){return this.m_sweep.localCenter},SetLinearVelocity:function(a){this.m_type!==d.b2_staticBody&&this.m_linearVelocity.SetV(a)},GetLinearVelocity:function(){return this.m_linearVelocity},SetAngularVelocity:function(a){this.m_type!==d.b2_staticBody&&(this.m_angularVelocity=a)},GetAngularVelocity:function(){return this.m_angularVelocity},GetDefinition:function(){var a=new e;return a.type=this.GetType(),a.allowSleep=(this.m_flags&d.e_allowSleepFlag)===d.e_allowSleepFlag,a.angle=this.GetAngle(),a.angularDamping=this.m_angularDamping,a.angularVelocity=this.m_angularVelocity,a.fixedRotation=(this.m_flags&d.e_fixedRotationFlag)===d.e_fixedRotationFlag,a.bullet=(this.m_flags&d.e_bulletFlag)===d.e_bulletFlag,a.awake=(this.m_flags&d.e_awakeFlag)===d.e_awakeFlag,a.linearDamping=this.m_linearDamping,a.linearVelocity.SetV(this.GetLinearVelocity()),a.position=this.GetPosition(),a.userData=this.GetUserData(),a},ApplyForce:function(a,b){this.m_type===d.b2_dynamicBody&&(this.IsAwake()===!1&&this.SetAwake(!0),this.m_force.x+=a.x,this.m_force.y+=a.y,this.m_torque+=(b.x-this.m_sweep.c.x)*a.y-(b.y-this.m_sweep.c.y)*a.x)},ApplyTorque:function(a){this.m_type===d.b2_dynamicBody&&(this.IsAwake()===!1&&this.SetAwake(!0),this.m_torque+=a)},ApplyImpulse:function(a,b){this.m_type===d.b2_dynamicBody&&(this.IsAwake()===!1&&this.SetAwake(!0),this.m_linearVelocity.x+=this.m_invMass*a.x,this.m_linearVelocity.y+=this.m_invMass*a.y,this.m_angularVelocity+=this.m_invI*((b.x-this.m_sweep.c.x)*a.y-(b.y-this.m_sweep.c.y)*a.x))},Split:function(a){for(var b,c=this.GetLinearVelocity().Copy(),d=this.GetAngularVelocity(),e=this.GetWorldCenter(),f=this,g=this.m_world.CreateBody(this.GetDefinition()),h=f.m_fixtureList;h;)if(a(h)){var i=h.m_next;b?b.m_next=i:f.m_fixtureList=i,f.m_fixtureCount--,h.m_next=g.m_fixtureList,g.m_fixtureList=h,g.m_fixtureCount++,h.m_body=g,h=i}else b=h,h=h.m_next;f.ResetMassData(),g.ResetMassData();var j=f.GetWorldCenter(),k=g.GetWorldCenter(),l=lb.AddVV(c,lb.CrossFV(d,lb.SubtractVV(j,e))),m=lb.AddVV(c,lb.CrossFV(d,lb.SubtractVV(k,e)));return f.SetLinearVelocity(l),g.SetLinearVelocity(m),f.SetAngularVelocity(d),g.SetAngularVelocity(d),f.SynchronizeFixtures(),g.SynchronizeFixtures(),g},Merge:function(a){var b;for(b=a.m_fixtureList;b;){var c=b.m_next;a.m_fixtureCount--,b.m_next=this.m_fixtureList,this.m_fixtureList=b,this.m_fixtureCount++,b.m_body=e,b=c}d.m_fixtureCount=0;{var d=this,e=a;d.GetWorldCenter(),e.GetWorldCenter(),d.GetLinearVelocity().Copy(),e.GetLinearVelocity().Copy(),d.GetAngularVelocity(),e.GetAngularVelocity()}d.ResetMassData(),this.SynchronizeFixtures()},GetMass:function(){return this.m_mass},GetInertia:function(){return this.m_I},GetMassData:function(a){a.mass=this.m_mass,a.I=this.m_I,a.center.SetV(this.m_sweep.localCenter)},SetMassData:function(a){if(Wb(this.m_world.IsLocked()===!1),this.m_world.IsLocked()!==!0&&this.m_type===d.b2_dynamicBody){this.m_invMass=0,this.m_I=0,this.m_invI=0,this.m_mass=a.mass,this.m_mass<=0&&(this.m_mass=1),this.m_invMass=1/this.m_mass,a.I>0&&0===(this.m_flags&d.e_fixedRotationFlag)&&(this.m_I=a.I-this.m_mass*(a.center.x*a.center.x+a.center.y*a.center.y),this.m_invI=1/this.m_I);var b=this.m_sweep.c.Copy();this.m_sweep.localCenter.SetV(a.center),this.m_sweep.c0.SetV(lb.MulX(this.m_xf,this.m_sweep.localCenter)),this.m_sweep.c.SetV(this.m_sweep.c0),this.m_linearVelocity.x+=this.m_angularVelocity*-(this.m_sweep.c.y-b.y),this.m_linearVelocity.y+=this.m_angularVelocity*+(this.m_sweep.c.x-b.x)}},ResetMassData:function(){if(this.m_mass=0,this.m_invMass=0,this.m_I=0,this.m_invI=0,this.m_sweep.localCenter.SetZero(),this.m_type!==d.b2_staticBody&&this.m_type!==d.b2_kinematicBody){for(var a=Qb.Make(0,0),b=this.m_fixtureList;b;b=b.m_next)if(0!==b.m_density){var c=b.GetMassData();this.m_mass+=c.mass,a.x+=c.center.x*c.mass,a.y+=c.center.y*c.mass,this.m_I+=c.I}this.m_mass>0?(this.m_invMass=1/this.m_mass,a.x*=this.m_invMass,a.y*=this.m_invMass):(this.m_mass=1,this.m_invMass=1),this.m_I>0&&0===(this.m_flags&d.e_fixedRotationFlag)?(this.m_I-=this.m_mass*(a.x*a.x+a.y*a.y),this.m_I*=this.m_inertiaScale,Wb(this.m_I>0),this.m_invI=1/this.m_I):(this.m_I=0,this.m_invI=0);var e=this.m_sweep.c.Copy();this.m_sweep.localCenter.SetV(a),this.m_sweep.c0.SetV(lb.MulX(this.m_xf,this.m_sweep.localCenter)),this.m_sweep.c.SetV(this.m_sweep.c0),this.m_linearVelocity.x+=this.m_angularVelocity*-(this.m_sweep.c.y-e.y),this.m_linearVelocity.y+=this.m_angularVelocity*+(this.m_sweep.c.x-e.x)}},GetWorldPoint:function(a){var b=this.m_xf.R,c=new Qb(b.col1.x*a.x+b.col2.x*a.y,b.col1.y*a.x+b.col2.y*a.y);return c.x+=this.m_xf.position.x,c.y+=this.m_xf.position.y,c},GetWorldVector:function(a){return lb.MulMV(this.m_xf.R,a)},GetLocalPoint:function(a){return lb.MulXT(this.m_xf,a)},GetLocalVector:function(a){return lb.MulTMV(this.m_xf.R,a)},GetLinearVelocityFromWorldPoint:function(a){return new Qb(this.m_linearVelocity.x-this.m_angularVelocity*(a.y-this.m_sweep.c.y),this.m_linearVelocity.y+this.m_angularVelocity*(a.x-this.m_sweep.c.x))},GetLinearVelocityFromLocalPoint:function(a){var b=this.m_xf.R,c=new Qb(b.col1.x*a.x+b.col2.x*a.y,b.col1.y*a.x+b.col2.y*a.y);return c.x+=this.m_xf.position.x,c.y+=this.m_xf.position.y,new Qb(this.m_linearVelocity.x-this.m_angularVelocity*(c.y-this.m_sweep.c.y),this.m_linearVelocity.y+this.m_angularVelocity*(c.x-this.m_sweep.c.x))},GetLinearDamping:function(){return this.m_linearDamping},SetLinearDamping:function(a){a=a||0,this.m_linearDamping=a},GetAngularDamping:function(){return this.m_angularDamping},SetAngularDamping:function(a){a=a||0,this.m_angularDamping=a},SetType:function(a){if(a=a||0,this.m_type!==a){this.m_type=a,this.ResetMassData(),this.m_type===d.b2_staticBody&&(this.m_linearVelocity.SetZero(),this.m_angularVelocity=0),this.SetAwake(!0),this.m_force.SetZero(),this.m_torque=0;for(var b=this.m_contactList;b;b=b.next)b.contact.FlagForFiltering()}},GetType:function(){return this.m_type},SetBullet:function(a){a?this.m_flags|=d.e_bulletFlag:this.m_flags&=~d.e_bulletFlag},IsBullet:function(){return(this.m_flags&d.e_bulletFlag)===d.e_bulletFlag},SetSleepingAllowed:function(a){a?this.m_flags|=d.e_allowSleepFlag:(this.m_flags&=~d.e_allowSleepFlag,this.SetAwake(!0))},SetAwake:function(a){a?(this.m_flags|=d.e_awakeFlag,this.m_sleepTime=0):(this.m_flags&=~d.e_awakeFlag,this.m_sleepTime=0,this.m_linearVelocity.SetZero(),this.m_angularVelocity=0,this.m_force.SetZero(),this.m_torque=0)},IsAwake:function(){return(this.m_flags&d.e_awakeFlag)===d.e_awakeFlag},SetFixedRotation:function(a){a?this.m_flags|=d.e_fixedRotationFlag:this.m_flags&=~d.e_fixedRotationFlag,this.ResetMassData()},IsFixedRotation:function(){return(this.m_flags&d.e_fixedRotationFlag)===d.e_fixedRotationFlag},SetActive:function(a){if(a!==this.IsActive()){var b,c;if(a)for(this.m_flags|=d.e_activeFlag,b=this.m_world.m_contactManager.m_broadPhase,c=this.m_fixtureList;c;c=c.m_next)c.CreateProxy(b,this.m_xf);else{for(this.m_flags&=~d.e_activeFlag,b=this.m_world.m_contactManager.m_broadPhase,c=this.m_fixtureList;c;c=c.m_next)c.DestroyProxy(b);for(var e=this.m_contactList;e;){var f=e;e=e.next,this.m_world.m_contactManager.Destroy(f.contact)}this.m_contactList=null}}},IsActive:function(){return(this.m_flags&d.e_activeFlag)===d.e_activeFlag},IsSleepingAllowed:function(){return(this.m_flags&d.e_allowSleepFlag)===d.e_allowSleepFlag},GetFixtureList:function(){return this.m_fixtureList},GetJointList:function(){return this.m_jointList},GetControllerList:function(){return this.m_controllerList},GetContactList:function(){return this.m_contactList},GetNext:function(){return this.m_next},GetUserData:function(){return this.m_userData},SetUserData:function(a){this.m_userData=a},GetWorld:function(){return this.m_world},SynchronizeFixtures:function(){var a=d.s_xf1;a.R.Set(this.m_sweep.a0);var b=a.R,c=this.m_sweep.localCenter;a.position.x=this.m_sweep.c0.x-(b.col1.x*c.x+b.col2.x*c.y),a.position.y=this.m_sweep.c0.y-(b.col1.y*c.x+b.col2.y*c.y);var e,f=this.m_world.m_contactManager.m_broadPhase;for(e=this.m_fixtureList;e;e=e.m_next)e.Synchronize(f,a,this.m_xf)},SynchronizeTransform:function(){this.m_xf.R.Set(this.m_sweep.a);var a=this.m_xf.R,b=this.m_sweep.localCenter;this.m_xf.position.x=this.m_sweep.c.x-(a.col1.x*b.x+a.col2.x*b.y),this.m_xf.position.y=this.m_sweep.c.y-(a.col1.y*b.x+a.col2.y*b.y)},ShouldCollide:function(a){if(this.m_type!==d.b2_dynamicBody&&a.m_type!==d.b2_dynamicBody)return!1;for(var b=this.m_jointList;b;b=b.next)if(b.other===a&&b.joint.m_collideConnected===!1)return!1;return!0},Advance:function(a){a=a||0,this.m_sweep.Advance(a),this.m_sweep.c.SetV(this.m_sweep.c0),this.m_sweep.a=this.m_sweep.a0,this.SynchronizeTransform()}},E=Xb.Dynamics.b2DebugDraw=function(){this.m_drawScale=1,this.m_lineThickness=1,this.m_alpha=1,this.m_fillAlpha=1,this.m_xformScale=1;var a=this;this.m_sprite={graphics:{clear:function(){a.m_ctx.clearRect(0,0,a.m_ctx.canvas.width,a.m_ctx.canvas.height)}}},this.m_drawFlags=0},E.e_shapeBit=1,E.e_jointBit=2,E.e_aabbBit=4,E.e_pairBit=8,E.e_centerOfMassBit=16,E.e_controllerBit=32,E.constructor=E,E.prototype={m_drawScale:1,m_lineThickness:1,m_alpha:1,m_fillAlpha:1,m_xformScale:1,m_drawFlags:0,m_ctx:null,SetFlags:function(a){a=a||0,this.m_drawFlags=a},GetFlags:function(){return this.m_drawFlags},AppendFlags:function(a){a=a||0,this.m_drawFlags|=a},ClearFlags:function(a){a=a||0,this.m_drawFlags&=~a},SetSprite:function(a){this.m_ctx=a},GetSprite:function(){return this.m_ctx},SetDrawScale:function(a){a=a||0,this.m_drawScale=a},GetDrawScale:function(){return this.m_drawScale},SetLineThickness:function(a){a=a||0,this.m_lineThickness=a,this.m_ctx.strokeWidth=a},GetLineThickness:function(){return this.m_lineThickness},SetAlpha:function(a){a=a||0,this.m_alpha=a},GetAlpha:function(){return this.m_alpha},SetFillAlpha:function(a){a=a||0,this.m_fillAlpha=a},GetFillAlpha:function(){return this.m_fillAlpha},SetXFormScale:function(a){a=a||0,this.m_xformScale=a},GetXFormScale:function(){return this.m_xformScale},DrawPolygon:function(a,b,c){if(b){var d=this.m_ctx,e=this.m_drawScale;d.beginPath(),d.strokeStyle=this._color(c.color,this.m_alpha),d.moveTo(a[0].x*e,a[0].y*e);for(var f=1;b>f;f++)d.lineTo(a[f].x*e,a[f].y*e);d.lineTo(a[0].x*e,a[0].y*e),d.closePath(),d.stroke()}},DrawSolidPolygon:function(a,b,c){if(b){var d=this.m_ctx,e=this.m_drawScale;d.beginPath(),d.strokeStyle=this._color(c.color,this.m_alpha),d.fillStyle=this._color(c.color,this.m_fillAlpha),d.moveTo(a[0].x*e,a[0].y*e);for(var f=1;b>f;f++)d.lineTo(a[f].x*e,a[f].y*e);d.lineTo(a[0].x*e,a[0].y*e),d.closePath(),d.fill(),d.stroke()}},DrawCircle:function(a,b,c){if(b){var d=this.m_ctx,e=this.m_drawScale;d.beginPath(),d.strokeStyle=this._color(c.color,this.m_alpha),d.arc(a.x*e,a.y*e,b*e,0,2*Math.PI,!0),d.closePath(),d.stroke()}},DrawSolidCircle:function(a,b,c,d){if(b){var e=this.m_ctx,f=this.m_drawScale,g=a.x*f,h=a.y*f;e.moveTo(0,0),e.beginPath(),e.strokeStyle=this._color(d.color,this.m_alpha),e.fillStyle=this._color(d.color,this.m_fillAlpha),e.arc(g,h,b*f,0,2*Math.PI,!0),e.moveTo(g,h),e.lineTo((a.x+c.x*b)*f,(a.y+c.y*b)*f),e.closePath(),e.fill(),e.stroke()}},DrawSegment:function(a,b,c){var d=this.m_ctx,e=this.m_drawScale;d.strokeStyle=this._color(c.color,this.m_alpha),d.beginPath(),d.moveTo(a.x*e,a.y*e),d.lineTo(b.x*e,b.y*e),d.closePath(),d.stroke()},DrawTransform:function(a){var b=this.m_ctx,c=this.m_drawScale;b.beginPath(),b.strokeStyle=this._color(16711680,this.m_alpha),b.moveTo(a.position.x*c,a.position.y*c),b.lineTo((a.position.x+this.m_xformScale*a.R.col1.x)*c,(a.position.y+this.m_xformScale*a.R.col1.y)*c),b.strokeStyle=this._color(65280,this.m_alpha),b.moveTo(a.position.x*c,a.position.y*c),b.lineTo((a.position.x+this.m_xformScale*a.R.col2.x)*c,(a.position.y+this.m_xformScale*a.R.col2.y)*c),b.closePath(),b.stroke()},_color:function(a,b){return"rgba("+((16711680&a)>>16)+","+((65280&a)>>8)+","+(255&a)+","+b+")"}},e=Xb.Dynamics.b2BodyDef=function(){this.position=new Qb(0,0),this.linearVelocity=new Qb(0,0),this.position.Set(0,0),this.linearVelocity.Set(0,0)},e.prototype={position:null,userData:null,angle:0,linearVelocity:null,angularVelocity:0,linearDamping:0,angularDamping:0,allowSleep:!0,awake:!0,fixedRotation:!1,bullet:!1,type:d.b2_staticBody,active:!0,inertiaScale:1},v=Xb.Dynamics.b2ContactImpulse=function(){this.normalImpulses=[],this.tangentImpulses=[];for(var a=0;a<Fb.b2_maxManifoldPoints;a++)this.normalImpulses.push(0),this.tangentImpulses.push(0)},v.constructor=v,v.prototype={normalImpulses:null,tangentImpulses:null},V=Xb.Dynamics.b2FixtureDef=function(){this.filter=new T},V.prototype={shape:null,userData:null,friction:.2,restitution:0,density:0,isSensor:!1,filter:null},_=Xb.Dynamics.b2Island=function(){this.m_bodies=[],this.m_contacts=[],this.m_joints=[]},_.s_impulse=new v,_.constructor=_,_.prototype={m_bodies:null,m_contacts:null,m_joints:null,m_bodyCapacity:0,m_contactCapacity:0,m_jointCapacity:0,m_bodyCount:0,m_contactCount:0,m_jointCount:0,m_allocator:null,m_listener:null,m_contactSolver:null,Initialize:function(a,b,c,d,e,f){var g;for(this.m_bodyCapacity=a,this.m_contactCapacity=b,this.m_jointCapacity=c,this.m_allocator=d,this.m_listener=e,this.m_contactSolver=f,g=this.m_bodies.length;a>g;g++)this.m_bodies[g]=null;for(g=this.m_contacts.length;b>g;g++)this.m_contacts[g]=null;for(g=this.m_joints.length;c>g;g++)this.m_joints[g]=null},Clear:function(){this.m_bodyCount=0,this.m_contactCount=0,this.m_jointCount=0},Solve:function(a,b,c){var e,f,g=0,h=0;for(g=0;g<this.m_bodyCount;++g)e=this.m_bodies[g],e.GetType()===d.b2_dynamicBody&&(e.m_linearVelocity.x+=a.dt*(b.x+e.m_invMass*e.m_force.x),e.m_linearVelocity.y+=a.dt*(b.y+e.m_invMass*e.m_force.y),e.m_angularVelocity+=a.dt*e.m_invI*e.m_torque,e.m_linearVelocity.Multiply(lb.Clamp(1-a.dt*e.m_linearDamping,0,1)),e.m_angularVelocity*=lb.Clamp(1-a.dt*e.m_angularDamping,0,1));this.m_contactSolver.Initialize(a,this.m_contacts,this.m_contactCount,this.m_allocator);var i=this.m_contactSolver;for(i.InitVelocityConstraints(a),g=0;g<this.m_jointCount;++g)f=this.m_joints[g],f.InitVelocityConstraints(a);for(g=0;g<a.velocityIterations;++g){for(h=0;h<this.m_jointCount;++h)f=this.m_joints[h],f.SolveVelocityConstraints(a);i.SolveVelocityConstraints()}for(g=0;g<this.m_jointCount;++g)f=this.m_joints[g],f.FinalizeVelocityConstraints();for(i.FinalizeVelocityConstraints(),g=0;g<this.m_bodyCount;++g)if(e=this.m_bodies[g],e.GetType()!==d.b2_staticBody){var j=a.dt*e.m_linearVelocity.x,k=a.dt*e.m_linearVelocity.y;j*j+k*k>Fb.b2_maxTranslationSquared&&(e.m_linearVelocity.Normalize(),e.m_linearVelocity.x*=Fb.b2_maxTranslation*a.inv_dt,e.m_linearVelocity.y*=Fb.b2_maxTranslation*a.inv_dt);var l=a.dt*e.m_angularVelocity;l*l>Fb.b2_maxRotationSquared&&(e.m_angularVelocity=e.m_angularVelocity<0?-Fb.b2_maxRotation*a.inv_dt:Fb.b2_maxRotation*a.inv_dt),e.m_sweep.c0.SetV(e.m_sweep.c),e.m_sweep.a0=e.m_sweep.a,e.m_sweep.c.x+=a.dt*e.m_linearVelocity.x,e.m_sweep.c.y+=a.dt*e.m_linearVelocity.y,e.m_sweep.a+=a.dt*e.m_angularVelocity,e.SynchronizeTransform()}for(g=0;g<a.positionIterations;++g){var m=i.SolvePositionConstraints(Fb.b2_contactBaumgarte),n=!0;for(h=0;h<this.m_jointCount;++h){f=this.m_joints[h];var o=f.SolvePositionConstraints(Fb.b2_contactBaumgarte);n=n&&o}if(m&&n)break}if(this.Report(i.m_constraints),c){var p=Fb.b2_maxFloat,q=Fb.b2_linearSleepTolerance*Fb.b2_linearSleepTolerance,r=Fb.b2_angularSleepTolerance*Fb.b2_angularSleepTolerance;for(g=0;g<this.m_bodyCount;++g)e=this.m_bodies[g],e.GetType()!==d.b2_staticBody&&(0===(e.m_flags&d.e_allowSleepFlag)&&(e.m_sleepTime=0,p=0),0===(e.m_flags&d.e_allowSleepFlag)||e.m_angularVelocity*e.m_angularVelocity>r||lb.Dot(e.m_linearVelocity,e.m_linearVelocity)>q?(e.m_sleepTime=0,p=0):(e.m_sleepTime+=a.dt,p=lb.Min(p,e.m_sleepTime)));if(p>=Fb.b2_timeToSleep)for(g=0;g<this.m_bodyCount;++g)e=this.m_bodies[g],e.SetAwake(!1)}},SolveTOI:function(a){var b=0,c=0;this.m_contactSolver.Initialize(a,this.m_contacts,this.m_contactCount,this.m_allocator);var e=this.m_contactSolver;for(b=0;b<this.m_jointCount;++b)this.m_joints[b].InitVelocityConstraints(a);for(b=0;b<a.velocityIterations;++b)for(e.SolveVelocityConstraints(),c=0;c<this.m_jointCount;++c)this.m_joints[c].SolveVelocityConstraints(a);for(b=0;b<this.m_bodyCount;++b){var f=this.m_bodies[b];if(f.GetType()!==d.b2_staticBody){var g=a.dt*f.m_linearVelocity.x,h=a.dt*f.m_linearVelocity.y;g*g+h*h>Fb.b2_maxTranslationSquared&&(f.m_linearVelocity.Normalize(),f.m_linearVelocity.x*=Fb.b2_maxTranslation*a.inv_dt,f.m_linearVelocity.y*=Fb.b2_maxTranslation*a.inv_dt);var i=a.dt*f.m_angularVelocity;i*i>Fb.b2_maxRotationSquared&&(f.m_angularVelocity=f.m_angularVelocity<0?-Fb.b2_maxRotation*a.inv_dt:Fb.b2_maxRotation*a.inv_dt),f.m_sweep.c0.SetV(f.m_sweep.c),f.m_sweep.a0=f.m_sweep.a,f.m_sweep.c.x+=a.dt*f.m_linearVelocity.x,f.m_sweep.c.y+=a.dt*f.m_linearVelocity.y,f.m_sweep.a+=a.dt*f.m_angularVelocity,f.SynchronizeTransform()}}var j=.75;for(b=0;b<a.positionIterations;++b){var k=e.SolvePositionConstraints(j),l=!0;for(c=0;c<this.m_jointCount;++c){var m=this.m_joints[c].SolvePositionConstraints(Fb.b2_contactBaumgarte);l=l&&m}if(k&&l)break}this.Report(e.m_constraints)},Report:function(a){if(null!=this.m_listener)for(var b=0;b<this.m_contactCount;++b){for(var c=this.m_contacts[b],d=a[b],e=0;e<d.pointCount;++e)_.s_impulse.normalImpulses[e]=d.points[e].normalImpulse,_.s_impulse.tangentImpulses[e]=d.points[e].tangentImpulse;this.m_listener.PostSolve(c,_.s_impulse)}},AddBody:function(a){a.m_islandIndex=this.m_bodyCount,this.m_bodies[this.m_bodyCount++]=a},AddContact:function(a){this.m_contacts[this.m_contactCount++]=a},AddJoint:function(a){this.m_joints[this.m_jointCount++]=a}},Ub=Xb.Dynamics.b2World=function(a,b){this.m_stack=[],this.m_contactManager=new x,this.m_contactSolver=new B,this.m_island=new _,this.m_allowSleep=b,this.m_gravity=a,this.m_contactManager.m_world=this;var c=new e;this.m_groundBody=this.CreateBody(c)},Ub.s_timestep2=new Ob,Ub.s_xf=new Pb,Ub.s_backupA=new Kb,Ub.s_backupB=new Kb,Ub.s_timestep=new Ob,Ub.s_queue=[],Ub.s_jointColor=new l(.5,.8,.8),Ub.e_newFixture=1,Ub.e_locked=2,Ub.constructor=Ub,Ub.prototype={m_stack:null,m_contactManager:null,m_contactSolver:null,m_island:null,m_destructionListener:null,m_debugDraw:null,m_bodyList:null,m_contactList:null,m_jointList:null,m_controllerList:null,m_bodyCount:0,m_contactCount:0,m_jointCount:0,m_controllerCount:0,m_allowSleep:null,m_gravity:null,m_inv_dt0:0,m_groundBody:null,m_warmStarting:!0,m_continuousPhysics:!0,SetDestructionListener:function(a){this.m_destructionListener=a},SetContactFilter:function(a){this.m_contactManager.m_contactFilter=a},SetContactListener:function(a){this.m_contactManager.m_contactListener=a},SetDebugDraw:function(a){this.m_debugDraw=a},SetBroadPhase:function(a){var b=this.m_contactManager.m_broadPhase;this.m_contactManager.m_broadPhase=a;for(var c=this.m_bodyList;c;c=c.m_next)for(var d=c.m_fixtureList;d;d=d.m_next)d.m_proxy=a.CreateProxy(b.GetFatAABB(d.m_proxy),d)},Validate:function(){this.m_contactManager.m_broadPhase.Validate()},GetProxyCount:function(){return this.m_contactManager.m_broadPhase.GetProxyCount()},CreateBody:function(a){if(this.IsLocked()===!0)return null;var b=new d(a,this);return b.m_prev=null,b.m_next=this.m_bodyList,this.m_bodyList&&(this.m_bodyList.m_prev=b),this.m_bodyList=b,++this.m_bodyCount,b},DestroyBody:function(a){if(this.IsLocked()!==!0){for(var b=a.m_jointList;b;){var c=b;b=b.next,this.m_destructionListener&&this.m_destructionListener.SayGoodbyeJoint(c.joint),this.DestroyJoint(c.joint)}for(var d=a.m_controllerList;d;){var e=d;d=d.nextController,e.controller.RemoveBody(a)}for(var f=a.m_contactList;f;){var g=f;f=f.next,this.m_contactManager.Destroy(g.contact)}a.m_contactList=null;for(var h=a.m_fixtureList;h;){var i=h;h=h.m_next,this.m_destructionListener&&this.m_destructionListener.SayGoodbyeFixture(i),i.DestroyProxy(this.m_contactManager.m_broadPhase),i.Destroy()}a.m_fixtureList=null,a.m_fixtureCount=0,a.m_prev&&(a.m_prev.m_next=a.m_next),a.m_next&&(a.m_next.m_prev=a.m_prev),a===this.m_bodyList&&(this.m_bodyList=a.m_next),--this.m_bodyCount}},CreateJoint:function(a){var b=bb.Create(a,null);b.m_prev=null,b.m_next=this.m_jointList,this.m_jointList&&(this.m_jointList.m_prev=b),this.m_jointList=b,++this.m_jointCount,b.m_edgeA.joint=b,b.m_edgeA.other=b.m_bodyB,b.m_edgeA.prev=null,b.m_edgeA.next=b.m_bodyA.m_jointList,b.m_bodyA.m_jointList&&(b.m_bodyA.m_jointList.prev=b.m_edgeA),b.m_bodyA.m_jointList=b.m_edgeA,b.m_edgeB.joint=b,b.m_edgeB.other=b.m_bodyA,b.m_edgeB.prev=null,b.m_edgeB.next=b.m_bodyB.m_jointList,b.m_bodyB.m_jointList&&(b.m_bodyB.m_jointList.prev=b.m_edgeB),b.m_bodyB.m_jointList=b.m_edgeB;var c=a.bodyA,d=a.bodyB;if(a.collideConnected===!1)for(var e=d.GetContactList();e;)e.other===c&&e.contact.FlagForFiltering(),e=e.next;return b},DestroyJoint:function(a){var b=a.m_collideConnected;a.m_prev&&(a.m_prev.m_next=a.m_next),a.m_next&&(a.m_next.m_prev=a.m_prev),a===this.m_jointList&&(this.m_jointList=a.m_next);var c=a.m_bodyA,d=a.m_bodyB;if(c.SetAwake(!0),d.SetAwake(!0),a.m_edgeA.prev&&(a.m_edgeA.prev.next=a.m_edgeA.next),a.m_edgeA.next&&(a.m_edgeA.next.prev=a.m_edgeA.prev),a.m_edgeA===c.m_jointList&&(c.m_jointList=a.m_edgeA.next),a.m_edgeA.prev=null,a.m_edgeA.next=null,a.m_edgeB.prev&&(a.m_edgeB.prev.next=a.m_edgeB.next),a.m_edgeB.next&&(a.m_edgeB.next.prev=a.m_edgeB.prev),a.m_edgeB===d.m_jointList&&(d.m_jointList=a.m_edgeB.next),a.m_edgeB.prev=null,a.m_edgeB.next=null,bb.Destroy(a,null),--this.m_jointCount,b===!1)for(var e=d.GetContactList();e;)e.other===c&&e.contact.FlagForFiltering(),e=e.next},AddController:function(a){return a.m_next=this.m_controllerList,a.m_prev=null,this.m_controllerList=a,a.m_world=this,this.m_controllerCount++,a},RemoveController:function(a){a.m_prev&&(a.m_prev.m_next=a.m_next),a.m_next&&(a.m_next.m_prev=a.m_prev),this.m_controllerList===a&&(this.m_controllerList=a.m_next),this.m_controllerCount--},CreateController:function(a){if(a.m_world!==this)throw new Error("Controller can only be a member of one world");return a.m_next=this.m_controllerList,a.m_prev=null,this.m_controllerList&&(this.m_controllerList.m_prev=a),this.m_controllerList=a,++this.m_controllerCount,a.m_world=this,a},DestroyController:function(a){a.Clear(),a.m_next&&(a.m_next.m_prev=a.m_prev),a.m_prev&&(a.m_prev.m_next=a.m_next),a===this.m_controllerList&&(this.m_controllerList=a.m_next),--this.m_controllerCount},SetWarmStarting:function(a){this.m_warmStarting=a},SetContinuousPhysics:function(a){this.m_continuousPhysics=a},GetBodyCount:function(){return this.m_bodyCount},GetJointCount:function(){return this.m_jointCount},GetContactCount:function(){return this.m_contactCount},SetGravity:function(a){this.m_gravity=a},GetGravity:function(){return this.m_gravity},GetGroundBody:function(){return this.m_groundBody},Step:function(a,b,c){a=a||0,b=b||0,c=c||0,this.m_flags&Ub.e_newFixture&&(this.m_contactManager.FindNewContacts(),this.m_flags&=~Ub.e_newFixture),this.m_flags|=Ub.e_locked;var d=Ub.s_timestep2;d.dt=a,d.velocityIterations=b,d.positionIterations=c,d.inv_dt=a>0?1/a:0,d.dtRatio=this.m_inv_dt0*a,d.warmStarting=this.m_warmStarting,this.m_contactManager.Collide(),d.dt>0&&this.Solve(d),this.m_continuousPhysics&&d.dt>0&&this.SolveTOI(d),d.dt>0&&(this.m_inv_dt0=d.inv_dt),this.m_flags&=~Ub.e_locked},ClearForces:function(){for(var a=this.m_bodyList;a;a=a.m_next)a.m_force.SetZero(),a.m_torque=0},DrawDebugData:function(){if(null!=this.m_debugDraw){this.m_debugDraw.m_sprite.graphics.clear();var a,b,e,f,g,h,i=this.m_debugDraw.GetFlags(),j=(new Qb,new Qb,new Qb,new c,new c,[new Qb(0,0),new Qb(0,0),new Qb(0,0),new Qb(0,0)]),k=new l(0,0,0);if(i&E.e_shapeBit)for(a=this.m_bodyList;a;a=a.m_next)for(h=a.m_xf,b=a.GetFixtureList();b;b=b.m_next)e=b.GetShape(),a.IsActive()===!1?(k.Set(.5,.5,.3),this.DrawShape(e,h,k)):a.GetType()===d.b2_staticBody?(k.Set(.5,.9,.5),this.DrawShape(e,h,k)):a.GetType()===d.b2_kinematicBody?(k.Set(.5,.5,.9),this.DrawShape(e,h,k)):a.IsAwake()===!1?(k.Set(.6,.6,.6),this.DrawShape(e,h,k)):(k.Set(.9,.7,.7),this.DrawShape(e,h,k));if(i&E.e_jointBit)for(f=this.m_jointList;f;f=f.m_next)this.DrawJoint(f);if(i&E.e_controllerBit)for(var m=this.m_controllerList;m;m=m.m_next)m.Draw(this.m_debugDraw);if(i&E.e_pairBit){k.Set(.3,.9,.9);for(var n=this.m_contactManager.m_contactList;n;n=n.GetNext()){var o=n.GetFixtureA(),p=n.GetFixtureB(),q=o.GetAABB().GetCenter(),r=p.GetAABB().GetCenter();this.m_debugDraw.DrawSegment(q,r,k)}}if(i&E.e_aabbBit)for(g=this.m_contactManager.m_broadPhase,j=[new Qb(0,0),new Qb(0,0),new Qb(0,0),new Qb(0,0)],a=this.m_bodyList;a;a=a.GetNext())if(a.IsActive()!==!1)for(b=a.GetFixtureList();b;b=b.GetNext()){var s=g.GetFatAABB(b.m_proxy);j[0].Set(s.lowerBound.x,s.lowerBound.y),j[1].Set(s.upperBound.x,s.lowerBound.y),j[2].Set(s.upperBound.x,s.upperBound.y),j[3].Set(s.lowerBound.x,s.upperBound.y),this.m_debugDraw.DrawPolygon(j,4,k)}if(i&E.e_centerOfMassBit)for(a=this.m_bodyList;a;a=a.m_next)h=Ub.s_xf,h.R=a.m_xf.R,h.position=a.GetWorldCenter(),this.m_debugDraw.DrawTransform(h)}},QueryAABB:function(a,b){function c(b){return a(e.GetUserData(b))}var d=this,e=d.m_contactManager.m_broadPhase;e.Query(c,b)},QueryShape:function(a,b,d){function e(c){var e=g.GetUserData(c)instanceof U?g.GetUserData(c):null;return Gb.TestOverlap(b,d,e.GetShape(),e.GetBody().GetTransform())?a(e):!0}var f=this;d=d||null,null==d&&(d=new Pb,d.SetIdentity());var g=f.m_contactManager.m_broadPhase,h=new c;b.ComputeAABB(h,d),g.Query(e,h)},QueryPoint:function(a,b){function d(c){var d=f.GetUserData(c)instanceof U?f.GetUserData(c):null;return d.TestPoint(b)?a(d):!0}var e=this,f=e.m_contactManager.m_broadPhase,g=new c;g.lowerBound.Set(b.x-Fb.b2_linearSlop,b.y-Fb.b2_linearSlop),g.upperBound.Set(b.x+Fb.b2_linearSlop,b.y+Fb.b2_linearSlop),f.Query(d,g)},RayCast:function(a,b,c){function d(d,e){var h=f.GetUserData(e),i=h instanceof U?h:null,j=i.RayCast(g,d);if(j){var k=g.fraction,l=new Qb((1-k)*b.x+k*c.x,(1-k)*b.y+k*c.y);return a(i,l,g.normal,k)}return d.maxFraction}var e=this,f=e.m_contactManager.m_broadPhase,g=new Ab,h=new zb(b,c);f.RayCast(d,h)},RayCastOne:function(a,b){function c(a,b,c,e){return e=e||0,d=a,e}var d,e=this;return e.RayCast(c,a,b),d},RayCastAll:function(a,b){function c(a,b,c,d){return d=d||0,e[e.length]=a,1}var d=this,e=[];return d.RayCast(c,a,b),e},GetBodyList:function(){return this.m_bodyList},GetJointList:function(){return this.m_jointList},GetContactList:function(){return this.m_contactList},IsLocked:function(){return(this.m_flags&Ub.e_locked)>0},Solve:function(a){for(var b,c=this.m_controllerList;c;c=c.m_next)c.Step(a);var e=this.m_island;for(e.Initialize(this.m_bodyCount,this.m_contactCount,this.m_jointCount,null,this.m_contactManager.m_contactListener,this.m_contactSolver),b=this.m_bodyList;b;b=b.m_next)b.m_flags&=~d.e_islandFlag;for(var f=this.m_contactList;f;f=f.m_next)f.m_flags&=~o.e_islandFlag;for(var g=this.m_jointList;g;g=g.m_next)g.m_islandFlag=!1;for(var h=(this.m_bodyCount,this.m_stack),i=this.m_bodyList;i;i=i.m_next)if(!(i.m_flags&d.e_islandFlag)&&i.IsAwake()!==!1&&i.IsActive()!==!1&&i.GetType()!==d.b2_staticBody){e.Clear();var j=0;for(h[j++]=i,i.m_flags|=d.e_islandFlag;j>0;)if(b=h[--j],e.AddBody(b),b.IsAwake()===!1&&b.SetAwake(!0),b.GetType()!==d.b2_staticBody){for(var k,l=b.m_contactList;l;l=l.next)l.contact.m_flags&o.e_islandFlag||l.contact.IsSensor()!==!0&&l.contact.IsEnabled()!==!1&&l.contact.IsTouching()!==!1&&(e.AddContact(l.contact),l.contact.m_flags|=o.e_islandFlag,k=l.other,k.m_flags&d.e_islandFlag||(h[j++]=k,k.m_flags|=d.e_islandFlag));
for(var m=b.m_jointList;m;m=m.next)m.joint.m_islandFlag!==!0&&(k=m.other,k.IsActive()!==!1&&(e.AddJoint(m.joint),m.joint.m_islandFlag=!0,k.m_flags&d.e_islandFlag||(h[j++]=k,k.m_flags|=d.e_islandFlag)))}e.Solve(a,this.m_gravity,this.m_allowSleep);for(var n=0;n<e.m_bodyCount;++n)b=e.m_bodies[n],b.GetType()===d.b2_staticBody&&(b.m_flags&=~d.e_islandFlag)}for(n=0;n<h.length&&h[n];++n)h[n]=null;for(b=this.m_bodyList;b;b=b.m_next)b.IsAwake()!==!1&&b.IsActive()!==!1&&b.GetType()!==d.b2_staticBody&&b.SynchronizeFixtures();this.m_contactManager.FindNewContacts()},SolveTOI:function(a){var b,c,e,f,g,h,i,j=this.m_island;j.Initialize(this.m_bodyCount,Fb.b2_maxTOIContactsPerIsland,Fb.b2_maxTOIJointsPerIsland,null,this.m_contactManager.m_contactListener,this.m_contactSolver);var k=Ub.s_queue;for(b=this.m_bodyList;b;b=b.m_next)b.m_flags&=~d.e_islandFlag,b.m_sweep.t0=0;var l;for(l=this.m_contactList;l;l=l.m_next)l.m_flags&=~(o.e_toiFlag|o.e_islandFlag);for(i=this.m_jointList;i;i=i.m_next)i.m_islandFlag=!1;for(;;){var m=null,n=1;for(l=this.m_contactList;l;l=l.m_next)if(l.IsSensor()!==!0&&l.IsEnabled()!==!1&&l.IsContinuous()!==!1){var p=1;if(l.m_flags&o.e_toiFlag)p=l.m_toi;else{if(c=l.m_fixtureA,e=l.m_fixtureB,f=c.m_body,g=e.m_body,!(f.GetType()===d.b2_dynamicBody&&f.IsAwake()!==!1||g.GetType()===d.b2_dynamicBody&&g.IsAwake()!==!1))continue;var q=f.m_sweep.t0;f.m_sweep.t0<g.m_sweep.t0?(q=g.m_sweep.t0,f.m_sweep.Advance(q)):g.m_sweep.t0<f.m_sweep.t0&&(q=f.m_sweep.t0,g.m_sweep.Advance(q)),p=l.ComputeTOI(f.m_sweep,g.m_sweep),Wb(p>=0&&1>=p),p>0&&1>p&&(p=(1-p)*q+p,p>1&&(p=1)),l.m_toi=p,l.m_flags|=o.e_toiFlag}Fb.b2_epsilon<p&&n>p&&(m=l,n=p)}if(null==m||1-100*Fb.b2_epsilon<n)break;if(c=m.m_fixtureA,e=m.m_fixtureB,f=c.m_body,g=e.m_body,Ub.s_backupA.Set(f.m_sweep),Ub.s_backupB.Set(g.m_sweep),f.Advance(n),g.Advance(n),m.Update(this.m_contactManager.m_contactListener),m.m_flags&=~o.e_toiFlag,m.IsSensor()!==!0&&m.IsEnabled()!==!1){if(m.IsTouching()!==!1){var r=f;r.GetType()!==d.b2_dynamicBody&&(r=g),j.Clear();var s=0,t=0;for(k[s+t++]=r,r.m_flags|=d.e_islandFlag;t>0;)if(b=k[s++],--t,j.AddBody(b),b.IsAwake()===!1&&b.SetAwake(!0),b.GetType()===d.b2_dynamicBody){for(h=b.m_contactList;h&&j.m_contactCount!==j.m_contactCapacity;h=h.next)if(!(h.contact.m_flags&o.e_islandFlag)&&h.contact.IsSensor()!==!0&&h.contact.IsEnabled()!==!1&&h.contact.IsTouching()!==!1){j.AddContact(h.contact),h.contact.m_flags|=o.e_islandFlag;var u=h.other;u.m_flags&d.e_islandFlag||(u.GetType()!==d.b2_staticBody&&(u.Advance(n),u.SetAwake(!0)),k[s+t]=u,++t,u.m_flags|=d.e_islandFlag)}for(var v=b.m_jointList;v;v=v.next)j.m_jointCount!==j.m_jointCapacity&&v.joint.m_islandFlag!==!0&&(u=v.other,u.IsActive()!==!1&&(j.AddJoint(v.joint),v.joint.m_islandFlag=!0,u.m_flags&d.e_islandFlag||(u.GetType()!==d.b2_staticBody&&(u.Advance(n),u.SetAwake(!0)),k[s+t]=u,++t,u.m_flags|=d.e_islandFlag)))}var w=Ub.s_timestep;w.warmStarting=!1,w.dt=(1-n)*a.dt,w.inv_dt=1/w.dt,w.dtRatio=0,w.velocityIterations=a.velocityIterations,w.positionIterations=a.positionIterations,j.SolveTOI(w);var x=0;for(x=0;x<j.m_bodyCount;++x)if(b=j.m_bodies[x],b.m_flags&=~d.e_islandFlag,b.IsAwake()!==!1&&b.GetType()===d.b2_dynamicBody)for(b.SynchronizeFixtures(),h=b.m_contactList;h;h=h.next)h.contact.m_flags&=~o.e_toiFlag;for(x=0;x<j.m_contactCount;++x)l=j.m_contacts[x],l.m_flags&=~(o.e_toiFlag|o.e_islandFlag);for(x=0;x<j.m_jointCount;++x)i=j.m_joints[x],i.m_islandFlag=!1;this.m_contactManager.FindNewContacts()}}else f.m_sweep.Set(Ub.s_backupA),g.m_sweep.Set(Ub.s_backupB),f.SynchronizeTransform(),g.SynchronizeTransform()}},DrawJoint:function(a){var b=a.GetBodyA(),c=a.GetBodyB(),d=b.m_xf,e=c.m_xf,f=d.position,g=e.position,h=a.GetAnchorA(),i=a.GetAnchorB(),j=Ub.s_jointColor;switch(a.m_type){case bb.e_distanceJoint:this.m_debugDraw.DrawSegment(h,i,j);break;case bb.e_pulleyJoint:var k=a instanceof xb?a:null,l=k.GetGroundAnchorA(),m=k.GetGroundAnchorB();this.m_debugDraw.DrawSegment(l,h,j),this.m_debugDraw.DrawSegment(m,i,j),this.m_debugDraw.DrawSegment(l,m,j);break;case bb.e_mouseJoint:this.m_debugDraw.DrawSegment(h,i,j);break;default:b!==this.m_groundBody&&this.m_debugDraw.DrawSegment(f,h,j),this.m_debugDraw.DrawSegment(h,i,j),c!==this.m_groundBody&&this.m_debugDraw.DrawSegment(g,i,j)}},DrawShape:function(a,b,c){switch(a.m_type){case Gb.e_circleShape:var d=a instanceof j?a:null,e=lb.MulX(b,d.m_p),f=d.m_radius,g=b.R.col1;this.m_debugDraw.DrawSolidCircle(e,f,g,c);break;case Gb.e_polygonShape:var h=0,i=a instanceof tb?a:null,k=i.GetVertexCount(),l=i.GetVertices(),m=[];for(h=0;k>h;++h)m.push(lb.MulX(b,l[h]));this.m_debugDraw.DrawSolidPolygon(m,k,c);break;case Gb.e_edgeShape:var n=a instanceof S?a:null;this.m_debugDraw.DrawSegment(lb.MulX(b,n.GetVertex1()),lb.MulX(b,n.GetVertex2()),c)}}},F=Xb.Dynamics.b2DestructionListener=function(){},F.constructor=F,F.prototype={SayGoodbyeJoint:function(){},SayGoodbyeFixture:function(){}},Xb}.call(this);"undefined"!=typeof module&&(module.exports=Box2D);